<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#1e3a5f">
  <title>{% block title %}LLM Chat{% endblock %}</title>

  <!-- Shared Styles -->
  <link rel="stylesheet" href="/static/design-tokens.css?v={{ design_tokens_css }}">
  <link rel="stylesheet" href="/static/reset.css?v={{ reset_css }}">
  <link rel="stylesheet" href="/static/typography.css?v={{ typography_css }}">
  <link rel="stylesheet" href="/static/layout.css?v={{ layout_css }}">
  <link rel="stylesheet" href="/static/components/navigation.css?v={{ navigation_css }}">
  <link rel="stylesheet" href="/static/components/buttons.css?v={{ buttons_css }}">
  <link rel="stylesheet" href="/static/components/cards.css?v={{ cards_css }}">
  <link rel="stylesheet" href="/static/components/forms.css?v={{ forms_css }}">
  <link rel="stylesheet" href="/static/components/badges.css?v={{ badges_css }}">
  <link rel="stylesheet" href="/static/components/model-selector.css?v={{ model_selector_css }}">
  <link rel="stylesheet" href="/static/components/modals.css?v={{ modals_css }}">
  <link rel="stylesheet" href="/static/common.css?v={{ common_css }}">
  <!-- KaTeX for LaTeX rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  {% block extra_css %}{% endblock %}

  <!-- Shared Scripts -->
  <script defer src="/static/settings.js?v={{ settings_js }}"></script>
  <!-- KaTeX for LaTeX rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script defer src="/static/content-formatter.js?v={{ content_formatter_js }}"></script>
  <script>
    // Smart dropdown positioning utility
    document.addEventListener('DOMContentLoaded', function () {
      const dropdowns = document.querySelectorAll('.mode-dropdown');

      dropdowns.forEach(dropdown => {
        const trigger = dropdown.querySelector('.dropdown-trigger');
        const menu = dropdown.querySelector('.dropdown-menu');

        if (!trigger || !menu) return;

        // Position dropdown intelligently based on available space
        const positionDropdown = () => {
          // Reset positioning class
          menu.classList.remove('open-above');

          // Use requestAnimationFrame to ensure accurate measurements
          requestAnimationFrame(() => {
            const triggerRect = trigger.getBoundingClientRect();
            const viewportHeight = window.innerHeight;

            // Get actual menu height if visible, otherwise estimate
            let menuHeight = menu.offsetHeight || 200;

            // Calculate space above and below the trigger
            const spaceBelow = viewportHeight - triggerRect.bottom - 8; // 8px margin
            const spaceAbove = triggerRect.top - 8; // 8px margin

            // If not enough space below but more space above, open above
            if (spaceBelow < menuHeight && spaceAbove > spaceBelow) {
              menu.classList.add('open-above');
            }
          });
        };

        // Trigger positioning on interaction events
        dropdown.addEventListener('mouseenter', positionDropdown);
        dropdown.addEventListener('focusin', positionDropdown);

        // Reposition on window resize/scroll
        let resizeTimeout;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(positionDropdown, 100);
        });

        window.addEventListener('scroll', positionDropdown, { passive: true });
      });
    });
  </script>
  {% block extra_js %}{% endblock %}
</head>

<body>
  <header>
    <div class="logo">
      <div class="logo-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path
            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
          </path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
      </div>
      <div class="logo-text">
        <span class="logo-title">Serverless LLM</span>
        <span class="logo-subtitle">{% block subtitle %}Compare AI Models{% endblock %}</span>
      </div>
    </div>

    <div class="header-actions">
      <nav class="modes">
        <a href="/" class="mode-link {% if request.url.path == '/' %}active{% endif %}">
          Chat
        </a>

        <a href="/playground" class="mode-link {% if request.url.path == '/playground' %}active{% endif %}">
          Arena <span style="background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; font-size: 9px; font-weight: 600; padding: 2px 5px; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; margin-left: 6px;">New</span>
        </a>

        <!-- Lab (Experimental Modes) Dropdown -->
        <div class="mode-dropdown">
          <button
            class="mode-link dropdown-trigger {% if request.url.path in ['/autogen', '/variations', '/confessions'] %}active{% endif %}">
            Lab
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              style="margin-left: 4px;">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="dropdown-menu">
            <a href="/autogen" class="dropdown-item {% if request.url.path == '/autogen' %}active{% endif %}">
              <div class="dropdown-item-content">
                <span class="dropdown-item-title">Agents</span>
                <span class="dropdown-item-desc">Tool-using orchestration</span>
              </div>
            </a>
            <a href="/variations" class="dropdown-item {% if request.url.path == '/variations' %}active{% endif %}">
              <div class="dropdown-item-content">
                <span class="dropdown-item-title">Variations</span>
                <span class="dropdown-item-desc">Verbalized sampling</span>
              </div>
            </a>
            <a href="/confessions" class="dropdown-item {% if request.url.path == '/confessions' %}active{% endif %}">
              <div class="dropdown-item-content">
                <span class="dropdown-item-title">Confessions</span>
                <span class="dropdown-item-desc">Honesty reports</span>
              </div>
            </a>
          </div>
        </div>
      </nav>

      <div class="header-controls">
        <button id="statusBtn" class="icon-btn" title="System Status" onclick="window.location.href='/status'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
          </svg>
        </button>
        <button id="settingsBtn" class="icon-btn" title="Settings" data-settings-trigger>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
            </path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main>
    {% block content %}{% endblock %}
  </main>

</body>

</html>