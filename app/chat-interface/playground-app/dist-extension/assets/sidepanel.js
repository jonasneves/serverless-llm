import{c as f,r as l,j as e,R as S,S as M,i as R,n as K,g as X,h as J}from"./index.js";import{P as Q,S as Y,A as P}from"./settings.js";import{S as Z}from"./server.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],W=f("circle-alert",ee);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],T=f("circle-check-big",te);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],I=f("circle-x",se);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],q=f("clock",ae);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ne=f("external-link",le);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],re=f("eye-off",oe);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ie=f("eye",ce);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],z=f("globe",de);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],V=f("rocket",me),U="jonasneves",L="serverless-llm",F=[{name:"Chat",path:"chat-interface.yml"},{name:"Build Images",path:"build-push-images.yml"}];function G(n){return n.trim().replace(/\/+$/,"")}function he(n){try{return new URL(n).host}catch{return n}}const xe=({githubToken:n,chatApiBaseUrl:h})=>{const[a,i]=l.useState(new Map),[E,A]=l.useState(new Map),[x,y]=l.useState(!0),[B,k]=l.useState(null),[d,w]=l.useState(null),[b,m]=l.useState("checking"),N={Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json","X-GitHub-Api-Version":"2022-11-28"},H=l.useCallback(async()=>{m("checking");try{const s=G(h)||"http://localhost:8080",o=await fetch(`${s}/health`,{method:"GET",mode:"cors",credentials:"omit",signal:AbortSignal.timeout(5e3)});m(o.ok?"ok":"down")}catch(s){console.log("Health check failed:",s),m("down")}},[h]),$=l.useCallback(async()=>{if(!n){k("GitHub token required"),y(!1);return}try{const s=await fetch(`https://api.github.com/repos/${U}/${L}/actions/workflows`,{headers:N});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);const o=await s.json(),r=new Map;for(const u of o.workflows){const p=F.find(g=>u.path.endsWith(g.path));p&&r.set(p.name,{id:u.id,name:p.name,path:u.path})}return i(r),r}catch(s){return k(s.message),null}},[n]),v=l.useCallback(async s=>{const o=s||a;if(o.size===0)return;const r=new Map;await Promise.all(Array.from(o.entries()).map(async([u,p])=>{try{const g=await fetch(`https://api.github.com/repos/${U}/${L}/actions/workflows/${p.id}/runs?per_page=1`,{headers:N});if(g.ok){const D=await g.json();if(D.workflow_runs&&D.workflow_runs.length>0){const j=D.workflow_runs[0];r.set(u,{id:j.id,name:j.name,status:j.status,conclusion:j.conclusion,created_at:j.created_at,updated_at:j.updated_at,html_url:j.html_url})}else r.set(u,null)}}catch{r.set(u,null)}})),A(r),y(!1)},[a,n]),C=async s=>{const o=a.get(s);if(!(!o||!n)){w(s);try{const r=await fetch(`https://api.github.com/repos/${U}/${L}/actions/workflows/${o.id}/dispatches`,{method:"POST",headers:{...N,"Content-Type":"application/json"},body:JSON.stringify({ref:"main",...s==="Build Images"&&{inputs:{models:"chat-interface"}}})});if(!r.ok&&r.status!==204)throw new Error(`Failed to trigger: ${r.status}`);setTimeout(()=>{v(),w(null)},2e3)}catch(r){console.error("Failed to trigger workflow:",r),w(null)}}},_=l.useCallback(async()=>{y(!0),k(null);const s=await $();s&&await v(s),await H(),y(!1)},[$,v,H]);l.useEffect(()=>{_();const s=setInterval(_,3e4);return()=>clearInterval(s)},[n]);const t=s=>s?s.status==="in_progress"||s.status==="queued"?e.jsx(S,{className:"w-4 h-4 text-yellow-400 animate-spin"}):s.conclusion==="success"?e.jsx(T,{className:"w-4 h-4 text-green-500"}):s.conclusion==="failure"?e.jsx(I,{className:"w-4 h-4 text-red-500"}):e.jsx(q,{className:"w-4 h-4 text-gray-400"}):e.jsx(q,{className:"w-4 h-4 text-gray-400"}),c=s=>{const o=new Date(s),u=new Date().getTime()-o.getTime(),p=Math.floor(u/6e4);if(p<1)return"just now";if(p<60)return`${p}m ago`;const g=Math.floor(p/60);return g<24?`${g}h ago`:o.toLocaleDateString()};return n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Deployments"]}),e.jsxs("button",{onClick:_,disabled:x,className:"text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(S,{className:`w-3 h-3 ${x?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-slate-800/50 border border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[b==="ok"&&e.jsx(T,{className:"w-4 h-4 text-green-500"}),b==="down"&&e.jsx(I,{className:"w-4 h-4 text-red-500"}),b==="checking"&&e.jsx(S,{className:"w-4 h-4 text-gray-400 animate-spin"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Backend"})]}),e.jsx("span",{className:"text-xs text-slate-500",children:he(G(h)||"http://localhost:8080")})]})}),B&&e.jsx("div",{className:"p-3 rounded-lg bg-red-900/20 border border-red-700/50 text-red-400 text-xs",children:B}),e.jsx("div",{className:"space-y-2",children:F.map(s=>{const o=E.get(s.name),r=d===s.name;return e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t(o??null),e.jsx("span",{className:"text-sm font-medium text-slate-200",children:s.name})]}),o&&e.jsx("a",{href:o.html_url,target:"_blank",rel:"noopener noreferrer",className:"text-slate-400 hover:text-white transition-colors",title:"View on GitHub",children:e.jsx(ne,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-500",children:o?c(o.updated_at):"No runs"}),e.jsxs("button",{onClick:()=>C(s.name),disabled:r||x,className:`flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors ${r?"bg-slate-700 text-slate-400":"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30"}`,children:[r?e.jsx(S,{className:"w-3 h-3 animate-spin"}):e.jsx(Q,{className:"w-3 h-3"}),r?"Triggering...":"Deploy"]})]})]},s.name)})}),e.jsxs("div",{className:"pt-3 border-t border-slate-700/50",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>C("Chat"),disabled:d==="Chat"||x,className:"px-3 py-2 text-xs bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600/30 rounded transition-colors",children:"ðŸš€ Redeploy Chat"}),e.jsx("button",{onClick:()=>C("Build Images"),disabled:d==="Build Images"||x,className:"px-3 py-2 text-xs bg-purple-600/20 text-purple-400 hover:bg-purple-600/30 rounded transition-colors",children:"ðŸ”¨ Rebuild Images"})]})]})]}):e.jsxs("div",{className:"p-4 text-center text-slate-400",children:[e.jsx(W,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Configure GitHub token in Settings to use deployments"})]})},O={githubToken:"",profile:"local_all",chatApiBaseUrl:"http://localhost:8080",modelsBaseDomain:"",modelsUseHttps:!1};function pe(n,h){const a={};for(const i of M)a[i.key]=R(i.key,i.localPort,n,h);return a}const ue=()=>{const[n,h]=l.useState([]),[a,i]=l.useState(O),[E,A]=l.useState(!1),[x,y]=l.useState(!1),[B,k]=l.useState(new Date),[d,w]=l.useState("deployments"),b=l.useCallback(t=>M.map(c=>({key:c.key,name:c.name,endpoint:R(c.key,c.localPort,t.modelsBaseDomain,t.modelsUseHttps),status:"checking"})),[]),m=l.useCallback(async t=>{k(new Date);const c=await Promise.all(t.map(async s=>{try{const o=await fetch(`${s.endpoint}/health`,{method:"GET",signal:AbortSignal.timeout(3e3)});return{...s,status:o.ok?"ok":"down"}}catch{return{...s,status:"down"}}}));h(c)},[]);l.useEffect(()=>{chrome.storage.local.get(["envConfig"],t=>{const c=K(t.envConfig||O);i(c);const s=b(c);h(s),d==="services"&&setTimeout(()=>m(s),500)})},[b,m]),l.useEffect(()=>{if(d!=="services")return;const t=setInterval(()=>{h(c=>(c.length>0&&m(c),c))},1e4);return()=>clearInterval(t)},[d,m]);const N=()=>{const t=pe(a.modelsBaseDomain,a.modelsUseHttps),c={...a,qwenEndpoint:t.qwen,phiEndpoint:t.phi,llamaEndpoint:t.llama,mistralEndpoint:t.mistral,gemmaEndpoint:t.gemma,r1qwenEndpoint:t.r1qwen,rnjEndpoint:t.rnj};chrome.storage.local.set({envConfig:c},()=>{const s=b(a);h(s),d==="services"&&m(s)})},H=()=>{chrome.tabs.create({url:chrome.runtime.getURL("index.html")})},$=t=>t==="ok"?e.jsx(T,{className:"w-4 h-4 text-green-500"}):t==="down"?e.jsx(W,{className:"w-4 h-4 text-red-500"}):e.jsx(S,{className:"w-4 h-4 text-gray-400 animate-spin"}),v=n.filter(t=>t.status==="ok").length,C=!!a.modelsBaseDomain,_=t=>{if(t==="remote_all"){i({...a,profile:t,chatApiBaseUrl:"https://chat.neevs.io",modelsBaseDomain:"neevs.io",modelsUseHttps:!0});return}if(t==="local_chat_remote_models"){i({...a,profile:t,chatApiBaseUrl:"http://localhost:8080",modelsBaseDomain:"neevs.io",modelsUseHttps:!0});return}if(t==="local_all"){i({...a,profile:t,chatApiBaseUrl:"http://localhost:8080",modelsBaseDomain:"",modelsUseHttps:!1});return}i({...a,profile:"custom"})};return e.jsxs("div",{className:"p-4 bg-slate-900 text-white min-h-screen font-sans",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Server Controls"]}),e.jsx("button",{onClick:()=>A(!E),className:"p-2 hover:bg-slate-800 rounded transition-colors",title:"Settings",children:e.jsx(Y,{className:"w-4 h-4"})})]}),E?e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Profile"}),e.jsxs("select",{value:a.profile,onChange:t=>_(t.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"remote_all",children:"Remote (hosted)"}),e.jsx("option",{value:"local_chat_remote_models",children:"Local chat + remote models"}),e.jsx("option",{value:"local_all",children:"Local (chat + models)"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-700",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Chat API Base URL"}),e.jsx("input",{type:"text",value:a.chatApiBaseUrl,onChange:t=>i({...a,profile:"custom",chatApiBaseUrl:t.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm focus:outline-none focus:border-blue-500",placeholder:"http://localhost:8080"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Used by the main app streaming API and the Deploy tab health check."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"GitHub Token"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:x?"text":"password",value:a.githubToken,onChange:t=>i({...a,githubToken:t.target.value}),className:"w-full px-3 py-2 pr-10 bg-slate-800 border border-slate-700 rounded text-sm focus:outline-none focus:border-blue-500",placeholder:"github_pat_..."}),e.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-slate-400 hover:text-slate-200 transition-colors",title:x?"Hide token":"Show token",children:x?e.jsx(re,{className:"w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Required for API models & deployments."," ",e.jsx("a",{href:"https://github.com/settings/tokens/new?description=Serverless+LLM+Extension&scopes=repo,workflow&default_expires_at=none",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Create token â†’"})]})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-700",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Models Base Domain"]}),e.jsx("input",{type:"text",value:a.modelsBaseDomain,onChange:t=>i({...a,profile:"custom",modelsBaseDomain:t.target.value.trim()}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm focus:outline-none focus:border-blue-500",placeholder:"neevs.io"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:a.modelsBaseDomain?`Endpoints: ${a.modelsUseHttps?"https":"http"}://[service].${a.modelsBaseDomain}`:"Leave empty for localhost (default ports)"})]}),a.modelsBaseDomain&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"modelsUseHttps",checked:a.modelsUseHttps,onChange:t=>i({...a,profile:"custom",modelsUseHttps:t.target.checked}),className:"w-4 h-4 rounded bg-slate-800 border-slate-700"}),e.jsx("label",{htmlFor:"modelsUseHttps",className:"text-sm text-slate-400",children:"Use HTTPS"})]}),a.modelsBaseDomain&&e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded border border-slate-700/50",children:[e.jsx("p",{className:"text-xs font-medium text-slate-400 mb-2",children:"Endpoint Preview"}),e.jsxs("div",{className:"space-y-1 text-xs text-slate-500 font-mono",children:[M.slice(0,3).map(t=>e.jsx("div",{children:R(t.key,t.localPort,a.modelsBaseDomain,a.modelsUseHttps)},t.key)),e.jsxs("div",{className:"text-slate-600",children:["...and ",M.length-3," more"]})]})]}),e.jsx("button",{onClick:N,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded font-medium transition-colors text-sm",children:"Save Configuration"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex border-b border-slate-700 mb-4",children:[e.jsxs("button",{onClick:()=>w("deployments"),className:`flex items-center gap-1.5 px-3 py-2 text-sm border-b-2 transition-colors ${d==="deployments"?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-white"}`,children:[e.jsx(V,{className:"w-3.5 h-3.5"}),"Deploy"]}),e.jsxs("button",{onClick:()=>{w("services"),m(n)},className:`flex items-center gap-1.5 px-3 py-2 text-sm border-b-2 transition-colors ${d==="services"?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-white"}`,children:[e.jsx(P,{className:"w-3.5 h-3.5"}),"Services"]})]}),d==="deployments"?e.jsx(xe,{githubToken:a.githubToken,chatApiBaseUrl:a.chatApiBaseUrl}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-slate-800/50 border border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-300",children:C?a.modelsBaseDomain:"localhost"})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[v,"/",n.length," online"]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Service Health"]}),e.jsx("button",{onClick:()=>m(n),className:"text-xs text-slate-400 hover:text-white transition-colors",children:"Refresh"})]}),e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-slate-800 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$(t.status),e.jsx("span",{className:"text-sm",children:t.name})]}),e.jsx("span",{className:"text-xs text-slate-500 truncate max-w-[120px]",title:t.endpoint,children:t.endpoint.replace("https://","").replace("http://","")})]},t.key))}),e.jsxs("div",{className:"mt-3 text-xs text-slate-500",children:["Last check: ",B.toLocaleTimeString()]})]})]}),e.jsx("div",{className:"space-y-2 pt-4 border-t border-slate-700/50",children:e.jsx("button",{onClick:H,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded font-medium transition-colors",children:"Open Full App"})})]})]})};X.createRoot(document.getElementById("sidepanel-root")).render(e.jsx(J.StrictMode,{children:e.jsx(ue,{})}));
