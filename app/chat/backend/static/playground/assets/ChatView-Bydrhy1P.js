import{r,j as e,u as ce,v as de,T as ee,S as le,w as Z,U as ue,C as xe,x as me}from"./react-vendor-CWWOLG9R.js";import{F as ne}from"./FormattedContent-BhU9r6Dv.js";import{a as pe,f as fe,s as he,E as ae,P as be}from"./index-C1Wsuuz3.js";import"./markdown-CTxNxC3n.js";import"./math-render-BlIsIJqb.js";import"./syntax-highlight-DYicKOQf.js";function ge(u){const[a,h]=r.useState([]);return r.useEffect(()=>{const C=u.match(/```json\s*([\s\S]*?)\s*```/);if(C)try{let w=C[1];w=w.replace(/[\\']/g,'"').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/}\s*[\\]+\s*$/g,"}").replace(/"\s*"\s*$/g,"").trim();const m=JSON.parse(w);if(m.options&&Array.isArray(m.options)){const p=m.options.filter(d=>d.id&&d.label&&d.value);p.length>0?h(p):h([])}}catch(w){console.error("Failed to parse gesture options:",w),h([])}else h([])},[u]),a}function we(u){return u.replace(/```json[\s\S]*?```/g,"").trim()}const ve=1800;function je({content:u,onSelect:a,isInline:h=!1}){const C=ge(u),[w,m]=r.useState(null),[p,d]=r.useState({}),A=r.useRef(0),x=r.useRef(0);r.useEffect(()=>{const o=$=>{var f;const N=(f=$.detail)==null?void 0:f.target;if(N&&N.hasAttribute("data-gesture-option")){const g=N.getAttribute("data-gesture-option");g&&g!==w&&(m(g),v(g))}else w&&(m(null),j())};return window.addEventListener("gesture-hover",o),()=>{window.removeEventListener("gesture-hover",o),j()}},[w]);const v=o=>{j(),A.current=Date.now();const $=()=>{const N=Date.now()-A.current,f=Math.min(N/ve*100,100);if(d(g=>({...g,[o]:f})),f>=100){const g=C.find(R=>R.id===o);g&&(a(g.value),j())}else x.current=requestAnimationFrame($)};x.current=requestAnimationFrame($)},j=()=>{x.current&&cancelAnimationFrame(x.current),d({})},b=o=>{m(o),v(o)},E=()=>{m(null),j()};if(C.length===0)return null;const k=h?"w-full mt-3":"w-full",l=h?"grid grid-cols-2 gap-2":"flex flex-col gap-2.5",T=o=>h?`relative overflow-hidden rounded-lg font-medium text-xs border transition-all duration-200 text-center min-h-[40px] flex items-center justify-center px-3 py-2 ${o?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`:`relative overflow-hidden rounded-xl font-medium text-sm border transition-all duration-200 w-full text-left min-h-[52px] flex items-center px-4 py-3 ${o?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10 scale-[1.02]":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`;return e.jsxs("div",{className:k,children:[!h&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-1",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider text-slate-400",children:"Quick Actions"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-700/50 to-transparent"})]}),e.jsx("div",{className:l,children:C.map(o=>{const $=p[o.id]||0,N=w===o.id;return e.jsxs("button",{onClick:()=>a(o.value),onMouseEnter:()=>b(o.id),onMouseLeave:E,"data-gesture-option":o.id,className:T(N),children:[N&&$>0&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-blue-400 to-blue-500 transition-all duration-75",style:{width:`${$}%`}}),e.jsx("span",{className:"relative z-10",children:o.label})]},o.id)})})]})}function oe({models:u,selectedModels:a,onToggleModel:h,isGenerating:C,githubToken:w,openrouterKey:m,dropDirection:p="up"}){const[d,A]=r.useState(null),[x,v]=r.useState(""),j=r.useRef(null),b=r.useRef(null),E=r.useMemo(()=>u.filter(s=>s.type==="self-hosted"),[u]),k=r.useMemo(()=>u.filter(s=>s.type==="github"),[u]),l=r.useMemo(()=>u.filter(s=>s.type==="external"),[u]),T=r.useMemo(()=>E.filter(s=>!x||s.name.toLowerCase().includes(x.toLowerCase())),[E,x]),o=r.useMemo(()=>k.filter(s=>!x||s.name.toLowerCase().includes(x.toLowerCase())),[k,x]),$=r.useMemo(()=>l.filter(s=>!x||s.name.toLowerCase().includes(x.toLowerCase())),[l,x]),N=E.filter(s=>a.has(s.id)).length,f=k.filter(s=>a.has(s.id)).length,g=l.filter(s=>a.has(s.id)).length;r.useEffect(()=>{const s=z=>{j.current&&!j.current.contains(z.target)&&(A(null),v(""))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),r.useEffect(()=>{const s=z=>{z.key==="Escape"&&(A(null),v(""))};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[]);const R=s=>{d===s?(A(null),v("")):(A(s),v(""),setTimeout(()=>{var z;return(z=b.current)==null?void 0:z.focus()},50))},D=s=>{const z=s.every(t=>a.has(t.id));s.forEach(t=>{(z||!a.has(t.id))&&h(t.id)})},P=s=>s==="self-hosted"?"Self-Hosted":s==="github"?"GitHub":"External",W=f>0&&!w,O=g>0&&!m,H=p==="up"?ce:de,U=s=>s?"rotate-180":"",B=(W||O)&&e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[W&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs",children:[e.jsx(ee,{size:11,className:"shrink-0 text-yellow-500"}),e.jsx("span",{children:"Add GitHub token in Settings for dedicated quota"})]}),O&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs",children:[e.jsx(ee,{size:11,className:"shrink-0 text-yellow-500"}),e.jsx("span",{children:"Add OpenRouter key in Settings for external models"})]})]});return e.jsxs("div",{className:"flex flex-col items-center gap-2",ref:j,children:[p==="up"&&B,e.jsxs("div",{className:"relative flex items-center gap-1 bg-slate-800/90 rounded-lg p-1 border border-slate-700/50 backdrop-blur-md shadow-lg",children:[E.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>R("self-hosted"),disabled:C,className:`h-7 px-3 flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${N>0?"bg-emerald-500/20 text-emerald-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{children:P("self-hosted")}),e.jsxs("span",{className:`text-[10px] ${N>0?"text-emerald-400":"text-slate-500"}`,children:[N,"/",E.length]}),e.jsx(H,{size:12,className:`transition-transform ${U(d==="self-hosted")}`})]}),d==="self-hosted"&&e.jsx(I,{models:T,allModels:E,selectedModels:a,onToggleModel:h,onToggleAll:()=>D(E),searchQuery:x,setSearchQuery:v,searchInputRef:b,color:"emerald",showSearch:E.length>5,direction:p})]}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50"})]}),k.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>R("github"),disabled:C,className:`h-7 px-3 flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${f>0?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{children:P("github")}),e.jsxs("span",{className:`text-[10px] ${f>0?"text-blue-400":"text-slate-500"}`,children:[f,"/",k.length]}),e.jsx(H,{size:12,className:`transition-transform ${U(d==="github")}`})]}),d==="github"&&e.jsx(I,{models:o,allModels:k,selectedModels:a,onToggleModel:h,onToggleAll:()=>D(k),searchQuery:x,setSearchQuery:v,searchInputRef:b,color:"blue",showSearch:k.length>5,direction:p})]}),l.length>0&&e.jsx("div",{className:"w-px h-5 bg-slate-600/50"})]}),l.length>0&&e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>R("external"),disabled:C,className:`h-7 px-3 flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${g>0?"bg-purple-500/20 text-purple-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),e.jsx("span",{children:P("external")}),e.jsxs("span",{className:`text-[10px] ${g>0?"text-purple-400":"text-slate-500"}`,children:[g,"/",l.length]}),e.jsx(H,{size:12,className:`transition-transform ${U(d==="external")}`})]}),d==="external"&&e.jsx(I,{models:$,allModels:l,selectedModels:a,onToggleModel:h,onToggleAll:()=>D(l),searchQuery:x,setSearchQuery:v,searchInputRef:b,color:"purple",showSearch:l.length>5,direction:p})]})]}),p==="down"&&B]})}function I({models:u,allModels:a,selectedModels:h,onToggleModel:C,onToggleAll:w,searchQuery:m,setSearchQuery:p,searchInputRef:d,color:A,showSearch:x,direction:v}){const j=a.every(l=>h.has(l.id)),b={emerald:{bg:"bg-emerald-500/20",text:"text-emerald-300",check:"text-emerald-400",dot:"bg-emerald-500/50",border:"focus:border-emerald-500/50"},blue:{bg:"bg-blue-500/20",text:"text-blue-300",check:"text-blue-400",dot:"bg-blue-500/50",border:"focus:border-blue-500/50"},purple:{bg:"bg-purple-500/20",text:"text-purple-300",check:"text-purple-400",dot:"bg-purple-500/50",border:"focus:border-purple-500/50"}}[A],E=v==="up"?"bottom-full left-0 mb-2":"top-full left-0 mt-2",k=v==="up"?"animate-in fade-in slide-in-from-bottom-2":"animate-in fade-in slide-in-from-top-2";return e.jsxs("div",{className:`absolute ${E} w-56 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden ${k} duration-150`,onClick:l=>l.stopPropagation(),"data-no-arena-scroll":!0,children:[v==="down"&&x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-2 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:d,type:"text",placeholder:"Search...",value:m,onChange:l=>p(l.target.value),className:`w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none ${b.border}`})]})}),e.jsx("div",{className:"border-t border-slate-700/50"})]}),v==="down"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:w,className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${j?`${b.bg} ${b.text}`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{children:j?"Deselect All":"Select All"}),j&&e.jsx("span",{className:b.check,children:"âœ“"})]}),e.jsx("div",{className:"border-t border-slate-700/50"})]}),e.jsx("div",{className:"max-h-48 overflow-y-scroll chat-scroll",style:{WebkitOverflowScrolling:"touch"},children:u.map(l=>{const T=h.has(l.id);return e.jsxs("button",{onClick:()=>C(l.id),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${T?`${b.bg} text-slate-200`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${b.dot}`}),e.jsx("span",{children:l.name})]}),T&&e.jsx("span",{className:b.check,children:"âœ“"})]},l.id)})}),v==="up"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsxs("button",{onClick:w,className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${j?`${b.bg} ${b.text}`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{children:j?"Deselect All":"Select All"}),j&&e.jsx("span",{className:b.check,children:"âœ“"})]})]}),v==="up"&&x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsx("div",{className:"px-2 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:d,type:"text",placeholder:"Search...",value:m,onChange:l=>p(l.target.value),className:`w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none ${b.border}`})]})})]})]})}const $e=r.forwardRef(({models:u,selectedModels:a,onToggleModel:h,githubToken:C,openrouterKey:w,messages:m,setMessages:p,isGenerating:d,setIsGenerating:A,gesturesActive:x=!1},v)=>{var s,z;const[j,b]=r.useState(!1),[E,k]=r.useState(null),[l,T]=r.useState(new Map),[o,$]=r.useState(new Map),N=r.useRef(new Map),f=r.useRef(null),g=r.useRef(null),R=r.useRef(!1),D=pe(),P=((s=D==null?void 0:D.gestureState)==null?void 0:s.gesture)==="Middle_Finger",W=r.useCallback(()=>{if(!f.current)return!0;const{scrollTop:t,scrollHeight:n,clientHeight:i}=f.current;return n-t-i<100},[]);r.useEffect(()=>{const t=f.current;if(!t)return;const n=()=>{W()?R.current=!1:R.current=!0};return t.addEventListener("scroll",n,{passive:!0}),()=>t.removeEventListener("scroll",n)},[W]),r.useImperativeHandle(v,()=>({sendMessage:(t,n)=>O(t,n),setInput:t=>{g.current&&(g.current.value=t,g.current.focus())},stopGeneration:H,scroll:t=>{f.current&&(R.current=!0,f.current.scrollTop=f.current.scrollTop-t)}})),r.useEffect(()=>{f.current&&!R.current&&(f.current.scrollTop=f.current.scrollHeight)},[m,l]),r.useEffect(()=>{const t=n=>{var M;if(n.ctrlKey||n.metaKey||n.altKey)return;const i=n.target;i.tagName==="INPUT"||i.tagName==="TEXTAREA"||n.key.length===1&&((M=g.current)==null||M.focus())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const O=async(t,n=!1)=>{if(!t.trim()||d||a.size===0)return;R.current=!1;const i=Array.from(a),M={role:"user",content:t};p(c=>[...c,M]),A(!0),T(new Map(i.map(c=>[c,""])));const F=Date.now();$(new Map(i.map(c=>[c,{startTime:F}])));const _=[...m,M].map(c=>({role:c.role,content:c.content})),J=n?[{role:"system",content:"User is using gesture control. Keep responses concise."},..._]:_;let K=0;const te=i.length,ie=i.map(async c=>{const G=u.find(S=>S.id===c),se=Date.now();if(!G){p(S=>[...S,{role:"assistant",content:"Model not found",modelName:c,modelId:c,error:!0}]),T(S=>{const y=new Map(S);return y.delete(c),y}),$(S=>{const y=new Map(S);return y.delete(c),y}),K++,K===te&&A(!1);return}const Q=new AbortController;N.current.set(c,Q);let q;try{const S=await fe({models:[c],messages:J,max_tokens:2048,temperature:.7,github_token:C||null,openrouter_key:w||null},Q.signal);let y="";await he(S,L=>{if(Q.signal.aborted)throw new DOMException("Aborted","AbortError");if(L.event==="error"||L.error)throw new Error(typeof L.error=="string"?L.error:L.content||"Stream failed");L.content&&(q||(q=Date.now(),$(X=>{const Y=new Map(X),re=Y.get(c);return re&&Y.set(c,{...re,firstTokenTime:q}),Y})),y+=L.content,T(X=>new Map(X).set(c,y)))});const V=Date.now();p(L=>[...L,{role:"assistant",content:y,modelName:G.name,modelId:c,timing:{startTime:se,firstTokenTime:q,endTime:V}}])}catch(S){const y=Date.now();S.name!=="AbortError"&&p(V=>[...V,{role:"assistant",content:S.message,modelName:G.name,modelId:c,error:!0,timing:{startTime:se,firstTokenTime:q,endTime:y}}])}finally{N.current.delete(c),T(S=>{const y=new Map(S);return y.delete(c),y}),$(S=>{const y=new Map(S);return y.delete(c),y}),K++,K===te&&A(!1)}});await Promise.all(ie)},H=()=>{N.current.forEach(i=>i.abort()),N.current.clear();const t=[],n=Date.now();l.forEach((i,M)=>{if(i.trim()){const F=u.find(J=>J.id===M),_=o.get(M);t.push({role:"assistant",content:i,modelName:F==null?void 0:F.name,modelId:M,timing:_?{..._,endTime:n}:void 0})}}),t.length>0&&p(i=>[...i,...t]),T(new Map),$(new Map),A(!1)},U=r.useCallback(async t=>{const n=m[t];if(n)try{await navigator.clipboard.writeText(n.content),k(`${t}`),setTimeout(()=>k(null),2e3)}catch(i){console.error("Copy failed",i)}},[m]),B=a.size===0?"Select models to start...":a.size===1?`Message ${((z=u.find(t=>t.id===Array.from(a)[0]))==null?void 0:z.name)||"model"}...`:`Message ${a.size} models...`;return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsx("div",{ref:f,className:"flex-1 overflow-y-scroll p-4 pb-40 chat-scroll",style:{WebkitOverflowScrolling:"touch"},"data-no-arena-scroll":!0,children:e.jsxs("div",{className:"mx-auto max-w-2xl space-y-4",children:[m.length===0&&e.jsxs("div",{className:"flex-1 flex flex-col items-center text-slate-500 select-none pt-[15vh]",children:[P?e.jsxs("div",{className:"mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500 blur-xl opacity-50 rounded-full"}),e.jsx(Z,{size:72,className:"relative text-red-500"}),e.jsx("div",{className:"absolute -top-2 -right-2 text-3xl",children:"ðŸ’¢"})]}):e.jsx(Z,{size:72,className:"mb-6 opacity-50 transition-all duration-300"}),e.jsx(oe,{models:u,selectedModels:a,onToggleModel:h,isGenerating:d,githubToken:C,openrouterKey:w,dropDirection:"down"})]}),m.map((t,n)=>{const i=t.role==="assistant"&&x&&t.content.includes("```json");return e.jsxs("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:[e.jsxs("div",{className:`group relative max-w-[85%] rounded-2xl px-4 py-3 ${t.role==="user"?"bg-blue-600/20 border border-blue-500/30 text-white rounded-tr-sm":t.error?"bg-red-500/10 border border-red-500/30 text-red-200 rounded-tl-sm":"bg-slate-800/60 border border-slate-700/60 text-slate-200 rounded-tl-sm"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider ${t.role==="user"?"text-blue-300 flex-row-reverse":"text-slate-400"}`,children:[t.role==="user"?e.jsx(ue,{size:12}):e.jsx(Z,{size:12}),t.role==="user"?"You":t.modelName||"Assistant",t.error&&e.jsx(ee,{size:12,className:"text-red-400"})]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(ne,{text:t.role==="user"?t.content:we(t.content)})}),t.role==="assistant"&&t.timing&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/30",children:e.jsx(ae,{times:t.timing})}),t.role==="assistant"&&t.content&&e.jsx("button",{onClick:()=>U(n),className:`absolute bottom-2 right-2 p-1.5 rounded-md transition-all ${E===`${n}`?"bg-emerald-500/20 text-emerald-400":"opacity-0 group-hover:opacity-100 bg-slate-700/70 text-slate-400"}`,children:E===`${n}`?e.jsx(xe,{size:12}):e.jsx(me,{size:12})})]}),i&&e.jsx("div",{className:"ml-4",children:e.jsx(je,{content:t.content,onSelect:M=>O(M,!0),isInline:!1})})]},n)}),d&&l.size>0&&e.jsx(e.Fragment,{children:Array.from(l.entries()).map(([t,n])=>{const i=u.find(F=>F.id===t),M=o.get(t);return e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[85%] rounded-2xl rounded-tl-sm px-4 py-3 bg-slate-800/60 border border-amber-500/30 text-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider text-amber-400/80",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/50 border-t-amber-400 rounded-full animate-spin"}),(i==null?void 0:i.name)||t]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(ne,{text:n||"..."})}),M&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/30",children:e.jsx(ae,{times:M})})]})},t)})})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-[99] flex flex-col items-center gap-3 px-4 pb-4",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom))"},children:[m.length>0&&e.jsx(oe,{models:u,selectedModels:a,onToggleModel:h,isGenerating:d,githubToken:C,openrouterKey:w,dropDirection:"up"}),e.jsx(be,{inputRef:g,inputFocused:j,setInputFocused:b,onSendMessage:O,placeholder:B,isGenerating:d,onStop:H,className:"w-full flex justify-center",style:{}})]})]})});export{$e as default};
