import{r,j as F}from"./react-vendor-D3aXD8-_.js";import{U as Ne,m as Ae}from"./mediapipe-BWDqrTQ6.js";import"./markdown-DXw-y-uZ.js";import"./math-render-B8LXoudh.js";import"./syntax-highlight-BO5EbbCt.js";const Ie={twoFingerTapWindow:500,twoFingerTapCooldown:400,twoFingerMinFrames:4,minPointingTime:100,dwellTime:1200,cursorSmoothing:.5},Le={Thumb_Up:{action:"message",message:"ðŸ‘"},Thumb_Down:{action:"message",message:"ðŸ‘Ž"},Open_Palm:{action:"message",message:"ðŸ‘‹"},Victory:{action:"message",message:"ok"},ILoveYou:{action:"message",message:"thanks"},Closed_Fist:{action:"message",message:"stop"},Pointing_Up:{action:"point"}};function Ve({onStopGeneration:ee,onSendMessage:te,onScroll:re,onPinch:ne,onHover:se,onModeChange:ie,onGestureState:ce,onError:oe,config:ae=Ie,onDebugInfo:le,onLandmarkData:ue,onPerformance:de,appContext:fe="chat",gestureActiveArea:me}){const Se=r.useRef(ee),H=r.useRef(te),X=r.useRef(re),Y=r.useRef(ne),q=r.useRef(se),Ce=r.useRef(ie),p=r.useRef(ce),Pe=r.useRef(le),W=r.useRef(ue),B=r.useRef(de),K=r.useRef(ae),ge=r.useRef(fe),he=r.useRef(me);Se.current=ee,H.current=te,X.current=re,Y.current=ne,q.current=se,Ce.current=ie,p.current=ce,Pe.current=le,W.current=ue,B.current=de,K.current=ae,ge.current=fe,he.current=me;const $=r.useRef(oe);$.current=oe;const N=r.useRef({frames:0,lastTime:performance.now(),fps:0}),C=r.useRef(null),pe=r.useRef(null),U=r.useRef(null),_=r.useRef(null),[we,Fe]=r.useState(!1),R=r.useRef(),D=r.useRef(null),V=r.useRef(null),b=r.useRef(null),_e=r.useRef(null),M=r.useRef({visible:!1,x:0,y:0,isClicking:!1}),De=r.useRef({x:0,y:0}),G=r.useRef(0),ve=1500,Me=15,ye=8,J=r.useRef(new Map),Q=r.useRef(new Map),Te=r.useCallback(t=>{const n=["Victory","ILoveYou","Fist","Open_Palm"],c=["Thumb_Up","Thumb_Down","Pointing_Up"];return n.includes(t)?15:c.includes(t)?5:Me},[]),Re=r.useCallback((t,n)=>{if(["PREV_MODE","NEXT_MODE"].includes(t))return!0;switch(n){case"chat":return!0;case"compare":return!0;case"analyze":case"debate":return!0;default:return!0}},[]),Z=r.useCallback((t,n)=>{const c=he.current;if(!c)return!0;const e=1-t;return e>=c.minX&&e<=c.maxX&&n>=c.minY&&n<=c.maxY},[]),xe=r.useCallback(t=>(Q.current.has(t)||Q.current.set(t,{isScrolling:!1,lastScrollY:null,scrollVelocity:0,lastOpenTime:0,waveXPositions:[],waveDirectionChanges:0,lastWaveDirection:null,waveStartTime:0,dwellStartTime:0,dwellPosition:null,wasPointingOnly:!1,pointingOnlyStartTime:0,twoFingerFrames:0,clickLocked:!1,middleFingerActive:!1}),Q.current.get(t)),[]),be=r.useCallback(t=>(J.current.has(t)||J.current.set(t,{candidate:"NEUTRAL",frames:0}),J.current.get(t)),[]);r.useEffect(()=>{let t=null;return(async()=>{var c;try{const e=typeof chrome<"u"&&!!((c=chrome.runtime)!=null&&c.id),s=e?"/mediapipe":"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm",z=e?"/mediapipe/gesture_recognizer.task":"https://storage.googleapis.com/mediapipe-models/gesture_recognizer/gesture_recognizer/float16/1/gesture_recognizer.task",E=await Ne.forVisionTasks(s);t=await Ae.createFromOptions(E,{baseOptions:{modelAssetPath:z,delegate:"GPU"},runningMode:"VIDEO",numHands:2,minHandDetectionConfidence:.5,minHandPresenceConfidence:.5,minTrackingConfidence:.5}),D.current=t;const o=document.createElement("canvas");o.width=320,o.height=240,pe.current=o;const f=document.createElement("canvas");f.width=1,f.height=1;const w=f.getContext("2d");w&&(w.fillStyle="#000",w.fillRect(0,0,1,1));try{t&&t.recognizeForVideo(f,0)}catch{}Fe(!0)}catch(e){console.error("Error initializing gesture recognition:",e)}})(),()=>{D.current&&D.current.close()}},[]);const Ee=r.useCallback((t,n,c)=>{var a;const e=xe(c),s=be(c),z=ge.current;if(!t.gestures||t.gestures.length===0)return e.isScrolling=!1,e.lastScrollY=null,M.current.visible&&b.current&&(b.current.style.opacity="0",M.current.visible=!1),e.middleFingerActive&&p.current&&(p.current({gesture:null,progress:0,triggered:!1}),e.middleFingerActive=!1),null;const E=(a=t.gestures[c])==null?void 0:a[0],o=t.landmarks[c];if(!E||!o)return null;const f=E.categoryName;if(!Re(f,z))return null;const w=Le[f];if(f==="Pointing_Up"&&o){const u=o[8],i={x:1-u.x,y:u.y};q.current&&q.current(i.x,i.y);const y=window.innerWidth,h=window.innerHeight,l=i.x*y,S=i.y*h,v=K.current.cursorSmoothing,m=De.current;M.current.visible?(m.x+=(l-m.x)*v,m.y+=(S-m.y)*v):(m.x=l,m.y=S),b.current&&(b.current.style.transform=`translate(${m.x}px, ${m.y}px)`,b.current.style.opacity="1",b.current.style.borderColor="rgba(148, 163, 184, 0.7)",b.current.style.boxShadow="0 0 8px rgba(148, 163, 184, 0.3)"),M.current={visible:!0,x:m.x,y:m.y,isClicking:!1};const P=K.current.dwellTime,g=.05;if(e.dwellPosition===null)e.dwellStartTime=n,e.dwellPosition=i;else if(Math.sqrt(Math.pow(i.x-e.dwellPosition.x,2)+Math.pow(i.y-e.dwellPosition.y,2))>g)e.dwellStartTime=n,e.dwellPosition=i;else{const T=n-e.dwellStartTime;if(T>=P&&Y.current)return Y.current(i.x,i.y),G.current=n,e.dwellStartTime=0,e.dwellPosition=null,p.current&&p.current({gesture:"DWELL_CLICK",progress:1,triggered:!0}),"DWELL_CLICK";if(p.current){const k=Math.min(1,T/P);p.current({gesture:"POINTING",progress:k,triggered:!1})}}return"POINTING"}else e.dwellStartTime=0,e.dwellPosition=null,M.current.visible&&b.current&&(b.current.style.opacity="0",M.current.visible=!1);if(f==="Closed_Fist"&&o){const i=o[0].y;if(!e.isScrolling)e.isScrolling=!0,e.lastScrollY=i,e.scrollVelocity=0;else if(e.lastScrollY!==null){const y=i-e.lastScrollY,h=(e.scrollVelocity||0)*.6+y*.4;e.scrollVelocity=h,Math.abs(h)>.006&&X.current?(X.current(h*1800),e.lastScrollY=i):Math.abs(y)>.02&&(e.lastScrollY=i)}return"FIST"}else e.isScrolling=!1,e.lastScrollY=null,e.scrollVelocity=0;if(f==="Open_Palm"&&o){e.lastOpenTime=n;const i=o[0].x;if(e.waveStartTime===0||n-e.waveStartTime>2e3)e.waveXPositions=[i],e.waveDirectionChanges=0,e.lastWaveDirection=null,e.waveStartTime=n;else{const y=e.waveXPositions[e.waveXPositions.length-1],h=i-y;if(Math.abs(h)>.03){e.waveXPositions.push(i);const S=h>0?"right":"left";if(e.lastWaveDirection&&S!==e.lastWaveDirection&&e.waveDirectionChanges++,e.lastWaveDirection=S,e.waveDirectionChanges>=3&&n-G.current>ve){const v=document.activeElement,m=v instanceof HTMLInputElement||v instanceof HTMLTextAreaElement,P=o[0].y;if(H.current&&!m&&Z(i,P))return H.current("Hi"),G.current=n,e.waveDirectionChanges=0,e.waveStartTime=0,e.lastWaveDirection=null,e.waveXPositions=[],"WAVE"}}}}if(o){const u=o[0],i=o[8],y=o[12],h=o[16],l=o[20],S=o[10],v=(k,x)=>(k.x-x.x)**2+(k.y-x.y)**2,m=v(y,u),P=v(i,u),g=v(h,u),d=v(l,u);if(v(y,u)>v(S,u)&&m>P*2&&m>g*2&&m>d*2){s.candidate==="Middle_Finger"?s.frames++:(s.candidate="Middle_Finger",s.frames=1);const k=Math.min(1,s.frames/ye),x=s.frames>=ye;if(e.middleFingerActive=x,p.current&&p.current({gesture:"Middle_Finger",progress:k,triggered:x}),x)return"Middle_Finger"}else(e.middleFingerActive||s.candidate==="Middle_Finger")&&(e.middleFingerActive=!1,s.candidate="NEUTRAL",s.frames=0,p.current&&p.current({gesture:null,progress:0,triggered:!1}))}if((w==null?void 0:w.action)==="message"&&w.message){s.candidate===f?s.frames++:(s.candidate=f,s.frames=1);const u=Te(f);if(s.frames>=u&&n-G.current>ve){const i=document.activeElement,y=i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement,h=o[0];if(H.current&&!y&&Z(h.x,h.y))return H.current(w.message),G.current=n,s.frames=0,p.current&&p.current({gesture:f,progress:1,triggered:!0}),f}if(p.current){const i=Math.min(1,s.frames/u);p.current({gesture:f,progress:i,triggered:!1})}}return f},[xe,be,Re,Te,Z]),A=r.useCallback(()=>{var S,v,m,P;const t=C.current,n=U.current;if(!t||!n){R.current=requestAnimationFrame(A);return}if(!D.current){R.current=requestAnimationFrame(A);return}if(t.videoWidth===0||t.videoHeight===0){R.current=requestAnimationFrame(A);return}const c=window.innerWidth,e=window.innerHeight;(n.width!==c||n.height!==e)&&(n.width=c,n.height=e);const s=n.getContext("2d");if(!s){R.current=requestAnimationFrame(A);return}const E=performance.now(),o=pe.current;if(o){const g=o.getContext("2d");g&&g.drawImage(t,0,0,o.width,o.height)}const f=o||t;let w=[],a=null;const u=D.current.recognizeForVideo(f,E);u.landmarks&&(w=u.landmarks.map(g=>g.map(d=>({x:d.x,y:d.y,z:d.z}))));for(let g=0;g<(((S=u.landmarks)==null?void 0:S.length)||0);g++){const d=Ee(u,E,g);d&&(a=d)}if(W.current&&w[0]){const g=(P=(m=(v=u.handednesses)==null?void 0:v[0])==null?void 0:m[0])==null?void 0:P.categoryName;W.current({landmarks:w[0],handedness:g??null})}const i=Math.round(performance.now()-E);N.current.frames++;const y=E-N.current.lastTime;y>=1e3&&(N.current.fps=Math.round(N.current.frames*1e3/y),N.current.frames=0,N.current.lastTime=E,B.current&&B.current({fps:N.current.fps,detectionTime:i}));const h=_.current,l=h==null?void 0:h.getContext("2d");if(s.clearRect(0,0,c,e),l&&l.clearRect(0,0,c,e),w.length>0)for(const g of w){let d="#3b82f6",T="#60a5fa";a&&(a==="Pointing_Up"||a==="POINTING"?(d="#06b6d4",T="#67e8f9"):a==="Thumb_Up"||a==="THUMBS_UP"?(d="#22c55e",T="#86efac"):a==="Thumb_Down"||a==="THUMBS_DOWN"?(d="#f97316",T="#fdba74"):a==="Closed_Fist"||a==="FIST"?(d="#a855f7",T="#d8b4fe"):a==="Open_Palm"||a==="WAVE"?(d="#f59e0b",T="#fcd34d"):a==="Middle_Finger"?(d="#ef4444",T="#f87171"):(d="#3b82f6",T="#60a5fa"));const k=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];for(const[x,j]of k){const L=g[x],O=g[j],I=s.createLinearGradient(L.x*c,L.y*e,O.x*c,O.y*e);I.addColorStop(0,d),I.addColorStop(1,T),s.beginPath(),s.moveTo(L.x*c,L.y*e),s.lineTo(O.x*c,O.y*e),s.strokeStyle=I,s.lineWidth=a?3:2,s.shadowColor=d,s.shadowBlur=a?10:8,s.stroke()}if(l){for(let x=0;x<g.length;x++){const j=g[x],L=j.x*c,O=j.y*e,I=[4,8,12,16,20].includes(x),ke=I?a?5:4:a?3:2;l.beginPath(),l.arc(L,O,ke,0,2*Math.PI),I?(l.fillStyle="#ffffff",l.shadowColor=T,l.shadowBlur=a?20:15):(l.fillStyle="#1e293b",l.strokeStyle=T,l.lineWidth=1.5,l.shadowColor=d,l.shadowBlur=a?8:5),l.fill(),I||l.stroke()}l.shadowBlur=0}}else M.current.visible&&b.current&&(b.current.style.opacity="0",M.current.visible=!1),W.current&&W.current({landmarks:null,handedness:null});R.current=requestAnimationFrame(A)},[Ee]);return r.useEffect(()=>(we&&C.current&&(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{V.current=t,C.current&&(C.current.srcObject=t,C.current.play(),C.current.addEventListener("loadeddata",()=>{const n=window.innerWidth,c=window.innerHeight;U.current&&(U.current.width=n,U.current.height=c),_.current&&(_.current.width=n,_.current.height=c),R.current&&cancelAnimationFrame(R.current),R.current=requestAnimationFrame(A)}))}).catch(t=>{console.error("Error accessing webcam:",t);let n="Could not access camera";t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n="No camera found. Please connect a webcam to use gesture control.":t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n="Camera access denied. Please allow camera access in your browser settings.":(t.name==="NotReadableError"||t.name==="TrackStartError")&&(n="Camera is in use by another application."),$.current&&$.current(n)}):console.warn("navigator.mediaDevices is undefined. Camera access requires HTTPS or localhost.")),()=>{R.current&&cancelAnimationFrame(R.current)}),[we,A]),r.useEffect(()=>()=>{R.current&&(cancelAnimationFrame(R.current),R.current=void 0),V.current&&(V.current.getTracks().forEach(t=>{t.stop()}),V.current=null),C.current&&(C.current.srcObject=null),D.current&&(D.current.close(),D.current=null),_.current&&(_.current.width=0,_.current.height=0)},[]),F.jsxs(F.Fragment,{children:[F.jsxs("div",{className:"fixed inset-0 z-[1] pointer-events-none overflow-hidden scale-x-[-1]",children:[F.jsx("video",{ref:C,className:"hidden",playsInline:!0,muted:!0,autoPlay:!0}),F.jsx("canvas",{ref:U,className:"absolute inset-0 w-full h-full opacity-50 mix-blend-screen"})]}),F.jsx("div",{className:"fixed inset-0 z-[1] pointer-events-none overflow-hidden scale-x-[-1]",children:F.jsx("canvas",{ref:_,className:"absolute inset-0 w-full h-full opacity-50 mix-blend-screen"})}),F.jsx("div",{ref:b,className:"fixed pointer-events-none z-[9999]",style:{top:0,left:0,width:28,height:28,marginLeft:-14,marginTop:-14,borderRadius:"50%",border:"2px solid rgba(148, 163, 184, 0.7)",opacity:0,boxShadow:"0 0 8px rgba(148, 163, 184, 0.3)",willChange:"transform, opacity"},children:F.jsx("div",{ref:_e,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full",style:{width:6,height:6,backgroundColor:"rgba(255, 255, 255, 0.9)"}})})]})}export{Ve as default};
