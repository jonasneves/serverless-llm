import{r as s,j as e,h as pe,i as fe,T as ne,S as se,B as G,U as he,C as be,k as ge,P as ve}from"./react-vendor-CQxWqugw.js";import{F as re}from"./FormattedContent-ClPh4eCb.js";import{a as we,f as je,s as Ne,E as le,P as ye,U as Ce}from"./index-U0PJXflW.js";import"./markdown-BNX5kHMI.js";import"./math-render-D6B7xoul.js";import"./syntax-highlight-K7DiErAG.js";function ke(m){const[u,p]=s.useState([]);return s.useEffect(()=>{const j=m.match(/```json\s*([\s\S]*?)\s*```/);if(j)try{let f=j[1];f=f.replace(/[\\']/g,'"').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/}\s*[\\]+\s*$/g,"}").replace(/"\s*"\s*$/g,"").trim();const g=JSON.parse(f);if(g.options&&Array.isArray(g.options)){const o=g.options.filter(c=>c.id&&c.label&&c.value);o.length>0?p(o):p([])}}catch(f){console.error("Failed to parse gesture options:",f),p([])}else p([])},[m]),u}function Se(m){return m.replace(/```json[\s\S]*?```/g,"").trim()}const $e=1800;function Ee({content:m,onSelect:u,isInline:p=!1}){const j=ke(m),[f,g]=s.useState(null),[o,c]=s.useState({}),N=s.useRef(0),a=s.useRef(0);s.useEffect(()=>{const l=v=>{var E;const y=(E=v.detail)==null?void 0:E.target;if(y&&y.hasAttribute("data-gesture-option")){const w=y.getAttribute("data-gesture-option");w&&w!==f&&(g(w),h(w))}else f&&(g(null),i())};return window.addEventListener("gesture-hover",l),()=>{window.removeEventListener("gesture-hover",l),i()}},[f]);const h=l=>{i(),N.current=Date.now();const v=()=>{const y=Date.now()-N.current,E=Math.min(y/$e*100,100);if(c(w=>({...w,[l]:E})),E>=100){const w=j.find(z=>z.id===l);w&&(u(w.value),i())}else a.current=requestAnimationFrame(v)};a.current=requestAnimationFrame(v)},i=()=>{a.current&&cancelAnimationFrame(a.current),c({})},x=l=>{g(l),h(l)},k=()=>{g(null),i()};if(j.length===0)return null;const S=p?"w-full mt-3":"w-full",b=p?"grid grid-cols-2 gap-2":"flex flex-col gap-2.5",R=l=>p?`relative overflow-hidden rounded-lg font-medium text-xs border transition-all duration-200 text-center min-h-[40px] flex items-center justify-center px-3 py-2 ${l?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`:`relative overflow-hidden rounded-xl font-medium text-sm border transition-all duration-200 w-full text-left min-h-[52px] flex items-center px-4 py-3 ${l?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10 scale-[1.02]":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`;return e.jsxs("div",{className:S,children:[!p&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-1",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider text-slate-400",children:"Quick Actions"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-700/50 to-transparent"})]}),e.jsx("div",{className:b,children:j.map(l=>{const v=o[l.id]||0,y=f===l.id;return e.jsxs("button",{onClick:()=>u(l.value),onMouseEnter:()=>x(l.id),onMouseLeave:k,"data-gesture-option":l.id,className:R(y),children:[y&&v>0&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-blue-400 to-blue-500 transition-all duration-75",style:{width:`${v}%`}}),e.jsx("span",{className:"relative z-10",children:l.label})]},l.id)})})]})}function Ae({models:m,selectedModels:u,onToggleModel:p,isGenerating:j,githubToken:f,onConnectGitHub:g,dropDirection:o="up"}){const[c,N]=s.useState(null),[a,h]=s.useState(""),i=s.useRef(null),x=s.useRef(null),k=s.useMemo(()=>m.filter(r=>r.type==="self-hosted"),[m]),S=s.useMemo(()=>m.filter(r=>r.type==="github"),[m]),b=s.useMemo(()=>k.filter(r=>!a||r.name.toLowerCase().includes(a.toLowerCase())),[k,a]),R=s.useMemo(()=>S.filter(r=>!a||r.name.toLowerCase().includes(a.toLowerCase())),[S,a]),l=k.filter(r=>u.has(r.id)).length,v=S.filter(r=>u.has(r.id)).length;s.useEffect(()=>{const r=A=>{i.current&&!i.current.contains(A.target)&&(N(null),h(""))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),s.useEffect(()=>{const r=A=>{A.key==="Escape"&&(N(null),h(""))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]);const y=r=>{c===r?(N(null),h("")):(N(r),h(""),setTimeout(()=>{var A;return(A=x.current)==null?void 0:A.focus()},50))},E=r=>{const A=r.every(D=>u.has(D.id));r.forEach(D=>{(A||!u.has(D.id))&&p(D.id)})},w=r=>r==="self-hosted"?"Self-Hosted":"GitHub",z=v>0&&!f,$=o==="up"?pe:fe,M=r=>r?"rotate-180":"",F=z&&e.jsx("div",{className:"flex flex-col items-center gap-1",children:g?e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-blue-500/10 border border-blue-500/20 text-blue-200 text-xs hover:bg-blue-500/20 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 16 16",fill:"currentColor",children:e.jsx("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})}),e.jsx("span",{children:"Connect GitHub for dedicated quota"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs",children:[e.jsx(ne,{size:11,className:"shrink-0 text-yellow-500"}),e.jsx("span",{children:"Add GitHub token in Settings for dedicated quota"})]})});return e.jsxs("div",{className:"flex flex-col items-center gap-2",ref:i,children:[o==="up"&&F,e.jsxs("div",{className:"relative flex items-center gap-1 bg-slate-800/90 rounded-lg p-1 border border-slate-700/50 backdrop-blur-md shadow-lg",children:[k.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>y("self-hosted"),disabled:j,className:`h-7 px-3 w-[150px] flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${l>0?"bg-emerald-500/20 text-emerald-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{children:w("self-hosted")}),e.jsxs("span",{className:`text-[10px] ${l>0?"text-emerald-400":"text-slate-500"}`,children:[l,"/",k.length]}),e.jsx($,{size:12,className:`transition-transform ${M(c==="self-hosted")}`})]}),c==="self-hosted"&&e.jsx(ae,{models:b,allModels:k,selectedModels:u,onToggleModel:p,onToggleAll:()=>E(k),searchQuery:a,setSearchQuery:h,searchInputRef:x,color:"emerald",showSearch:k.length>5,direction:o})]}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50"})]}),S.length>0&&e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>y("github"),disabled:j,className:`h-7 px-3 w-[150px] flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${v>0?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{children:w("github")}),e.jsxs("span",{className:`text-[10px] ${v>0?"text-blue-400":"text-slate-500"}`,children:[v,"/",S.length]}),e.jsx($,{size:12,className:`transition-transform ${M(c==="github")}`})]}),c==="github"&&e.jsx(ae,{models:R,allModels:S,selectedModels:u,onToggleModel:p,onToggleAll:()=>E(S),searchQuery:a,setSearchQuery:h,searchInputRef:x,color:"blue",showSearch:S.length>5,direction:o})]})]}),o==="down"&&F]})}function ae({models:m,allModels:u,selectedModels:p,onToggleModel:j,onToggleAll:f,searchQuery:g,setSearchQuery:o,searchInputRef:c,color:N,showSearch:a,direction:h}){const i=u.every(b=>p.has(b.id)),x={emerald:{bg:"bg-emerald-500/20",text:"text-emerald-300",check:"text-emerald-400",dot:"bg-emerald-500/50",border:"focus:border-emerald-500/50"},blue:{bg:"bg-blue-500/20",text:"text-blue-300",check:"text-blue-400",dot:"bg-blue-500/50",border:"focus:border-blue-500/50"}}[N],k=h==="up"?"bottom-full left-0 mb-2":"top-full left-0 mt-2",S=h==="up"?"animate-in fade-in slide-in-from-bottom-2":"animate-in fade-in slide-in-from-top-2";return e.jsxs("div",{className:`absolute ${k} w-56 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden ${S} duration-150`,onClick:b=>b.stopPropagation(),"data-no-arena-scroll":!0,children:[h==="down"&&a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-2 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:c,type:"text",placeholder:"Search...",value:g,onChange:b=>o(b.target.value),className:`w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none ${x.border}`})]})}),e.jsx("div",{className:"border-t border-slate-700/50"})]}),h==="down"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:f,className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${i?`${x.bg} ${x.text}`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{children:i?"Deselect All":"Select All"}),i&&e.jsx("span",{className:x.check,children:"âœ“"})]}),e.jsx("div",{className:"border-t border-slate-700/50"})]}),e.jsx("div",{className:"max-h-48 overflow-y-scroll chat-scroll",style:{WebkitOverflowScrolling:"touch"},children:m.map(b=>{const R=p.has(b.id);return e.jsxs("button",{onClick:()=>j(b.id),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${R?`${x.bg} text-slate-200`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x.dot}`}),e.jsx("span",{children:b.name})]}),R&&e.jsx("span",{className:x.check,children:"âœ“"})]},b.id)})}),h==="up"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsxs("button",{onClick:f,className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${i?`${x.bg} ${x.text}`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{children:i?"Deselect All":"Select All"}),i&&e.jsx("span",{className:x.check,children:"âœ“"})]})]}),h==="up"&&a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsx("div",{className:"px-2 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:c,type:"text",placeholder:"Search...",value:g,onChange:b=>o(b.target.value),className:`w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none ${x.border}`})]})})]})]})}const Te=s.forwardRef(({models:m,selectedModels:u,onToggleModel:p,githubToken:j,githubUsername:f,onConnectGitHub:g,messages:o,setMessages:c,isGenerating:N,setIsGenerating:a,gesturesActive:h=!1,uiBuilderEnabled:i,setUiBuilderEnabled:x},k)=>{var Y;const[S,b]=s.useState(!1),[R,l]=s.useState(null),[v,y]=s.useState(new Map),[E,w]=s.useState(new Map),z=s.useRef(new Map),$=s.useRef(null),M=s.useRef(null),F=s.useRef(!1),r=we(),A=((Y=r==null?void 0:r.gestureState)==null?void 0:Y.gesture)==="Middle_Finger";s.useEffect(()=>{const t=n=>{const C=n.target;C.tagName==="INPUT"||C.tagName==="TEXTAREA"||n.key.length===1&&!n.ctrlKey&&!n.metaKey&&!n.altKey&&M.current&&M.current.focus()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const D=s.useCallback(()=>{if(!$.current)return!0;const{scrollTop:t,scrollHeight:n,clientHeight:C}=$.current;return n-t-C<100},[]);s.useEffect(()=>{const t=$.current;if(!t)return;const n=()=>{D()?F.current=!1:F.current=!0};return t.addEventListener("scroll",n,{passive:!0}),()=>t.removeEventListener("scroll",n)},[D]);const Q=s.useCallback(()=>{!F.current&&$.current&&($.current.scrollTop=$.current.scrollHeight)},[]);s.useEffect(()=>{Q()},[o,v,Q]);const H=s.useCallback(async(t,n=!1)=>{if(!t.trim()||N)return;const C=Array.from(u);if(C.length===0)return;F.current=!1,a(!0),y(new Map),w(new Map);const P={role:"user",content:t};c(d=>[...d,P]);const B=Date.now();w(new Map(C.map(d=>[d,{startTime:B}])));const ce=[...o,P].map(d=>({role:d.role,content:d.content})),O=[];i&&O.push({role:"system",content:Ce}),n&&O.push({role:"system",content:'User is using gesture control. Available gestures: ðŸ‘ (yes), ðŸ‘Ž (no), ðŸ‘‹ (hello), "ok", "thanks", "stop", pointing finger (select buttons).'}),(t==="ðŸ–•"||t.toLowerCase().includes("middle finger"))&&O.push({role:"system",content:"The user is showing you their middle finger. Respond with humorous, over-the-top mock indignation. Play along with the 'angry robot' persona."});const de=[...O,...ce];let U=0;const Z=C.length,ue=C.map(async d=>{const K=m.find(T=>T.id===d),I=Date.now();if(!K){c(T=>[...T,{role:"assistant",content:`Model ${d} not found`,modelId:d,modelName:d,error:!0}]),U++,U===Z&&a(!1);return}const ee=new AbortController;z.current.set(d,ee);try{const T=await je({models:[d],messages:de,max_tokens:4096,temperature:.7,github_token:j},ee.signal);let L="",te=!0,W;await Ne(T,_=>{_.content&&(te&&(te=!1,W=Date.now(),w(J=>{const V=new Map(J),me=V.get(d)||{startTime:I};return V.set(d,{...me,firstTokenTime:W}),V})),L+=_.content,y(J=>new Map(J).set(d,L)))});const xe=Date.now();c(_=>[..._,{role:"assistant",content:L||"(empty response)",modelId:d,modelName:K.name,timing:{startTime:I,firstTokenTime:W,endTime:xe}}])}catch(T){T.name!=="AbortError"&&c(L=>[...L,{role:"assistant",content:T.message||"Request failed",modelId:d,modelName:K.name,error:!0}])}finally{z.current.delete(d),y(T=>{const L=new Map(T);return L.delete(d),L}),U++,U===Z&&a(!1)}});await Promise.allSettled(ue)},[N,u,o,m,j,i,c,a]),q=s.useCallback(()=>{z.current.forEach(t=>t.abort()),z.current.clear(),a(!1)},[a]),X=s.useCallback(t=>{$.current&&($.current.scrollTop-=t)},[]);s.useImperativeHandle(k,()=>({sendMessage:H,setInput:t=>{M.current&&(M.current.value=t,M.current.focus())},stopGeneration:q,scroll:X}),[H,q,X]);const oe=t=>{const n=o[t];n&&n.role==="assistant"&&(navigator.clipboard.writeText(n.content),l(`${t}`),setTimeout(()=>l(null),2e3))},ie=({compact:t=!1})=>e.jsxs("button",{onClick:()=>x(!i),className:`flex items-center gap-1.5 rounded-md transition-all active:scale-95 font-medium ${t?"h-6 px-2 text-[11px]":"h-7 px-2.5 text-xs"} ${i?"bg-violet-500/20 text-violet-300 hover:bg-violet-500/30":"bg-slate-800/60 text-slate-400 hover:text-slate-300 hover:bg-slate-700/50"}`,title:"Enable interactive UI elements in responses",children:[e.jsx(ve,{size:t?11:12}),e.jsx("span",{children:"UI Builder"})]});return e.jsxs("div",{className:"flex flex-col h-full w-full relative",children:[e.jsx("div",{ref:$,"data-no-arena-scroll":!0,className:"flex-1 overflow-y-auto px-4 py-6 space-y-4 chat-scroll",style:{paddingBottom:o.length>0?"160px":"80px"},children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-6",children:[A?e.jsxs("div",{className:"mb-2 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500 blur-xl opacity-50 rounded-full"}),e.jsx(G,{size:72,className:"relative text-red-500"}),e.jsx("div",{className:"absolute -top-2 -right-2 text-3xl",children:"ðŸ’¢"})]}):e.jsx(G,{size:72,className:"mb-2 text-slate-500 transition-all duration-300"}),f?e.jsxs("p",{className:"text-slate-400 text-lg font-medium",children:["Hey ",f,"!"]}):null,e.jsx("p",{className:"text-slate-500 text-sm",children:"Select one or more models and start chatting"}),e.jsx(Ae,{models:m,selectedModels:u,onToggleModel:p,isGenerating:N,githubToken:j,onConnectGitHub:g,dropDirection:"down"}),e.jsx(ie,{})]}),o.map((t,n)=>{const C=t.role==="assistant"&&(h||i)&&t.content.includes("```json");return e.jsxs("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:[e.jsxs("div",{className:`group relative max-w-[85%] rounded-2xl px-4 py-3 ${t.role==="user"?"bg-blue-600/20 border border-blue-500/30 text-white rounded-tr-sm":t.error?"bg-red-500/10 border border-red-500/30 text-red-200 rounded-tl-sm":"bg-slate-800/60 border border-slate-700/60 text-slate-200 rounded-tl-sm"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider ${t.role==="user"?"text-blue-300 flex-row-reverse":"text-slate-400"}`,children:[t.role==="user"?e.jsx(he,{size:12}):e.jsx(G,{size:12}),t.role==="user"?"You":t.modelName||"Assistant",t.error&&e.jsx(ne,{size:12,className:"text-red-400"})]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(re,{text:t.role==="user"?t.content:Se(t.content)})}),t.role==="assistant"&&t.timing&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/30",children:e.jsx(le,{times:t.timing})}),t.role==="assistant"&&t.content&&e.jsx("button",{onClick:()=>oe(n),className:`absolute bottom-2 right-2 p-1.5 rounded-md transition-all ${R===`${n}`?"bg-emerald-500/20 text-emerald-400":"opacity-0 group-hover:opacity-100 bg-slate-700/70 text-slate-400"}`,children:R===`${n}`?e.jsx(be,{size:12}):e.jsx(ge,{size:12})})]}),C&&e.jsx("div",{className:"ml-4",children:e.jsx(Ee,{content:t.content,onSelect:P=>H(P,!0),isInline:!1})})]},n)}),N&&v.size>0&&e.jsx(e.Fragment,{children:Array.from(v.entries()).map(([t,n])=>{const C=m.find(B=>B.id===t),P=E.get(t);return e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[85%] rounded-2xl rounded-tl-sm px-4 py-3 bg-slate-800/60 border border-amber-500/30 text-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider text-amber-400/80",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/50 border-t-amber-400 rounded-full animate-spin"}),(C==null?void 0:C.name)||t]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(re,{text:n||"..."})}),P&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/30",children:e.jsx(le,{times:P})})]})},t)})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-[99] flex flex-col items-center gap-2 px-4 pb-4",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom))"},children:e.jsx(ye,{inputRef:M,inputFocused:S,setInputFocused:b,onSendMessage:H,isGenerating:N||u.size===0,onStop:q,placeholder:u.size===0?"Select a model above...":"Type a message..."})})]})});Te.displayName="ChatView";export{Te as default};
