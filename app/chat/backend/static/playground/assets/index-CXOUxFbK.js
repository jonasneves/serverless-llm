const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SettingsModal-BI6aXFSf.js","assets/react-vendor-Cr2kZ6Hw.js","assets/markdown-BhL5aFst.js","assets/math-render-BeslBgx1.js","assets/math-render-BqiDbsU2.css","assets/syntax-highlight-xu6YVAlF.js","assets/syntax-highlight-BEHUn5zE.css","assets/DiscussionTranscript-C3rrgU_z.js","assets/FormattedContent-C59IBQBw.js","assets/GestureControl-BR0BtKnU.js","assets/HandBackground-DNaG2EDE.js","assets/mediapipe-YSlczgt6.js","assets/ChatView-D_zNVuKG.js"])))=>i.map(i=>d[i]);
var Dn=Object.defineProperty;var zn=(t,n,o)=>n in t?Dn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;var Jt=(t,n,o)=>zn(t,typeof n!="symbol"?n+"":n,o);import{j as e,S as Pn,A as On,r as s,a as Bn,Z as $n,T as Hn,R as Wn,c as Yn,b as Xn}from"./react-vendor-Cr2kZ6Hw.js";import"./math-render-BeslBgx1.js";import"./syntax-highlight-xu6YVAlF.js";import"./markdown-BhL5aFst.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))u(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const b of a.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&u(b)}).observe(document,{childList:!0,subtree:!0});function o(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(c){if(c.ep)return;c.ep=!0;const a=o(c);fetch(c.href,a)}})();const Fn="modulepreload",Gn=function(t){return"/static/playground/"+t},Qt={},Ue=function(n,o,u){let c=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),p=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));c=Promise.allSettled(o.map(f=>{if(f=Gn(f),f in Qt)return;Qt[f]=!0;const h=f.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${m}`))return;const y=document.createElement("link");if(y.rel=h?"stylesheet":Fn,h||(y.as="script"),y.crossOrigin="",y.href=f,p&&y.setAttribute("nonce",p),document.head.appendChild(y),h)return new Promise((T,I)=>{y.addEventListener("load",T),y.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(b){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=b,window.dispatchEvent(p),!p.defaultPrevented)throw b}return c.then(b=>{for(const p of b||[])p.status==="rejected"&&a(p.reason);return n().catch(a)})},Un={"self-hosted":{color:"#10b981"},github:{color:"#3b82f6"},external:{color:"#8b5cf6"}},qn={nanbeige:1,qwen:2,r1qwen:3,deepseek:3,gemma:4,mistral:5,phi:6,rnj:7,llama:8,functiongemma:9,nemotron:10,gptoss:11,"gpt-oss":11},Kn={"gpt-4o":1,"gpt-4.1":2,"gpt-5":3,"gpt-5-mini":4,"gpt-5-nano":5,"llama-3.3-70b":6,"llama-4-scout-17b-16e-instruct":7,"mistral-large":8},Vn={"deepseek-v3-0324":1,"glm-4.6":2,"command-r-plus":3},Jn=50,Qn=100,Zn=150;function nr(t,n,o){if(o!==void 0)return o;let u,c;switch(n){case"self-hosted":u=qn,c=Jn;break;case"github":u=Kn,c=Qn;break;case"external":u=Vn,c=Zn;break}for(const[a,b]of Object.entries(u))if(t.toLowerCase().includes(a.toLowerCase()))return b;return c}const Nt=[{id:"eu-ai-act-enforcement",label:"EU AI Act Enforcement Wave",prompt:"The EU AI Act enters enforcement; high-risk systems must prove data provenance, evals, and risk controls. Outline compliance gaps for a frontier model API and tradeoffs between speed and alignment.",category:"Policy",modes:["analyze","debate"],tags:["governance","compliance"]},{id:"export-controls-blackwell",label:"Export Controls Tighten",prompt:"U.S. export rules tighten again on AI accelerators; Blackwell-class parts face new caps and cloud checks. Map the impact on training roadmaps, costs, and on-device strategies.",category:"Infra",modes:["compare","debate"],tags:["chips","supply-chain"]},{id:"weights-leak",label:"Major Weights Leak",prompt:"A commercial frontier model checkpoint leaks. Assess risks (misuse, impersonation, jailbreak diffusion), legal exposure, and whether open red-team releases mitigate or worsen safety.",category:"Security",modes:["analyze","debate"],tags:["safety","open-weights"]},{id:"on-device-llm-race",label:"On-Device LLM Race",prompt:"Phone OEMs ship 3nm NPUs and 20B-parameter on-device assistants. What actually moves the needle for UX, privacy, and cost vs. cloud? Where do hybrid (edge + cloud) designs win?",category:"Infra",modes:["compare","debate"],tags:["edge","latency"]},{id:"signed-app-prompt-injection",label:"Signed App Prompt Injection",prompt:"A popular signed desktop app shipped with hardcoded system prompts; attackers use supply chain updates to exfiltrate data. How should vendors audit, sandbox, and attest LLM apps?",category:"Security",modes:["compare","analyze"],tags:["supply-chain","prompt-injection"]},{id:"eval-standardization",label:"Safety Eval Standard",prompt:"NIST-style safety eval suites gain traction (jailbreak, autonomy, bio). How should vendors report scores, and what gaps remain for frontier vs. small models?",category:"Policy",modes:["compare","debate"],tags:["evaluation","safety"]},{id:"licensing-standoff",label:"Publisher Licensing Standoff",prompt:"Major news publishers pause AI licensing talks and sue over training. What remedies (revenue share, opt-out registries, model removal) are realistic, and how do they ripple to open models?",category:"Data",modes:["analyze","debate"],tags:["licensing","copyright"]},{id:"sbom-for-llms",label:"SBOM for LLM Pipelines",prompt:"Regulators push SBOMs and signed artifacts for AI stacks. Draft what should appear in an LLM pipeline SBOM (data, weights, evals, guardrails) and how to verify it at runtime.",category:"Security",modes:["compare","analyze"],tags:["sbom","supply-chain"]},{id:"data-poisoning-campaign",label:"Data Poisoning Campaign",prompt:"Researchers find coordinated data poisoning in popular open corpora. How should model hosts detect and mitigate poisoning post-hoc, and what retraining tradeoffs are acceptable?",category:"Security",modes:["compare","debate"],tags:["data","poisoning"]},{id:"copyright-settlement",label:"Copyright Settlement Sets Precedent",prompt:"A major copyright suit settles with dataset disclosure and per-output watermarking. Predict how this precedent affects future training sets and open-weight releases.",category:"Policy",modes:["debate"],tags:["copyright","watermarking"]}],sr={analyze:["What's the most important programming principle?","Should code comments explain 'what' or 'why'?","Is TypeScript worth the extra complexity?"],debate:["Tabs or spaces? Give your verdict.","Should AI be allowed to write its own code?","What will never be automated by AI?"],compare:[],chat:[]};Nt.filter(t=>t.category==="Policy"||t.category==="Data"),Nt.filter(t=>t.category==="Infra"),Nt.filter(t=>t.category==="Security");const es=["dots-mesh","dots","dots-fade","grid","mesh","animated-mesh","none"],at="#0f172a",Zt={compare:at,analyze:at,debate:at,chat:at},Ge={maxTokens:1024,temperature:.7},te={cardWidth:256,cardHeight:200,gapX:24,gapY:24,baseRadius:160,minRadius:120,radiusPerModel:15,scrollClamp:200};function ts({showDock:t,availableModels:n,allSelectedByType:o,totalModelsByType:u,handleDragStart:c,handleModelToggle:a,handleAddGroup:b,dockRef:p}){const f=[{type:"self-hosted",title:"Self-Hosted Models",accentColor:"emerald"},{type:"github",title:"GitHub Models",accentColor:"blue"}];return e.jsxs("div",{ref:p,"data-no-arena-scroll":!0,"data-no-background":!0,className:"dock-scroll model-dock-panel fixed left-3 top-20 bottom-20 w-[min(75vw,320px)] sm:left-6 sm:top-24 sm:bottom-24 sm:w-72 rounded-2xl flex flex-col z-[60] transition-all duration-300 overflow-hidden",style:{transform:t?"translateX(0)":"translateX(-150%)",opacity:t?1:0,pointerEvents:t?"auto":"none"},children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-700/50",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Available Models"}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5",children:"Click to add to arena"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:f.map(h=>{const m=n.filter(L=>L.type===h.type),y=o[h.type],T=u[h.type]>0,I={emerald:{button:"text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/10",dot:"bg-emerald-500",border:"hover:border-emerald-500/40"},blue:{button:"text-blue-400 hover:text-blue-300 hover:bg-blue-500/10",dot:"bg-blue-500",border:"hover:border-blue-500/40"}}[h.accentColor];return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${I.dot} ${h.type==="self-hosted"?"glow-dot-emerald":"glow-dot-blue"}`}),e.jsx("h3",{className:"text-[11px] font-semibold text-slate-300 uppercase tracking-wide",children:h.title}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",m.length,")"]})]}),e.jsx("button",{onClick:()=>b(h.type),className:`text-[10px] font-medium px-2 py-1.5 sm:py-0.5 rounded transition-all active:scale-95 ${I.button} ${T?"":"opacity-40 cursor-not-allowed"}`,disabled:!T,children:y?"− Remove All":"+ Add All"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[m.map(L=>e.jsxs("div",{draggable:!0,onDragStart:D=>c(D,L.id),onClick:()=>a(L.id),className:`group flex items-center gap-3 px-3 py-3 sm:py-2 rounded-lg cursor-grab active:cursor-grabbing hover:bg-white/5 transition-all border border-transparent active:scale-95 ${I.border}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${I.dot} opacity-60 group-hover:opacity-100 transition-opacity`}),e.jsx("span",{className:"text-xs font-medium text-slate-400 group-hover:text-slate-200 transition-colors",children:L.name})]},L.id)),m.length===0&&e.jsx("div",{className:"text-[10px] text-slate-600 italic px-3 py-2",children:"All models are in the arena"})]})]},h.type)})}),e.jsx("div",{className:"px-5 py-3 border-t border-slate-700/50 bg-slate-900/30",children:e.jsxs("p",{className:"text-[10px] text-slate-500 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-slate-800 text-slate-400 font-mono text-[9px]",children:"M"})," to toggle this panel"]})})]})}function ns({inputRef:t,inputFocused:n,setInputFocused:o,onSendMessage:u,className:c,style:a,placeholder:b,isGenerating:p,onStop:f}){return e.jsx("div",{className:c??"fixed bottom-0 right-0 left-0 z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300",style:a??{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full pointer-events-auto",style:{maxWidth:"600px"},children:e.jsxs("div",{className:`rounded-xl p-2.5 transition-all duration-300 flex items-center gap-2 border border-slate-700/40 header-shell ${n?"prompt-panel-focused":""}`,children:[e.jsx("input",{ref:t,type:"text",placeholder:b||"Ask a question to compare model responses...",className:"w-full bg-transparent text-slate-200 placeholder-slate-500 outline-none text-base sm:text-sm px-2.5 py-2.5",onFocus:()=>o(!0),onBlur:()=>o(!1),onKeyDown:h=>{var m;if(h.key==="Enter"&&!h.shiftKey){if(h.preventDefault(),p)return;(m=t.current)!=null&&m.value&&(u(t.current.value),t.current.value="")}},disabled:p}),e.jsx("button",{onClick:()=>{var h;p?f==null||f():(h=t.current)!=null&&h.value&&(u(t.current.value),t.current.value="")},onMouseDown:h=>h.currentTarget.blur(),className:`min-w-[44px] min-h-[44px] sm:min-w-[36px] sm:min-h-[36px] p-2 rounded-lg transition-colors active:scale-95 flex items-center justify-center focus:outline-none focus-visible:outline-none ${p?"text-red-400 hover:text-red-300 hover:bg-red-500/10":"text-slate-400 hover:text-white hover:bg-white/10"}`,"aria-label":p?"Stop generation":"Send message",children:p?e.jsx(Pn,{className:"w-5 h-5 sm:w-4 sm:h-4 fill-current"}):e.jsx(On,{className:"w-5 h-5 sm:w-4 sm:h-4",strokeWidth:2.5})})]})})})}const ss={chat:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),compare:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})}),analyze:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),debate:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})},De=[{value:"chat",label:"Chat"},{value:"compare",label:"Compare"},{value:"analyze",label:"Analyze"},{value:"debate",label:"Debate"}];function rs({mode:t,setMode:n,setHoveredCard:o,clearSelection:u,showDock:c,setShowDock:a,onOpenSettings:b,gestureButtonSlot:p}){const[f,h]=s.useState(!1),m=s.useRef(null),[y,T]=s.useState(!0),I=s.useRef(null),[L,D]=s.useState(null),[G,d]=s.useState(0),z=De.findIndex(S=>S.value===t),P=z===-1?0:z,X=De[P].label;s.useEffect(()=>{const S=()=>{T(window.innerWidth>=1024)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),s.useEffect(()=>{if(!I.current)return;const S=()=>{const ee=I.current;if(!ee)return;const C=ee.querySelectorAll('button[role="radio"]');if(C.length===0||P>=C.length)return;const $=C[P].getBoundingClientRect(),Q=ee.getBoundingClientRect(),Z=$.width,U=$.left,V=Q.left;D(Z),d(U-V)},J=setTimeout(S,0),W=new ResizeObserver(()=>{setTimeout(S,0)});return W.observe(I.current),window.addEventListener("resize",S),()=>{clearTimeout(J),W.disconnect(),window.removeEventListener("resize",S)}},[t,y,P]),s.useEffect(()=>{function S(J){m.current&&!m.current.contains(J.target)&&h(!1)}return f&&document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[f]);const O=S=>{n(S),o(null),u(),h(!1)};return e.jsxs("div",{className:"fixed top-0 left-0 right-0 flex items-center justify-between mb-2 px-3 sm:px-6 pt-4 sm:pt-6 z-50 pointer-events-none transition-all duration-300",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-auto",style:{height:"100%",zIndex:-1}}),e.jsx("div",{className:"flex items-center gap-2 w-auto pointer-events-auto z-20",children:p}),e.jsx("div",{className:"hidden md:block absolute left-1/2 -translate-x-1/2 pointer-events-auto z-20",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center p-1.5 rounded-xl border border-slate-700/40 header-shell",children:[e.jsx("button",{onClick:()=>a(!c),className:"px-2 sm:px-3 flex items-center justify-center text-slate-400 hover:text-white transition-colors",title:"Toggle Model Dock",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("div",{className:"w-px h-5 bg-slate-700/50 mx-0.5 sm:mx-1"}),e.jsxs("div",{ref:I,className:"relative flex p-1 rounded-lg bg-black/20 mode-track",role:"radiogroup","aria-label":"Mode selection","data-gesture-mode-track":"true",children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-md transition-all duration-300 ease-out mode-slider",style:{width:L!==null?`${L}px`:`calc((100% - 8px) / ${De.length})`,left:L!==null?`${G}px`:`calc(4px + (100% - 8px) * ${P} / ${De.length})`}}),De.map(S=>e.jsx("button",{tabIndex:-1,onClick:()=>O(S.value),role:"radio","aria-checked":t===S.value,"aria-label":S.label,title:S.label,className:`relative z-10 py-2 sm:py-1.5 px-3 text-[11px] sm:text-xs font-medium transition-colors duration-200 min-h-[44px] sm:min-h-0 active:scale-95 focus:outline-none focus-visible:outline-none flex-1 flex items-center justify-center text-center ${t===S.value?"text-white":"text-slate-400 hover:text-slate-200"}`,children:S.label},S.value))]})]})})}),e.jsx("div",{className:"flex md:hidden flex-1 justify-center pointer-events-auto relative z-20",children:e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{onClick:()=>h(!f),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800/90 border border-slate-700/50 text-slate-200 font-medium text-sm backdrop-blur-md shadow-lg active:scale-95 transition-all",children:[e.jsx("span",{className:"font-bold text-slate-400 hidden xs:inline",children:"Arena"}),e.jsx("span",{className:"font-bold hidden xs:inline text-slate-600",children:"/"}),e.jsx("span",{children:X}),e.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform duration-200 ${f?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),f&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 py-1 rounded-xl bg-slate-800 border border-slate-700 shadow-2xl overflow-hidden flex flex-col animate-in fade-in zoom-in-95 duration-100 origin-top",children:De.map(S=>e.jsxs("button",{onClick:()=>O(S.value),className:`px-4 py-3 text-sm text-left w-full transition-colors flex items-center gap-3 ${t===S.value?"bg-blue-500/10 text-blue-400":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{className:"flex-shrink-0",children:ss[S.value]}),e.jsx("span",{className:"flex-1",children:S.label}),t===S.value&&e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},S.value))})]})}),e.jsx("div",{className:"flex items-center gap-2 w-auto justify-end pointer-events-auto z-20",children:e.jsx("button",{onClick:b,className:"min-w-[42px] min-h-[42px] w-[42px] h-[42px] rounded-full bg-slate-800/50 flex items-center justify-center border border-slate-700/50 hover:border-slate-600 transition-colors active:scale-95 focus:outline-none focus-visible:outline-none",title:"Settings",children:e.jsxs("svg",{className:"w-4 h-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}const os=t=>{if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return null}},as=(t,n)=>{if(t===null)return n;try{return JSON.parse(t)}catch{return n}};function Oe(t,n,o={}){const u=o.serialize??os,c=o.deserialize??as,[a,b]=s.useState(()=>{if(typeof window>"u")return n;try{const p=window.localStorage.getItem(t);return c(p,n)}catch{return n}});return s.useEffect(()=>{if(!(typeof window>"u"))try{const p=u(a);p===null?window.localStorage.removeItem(t):window.localStorage.setItem(t,p)}catch{}},[t,u,a]),[a,b]}const is=800,ls=3e3,cs=8;function ds(){const[t,n]=s.useState([]),[o,u]=s.useState(!0),[c,a]=s.useState(null),[b,p]=s.useState(0),[f,h]=Oe("playground_selected_models",null),m=s.useRef(f!==null),[y,T]=Oe("playground_chat_model",null),I=s.useRef(y!==null),L=s.useMemo(()=>f??[],[f]),D=s.useCallback(C=>{h(q=>typeof C=="function"?C(q??[]):C)},[h]),[G,d]=s.useState(""),z=s.useRef(0),P=s.useRef(null),X=s.useCallback(async(C,q,$=!1)=>{P.current&&(clearTimeout(P.current),P.current=null),u(!0),$&&(a("Refreshing..."),p(0));const Q=Z=>{var ue,ie;const U=Z.models.map(F=>{const le=F.type==="self-hosted"||F.type==="github"||F.type==="external"?F.type:"self-hosted",me=Un[le];return{id:F.id,name:me.name||F.name||F.id,color:me.color,type:le,response:"Ready to generate...",priority:F.priority,context_length:F.context_length}});if(n(U),u(!1),a(null),p(0),m.current||(h(U.filter(F=>F.type==="self-hosted"&&F.id!=="nemotron-3-nano-30b-a3b").map(F=>F.id)),m.current=!0),!I.current){const F=U.find(le=>le.type==="github"||le.type==="external");T((F==null?void 0:F.id)||((ue=U[0])==null?void 0:ue.id)||null),I.current=!0}const V=U.find(F=>F.type==="github"||F.type==="external"),ne=((ie=U[0])==null?void 0:ie.id)||"";d((V==null?void 0:V.id)||ne)};try{const Z=await fetch("/api/models");if(C!==z.current)return;if(!Z.ok)throw new Error(`HTTP ${Z.status}`);const U=await Z.json();if(C!==z.current)return;if(!U.models||U.models.length===0)throw new Error("No models available yet");Q(U)}catch(Z){if(C!==z.current)return;console.warn("Backend fetch failed:",Z);try{console.log("Trying static models.json...");const V=await fetch("/models.json");if(V.ok){const ne=await V.json();if(ne.models&&ne.models.length>0){console.log(`Loaded ${ne.models.length} models from static file`),Q(ne);return}}}catch(V){console.warn("Static models.json not available:",V)}const U=q+1;if(p(U),U<cs){const V=Math.min(is*Math.pow(1.4,q),ls);a("Connecting to backend..."),P.current=setTimeout(()=>{X(C,U)},V)}else u(!1),a("Could not load models")}},[h,T]),O=s.useCallback(()=>{z.current+=1,X(z.current,0,!0)},[X]);s.useEffect(()=>(z.current+=1,X(z.current,0),()=>{z.current+=1,P.current&&clearTimeout(P.current)}),[X]);const S=s.useMemo(()=>t.filter(C=>!L.includes(C.id)),[t,L]),{totalModelsByType:J,allSelectedByType:W}=s.useMemo(()=>{const C={"self-hosted":t.filter($=>$.type==="self-hosted").length,github:t.filter($=>$.type==="github").length,external:t.filter($=>$.type==="external").length},q={"self-hosted":t.filter($=>$.type==="self-hosted"&&L.includes($.id)).length,github:t.filter($=>$.type==="github"&&L.includes($.id)).length,external:t.filter($=>$.type==="external"&&L.includes($.id)).length};return{totalModelsByType:C,allSelectedByType:{"self-hosted":C["self-hosted"]>0&&q["self-hosted"]===C["self-hosted"],github:C.github>0&&q.github===C.github,external:C.external>0&&q.external===C.external}}},[t,L]),ee=s.useCallback(C=>{var q;return((q=t.find($=>$.id===C))==null?void 0:q.name)||C},[t]);return{modelsData:t,setModelsData:n,selected:L,setSelected:D,chatModelId:y,setChatModelId:T,moderator:G,setModerator:d,availableModels:S,totalModelsByType:J,allSelectedByType:W,modelIdToName:ee,isLoading:o,loadError:c,retryCount:b,retryNow:O}}function us(){var t;return typeof chrome<"u"&&((t=chrome.storage)!=null&&t.local)?window.__API_BASE__||"https://chat.neevs.io":""}async function*At(t,n,o){var h;const c=`${us()}${t}`,a=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:o});if(!a.ok){yield{event:"error",error:`HTTP ${a.status}: ${a.statusText}`};return}const b=(h=a.body)==null?void 0:h.getReader();if(!b){yield{event:"error",error:"No response body"};return}const p=new TextDecoder;let f="";try{for(;;){const{done:m,value:y}=await b.read();if(m)break;f+=p.decode(y,{stream:!0});const T=f.split(`
`);f=T.pop()||"";for(const I of T)if(I.startsWith("data: ")){const L=I.slice(6).trim();if(L)try{yield JSON.parse(L)}catch{}}}}finally{b.releaseLock()}}const ps=async(t,n)=>At("/api/chat/stream",{models:t.models,messages:t.messages,max_tokens:t.max_tokens,temperature:t.temperature,github_token:t.github_token,openrouter_key:t.openrouter_key},n),fs=async(t,n)=>At("/api/chat/analyze/stream",t,n),hs=async(t,n)=>At("/api/chat/debate/stream",t,n),Tt=async(t,n)=>{try{for await(const o of t)n(o)}catch(o){throw console.error("Stream error:",o),o}};function en(t){window.__API_BASE__=t}const ms=[{name:"Chat",path:"chat.yml",category:"core"},{name:"Build Images",path:"build-push-images.yml",category:"core"},{name:"Nanbeige4-3B Thinking",path:"nanbeige-inference.yml",category:"reasoning",serviceKey:"nanbeige"},{name:"Qwen3 4B",path:"qwen-inference.yml",category:"small",serviceKey:"qwen"},{name:"SmolLM3 3B",path:"smollm3-inference.yml",category:"small",serviceKey:"smollm3"},{name:"DeepSeek R1 1.5B",path:"r1qwen-inference.yml",category:"reasoning",serviceKey:"r1qwen"},{name:"Gemma 3 12B",path:"gemma-inference.yml",category:"medium",serviceKey:"gemma"},{name:"Mistral 7B v0.3",path:"mistral-inference.yml",category:"medium",serviceKey:"mistral"},{name:"Phi-3 Mini",path:"phi-inference.yml",category:"small",serviceKey:"phi"},{name:"RNJ-1 Instruct",path:"rnj-inference.yml",category:"medium",serviceKey:"rnj"},{name:"Llama 3.2-3B",path:"llama-inference.yml",category:"medium",serviceKey:"llama"},{name:"FunctionGemma 270M",path:"functiongemma-inference.yml",category:"small",serviceKey:"functiongemma"},{name:"Nemotron-3 Nano 30B",path:"nemotron-inference.yml",category:"reasoning",serviceKey:"nemotron"},{name:"GPT-OSS 20B",path:"gptoss-inference.yml",category:"reasoning",serviceKey:"gptoss"}],xs={workflows:ms},sn=xs.workflows;new Map(sn.map(t=>[t.name,t.path]));new Map(sn.filter(t=>t.serviceKey).map(t=>[t.serviceKey,t.name]));const Pe={githubToken:"",profile:"local_all",chatApiBaseUrl:"http://localhost:8080",modelsBaseDomain:"",modelsUseHttps:!1};function tn(t){const n={...Pe,...t};(!n.chatApiBaseUrl||typeof n.chatApiBaseUrl!="string")&&typeof n.baseDomain=="string"&&(n.chatApiBaseUrl=n.baseDomain?`${n.useHttps===!1?"http":"https"}://chat.${n.baseDomain}`:"http://localhost:8080",n.profile="custom"),(!n.modelsBaseDomain||typeof n.modelsBaseDomain!="string")&&typeof n.baseDomain=="string"&&(n.modelsBaseDomain=n.baseDomain,n.profile="custom"),typeof n.modelsUseHttps!="boolean"&&typeof n.useHttps=="boolean"&&(n.modelsUseHttps=n.useHttps,n.profile="custom");const o=n.profile==="remote_all"||n.profile==="local_chat_remote_models"||n.profile==="local_all"||n.profile==="custom"?n.profile:Pe.profile;return{githubToken:typeof n.githubToken=="string"?n.githubToken:Pe.githubToken,profile:o,chatApiBaseUrl:_t(typeof n.chatApiBaseUrl=="string"?n.chatApiBaseUrl:""),modelsBaseDomain:typeof n.modelsBaseDomain=="string"?n.modelsBaseDomain:Pe.modelsBaseDomain,modelsUseHttps:typeof n.modelsUseHttps=="boolean"?n.modelsUseHttps:Pe.modelsUseHttps}}function gs(){var t;return typeof chrome<"u"&&!!((t=chrome.storage)!=null&&t.local)}function _t(t){const n=t.trim().replace(/\/+$/,"");return n||"http://localhost:8080"}function bs(){const[t,n]=s.useState(Pe),[o,u]=s.useState(!1);return s.useEffect(()=>{if(gs()){chrome.storage.local.get(["envConfig"],a=>{const b=tn(a.envConfig);n(b),u(!0);const p=_t(b.chatApiBaseUrl);en(p),console.log("[Config] Extension mode, API base:",p)});const c=(a,b)=>{var p;if(b==="local"&&((p=a.envConfig)!=null&&p.newValue)){const f=tn(a.envConfig.newValue);n(f);const h=_t(f.chatApiBaseUrl);en(h),console.log("[Config] Updated API base:",h)}};return chrome.storage.onChanged.addListener(c),()=>chrome.storage.onChanged.removeListener(c)}else u(!0),console.log("[Config] Web mode, using relative URLs")},[]),{config:t,isLoaded:o}}function ys(){const[t,n]=s.useState([]),o=s.useRef([]),u=s.useCallback(p=>{if(!p.length)return;const f=[...o.current,...p];o.current=f,n(f)},[]),c=s.useCallback(()=>{o.current=[],n([])},[]),a=s.useCallback(p=>p.map(f=>`${f.role==="user"?"User":"Assistant"}: ${f.content}`).join(`

`),[]),b=s.useCallback((p,f)=>{if(f==="compare")return p;const h=p.filter(y=>y.role==="user"),m=[...p].reverse().find(y=>y.role==="assistant"&&y.kind==="analyze_synthesis"&&y.content.trim().length>0);return m?[...h,m]:h},[]);return{history:t,historyRef:o,pushHistoryEntries:u,clearHistory:c,historyToText:a,buildCarryoverHistory:b}}function vs(t){const n=s.useRef({}),o=s.useRef(null),u=s.useCallback(()=>{o.current=null;const f=n.current;n.current={},Object.keys(f).length&&t(m=>m.map(y=>{const T=f[y.id];return T?{...y,response:(y.response||"")+T.answer,thinking:(y.thinking||"")+T.thinking}:y}))},[t]),c=s.useCallback(()=>{o.current==null&&(o.current=requestAnimationFrame(u))},[u]),a=s.useCallback((f,h,m)=>{if(!h&&!m)return;const y=n.current[f]||{answer:"",thinking:""};y.answer+=h,y.thinking+=m,n.current[f]=y,c()},[c]),b=s.useCallback(f=>{n.current[f]&&delete n.current[f]},[]),p=s.useCallback(()=>{n.current={},o.current!=null&&(cancelAnimationFrame(o.current),o.current=null)},[]);return{pendingStreamRef:n,flushStreamRafRef:o,enqueueStreamDelta:a,clearPendingStreamForModel:b,resetPendingStream:p}}function ws(t){const{mode:n,moderator:o,selected:u,selectedCardIds:c,githubToken:a,isGenerating:b,summarizeSessionResponses:p,setLastQuery:f,setHoveredCard:h,setPhaseLabel:m,setModeratorSynthesis:y,setDiscussionTurnsByModel:T,resetFailedModels:I,markModelFailed:L,failedModelsRef:D,currentDiscussionTurnRef:G,sessionModelIdsRef:d,abortControllerRef:z,thinkingStateRef:P,conversationHistoryRef:X,pushHistoryEntries:O,historyToText:S,buildCarryoverHistory:J,setModelsData:W,modelIdToName:ee,setExecutionTimes:C,setIsGenerating:q,setIsSynthesizing:$,setSpeaking:Q,enqueueStreamDelta:Z,clearPendingStreamForModel:U,resetPendingStream:V}=t;return{sendMessage:async(ue,ie,F,le)=>{if(!ue.trim()||u.length===0&&!F||!F&&b)return;const me=(le==null?void 0:le.skipHistory)??!1,se={role:"user",content:ue},Se=me?X.current:[...X.current,se];me||O([se]);const Be=J(Se,n),be=S(Be);f(ue);const we=be?`${be}

Continue the conversation above and respond to the latest user request.`:ue;let i;if(F)i=F;else{const R=Array.from(c).filter(j=>u.includes(j)&&(n==="compare"||j!==o));i=R.length>0?R:u.slice()}d.current=i;const re={},oe=(R,j,g)=>{if(!j)return;const x=g!=null&&g.label?`${g.label}: ${j}`:j;re[R]=g!=null&&g.replace?x:re[R]?`${re[R]}

${x}`:x},ce=new AbortController;z.current=ce,q(!0),$(!1),h(null),m(null),y(""),T({}),I(),G.current=null,V(),W(R=>R.map(j=>i.includes(j.id)||j.id===o?ie&&ie[j.id]?{...j,response:ie[j.id],thinking:void 0,error:void 0}:{...j,response:"",thinking:void 0,error:void 0}:j)),C(R=>{const j={...R},g=performance.now();return i.forEach(x=>{j[x]={startTime:g}}),o&&!j[o]&&(j[o]={startTime:g}),j});const ae=new Set(i);o&&ae.add(o),ae.forEach(R=>{P.current[R]={inThink:!1,carry:""}});const de=new Set,pe=(R,j)=>{const g=R==null?void 0:R.trim();!g||me||O([{role:"assistant",content:g,kind:j}])},ke=(R,j)=>{const g=P.current[R]||{inThink:!1,carry:""};let x=g.carry+j;g.carry="";const k=x.lastIndexOf("<");if(k!==-1&&x.length-k<8){const N=x.slice(k);("<think>".startsWith(N)||"</think>".startsWith(N))&&(g.carry=N,x=x.slice(0,k))}let w="",B="",_=0;for(;_<x.length;)if(g.inThink){const N=x.indexOf("</think>",_);if(N===-1){w+=x.slice(_);break}w+=x.slice(_,N),g.inThink=!1,_=N+8}else{const N=x.indexOf("<think>",_);if(N===-1){B+=x.slice(_);break}B+=x.slice(_,N),g.inThink=!0,_=N+7}P.current[R]=g,B&&oe(R,B),(w||B)&&Z(R,B,w)},Te=R=>{const j=R.toLowerCase();return j.includes("rate limit")||j.includes("waiting")?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="display: inline-block; vertical-align: text-bottom; margin-right: 6px;"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'+R:j.includes("error")||j.includes("failed")?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="display: inline-block; vertical-align: text-bottom; margin-right: 6px;"><path d="M12 2L2 20h20L12 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/><path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'+R:R};try{if(n==="compare"){Q(new Set(i));const R=await ps({models:i,messages:Se.map(j=>({role:j.role,content:j.content})),max_tokens:Ge.maxTokens,temperature:Ge.temperature,github_token:a||null},ce.signal);if(await Tt(R,j=>{if(j.event==="info"&&j.content){const g=String(j.content),x=Te(g);m(x),j.model_id&&W(k=>k.map(w=>w.id===j.model_id?{...w,statusMessage:x}:w))}if(j.event==="token"&&j.model_id){const g=j.model_id,x=performance.now();de.has(g)||(de.add(g),C(k=>({...k,[g]:{...k[g],firstTokenTime:x}})),W(k=>k.map(w=>w.id===g?{...w,statusMessage:void 0}:w))),ke(g,String(j.content??""))}if(j.event==="done"&&j.model_id){const g=performance.now(),x=j.model_id;C(k=>({...k,[x]:{...k[x],endTime:g}})),Q(k=>{const w=new Set(k);return w.delete(x),w})}}),!me){const j=p(re,i);j&&O([{role:"assistant",content:j,kind:"compare_summary"}])}return}if(n==="analyze"){const R=i;if(R.length<2){const x="Select at least 2 participants for Analyze mode.";y(x),o&&W(k=>k.map(w=>w.id===o?{...w,response:x}:w)),m("Error");return}Q(new Set(R));const j=await fs({query:we,participants:R,max_tokens:Ge.maxTokens,github_token:a||null},ce.signal);let g="";if(await Tt(j,x=>{const k=x.event;if(k==="analyze_start"&&m("Collecting Responses"),k==="model_start"&&x.model_id){const w=x.model_id;Q(B=>{const _=new Set(B);return _.add(w),_})}if(k==="model_chunk"&&x.model_id){const w=x.model_id,B=performance.now();de.has(w)||(de.add(w),C(_=>({..._,[w]:{..._[w],firstTokenTime:B}}))),ke(w,String(x.chunk??""))}if(k==="model_response"&&x.model_id){const w=x.model_id,B=performance.now();C(N=>({...N,[w]:{...N[w],endTime:B}})),Q(N=>{const K=new Set(N);return K.delete(w),K});const _=String(x.response??"");oe(w,_,{replace:!0}),ie&&ie[w]||(W(N=>N.map(K=>K.id===w?{...K,response:_}:K)),pe(`${ee(w)}:
${_}`,"analyze_response"))}if(k==="model_error"&&x.model_id){const w=x.model_id,B=performance.now();C(N=>({...N,[w]:{...N[w],endTime:B}})),Q(N=>{const K=new Set(N);return K.delete(w),K});const _=String(x.error??"Error generating response.");U(w),W(N=>N.map(K=>K.id===w?{...K,response:_,error:_}:K)),L(w),oe(w,_,{replace:!0})}if(k==="analysis_complete"){m("Analysis Complete");const w=x.consensus||[],B=x.unique_contributions||{};let _=`Analysis:

`;if(w.length>0&&(_+=`Consensus:
`+w.map(N=>`• ${N}`).join(`
`)+`

`),Object.keys(B).length>0){_+=`Unique Contributions:
`;for(const[N,K]of Object.entries(B)){const $e=ee(N);_+=`
${$e}:
`+K.map(Le=>`• ${Le}`).join(`
`)+`
`}}g=_,y(_),o&&W(N=>N.map(K=>K.id===o?{...K,response:_}:K))}if(k==="analyze_complete"&&(m("Complete"),Q(new Set)),k==="error"){const w=String(x.error??"Analyze error.");y(w),m("Error")}}),!me){const x=g.trim();x&&O([{role:"assistant",content:x,kind:"analyze_synthesis"}])}return}if(n==="debate"){const R=i;if(R.length<2){const g="Select at least 2 participants for Debate mode.";y(g),o&&W(x=>x.map(k=>k.id===o?{...k,response:g}:k)),m("Error");return}const j=await hs({query:we,participants:R,turns:2,max_tokens:Ge.maxTokens,temperature:Ge.temperature,github_token:a||null},ce.signal);await Tt(j,g=>{const x=g.event;if(x==="debate_start"&&m("Debate Starting"),x==="round_start"){const k=g.round_number??0;m(`Round ${k+1}`)}if(x==="turn_start"&&g.model_id){const k=g.model_id,w=g.turn_number??0,B=g.round_number??0;Q(new Set([k])),m(`Round ${B+1} · Turn ${w+1}`),G.current={modelId:k,turnNumber:w}}if(x==="turn_chunk"&&g.model_id){const k=g.model_id,w=performance.now();de.has(k)||(de.add(k),C(B=>({...B,[k]:{...B[k],firstTokenTime:w}}))),ke(k,String(g.chunk??""))}if(x==="turn_complete"&&g.model_id){const k=g.model_id,w=performance.now();C(N=>({...N,[k]:{...N[k],endTime:w}})),Q(N=>{const K=new Set(N);return K.delete(k),K});const B=String(g.response??""),_=g.turn_number??0;oe(k,B,{replace:!0}),W(N=>N.map(K=>K.id===k?{...K,response:B}:K)),T(N=>({...N,[k]:[...N[k]||[],{turn_number:_,response:B}]})),pe(`${ee(k)}:
${B}`,"debate_turn")}if(x==="turn_error"&&g.model_id){const k=g.model_id,w=performance.now();C(_=>({..._,[k]:{..._[k],endTime:w}})),Q(_=>{const N=new Set(_);return N.delete(k),N});const B=String(g.error??"Turn error.");U(k),W(_=>_.map(N=>N.id===k?{...N,response:B,error:B}:N)),L(k)}if(x==="debate_complete"&&(m("Complete"),Q(new Set)),x==="error"){const k=String(g.error??"Debate error.");m("Error"),y(k)}});return}}catch(R){if(R.name==="AbortError")return;if(console.error("Chat error:",R),z.current===ce){const j=R.message||String(R);y(`Session Error: ${j}`),m("Error"),V(),W(g=>g.map(x=>i.includes(x.id)&&!x.response?{...x,response:"Error generating response."}:x)),i.forEach(g=>L(g))}}finally{if(z.current===ce){const R=performance.now();C(j=>{const g={...j};return d.current.forEach(x=>{g[x]&&!g[x].endTime&&(g[x]={...g[x],endTime:R})}),g}),q(!1),$(!1),m(j=>j==="Error"?j:null),Q(new Set)}}}}}function Lt(t,n){const o=Math.min(t.x,n.x),u=Math.min(t.y,n.y),c=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return{left:o,top:u,right:c,bottom:a,width:c-o,height:a-u}}function ks({rootContainerRef:t,visualizationAreaRef:n,arenaOffsetYRef:o,arenaTargetYRef:u,wheelRafRef:c,selectedModels:a,cardRefs:b,selectedCardIds:p,setSelectedCardIds:f,suppressClickRef:h}){const[m,y]=s.useState(null),T=s.useRef(!1);s.useEffect(()=>{T.current=m!=null},[m]),s.useEffect(()=>{const D=G=>{if(G.button!==0||!t.current)return;const d=G.target;if(!d)return;const z=d.closest("[data-card]"),P=d.closest('button, a, input, textarea, select, [role="button"]'),X=d.closest("[draggable]"),O=d.closest("[data-no-arena-scroll]");if(z||P||X||O||!t.current.contains(d))return;u.current=o.current,c.current!=null&&(cancelAnimationFrame(c.current),c.current=null);const S=t.current.getBoundingClientRect(),J={x:G.clientX-S.left,y:G.clientY-S.top};G.preventDefault(),T.current=!0,h.current.card=!1,h.current.background=!1,y({origin:J,current:J,active:!1})};return window.addEventListener("mousedown",D,!0),()=>window.removeEventListener("mousedown",D,!0)},[o,u,c,t,n,h]),s.useEffect(()=>{if(!m||!t.current)return;const D=z=>z.preventDefault();document.addEventListener("selectstart",D);const G=z=>{const P=t.current.getBoundingClientRect(),X={x:z.clientX-P.left,y:z.clientY-P.top};y(O=>{if(!O)return O;const S=Lt(O.origin,X),J=O.active||S.width>4||S.height>4;return{...O,current:X,active:J}})},d=z=>{T.current=!1;const P=t.current.getBoundingClientRect(),X={x:z.clientX-P.left,y:z.clientY-P.top},O=z.target,S=!!(O&&O.closest("[data-card]"));y(J=>{if(!J)return null;const W=Lt(J.origin,X);if(J.active&&W.width>0&&W.height>0){const ee=[],C=t.current.getBoundingClientRect(),q={left:C.left+W.left,right:C.left+W.right,top:C.top+W.top,bottom:C.top+W.bottom};for(const $ of a){const Q=b.current.get($.id);if(!Q)continue;const Z=Q.getBoundingClientRect();!(Z.right<q.left||Z.left>q.right||Z.bottom<q.top||Z.top>q.bottom)&&ee.push($.id)}f(new Set(ee)),S?h.current.card=!0:ee.length>0&&(h.current.background=!0)}return null})};return window.addEventListener("mousemove",G),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",d),document.removeEventListener("selectstart",D)}},[m,t,n,a,b,p,f,h]);const I=s.useMemo(()=>{if(!m||!m.active)return null;const D=Lt(m.origin,m.current);return D.width<=0||D.height<=0?null:{left:D.left,top:D.top,width:D.width,height:D.height}},[m]),L=s.useCallback(()=>{y(null),T.current=!1},[]);return{selectionRect:I,isSelecting:m!=null,dragSelectionActiveRef:T,clearSelection:L}}function js({visualizationAreaRef:t,cardRefs:n,selected:o,setSelected:u,mode:c,gridCols:a,getCirclePosition:b}){const[p,f]=s.useState(null),h=s.useCallback((m,y)=>{if(m.button!==0||m.target.closest('button, a, input, textarea, select, [role="button"]'))return;m.preventDefault();const I=n.current.get(y);if(!I||!t.current)return;const L=I.getBoundingClientRect(),D=t.current.getBoundingClientRect(),G=L.left+L.width/2,d=L.top+L.height/2;f({activeId:y,currX:m.clientX,currY:m.clientY,offsetX:G-m.clientX,offsetY:d-m.clientY,containerLeft:D.left,containerTop:D.top,containerWidth:D.width,containerHeight:D.height,cardHeight:L.height}),m.target.setPointerCapture(m.pointerId)},[t]);return s.useEffect(()=>{if(!p)return;const m=T=>{if(f(d=>d?{...d,currX:T.clientX,currY:T.clientY}:null),!t.current)return;const I=t.current.getBoundingClientRect(),L=o.indexOf(p.activeId);let D=1/0,G=-1;if(c==="compare"){const d=T.clientX-(I.left+I.width/2),z=T.clientY-I.top,P=(te.cardWidth+te.gapX)*a-te.gapX;o.forEach((X,O)=>{const S=Math.floor(O/a),W=O%a*(te.cardWidth+te.gapX)-P/2+te.cardWidth/2,ee=S*(te.cardHeight+te.gapY),C=W,q=ee+te.cardHeight/2,$=(d-C)**2+(z-q)**2;$<D&&(D=$,G=O)})}else{const d=T.clientX-(I.left+I.width/2),z=T.clientY-(I.top+I.height/2),P=Math.max(te.baseRadius,te.minRadius+o.length*te.radiusPerModel);o.forEach((X,O)=>{const S=b(O,o.length,c,P),J=(d-S.x)**2+(z-S.y)**2;J<D&&(D=J,G=O)})}if(G!==-1&&G!==L){const d=[...o],[z]=d.splice(L,1);d.splice(G,0,z),u(d)}},y=()=>f(null);return window.addEventListener("pointermove",m),window.addEventListener("pointerup",y),()=>{window.removeEventListener("pointermove",m),window.removeEventListener("pointerup",y)}},[p,t,n,o,u,c,a,b]),{dragState:p,handlePointerDown:h}}const Ss={autoMode:!0,autoModeScope:"local",selectedModelId:null};function Ms(t,n){switch(n.type){case"SET_AUTO_MODE":return{...t,autoMode:n.payload};case"SET_AUTO_MODE_SCOPE":return{...t,autoMode:!0,autoModeScope:n.payload};case"SELECT_MODEL":return{...t,selectedModelId:n.payload};default:return t}}function Es(t){const[n,o]=s.useReducer(Ms,{...Ss,...t});return{autoMode:n.autoMode,autoModeScope:n.autoModeScope,selectedModelId:n.selectedModelId,setAutoMode:u=>o({type:"SET_AUTO_MODE",payload:u}),setAutoModeScope:u=>o({type:"SET_AUTO_MODE_SCOPE",payload:u}),selectModel:u=>o({type:"SELECT_MODEL",payload:u})}}const ve=(t,n)=>!t||!t.startsWith("#")?t:t.length===7||t.length===4?`${t}${n}`:t,Cs={idle:"Ready",responding:"Responding",done:"Done",waiting:"Waiting",error:"Error"};function Rt({state:t,color:n,size:o=16,label:u,className:c=""}){const a={width:`${o}px`,height:`${o}px`},b=u??Cs[t],p=Math.max(2,Math.round(o*.14)),f=Math.max(12,o-2),h="#fbbf24",m=ve(n,"cc"),y=()=>{switch(t){case"responding":return e.jsx("div",{className:"relative flex items-center justify-center",style:a,children:e.jsxs("svg",{width:f,height:f,viewBox:"0 0 24 24",fill:"none",className:"",style:{filter:`drop-shadow(0 0 6px ${ve(h,"55")})`,animation:"spin 0.6s linear infinite"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"spinnerGradient",gradientUnits:"userSpaceOnUse",x1:"3",y1:"12",x2:"12",y2:"3",children:[e.jsx("stop",{offset:"0%",stopColor:h,stopOpacity:"1"}),e.jsx("stop",{offset:"60%",stopColor:h,stopOpacity:"0.5"}),e.jsx("stop",{offset:"100%",stopColor:h,stopOpacity:"0"})]})}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:ve(h,"15"),strokeWidth:p,fill:"none"}),e.jsx("path",{d:"M 12 3 A 9 9 0 1 1 3 12",stroke:"url(#spinnerGradient)",strokeWidth:p,strokeLinecap:"round",fill:"none"}),e.jsx("circle",{cx:"3",cy:"12",r:p*.7,fill:h})]})});case"done":return e.jsx("div",{className:"flex items-center justify-center rounded-full",style:{...a,background:ve(n,"14"),border:`1px solid ${ve(n,"99")}`},children:e.jsx("svg",{width:f,height:f,viewBox:"0 0 24 24",fill:"none",children:e.jsx("polyline",{points:"5 13 10 18 19 7",stroke:n,strokeWidth:p,strokeLinecap:"round",strokeLinejoin:"round"})})});case"error":const T="#ef4444";return e.jsx("div",{className:"flex items-center justify-center rounded-full",style:{...a,background:ve(T,"14"),border:`1px solid ${ve(T,"99")}`},children:e.jsx("svg",{width:f,height:f,viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 6L18 18M6 18L18 6",stroke:T,strokeWidth:p,strokeLinecap:"round",strokeLinejoin:"round"})})});case"waiting":return e.jsxs("div",{className:"relative flex items-center justify-center",style:a,children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{border:`1px solid ${ve(m,"99")}`}}),e.jsx("svg",{width:f,height:f,viewBox:"0 0 24 24",fill:"none",style:{animation:"spin 5s linear infinite"},children:e.jsx("circle",{cx:"12",cy:"12",r:"8.5",stroke:ve(m,"44"),strokeWidth:p-1,strokeDasharray:"6 10",strokeLinecap:"round"})}),e.jsx("div",{className:"absolute w-2 h-2 rounded-full",style:{background:ve(m,"aa"),animation:"pulse 1.5s ease-in-out infinite"}})]});default:return e.jsxs("div",{className:"relative flex items-center justify-center",style:a,children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{border:"1px solid rgba(71, 85, 105, 0.5)"}}),e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:"rgba(148, 163, 184, 0.6)",animation:"pulse 2.4s ease-in-out infinite"}})]})}};return e.jsx("div",{className:`inline-flex items-center justify-center ${c}`,title:b,children:y()})}function nn({times:t}){const n=(t==null?void 0:t.startTime)!=null,o=(t==null?void 0:t.endTime)!=null,u=(t==null?void 0:t.firstTokenTime)!=null,c=n&&o?((t.endTime-t.startTime)/1e3).toFixed(2):null,a=n&&u?((t.firstTokenTime-t.startTime)/1e3).toFixed(2):null;return e.jsxs("div",{className:"text-[10px] text-slate-500",children:[e.jsx("span",{className:"text-slate-400",children:"TIME"})," ",c?`${c}s`:n&&!o?"...":"—",a&&e.jsxs("span",{className:"ml-2 text-slate-600",children:["TTFT ",a,"s"]})]})}const It=({text:t,speed:n=5})=>{const[o,u]=s.useState(""),c=s.useRef(0),a=s.useRef(null);return s.useEffect(()=>{!t.startsWith(o)&&o!==""&&(u(""),c.current=0)},[t]),s.useEffect(()=>{a.current!=null&&(clearTimeout(a.current),a.current=null);const b=t.length;if(c.current>=b)return;const p=()=>{const f=c.current,h=b-f;if(h<=0)return;const m=h>120?12:h>40?4:h>10?2:1,y=Math.min(b,f+m);c.current=y,u(t.slice(0,y));const I=b-y>5?0:n;a.current=window.setTimeout(p,I)};return a.current=window.setTimeout(p,n),()=>{a.current!=null&&(clearTimeout(a.current),a.current=null)}},[t,n]),e.jsx("span",{children:o})},it=256,rn=200,ze=96;function Ns(t){const{mode:n,selectedModels:o,gridCols:u,speaking:c,selectedCardIds:a,setSelectedCardIds:b,executionTimes:p,failedModels:f,cardRefs:h,handlePointerDown:m,dragState:y,setContextMenu:T,suppressClickRef:I,getTailSnippet:L,hoveredCard:D,setHoveredCard:G,layoutRadius:d,getCirclePosition:z,moderatorModel:P,moderatorId:X,orchestratorTransform:O,orchestratorStatus:S,orchestratorPhaseLabel:J,moderatorSynthesis:W,isSynthesizing:ee,isGenerating:C,phaseLabel:q,linesTransitioning:$,lastSelectedCardRef:Q,orchestratorAutoMode:Z,orchestratorAutoScope:U,showOrchestratorMenu:V,setShowOrchestratorMenu:ne,setOrchestratorAutoMode:ue,setOrchestratorAutoScope:ie,orchestratorMenuRef:F,availableModels:le,setModerator:me}=t,se=n!=="compare",Se=n==="analyze"?d-64:0,Be=S==="responding"?"Responding":S==="waiting"?"Waiting":S==="done"?"Done":"Ready",[be,we]=s.useState(null);return s.useEffect(()=>{if(!V)return;const i=re=>{F.current&&!F.current.contains(re.target)&&(ne(!1),we(null))};return document.addEventListener("mousedown",i,!0),()=>document.removeEventListener("mousedown",i,!0)},[V,F,ne]),e.jsxs(e.Fragment,{children:[o.map((i,re)=>{var Re;const oe=z(re,o.length,n,d),ce=Ts(re,u),ae=c.has(i.id),de=a.has(i.id),pe=f.has(i.id),ke=!ae&&!pe&&!!((Re=p[i.id])!=null&&Re.endTime)&&i.response.trim().length>0,Te=!ae&&!ke&&!pe&&C&&n==="debate",R=pe?"error":ae?"responding":ke?"done":Te?"waiting":"idle",j=pe?"Error":ae?"Responding":ke?"Done":Te?"Waiting":"Ready",g="#fbbf24",x="#ef4444",k=i.type==="self-hosted"?"#10b981":"#3b82f6",w=pe?x:k,B=ae&&!pe,_="rgba(30, 41, 59, 0.85)",N=pe?`linear-gradient(135deg, ${x}14, ${_})`:B?`linear-gradient(135deg, ${g}14, ${_})`:_,K=pe?`1px solid ${x}99`:B?`1px solid ${g}99`:de?`1px solid ${k}d0`:"1px solid rgba(71, 85, 105, 0.5)",$e=pe?`0 0 24px ${x}33, inset 0 1px 1px rgba(255,255,255,0.1)`:B?`0 0 24px ${g}33, inset 0 1px 1px rgba(255,255,255,0.1)`:de?`0 0 20px ${k}30, inset 0 1px 1px rgba(255,255,255,0.1)`:"0 4px 20px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.05)",Le=Ls({mode:n,gridX:ce.gridX,gridY:ce.gridY,circleX:oe.x,circleY:oe.y,dragState:y,modelId:i.id}),lt=D===i.id,ct=se?ze:it,dt=se?ze:rn,he=Math.max(800,d*2+600),Me=he/2,qe=Me,Ke=Me,Ve=Me+(0-oe.x),Je=Me+(Se-oe.y);return e.jsxs("div",{ref:fe=>{fe?h.current.set(i.id,fe):h.current.delete(i.id)},onPointerDown:fe=>m(fe,i.id),className:"absolute",onContextMenu:fe=>{fe.preventDefault(),fe.stopPropagation(),T({x:fe.clientX,y:fe.clientY,modelId:i.id})},style:{transform:Le,zIndex:se?lt?300:de?40:ae?15:5:de?20:ae?10:1,left:"50%",top:se?"50%":"0",transition:(y==null?void 0:y.activeId)===i.id?"none":"transform 300ms cubic-bezier(0.2, 0, 0.2, 1)"},children:[se&&ae&&!pe&&!$&&e.jsxs("svg",{className:"absolute pointer-events-none",style:{width:`${he}px`,height:`${he}px`,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:-1},viewBox:`0 0 ${he} ${he}`,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`grad-${i.id}`,gradientUnits:"userSpaceOnUse",x1:qe,y1:Ke,x2:Ve,y2:Je,children:[e.jsx("stop",{offset:"0%",stopColor:g,stopOpacity:"0.45"}),e.jsx("stop",{offset:"100%",stopColor:g,stopOpacity:"0.12"})]})}),e.jsx("line",{x1:qe,y1:Ke,x2:Ve,y2:Je,stroke:`url(#grad-${i.id})`,strokeWidth:"2",strokeDasharray:"6,4",strokeLinecap:"round",className:"animate-flow arena-link"})]}),e.jsxs("div",{"data-card":!0,onClick:fe=>Rs({e:fe,modelId:i.id,suppressClickRef:I,setSelectedCardIds:b,selectedModels:o,lastSelectedCardRef:Q}),onMouseEnter:()=>se&&G(i.id),onMouseLeave:()=>se&&G(null),className:`relative cursor-grab active:cursor-grabbing card-hover ${se?"rounded-full":""} ${de?"card-selected":""} ${ae?"card-speaking":""}`,style:{background:N,backdropFilter:se?void 0:"blur(8px)",WebkitBackdropFilter:se?void 0:"blur(8px)",border:K,boxShadow:$e,transform:de||B?"scale(1.05)":"scale(1)",width:`${ct}px`,height:`${dt}px`,borderRadius:se?"50%":"12px",transition:"transform 180ms ease-out, box-shadow 180ms ease-out, border-color 180ms ease-out, width 0.7s cubic-bezier(0.4, 0, 0.2, 1), height 0.7s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.7s cubic-bezier(0.4, 0, 0.2, 1)"},children:[!se&&e.jsxs("div",{style:Ds,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(Rt,{state:R,color:w,size:16,label:j}),e.jsx("span",{className:"text-xs font-semibold text-slate-200 truncate",children:i.name})]}),e.jsx("div",{className:"flex items-center gap-1.5 shrink-0",children:e.jsx("span",{className:`text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded ${i.type==="self-hosted"?"bg-emerald-500/10 text-emerald-300 border border-emerald-500/30":"bg-blue-500/10 text-blue-300 border border-blue-500/30"}`,children:i.type==="self-hosted"?"Local":"API"})})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed line-clamp-3 flex-1",children:_s({model:i,isSpeaking:ae,thinkingFallback:e.jsx("span",{className:"text-slate-500 italic",children:"Thinking…"}),getTailSnippet:L})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-slate-700/50",children:e.jsx(nn,{times:p[i.id]})})]}),se&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-center",style:{transition:"opacity 0.3s ease-out"},children:[e.jsx("div",{className:"absolute inset-[3px] rounded-full border border-white/5",style:{boxShadow:`inset 0 0 20px ${w}15`}}),e.jsx("div",{className:"absolute inset-[-6px] rounded-full opacity-60",style:{background:`radial-gradient(circle, ${w}22 0%, transparent 65%)`,filter:"blur(10px)"}}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center gap-1.5 px-3",children:[e.jsx("div",{className:"text-[7px] tracking-[0.32em] text-slate-400 uppercase",children:j}),e.jsx("div",{className:"text-[10px] font-semibold text-slate-100 leading-tight",children:i.name}),e.jsx(Rt,{state:R,color:w,size:12})]})]})]}),n==="analyze"&&se&&i.personaEmoji&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center justify-center pointer-events-none select-none",style:{bottom:"-12px",fontSize:"20px",zIndex:100,transition:"transform 180ms ease-out",transform:ae?"scale(1.15)":"scale(1)",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5)) drop-shadow(0 0 8px rgba(0,0,0,0.3))"},title:i.personaName?`${i.personaName} - ${i.personaTrait}`:"Persona",children:i.personaEmoji}),se&&ae&&i.thinking&&i.thinking.trim().length>0&&i.response.trim().length===0&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center justify-center pointer-events-none select-none animate-pulse",style:{bottom:"-12px",fontSize:"18px",zIndex:100,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5)) drop-shadow(0 0 10px rgba(168, 85, 247, 0.4))"},title:"Thinking...",children:"💭"}),se&&D===i.id&&e.jsxs("div",{"data-card":!0,onClick:fe=>fe.stopPropagation(),className:"absolute w-64 max-w-[calc(100vw-2rem)] p-4 rounded-xl transition-all duration-300 z-[220]",style:{top:oe.y>0?"auto":"100%",bottom:oe.y>0?"100%":"auto",left:"50%",transform:"translateX(-50%)",marginTop:oe.y>0?0:"12px",marginBottom:oe.y>0?"12px":0,background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(16px)",border:`1px solid ${w}40`,boxShadow:`0 20px 40px rgba(0,0,0,0.5), 0 0 20px ${w}15`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:w}}),e.jsx("span",{className:"text-xs font-semibold text-slate-300",children:i.name})]}),n==="analyze"&&i.personaEmoji&&i.personaName&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-700/50",children:[e.jsx("span",{className:"text-base",children:i.personaEmoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-semibold text-blue-400",children:i.personaName}),i.personaTrait&&e.jsx("div",{className:"text-[10px] text-slate-500",children:i.personaTrait})]})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed whitespace-pre-wrap",children:As({model:i,isSpeaking:ae,getTailSnippet:L})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-2 border-t border-slate-700/50",children:e.jsx(nn,{times:p[i.id]})})]})]},i.id)}),n!=="compare"&&P&&e.jsxs("div",{"data-card":!0,className:"absolute z-20 transition-all duration-700 ease-out cursor-pointer",style:{opacity:1,transform:O,left:"50%",top:n==="analyze"?`calc(50% + ${d}px - 64px)`:"50%"},onClick:i=>{i.stopPropagation(),X&&(b(new Set([X])),Q.current=X)},onContextMenu:i=>{i.preventDefault(),i.stopPropagation(),V?(ne(!1),we(null)):(we({x:i.clientX,y:i.clientY}),ne(!0))},onMouseEnter:()=>G("moderator"),onMouseLeave:()=>G(null),children:[e.jsx("div",{className:"relative flex items-center justify-center",style:{width:`${ze}px`,height:`${ze}px`},children:(()=>{const i=S==="responding",re=i?"#fbbf24":P.color;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-pulse",style:{background:`radial-gradient(circle, ${re}20 0%, transparent 70%)`,transform:"scale(2.2)",filter:"blur(18px)"}}),e.jsxs("div",{className:"relative rounded-full flex items-center justify-center transition-all duration-300",style:{width:`${ze}px`,height:`${ze}px`,background:i?"linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(15, 23, 42, 0.9))":"rgba(15, 23, 42, 0.9)",backdropFilter:"blur(16px)",border:`2px solid ${re}${i?"99":"60"}`,boxShadow:`0 0 36px ${re}${i?"40":"28"}, inset 0 1px 1px rgba(255,255,255,0.1)`},children:[e.jsx("div",{className:"absolute inset-[-4px] rounded-full",style:{background:`conic-gradient(from 0deg, transparent, ${re}60, transparent)`,animation:"spin 4s linear infinite"}}),e.jsx("div",{className:"absolute inset-[2px] rounded-full",style:{background:"rgba(15, 23, 42, 0.96)"}}),e.jsxs("div",{className:"relative text-center z-10 flex flex-col items-center gap-1.5 px-3",children:[e.jsx("div",{className:"text-[7px] tracking-[0.32em] text-slate-400 uppercase",children:Be}),e.jsx("div",{className:"text-[10px] font-semibold text-slate-100 leading-tight",children:P.name}),e.jsx(Rt,{state:S,color:re,size:12})]})]})]})})()}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex flex-col items-center gap-1 w-max max-w-[200px]",style:{top:"calc(100% + 12px)"},children:e.jsx("span",{className:"text-[10px] text-slate-500",children:J})}),D==="moderator"&&!V&&(()=>{const i=S==="responding",re=i?"#fbbf24":P.color;return e.jsxs("div",{"data-card":!0,onClick:oe=>oe.stopPropagation(),className:"absolute bottom-full mb-4 left-1/2 -translate-x-1/2 w-80 max-w-[calc(100vw-2rem)] p-4 rounded-xl z-[200] transition-all duration-300",style:{background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(16px)",border:`1px solid ${re}40`,boxShadow:`0 20px 40px rgba(0,0,0,0.5), 0 0 30px ${re}20`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Orchestrator"}),e.jsx("span",{className:"text-xs text-slate-500",children:"·"}),e.jsx("span",{className:"text-xs font-medium text-slate-300",children:P.name}),i&&e.jsx("span",{className:"text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-300 border border-yellow-500/30",children:"Working"})]}),e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:Is({moderatorSynthesis:W,isSynthesizing:ee,moderatorId:X,speaking:c,phaseLabel:q,isGenerating:C,getTailSnippet:L})})]})})(),V&&be&&Bn.createPortal(e.jsx("div",{ref:F,className:"w-64 bg-slate-800 border border-slate-700 rounded-lg shadow-xl overflow-hidden",style:{position:"fixed",top:`${be.y}px`,left:`${be.x}px`,transform:"translateY(-50%)",zIndex:9999},onClick:i=>i.stopPropagation(),children:Z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[10px] uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-700/50",children:["Auto Mode: ",U.toUpperCase()]}),["all","local","api"].map(i=>e.jsxs("button",{onClick:()=>{ie(i),ne(!1)},className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors ${U===i?"bg-yellow-500/20 text-yellow-300":"text-slate-300 hover:bg-slate-700/50"}`,children:[i==="all"&&"All",i==="local"&&"Local",i==="api"&&"API",e.jsxs("span",{className:"text-[10px] text-slate-500 ml-1",children:[i==="all"&&"(local → API)",i==="local"&&"(no quota)",i==="api"&&"(cloud only)"]})]},i)),e.jsx("div",{className:"border-t border-slate-700",children:e.jsx("button",{onClick:()=>{ue(!1),ne(!1)},className:"w-full px-3 py-2 text-left text-xs font-medium text-slate-400 hover:bg-slate-700/50 transition-colors",children:"Manual Mode"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 text-[10px] uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-700/50",children:"Select Orchestrator"}),le.filter(i=>i.type==="github"||i.type==="external").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 text-[9px] uppercase tracking-wider text-slate-600 font-semibold",children:"GitHub Models"}),le.filter(i=>i.type==="github"||i.type==="external").map(i=>e.jsx("button",{onClick:()=>{me(i.id),ne(!1)},className:`w-full px-4 py-2 text-left text-xs font-medium transition-colors ${X===i.id?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),X===i.id&&e.jsx("span",{className:"text-blue-400",children:"✓"})]})},i.id))]}),le.filter(i=>i.type==="self-hosted").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 text-[9px] uppercase tracking-wider text-slate-600 font-semibold border-t border-slate-700/50 mt-1",children:"Self-Hosted Models"}),le.filter(i=>i.type==="self-hosted").map(i=>e.jsx("button",{onClick:()=>{me(i.id),ne(!1)},className:`w-full px-4 py-2 text-left text-xs font-medium transition-colors ${X===i.id?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),X===i.id&&e.jsx("span",{className:"text-blue-400",children:"✓"})]})},i.id))]}),e.jsx("div",{className:"border-t border-slate-700",children:e.jsxs("button",{onClick:()=>{ue(!0),ne(!1)},className:"w-full px-3 py-2 text-left text-xs font-medium text-yellow-400 hover:bg-slate-700/50 transition-colors flex items-center gap-2",children:[e.jsx($n,{size:12}),e.jsx("span",{children:"Enable Auto Mode"})]})})]})}),document.body)]}),n!=="compare"&&e.jsxs("svg",{className:"absolute pointer-events-none transition-opacity duration-700",style:{width:"1000px",height:"1000px",opacity:.2},children:[e.jsx("circle",{cx:"500",cy:"500",r:d,fill:"none",stroke:"url(#circleGrad)",strokeWidth:"1",strokeDasharray:"8,4"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"circleGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"50%",stopColor:"#8b5cf6"}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6"})]})})]})]})}function Ts(t,n){const o=Math.floor(t/n),u=t%n,c=(it+te.gapX)*n-te.gapX,a=o*(rn+te.gapY);return{gridX:u*(it+te.gapX)-c/2+it/2,gridY:a}}function Ls({mode:t,gridX:n,gridY:o,circleX:u,circleY:c,dragState:a,modelId:b}){if((a==null?void 0:a.activeId)===b){const p=a.currX+a.offsetX,f=a.currY+a.offsetY;if(t==="compare"){const y=p-(a.containerLeft+a.containerWidth/2),T=f-a.containerTop-a.cardHeight/2;return`translate(calc(-50% + ${y}px), ${T}px)`}const h=p-(a.containerLeft+a.containerWidth/2),m=f-(a.containerTop+a.containerHeight/2);return`translate(calc(-50% + ${h}px), calc(-50% + ${m}px))`}return t==="compare"?`translate(calc(-50% + ${n}px), ${o}px)`:`translate(calc(-50% + ${u}px), calc(-50% + ${c}px))`}function Rs({e:t,modelId:n,suppressClickRef:o,setSelectedCardIds:u,selectedModels:c,lastSelectedCardRef:a}){if(t.stopPropagation(),o.current.card){o.current.card=!1;return}const b=t.shiftKey,p=t.metaKey||t.ctrlKey;if(b&&a.current){const f=c.findIndex(m=>m.id===a.current),h=c.findIndex(m=>m.id===n);if(f!==-1&&h!==-1){const m=Math.min(f,h),y=Math.max(f,h),T=c.slice(m,y+1).map(I=>I.id);u(I=>{const L=new Set(I);return T.forEach(D=>L.add(D)),L})}}else p?(u(f=>{const h=new Set(f);return h.has(n)?h.delete(n):h.add(n),h}),a.current=n):(u(new Set([n])),a.current=n)}function _s({model:t,isSpeaking:n,thinkingFallback:o,getTailSnippet:u}){return t.statusMessage?t.statusMessage.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.statusMessage}}):t.statusMessage:n?t.response.trim().length>0?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):e.jsx(It,{text:t.response,speed:20}):t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-slate-500 italic",children:"Thinking… "}),u(t.thinking.trim(),220)]}):o:t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):t.response}function As({model:t,isSpeaking:n,getTailSnippet:o,maxChars:u=220}){return t.statusMessage?t.statusMessage.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.statusMessage}}):t.statusMessage:n?t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-purple-400/80 text-[10px] uppercase tracking-wider font-medium",children:"💭 Thinking "}),e.jsx("span",{className:"text-slate-400",children:o(t.thinking.trim(),260)})]}):t.response.trim().length>0?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):e.jsx(It,{text:t.response,speed:20}):e.jsx("span",{className:"text-slate-500 italic",children:"Thinking…"}):t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-purple-400/80 text-[10px] uppercase tracking-wider font-medium",children:"💭 Reasoning "}),e.jsx("span",{className:"text-slate-400",children:o(t.thinking.trim(),260)})]}):t.response?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):o(t.response,u):e.jsx("span",{className:"text-slate-500 italic",children:"No response yet."})}function Is({moderatorSynthesis:t,isSynthesizing:n,moderatorId:o,speaking:u,phaseLabel:c,isGenerating:a,getTailSnippet:b}){return t?n&&o&&u.has(o)?e.jsx(It,{text:t,speed:20}):b(t):n?e.jsx("span",{className:"text-slate-500 italic",children:"Synthesizing responses..."}):a?c&&c.startsWith("<svg")?e.jsx("span",{className:"text-slate-500 italic",dangerouslySetInnerHTML:{__html:c}}):e.jsx("span",{className:"text-slate-500 italic",children:c==="Stage 1 · Responses"?"Waiting for model responses...":c||"Orchestrating..."}):e.jsx("span",{className:"text-slate-500 italic",children:"Send a prompt to see the synthesis."})}const Ds={padding:"16px",height:"100%",display:"flex",flexDirection:"column",isolation:"isolate",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",opacity:1,transition:"opacity 0.3s ease-out"};function zs({rect:t}){return t?e.jsx("div",{className:"absolute pointer-events-none z-30",style:{left:t.left,top:t.top,width:t.width,height:t.height,border:"2px solid rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)"}}):null}const Ps={twoFingerTapWindow:500,twoFingerTapCooldown:400,twoFingerMinFrames:4,minPointingTime:100,dwellTime:1200,cursorSmoothing:.5},Dt=s.createContext(null);function Os({children:t}){const[n,o]=s.useState(!1),[u,c]=s.useState("navigation"),[a,b]=s.useState("chat"),[p,f]=s.useState(Ps),[h,m]=s.useState(!1),y=s.useRef({}),T=s.useCallback(C=>{y.current=C},[]),[I,L]=s.useState({gesture:null,progress:0,triggered:!1}),[D,G]=s.useState(null),[d,z]=s.useState(void 0),[P,X]=s.useState(void 0),[O,S]=s.useState(void 0),[J,W]=s.useState(null),ee={isActive:n,setIsActive:o,gestureMode:u,setGestureMode:c,appContext:a,setAppContext:b,gestureConfig:p,setGestureConfig:f,mouseSimulation:h,setMouseSimulation:m,callbacks:y,setCallbacks:T,gestureState:I,setGestureState:L,aslResult:D,setASLResult:G,debugInfo:d,setDebugInfo:z,landmarkData:P,setLandmarkData:X,performanceMetrics:O,setPerformanceMetrics:S,cameraError:J,setCameraError:W};return e.jsx(Dt.Provider,{value:ee,children:t})}function Bs(){const t=s.useContext(Dt);if(!t)throw new Error("useGesture must be used within a GestureProvider");return t}function rr(){return s.useContext(Dt)}class $s extends s.Component{constructor(o){super(o);Jt(this,"handleRetry",()=>{var o,u;this.setState({hasError:!1,error:null}),(u=(o=this.props).onRetry)==null||u.call(o)});this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,u){console.error("ErrorBoundary caught an error:",o,u)}render(){var o;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/70 gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-400",children:[e.jsx(Hn,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:"Something went wrong"})]}),e.jsx("p",{className:"text-xs text-white/40 text-center max-w-xs",children:((o=this.state.error)==null?void 0:o.message)||"Failed to load component"}),e.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white/80 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg transition-all active:scale-95 border border-slate-600/50",children:[e.jsx(Wn,{size:14}),"Try Again"]})]}):this.props.children}}const Hs=s.lazy(()=>Ue(()=>import("./SettingsModal-BI6aXFSf.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ws=s.lazy(()=>Ue(()=>import("./DiscussionTranscript-C3rrgU_z.js"),__vite__mapDeps([7,1,2,3,4,5,6,8]))),Ys=s.lazy(()=>Ue(()=>import("./GestureControl-BR0BtKnU.js"),__vite__mapDeps([9,1,2,3,4,5,6]))),Xs=s.lazy(()=>Ue(()=>import("./HandBackground-DNaG2EDE.js"),__vite__mapDeps([10,1,2,3,4,5,6,11]))),Fs=s.lazy(()=>Ue(()=>import("./ChatView-D_zNVuKG.js"),__vite__mapDeps([12,1,2,3,4,5,6,8])).then(t=>({default:t.default}))),Gs='button, input, textarea, select, a, [role="button"], [data-no-background], [data-card]';function Us(){const t=Bs();bs();const{modelsData:n,setModelsData:o,selected:u,setSelected:c,chatModelId:a,setChatModelId:b,moderator:p,setModerator:f,availableModels:h,totalModelsByType:m,allSelectedByType:y,modelIdToName:T,isLoading:I,loadError:L,retryCount:D,retryNow:G}=ds(),[d,z]=Oe("playground_mode","chat",{serialize:r=>r,deserialize:(r,l)=>["chat","compare","analyze","debate"].includes(r)?r:l}),[P,X]=s.useState(!1),O=s.useRef(null),[S,J]=s.useState(null),[W,ee]=s.useState(!1),[C,q]=s.useState(!1),[$,Q]=s.useState(2),Z=s.useRef(0),U=s.useRef(0),V=s.useRef(null),[ne,ue]=s.useState(!1),[ie,F]=Oe("github_models_token","",{serialize:r=>r||null,deserialize:(r,l)=>r??l}),[le,me]=Oe("openrouter_api_key","",{serialize:r=>r||null,deserialize:(r,l)=>r??l}),[se,Se]=s.useState({}),Be=s.useRef(null),be=s.useRef(null),[we,i]=s.useState(""),[re,oe]=s.useState(null),ce=s.useRef(null),ae=s.useCallback(r=>{ce.current&&clearTimeout(ce.current),oe(r),ce.current=window.setTimeout(()=>{oe(null),ce.current=null},5e3)},[]),de=s.useCallback(r=>{if(d==="chat"||ie)return!0;const l=n.find(v=>v.id===r);return!l||l.type!=="github"&&l.type!=="external"},[d,ie,n]),pe=s.useCallback(()=>!!(d==="chat"||ie),[d,ie]),[ke,Te]=s.useState([]),{autoMode:R,autoModeScope:j,setAutoMode:g,setAutoModeScope:x}=Es({autoMode:!0,autoModeScope:"local"}),[k,w]=s.useState(""),[B,_]=s.useState(!1),{history:N,historyRef:K,pushHistoryEntries:$e,clearHistory:Le,historyToText:lt,buildCarryoverHistory:ct}=ys(),dt=(r,l)=>{const v=new Set,M=l.filter(Boolean).filter((A,H,Y)=>Y.indexOf(A)===H),E=[];return M.forEach(A=>{const H=r[A];H&&H.trim()&&(E.push({id:A,text:H.trim()}),v.add(A))}),Object.entries(r).forEach(([A,H])=>{v.has(A)||!H||!H.trim()||E.push({id:A,text:H.trim()})}),E.length?E.map(({id:A,text:H})=>`${T(A)}:
${H}`).join(`

`):null},he=u.map(r=>n.find(l=>l.id===r)).filter(r=>!!r&&(d==="compare"||r.id!==p)),Me=(r,l,v,M)=>{if(v==="analyze"){const rt=250+r*220/(l-1)-90,ot=rt*Math.PI/180;return{x:Math.cos(ot)*M,y:Math.sin(ot)*M,angle:rt}}const E=r*360/l-90,A=Math.cos(E*Math.PI/180)*M,H=Math.sin(E*Math.PI/180)*M;return{x:A,y:H,angle:E}},qe=(r,l)=>{J(l),r.dataTransfer.effectAllowed="move"},Ke=r=>{r.preventDefault(),ee(!0)},Ve=()=>{ee(!1)},Je=r=>{if(r.preventDefault(),ee(!1),S){if(d==="chat")b(S);else if(!u.includes(S)){if(!de(S)){ae("Add your GitHub token in Settings for API model access with dedicated quota"),J(null);return}c(l=>[...l,S])}J(null)}},Re=r=>{if(d==="chat"){b(a===r?null:r);return}if(u.includes(r))if(Ne&&pt.current.includes(r)&&we){be.current&&be.current.abort();const v=pt.current.filter(E=>E!==r),M={};if(n.forEach(E=>{v.includes(E.id)&&E.response&&!E.error&&(M[E.id]=E.response)}),c(E=>E.filter(A=>A!==r)),je.has(r)&&He(E=>{const A=new Set(E);return A.delete(r),A}),(d==="analyze"||d==="debate")&&v.length<2){Xe(!1),tt(!1),xt("This mode requires at least 2 participants."),vt("Error");return}jt(we,M,v,{skipHistory:!0})}else c(v=>v.filter(M=>M!==r));else{if(!de(r)){ae("Add your GitHub token in Settings for API model access with dedicated quota");return}c(l=>[...l,r])}},fe=r=>{const l=n.filter(E=>E.type===r).map(E=>E.id);if(l.length>0&&l.every(E=>u.includes(E))){c(E=>E.filter(A=>!l.includes(A)));return}if((r==="github"||r==="external")&&!pe()){ae("Add your GitHub token in Settings for API model access with dedicated quota");return}const M=h.filter(E=>E.type===r).map(E=>E.id);M.length>0&&c(E=>[...E,...M])},[on,_e]=s.useState(null),[zt,Pt]=s.useState(new Set),[an,ln]=s.useState(!1),[je,He]=s.useState(new Set),Ae=()=>He(new Set),[Qe,cn]=s.useState(null),ut=s.useMemo(()=>{if(d==="compare")return 0;const r=Math.max(te.baseRadius,te.minRadius+he.length*te.radiusPerModel);if(!Qe)return r;const v=Math.min(Qe.width,Qe.height)/2-140;return Math.max(r,v)},[d,he.length,Qe]);s.useEffect(()=>{const r=()=>{if(!xe.current)return;const{clientWidth:v,clientHeight:M}=xe.current;let E=Math.floor(v/(te.cardWidth+te.gapX));E=Math.max(1,E),Q(E),cn({width:v,height:M})},l=new ResizeObserver(v=>{for(let M of v)M.target===xe.current&&r()});return xe.current&&(l.observe(xe.current),r()),()=>{xe.current&&l.unobserve(xe.current)}},[d]);const Ie=s.useRef(null),xe=s.useRef(null),Ee=s.useRef(null),Ot=s.useRef(null),Ze=s.useRef(new Map),dn=s.useRef(null),We=s.useRef({card:!1,background:!1}),un=s.useRef({}),pt=s.useRef([]),{enqueueStreamDelta:pn,clearPendingStreamForModel:fn,resetPendingStream:ft}=vs(o),{selectionRect:hn,isSelecting:ht,dragSelectionActiveRef:Bt}=ks({rootContainerRef:Ot,visualizationAreaRef:xe,arenaOffsetYRef:Z,arenaTargetYRef:U,wheelRafRef:V,selectedModels:he,cardRefs:Ze,selectedCardIds:je,setSelectedCardIds:He,suppressClickRef:We}),{dragState:mn,handlePointerDown:xn}=js({visualizationAreaRef:xe,cardRefs:Ze,selected:u,setSelected:c,mode:d,gridCols:$,getCirclePosition:Me});s.useEffect(()=>()=>ft(),[ft]);const[ye,Ce]=s.useState(null);s.useEffect(()=>{const r="arena-selecting",l=document.body;return ht?l.classList.add(r):l.classList.remove(r),()=>{l.classList.remove(r)}},[ht]);const et=s.useCallback(r=>r?!r.closest(Gs):!1,[]),gn=s.useCallback(r=>{if(et(r.target)){if(We.current.background){We.current.background=!1;return}_e(null),Ae(),We.current.background=!1}},[et,Ae]),bn=s.useCallback(r=>{et(r.target)&&(r.preventDefault(),Ce({x:r.clientX,y:r.clientY,type:"background"}))},[et]),$t=s.useCallback(()=>{X(!0),O.current&&clearTimeout(O.current),O.current=window.setTimeout(()=>{X(!1),O.current=null},350)},[]),Ye=s.useCallback(r=>{r!==d&&($t(),Xe(!1),z(r))},[d,$t]);s.useEffect(()=>()=>{ce.current&&clearTimeout(ce.current)},[]),s.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]),s.useEffect(()=>{const r=()=>Ce(null);return window.addEventListener("click",r),()=>window.removeEventListener("click",r)},[]);const[Ne,Xe]=s.useState(!1),[Fe,tt]=s.useState(!1),[mt,xt]=s.useState(""),yn=s.useCallback(()=>{Le(),Xe(!1),tt(!1),xt(""),vt(null),Wt({}),o(r=>r.map(l=>({...l,response:"Ready to generate...",thinking:void 0,error:void 0}))),Se({}),Pt(new Set)},[Le,o]),[vn,wn]=s.useState(!0),[kn,jn]=s.useState("api"),[gt,bt]=s.useState(!1),yt=s.useRef(null);s.useEffect(()=>{const r=v=>{yt.current&&!yt.current.contains(v.target)&&bt(!1)},l=v=>{v.key==="Escape"&&bt(!1)};return gt&&(document.addEventListener("mousedown",r),document.addEventListener("keydown",l)),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("keydown",l)}},[gt]);const[Ht,vt]=s.useState(null),[,Wt]=s.useState({}),[Sn,Yt]=s.useState(new Set),wt=s.useRef(new Set),Mn=s.useRef(null),Xt=s.useRef({}),Ft=s.useRef(d),[kt,Gt]=s.useState(null),En=()=>{const r=new Set;wt.current=r,Yt(r)},Cn=r=>{Yt(l=>{if(l.has(r))return l;const v=new Set(l);return v.add(r),wt.current=v,v})},{sendMessage:jt}=ws({mode:d,moderator:p,selected:u,selectedCardIds:je,githubToken:ie,isGenerating:Ne,summarizeSessionResponses:dt,setLastQuery:i,setHoveredCard:_e,setPhaseLabel:vt,setModeratorSynthesis:xt,setDiscussionTurnsByModel:Wt,resetFailedModels:En,markModelFailed:Cn,failedModelsRef:wt,currentDiscussionTurnRef:Mn,sessionModelIdsRef:pt,abortControllerRef:be,thinkingStateRef:un,conversationHistoryRef:K,pushHistoryEntries:$e,historyToText:lt,buildCarryoverHistory:ct,setModelsData:o,modelIdToName:T,setExecutionTimes:Se,setIsGenerating:Xe,setIsSynthesizing:tt,setSpeaking:Pt,enqueueStreamDelta:pn,clearPendingStreamForModel:fn,resetPendingStream:ft});s.useEffect(()=>{const r=l=>{if(l.key==="Escape"){const M=document.activeElement;if(M&&M!==document.body&&M.blur(),ne){ue(!1);return}if(ye){Ce(null);return}if(je.size>0){Ae(),_e(null);return}if(C){q(!1);return}_e(null);return}if((l.metaKey||l.ctrlKey)&&(l.key==="a"||l.key==="A")){const M=l.target;if(M.tagName==="INPUT"||M.tagName==="TEXTAREA"||d==="chat")return;l.preventDefault(),u.length>0&&He(new Set(u));return}const v=l.target;if(!(v.tagName==="INPUT"||v.tagName==="TEXTAREA")){if(l.key==="ArrowRight"||l.key==="ArrowLeft"){l.preventDefault();const M=["chat","compare","analyze","debate"],E=M.indexOf(d);if(E!==-1){const A=l.key==="ArrowRight"?1:-1,H=(E+A+M.length)%M.length;Ye(M[H])}return}if(l.key==="m"||l.key==="M"){l.preventDefault(),q(!C);return}if((l.key==="Delete"||l.key==="Backspace")&&je.size>0){l.preventDefault(),c(M=>M.filter(E=>!je.has(E))),Ae();return}l.key.length===1&&!l.ctrlKey&&!l.metaKey&&!l.altKey&&Ie.current&&Ie.current.focus()}};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}},[C,ne,ye,je,d,Ye,Ae]);const nt=s.useRef(!1),St=s.useRef(0),Ut=r=>{const l=xe.current;l&&l.style.setProperty("--arena-offset-y",`${r}px`)},Mt=r=>Math.max(-200,Math.min(te.scrollClamp,r)),qt=()=>{const r=Z.current,l=U.current,v=l-r;if(Math.abs(v)<.5){Z.current=l,Ut(l),V.current=null;return}const M=r+v*.35;Z.current=M,Ut(M),V.current=requestAnimationFrame(qt)},Et=()=>{V.current==null&&(V.current=requestAnimationFrame(qt))};s.useEffect(()=>{const r=A=>{if(Bt.current)return;const H=A.target;if(H&&H.closest("input, textarea, [data-no-arena-scroll]"))return;A.preventDefault();const Y=A.deltaY*.9,ge=U.current-Y;U.current=Mt(ge),Et()},l=A=>A?!!A.closest('input, textarea, [data-no-arena-scroll], [data-card], button, a, select, [role="button"]'):!1,v=A=>{if(A.touches.length!==1)return;const H=A.target;l(H)||(nt.current=!0,St.current=A.touches[0].clientY)},M=A=>{if(Bt.current||!nt.current||A.touches.length!==1)return;const H=A.target;if(l(H)){nt.current=!1;return}const Y=A.touches[0].clientY,ge=Y-St.current;St.current=Y,A.preventDefault(),U.current=Mt(U.current+ge),Et()},E=()=>{nt.current=!1};return window.addEventListener("touchstart",v,{passive:!0}),window.addEventListener("touchmove",M,{passive:!1}),window.addEventListener("touchend",E),window.addEventListener("touchcancel",E),window.addEventListener("wheel",r,{passive:!1}),()=>{window.removeEventListener("touchstart",v),window.removeEventListener("touchmove",M),window.removeEventListener("touchend",E),window.removeEventListener("touchcancel",E),window.removeEventListener("wheel",r),V.current!=null&&cancelAnimationFrame(V.current)}},[]);const[st,Nn]=Oe("playground-bg-style","dots",{serialize:r=>r,deserialize:(r,l)=>r&&es.includes(r)?r:l}),Tn=n.find(r=>r.id===p),Ln=Fe?"responding":Ne?"waiting":mt?"done":"idle",Rn=Fe?"Synthesizing...":Ne?"Observing":mt?"Complete":"Ready",_n=`${kt?`translate(-50%, -50%) translate(${kt.x}px, ${kt.y}px)`:"translate(-50%, -50%)"} scale(1)`;s.useLayoutEffect(()=>{if(d!=="compare")return;const r={};he.forEach(l=>{const v=Ze.current.get(l.id);v&&(r[l.id]=v.getBoundingClientRect())}),Xt.current=r},[d,he.length,he.map(r=>r.id).join(",")]),s.useEffect(()=>{if(Ft.current==="compare"&&d!=="compare"&&p&&xe.current){const l=Xt.current[p],v=xe.current.getBoundingClientRect();if(l&&v.width>0&&v.height>0){const M=v.left+v.width/2,E=d==="analyze"?ut-64:0,A=v.top+(v.height*.5+E),H=l.left+l.width/2-M,Y=l.top+l.height/2-A;(Math.abs(H)>1||Math.abs(Y)>1)&&(Gt({x:H,y:Y}),requestAnimationFrame(()=>Gt(null)))}}Ft.current=d},[d,p,ut]);const An=st==="none"?"":`bg-${st}`,In=(r,l=280)=>r?r.length<=l?r:`…${r.slice(r.length-l)}`:"",Kt=()=>{be.current&&(be.current.abort(),Xe(!1),tt(!1))};return e.jsxs("div",{ref:Ot,className:`fixed inset-0 overflow-hidden text-white ${An}`,style:{backgroundColor:Zt[d],transition:"background-color 1s ease",...st==="none"?{background:Zt[d]}:{},...ht?{userSelect:"none",WebkitUserSelect:"none"}:{}},onClick:gn,onContextMenu:bn,children:[t.isActive&&!t.mouseSimulation&&e.jsx(s.Suspense,{fallback:null,children:e.jsx(Xs,{onStopGeneration:t.callbacks.current.onStopGeneration,onSendMessage:t.callbacks.current.onSendMessage,onScroll:t.callbacks.current.onScroll,onPinch:t.callbacks.current.onPinch,onHover:t.callbacks.current.onHover,onModeChange:t.callbacks.current.onModeChange,config:t.gestureConfig,mode:t.gestureMode,appContext:t.appContext,onGestureModeToggle:()=>t.setGestureMode(t.gestureMode==="navigation"?"asl":"navigation"),gestureActiveArea:{minX:.7,maxX:1,minY:0,maxY:1},onGestureState:t.setGestureState,onASLResult:t.setASLResult,onError:t.setCameraError,onDebugInfo:t.setDebugInfo,onLandmarkData:t.setLandmarkData,onPerformance:t.setPerformanceMetrics})}),I&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/95 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-5 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-slate-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-12 h-12 border-2 border-transparent border-b-emerald-500/50 rounded-full animate-spin",style:{animationDirection:"reverse",animationDuration:"1.5s"}})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:L||"Connecting to models..."}),D>0&&e.jsxs("p",{className:"text-white/40 text-xs tabular-nums",children:["Attempt ",D," of 8"]})]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 rounded-lg transition-all active:scale-95",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh Now"]})]})}),e.jsx(rs,{mode:d,setMode:Ye,setHoveredCard:_e,clearSelection:Ae,showDock:C,setShowDock:q,onOpenSettings:()=>ue(!0),gestureButtonSlot:e.jsx(s.Suspense,{fallback:null,children:e.jsx(Ys,{inHeader:!0,appContext:d,onStopGeneration:()=>{if(d==="chat"&&Ee.current){Ee.current.stopGeneration();return}Kt()},onSendMessage:r=>{if(d==="chat"&&Ee.current){Ee.current.sendMessage(r,!0);return}const l=d==="compare"||d==="analyze"||d==="debate"?u:[];l.length>0&&jt(r,{},l)},onScroll:r=>{if(d==="chat"&&Ee.current){Ee.current.scroll(r);return}U.current=Mt(U.current+r),Et()},onHover:(r,l)=>{const v=r*window.innerWidth,M=l*window.innerHeight,E=document.elementFromPoint(v,M);if(E){const A=E.closest("[data-gesture-mode-track]");if(A){const ge=A.getBoundingClientRect(),Vt=v-ge.left,rt=ge.width,ot=Math.floor(Vt/rt*5),Ct=["chat","compare","analyze","debate"][Math.max(0,Math.min(4,ot))];Ct&&Ct!==d&&Ye(Ct);return}const H=document.querySelector('[data-gesture-hovered="true"]'),Y=E.closest('button, a, [role="button"], [data-clickable], .cursor-pointer, [onclick]')||E;Y!==H?(H&&(H.removeAttribute("data-gesture-hovered"),H.dispatchEvent(new PointerEvent("pointerleave",{bubbles:!1,cancelable:!0})),H.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!1,cancelable:!0})),H.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0}))),Y.setAttribute("data-gesture-hovered","true"),Y.dispatchEvent(new PointerEvent("pointerenter",{bubbles:!1,cancelable:!0,clientX:v,clientY:M})),Y.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:v,clientY:M})),Y.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!1,cancelable:!0,clientX:v,clientY:M})),Y.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,clientX:v,clientY:M}))):Y===H&&(Y.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:v,clientY:M})),Y.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:v,clientY:M})))}},onPinch:(r,l)=>{const v=r*window.innerWidth,M=l*window.innerHeight,E=document.elementFromPoint(v,M);if(E){const A=ge=>{ge.dispatchEvent(new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:v,clientY:M,pointerId:1,pointerType:"touch",isPrimary:!0})),ge.dispatchEvent(new PointerEvent("pointerup",{bubbles:!0,cancelable:!0,clientX:v,clientY:M,pointerId:1,pointerType:"touch",isPrimary:!0})),ge.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:v,clientY:M})),ge.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:v,clientY:M})),ge.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:v,clientY:M}))},H=E.closest('button, a, [role="button"], [data-clickable], .cursor-pointer, [onclick]');A(H||E);const Y=document.createElement("div");Y.style.position="fixed",Y.style.left=`${v}px`,Y.style.top=`${M}px`,Y.style.width="20px",Y.style.height="20px",Y.style.background="rgba(236, 72, 153, 0.5)",Y.style.borderRadius="50%",Y.style.transform="translate(-50%, -50%)",Y.style.pointerEvents="none",Y.style.zIndex="9999",document.body.appendChild(Y),Y.animate([{transform:"translate(-50%, -50%) scale(1)",opacity:1},{transform:"translate(-50%, -50%) scale(4)",opacity:0}],{duration:400}).onfinish=()=>Y.remove()}},onModeChange:r=>{const l=["chat","compare","analyze","debate"],v=l.indexOf(d);let M;r==="next"?M=(v+1)%l.length:M=(v-1+l.length)%l.length,Ye(l[M])}})})}),e.jsxs("div",{style:{paddingLeft:"1.5rem",paddingRight:"0"},children:[C&&e.jsx("div",{className:"fixed inset-0 z-[55] bg-black/10 backdrop-blur-[1px] transition-opacity duration-300",onClick:()=>q(!1)}),e.jsx(ts,{showDock:C,availableModels:h,allSelectedByType:y,totalModelsByType:m,handleDragStart:qe,handleModelToggle:Re,handleAddGroup:fe,dockRef:Be}),d==="chat"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex h-screen w-full relative z-[10]",children:e.jsx("div",{className:"flex-1 relative px-2 sm:px-6 pt-20 pb-6",children:e.jsx($s,{children:e.jsx(s.Suspense,{fallback:e.jsxs("div",{className:"flex items-center justify-center h-full text-white/50 gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white/60 rounded-full animate-spin"}),"Loading..."]}),children:e.jsx(Fs,{ref:Ee,models:n,selectedModelId:a,onSelectModel:b,githubToken:ie,openrouterKey:le,messages:ke,setMessages:Te,autoMode:R,setAutoMode:g,autoModeScope:j,setAutoModeScope:x,currentResponse:k,setCurrentResponse:w,isGenerating:B,setIsGenerating:_,onModelUsed:b,gesturesActive:t.isActive})})})})})}),d!=="chat"&&e.jsxs("div",{className:"flex h-screen w-full relative",children:[e.jsx("div",{className:"relative flex-1 transition-all duration-300 flex flex-col pt-24",children:e.jsx("div",{ref:xe,onDragOver:Ke,onDragLeave:Ve,onDrop:Je,className:"relative w-full h-full z-10 transition-all duration-300",style:{position:"relative",display:"flex",alignItems:d==="compare"?"flex-start":"center",justifyContent:"center","--arena-offset-y":`${Z.current}px`,transform:d==="analyze"||d==="debate"?`translateY(calc(var(--arena-offset-y) - 50px)) scale(${W?1.02:1})`:`translateY(var(--arena-offset-y)) scale(${W?1.02:1})`,willChange:"transform",border:W?"2px dashed rgba(59, 130, 246, 0.4)":"2px dashed transparent",borderRadius:W?"24px":"0px",transition:"transform 0s linear",...d==="compare"?{minHeight:"300px",paddingBottom:"120px"}:d==="analyze"||d==="debate"?{height:"100%",minHeight:"100%",overflow:"hidden"}:{height:"100%",minHeight:"100%",overflow:"hidden"},...W?{background:"rgba(59, 130, 246, 0.05)"}:{}},children:e.jsx(Ns,{mode:d,selectedModels:he,gridCols:$,speaking:zt,selectedCardIds:je,setSelectedCardIds:He,executionTimes:se,failedModels:Sn,cardRefs:Ze,handlePointerDown:xn,dragState:mn,handleModelToggle:Re,setContextMenu:Ce,suppressClickRef:We,getTailSnippet:In,hoveredCard:on,setHoveredCard:_e,layoutRadius:ut,getCirclePosition:Me,moderatorModel:Tn,moderatorId:p,orchestratorTransform:_n,orchestratorStatus:Ln,orchestratorPhaseLabel:Rn,moderatorSynthesis:mt,isSynthesizing:Fe,isGenerating:Ne,phaseLabel:Ht,linesTransitioning:P,lastSelectedCardRef:dn,orchestratorAutoMode:vn,orchestratorAutoScope:kn,showOrchestratorMenu:gt,setShowOrchestratorMenu:bt,setOrchestratorAutoMode:wn,setOrchestratorAutoScope:jn,orchestratorMenuRef:yt,availableModels:h,setModerator:f})})}),d!=="compare"&&e.jsx("div",{className:"transcript-panel w-[400px] xl:w-[480px] flex flex-col border-l border-white/5 bg-slate-900/20 backdrop-blur-sm z-40 relative h-full",children:e.jsx(s.Suspense,{fallback:null,children:e.jsx(Ws,{history:N,models:n,mode:d,onSelectPrompt:r=>{Ie.current&&(Ie.current.value=r,Ie.current.focus())},onNewSession:yn,className:"pt-24 pb-6 mask-fade-top",phaseLabel:Ht,isGenerating:Ne,isSynthesizing:Fe,speakingCount:zt.size,totalParticipants:he.length})})})]})]}),e.jsx(zs,{rect:hn}),re&&e.jsx("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-[200] animate-in slide-in-from-bottom-4 fade-in duration-300",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl bg-amber-500/10 border border-amber-500/30 backdrop-blur-md shadow-xl",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-400 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm text-amber-100",children:re}),e.jsx("button",{onClick:()=>{oe(null),ue(!0)},className:"ml-2 px-3 py-1 text-xs font-medium text-amber-900 bg-amber-400 hover:bg-amber-300 rounded-md transition-colors",children:"Open Settings"}),e.jsx("button",{onClick:()=>oe(null),className:"ml-1 p-1 text-amber-400/60 hover:text-amber-400 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx(s.Suspense,{fallback:null,children:e.jsx(Hs,{open:ne,onClose:()=>ue(!1),token:ie,setToken:F,openrouterKey:le,setOpenrouterKey:me,bgStyle:st,setBgStyle:Nn})}),(d==="compare"||d==="analyze"||d==="debate")&&e.jsx(ns,{inputRef:Ie,inputFocused:an,setInputFocused:ln,onSendMessage:jt,isGenerating:Ne||Fe,onStop:Kt,placeholder:d==="compare"?void 0:"Steer the discussion...",className:`fixed bottom-0 left-0 z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300 ${d==="compare"?"right-0":"right-[400px] xl:right-[480px]"}`,style:{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"}}),ye&&e.jsx("div",{className:"fixed bg-slate-800 border border-slate-700 rounded-lg shadow-xl py-1 z-[200] min-w-[160px]",style:{top:ye.y,left:ye.x},onClick:r=>r.stopPropagation(),children:ye.type==="background"?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{q(!0),Ce(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Model"]}):ye.modelId?e.jsxs(e.Fragment,{children:[d!=="compare"&&ye.modelId!==p&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{f(ye.modelId),Ce(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),"Set as Orchestrator"]}),e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{const r=ye.modelId===p;if(Re(ye.modelId),r&&d!=="compare"){const l=u.filter(v=>v!==ye.modelId);l.length>0?f(l[0]):f("")}Ce(null)},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})]}):null})]})}function qs(){return e.jsx(Os,{children:e.jsx(Us,{})})}Yn.createRoot(document.getElementById("root")).render(e.jsx(Xn.StrictMode,{children:e.jsx(qs,{})}));export{es as B,sr as M,ns as P,zs as S,rr as a,ps as f,nr as g,Tt as s,Bs as u};
