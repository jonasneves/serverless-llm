import{r as s,j as e,h as xe,i as me,T as le,S as ee,B as V,U as fe,C as pe,k as he,P as be}from"./react-vendor-CQxWqugw.js";import{F as te}from"./FormattedContent-ClPh4eCb.js";import{a as ge,f as ve,s as we,E as se,P as je,U as Ne}from"./index-pXTUsxRL.js";import"./markdown-BNX5kHMI.js";import"./math-render-D6B7xoul.js";import"./syntax-highlight-K7DiErAG.js";function ye(h){const[m,b]=s.useState([]);return s.useEffect(()=>{const v=h.match(/```json\s*([\s\S]*?)\s*```/);if(v)try{let o=v[1];o=o.replace(/[\\']/g,'"').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/}\s*[\\]+\s*$/g,"}").replace(/"\s*"\s*$/g,"").trim();const a=JSON.parse(o);if(a.options&&Array.isArray(a.options)){const f=a.options.filter(c=>c.id&&c.label&&c.value);f.length>0?b(f):b([])}}catch(o){console.error("Failed to parse gesture options:",o),b([])}else b([])},[h]),m}function Ce(h){return h.replace(/```json[\s\S]*?```/g,"").trim()}const ke=1800;function Se({content:h,onSelect:m,isInline:b=!1}){const v=ye(h),[o,a]=s.useState(null),[f,c]=s.useState({}),w=s.useRef(0),u=s.useRef(0);s.useEffect(()=>{const l=$=>{var k;const N=(k=$.detail)==null?void 0:k.target;if(N&&N.hasAttribute("data-gesture-option")){const d=N.getAttribute("data-gesture-option");d&&d!==o&&(a(d),j(d))}else o&&(a(null),g())};return window.addEventListener("gesture-hover",l),()=>{window.removeEventListener("gesture-hover",l),g()}},[o]);const j=l=>{g(),w.current=Date.now();const $=()=>{const N=Date.now()-w.current,k=Math.min(N/ke*100,100);if(c(d=>({...d,[l]:k})),k>=100){const d=v.find(E=>E.id===l);d&&(m(d.value),g())}else u.current=requestAnimationFrame($)};u.current=requestAnimationFrame($)},g=()=>{u.current&&cancelAnimationFrame(u.current),c({})},n=l=>{a(l),j(l)},C=()=>{a(null),g()};if(v.length===0)return null;const R=b?"w-full mt-3":"w-full",p=b?"grid grid-cols-2 gap-2":"flex flex-col gap-2.5",S=l=>b?`relative overflow-hidden rounded-lg font-medium text-xs border transition-all duration-200 text-center min-h-[40px] flex items-center justify-center px-3 py-2 ${l?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`:`relative overflow-hidden rounded-xl font-medium text-sm border transition-all duration-200 w-full text-left min-h-[52px] flex items-center px-4 py-3 ${l?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10 scale-[1.02]":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`;return e.jsxs("div",{className:R,children:[!b&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-1",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider text-slate-400",children:"Quick Actions"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-700/50 to-transparent"})]}),e.jsx("div",{className:p,children:v.map(l=>{const $=f[l.id]||0,N=o===l.id;return e.jsxs("button",{onClick:()=>m(l.value),onMouseEnter:()=>n(l.id),onMouseLeave:C,"data-gesture-option":l.id,className:S(N),children:[N&&$>0&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-blue-400 to-blue-500 transition-all duration-75",style:{width:`${$}%`}}),e.jsx("span",{className:"relative z-10",children:l.label})]},l.id)})})]})}function $e({models:h,selectedModels:m,onToggleModel:b,isGenerating:v,githubToken:o,dropDirection:a="up"}){const[f,c]=s.useState(null),[w,u]=s.useState(""),j=s.useRef(null),g=s.useRef(null),n=s.useMemo(()=>h.filter(r=>r.type==="self-hosted"),[h]),C=s.useMemo(()=>h.filter(r=>r.type==="github"),[h]),R=s.useMemo(()=>n.filter(r=>!w||r.name.toLowerCase().includes(w.toLowerCase())),[n,w]),p=s.useMemo(()=>C.filter(r=>!w||r.name.toLowerCase().includes(w.toLowerCase())),[C,w]),S=n.filter(r=>m.has(r.id)).length,l=C.filter(r=>m.has(r.id)).length;s.useEffect(()=>{const r=A=>{j.current&&!j.current.contains(A.target)&&(c(null),u(""))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),s.useEffect(()=>{const r=A=>{A.key==="Escape"&&(c(null),u(""))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]);const $=r=>{f===r?(c(null),u("")):(c(r),u(""),setTimeout(()=>{var A;return(A=g.current)==null?void 0:A.focus()},50))},N=r=>{const A=r.every(z=>m.has(z.id));r.forEach(z=>{(A||!m.has(z.id))&&b(z.id)})},k=r=>r==="self-hosted"?"Self-Hosted":"GitHub",d=l>0&&!o,E=a==="up"?xe:me,L=r=>r?"rotate-180":"",D=d&&e.jsx("div",{className:"flex flex-col items-center gap-1",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs",children:[e.jsx(le,{size:11,className:"shrink-0 text-yellow-500"}),e.jsx("span",{children:"Add GitHub token in Settings for dedicated quota"})]})});return e.jsxs("div",{className:"flex flex-col items-center gap-2",ref:j,children:[a==="up"&&D,e.jsxs("div",{className:"relative flex items-center gap-1 bg-slate-800/90 rounded-lg p-1 border border-slate-700/50 backdrop-blur-md shadow-lg",children:[n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>$("self-hosted"),disabled:v,className:`h-7 px-3 flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${S>0?"bg-emerald-500/20 text-emerald-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{children:k("self-hosted")}),e.jsxs("span",{className:`text-[10px] ${S>0?"text-emerald-400":"text-slate-500"}`,children:[S,"/",n.length]}),e.jsx(E,{size:12,className:`transition-transform ${L(f==="self-hosted")}`})]}),f==="self-hosted"&&e.jsx(re,{models:R,allModels:n,selectedModels:m,onToggleModel:b,onToggleAll:()=>N(n),searchQuery:w,setSearchQuery:u,searchInputRef:g,color:"emerald",showSearch:n.length>5,direction:a})]}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50"})]}),C.length>0&&e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>$("github"),disabled:v,className:`h-7 px-3 flex items-center gap-1.5 rounded-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${l>0?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{children:k("github")}),e.jsxs("span",{className:`text-[10px] ${l>0?"text-blue-400":"text-slate-500"}`,children:[l,"/",C.length]}),e.jsx(E,{size:12,className:`transition-transform ${L(f==="github")}`})]}),f==="github"&&e.jsx(re,{models:p,allModels:C,selectedModels:m,onToggleModel:b,onToggleAll:()=>N(C),searchQuery:w,setSearchQuery:u,searchInputRef:g,color:"blue",showSearch:C.length>5,direction:a})]})]}),a==="down"&&D]})}function re({models:h,allModels:m,selectedModels:b,onToggleModel:v,onToggleAll:o,searchQuery:a,setSearchQuery:f,searchInputRef:c,color:w,showSearch:u,direction:j}){const g=m.every(p=>b.has(p.id)),n={emerald:{bg:"bg-emerald-500/20",text:"text-emerald-300",check:"text-emerald-400",dot:"bg-emerald-500/50",border:"focus:border-emerald-500/50"},blue:{bg:"bg-blue-500/20",text:"text-blue-300",check:"text-blue-400",dot:"bg-blue-500/50",border:"focus:border-blue-500/50"}}[w],C=j==="up"?"bottom-full left-0 mb-2":"top-full left-0 mt-2",R=j==="up"?"animate-in fade-in slide-in-from-bottom-2":"animate-in fade-in slide-in-from-top-2";return e.jsxs("div",{className:`absolute ${C} w-56 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden ${R} duration-150`,onClick:p=>p.stopPropagation(),"data-no-arena-scroll":!0,children:[j==="down"&&u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-2 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:c,type:"text",placeholder:"Search...",value:a,onChange:p=>f(p.target.value),className:`w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none ${n.border}`})]})}),e.jsx("div",{className:"border-t border-slate-700/50"})]}),j==="down"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:o,className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${g?`${n.bg} ${n.text}`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{children:g?"Deselect All":"Select All"}),g&&e.jsx("span",{className:n.check,children:"âœ“"})]}),e.jsx("div",{className:"border-t border-slate-700/50"})]}),e.jsx("div",{className:"max-h-48 overflow-y-scroll chat-scroll",style:{WebkitOverflowScrolling:"touch"},children:h.map(p=>{const S=b.has(p.id);return e.jsxs("button",{onClick:()=>v(p.id),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${S?`${n.bg} text-slate-200`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.dot}`}),e.jsx("span",{children:p.name})]}),S&&e.jsx("span",{className:n.check,children:"âœ“"})]},p.id)})}),j==="up"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsxs("button",{onClick:o,className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${g?`${n.bg} ${n.text}`:"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{children:g?"Deselect All":"Select All"}),g&&e.jsx("span",{className:n.check,children:"âœ“"})]})]}),j==="up"&&u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsx("div",{className:"px-2 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:c,type:"text",placeholder:"Search...",value:a,onChange:p=>f(p.target.value),className:`w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none ${n.border}`})]})})]})]})}const Ee=s.forwardRef(({models:h,selectedModels:m,onToggleModel:b,githubToken:v,messages:o,setMessages:a,isGenerating:f,setIsGenerating:c,gesturesActive:w=!1,uiBuilderEnabled:u,setUiBuilderEnabled:j},g)=>{var Q;const[n,C]=s.useState(!1),[R,p]=s.useState(null),[S,l]=s.useState(new Map),[$,N]=s.useState(new Map),k=s.useRef(new Map),d=s.useRef(null),E=s.useRef(null),L=s.useRef(!1),D=ge(),r=((Q=D==null?void 0:D.gestureState)==null?void 0:Q.gesture)==="Middle_Finger";s.useEffect(()=>{const t=i=>{const y=i.target;y.tagName==="INPUT"||y.tagName==="TEXTAREA"||i.key.length===1&&!i.ctrlKey&&!i.metaKey&&!i.altKey&&E.current&&E.current.focus()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const A=s.useCallback(()=>{if(!d.current)return!0;const{scrollTop:t,scrollHeight:i,clientHeight:y}=d.current;return i-t-y<100},[]);s.useEffect(()=>{const t=d.current;if(!t)return;const i=()=>{A()?L.current=!1:L.current=!0};return t.addEventListener("scroll",i,{passive:!0}),()=>t.removeEventListener("scroll",i)},[A]);const z=s.useCallback(()=>{!L.current&&d.current&&(d.current.scrollTop=d.current.scrollHeight)},[]);s.useEffect(()=>{z()},[o,S,z]);const P=s.useCallback(async(t,i=!1)=>{if(!t.trim()||f)return;const y=Array.from(m);if(y.length===0)return;L.current=!1,c(!0),l(new Map),N(new Map);const F={role:"user",content:t};a(x=>[...x,F]);const q=Date.now();N(new Map(y.map(x=>[x,{startTime:q}])));const oe=[...o,F].map(x=>({role:x.role,content:x.content})),U=[];u&&U.push({role:"system",content:Ne}),i&&U.push({role:"system",content:'User is using gesture control. Available gestures: ðŸ‘ (yes), ðŸ‘Ž (no), ðŸ‘‹ (hello), "ok", "thanks", "stop", pointing finger (select buttons).'}),(t==="ðŸ–•"||t.toLowerCase().includes("middle finger"))&&U.push({role:"system",content:"The user is showing you their middle finger. Respond with humorous, over-the-top mock indignation. Play along with the 'angry robot' persona."});const ie=[...U,...oe];let O=0;const X=y.length,ce=y.map(async x=>{const B=h.find(T=>T.id===x),Y=Date.now();if(!B){a(T=>[...T,{role:"assistant",content:`Model ${x} not found`,modelId:x,modelName:x,error:!0}]),O++,O===X&&c(!1);return}const Z=new AbortController;k.current.set(x,Z);try{const T=await ve({models:[x],messages:ie,max_tokens:4096,temperature:.7,github_token:v},Z.signal);let M="",I=!0,K;await we(T,H=>{H.content&&(I&&(I=!1,K=Date.now(),N(W=>{const J=new Map(W),ue=J.get(x)||{startTime:Y};return J.set(x,{...ue,firstTokenTime:K}),J})),M+=H.content,l(W=>new Map(W).set(x,M)))});const de=Date.now();a(H=>[...H,{role:"assistant",content:M||"(empty response)",modelId:x,modelName:B.name,timing:{startTime:Y,firstTokenTime:K,endTime:de}}])}catch(T){T.name!=="AbortError"&&a(M=>[...M,{role:"assistant",content:T.message||"Request failed",modelId:x,modelName:B.name,error:!0}])}finally{k.current.delete(x),l(T=>{const M=new Map(T);return M.delete(x),M}),O++,O===X&&c(!1)}});await Promise.allSettled(ce)},[f,m,o,h,v,u,a,c]),_=s.useCallback(()=>{k.current.forEach(t=>t.abort()),k.current.clear(),c(!1)},[c]),G=s.useCallback(t=>{d.current&&(d.current.scrollTop-=t)},[]);s.useImperativeHandle(g,()=>({sendMessage:P,setInput:t=>{E.current&&(E.current.value=t,E.current.focus())},stopGeneration:_,scroll:G}),[P,_,G]);const ae=t=>{const i=o[t];i&&i.role==="assistant"&&(navigator.clipboard.writeText(i.content),p(`${t}`),setTimeout(()=>p(null),2e3))},ne=({compact:t=!1})=>e.jsxs("button",{onClick:()=>j(!u),className:`flex items-center gap-1.5 rounded-md transition-all active:scale-95 font-medium ${t?"h-6 px-2 text-[11px]":"h-7 px-2.5 text-xs"} ${u?"bg-violet-500/20 text-violet-300 hover:bg-violet-500/30":"bg-slate-800/60 text-slate-400 hover:text-slate-300 hover:bg-slate-700/50"}`,title:"Enable interactive UI elements in responses",children:[e.jsx(be,{size:t?11:12}),e.jsx("span",{children:"UI Builder"})]});return e.jsxs("div",{className:"flex flex-col h-full w-full relative",children:[e.jsx("div",{ref:d,"data-no-arena-scroll":!0,className:"flex-1 overflow-y-auto px-4 py-6 space-y-4 chat-scroll",style:{paddingBottom:o.length>0?"160px":"80px"},children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-6",children:[r?e.jsxs("div",{className:"mb-2 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500 blur-xl opacity-50 rounded-full"}),e.jsx(V,{size:72,className:"relative text-red-500"}),e.jsx("div",{className:"absolute -top-2 -right-2 text-3xl",children:"ðŸ’¢"})]}):e.jsx(V,{size:72,className:"mb-2 text-slate-500 transition-all duration-300"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Select one or more models and start chatting"}),e.jsx($e,{models:h,selectedModels:m,onToggleModel:b,isGenerating:f,githubToken:v,dropDirection:"down"}),e.jsx(ne,{})]}),o.map((t,i)=>{const y=t.role==="assistant"&&(w||u)&&t.content.includes("```json");return e.jsxs("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:[e.jsxs("div",{className:`group relative max-w-[85%] rounded-2xl px-4 py-3 ${t.role==="user"?"bg-blue-600/20 border border-blue-500/30 text-white rounded-tr-sm":t.error?"bg-red-500/10 border border-red-500/30 text-red-200 rounded-tl-sm":"bg-slate-800/60 border border-slate-700/60 text-slate-200 rounded-tl-sm"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider ${t.role==="user"?"text-blue-300 flex-row-reverse":"text-slate-400"}`,children:[t.role==="user"?e.jsx(fe,{size:12}):e.jsx(V,{size:12}),t.role==="user"?"You":t.modelName||"Assistant",t.error&&e.jsx(le,{size:12,className:"text-red-400"})]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(te,{text:t.role==="user"?t.content:Ce(t.content)})}),t.role==="assistant"&&t.timing&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/30",children:e.jsx(se,{times:t.timing})}),t.role==="assistant"&&t.content&&e.jsx("button",{onClick:()=>ae(i),className:`absolute bottom-2 right-2 p-1.5 rounded-md transition-all ${R===`${i}`?"bg-emerald-500/20 text-emerald-400":"opacity-0 group-hover:opacity-100 bg-slate-700/70 text-slate-400"}`,children:R===`${i}`?e.jsx(pe,{size:12}):e.jsx(he,{size:12})})]}),y&&e.jsx("div",{className:"ml-4",children:e.jsx(Se,{content:t.content,onSelect:F=>P(F,!0),isInline:!1})})]},i)}),f&&S.size>0&&e.jsx(e.Fragment,{children:Array.from(S.entries()).map(([t,i])=>{const y=h.find(q=>q.id===t),F=$.get(t);return e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[85%] rounded-2xl rounded-tl-sm px-4 py-3 bg-slate-800/60 border border-amber-500/30 text-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider text-amber-400/80",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-amber-400/50 border-t-amber-400 rounded-full animate-spin"}),(y==null?void 0:y.name)||t]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(te,{text:i||"..."})}),F&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/30",children:e.jsx(se,{times:F})})]})},t)})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-[99] flex flex-col items-center gap-2 px-4 pb-4",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom))"},children:e.jsx(je,{inputRef:E,inputFocused:n,setInputFocused:C,onSendMessage:P,isGenerating:f||m.size===0,onStop:_,placeholder:m.size===0?"Select a model above...":"Type a message..."})})]})});Ee.displayName="ChatView";export{Ee as default};
