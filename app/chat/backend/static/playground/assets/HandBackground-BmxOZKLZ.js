import{r as n,j as b}from"./react-vendor-Bq61NGg7.js";import{U as Ee,m as Fe}from"./mediapipe-BWDqrTQ6.js";import"./markdown-6lcgs53N.js";import"./math-render-COlGIMml.js";import"./syntax-highlight-CmSz_mm1.js";const ge=1200,pe=.5,he=1500,we=10,Pe={Thumb_Up:{action:"message",message:"ðŸ‘"},Thumb_Down:{action:"message",message:"ðŸ‘Ž"},Open_Palm:{action:"message",message:"ðŸ‘‹"},Victory:{action:"message",message:"ok"},ILoveYou:{action:"message",message:"thanks"},Closed_Fist:{action:"message",message:"stop"},Pointing_Up:{action:"point"}};function Me({onSendMessage:q,onScroll:B,onPinch:K,onHover:$,onGestureState:J,onError:Q,onPerformance:Z,gestureActiveArea:G}){const C=n.useRef(q),V=n.useRef(B),Y=n.useRef(K),I=n.useRef($),i=n.useRef(J),L=n.useRef(Z),ee=n.useRef(G),O=n.useRef(Q);C.current=q,V.current=B,Y.current=K,I.current=$,i.current=J,L.current=Z,ee.current=G,O.current=Q;const P=n.useRef({frames:0,lastTime:performance.now(),fps:0}),w=n.useRef(null),_=n.useRef(null),[te,ve]=n.useState(!1),m=n.useRef(),S=n.useRef(null),re=n.useRef(null),g=n.useRef(null),xe=n.useRef({x:0,y:0}),x=n.useRef(!1),A=n.useRef(0),ye=n.useRef({candidate:"NEUTRAL",frames:0}),Te=n.useRef({isScrolling:!1,lastScrollY:null,scrollVelocity:0,waveXPositions:[],waveDirectionChanges:0,lastWaveDirection:null,waveStartTime:0,dwellStartTime:0,dwellPosition:null,middleFingerActive:!1}),j=n.useCallback((l,t)=>{const e=ee.current;if(!e)return!0;const r=1-l;return r>=e.minX&&r<=e.maxX&&t>=e.minY&&t<=e.maxY},[]);n.useEffect(()=>((async()=>{var t;try{const e=typeof chrome<"u"&&!!((t=chrome.runtime)!=null&&t.id),r=e?"/mediapipe":"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm",s=e?"/mediapipe/gesture_recognizer.task":"https://storage.googleapis.com/mediapipe-models/gesture_recognizer/gesture_recognizer/float16/1/gesture_recognizer.task",c=await Ee.forVisionTasks(r),u=await Fe.createFromOptions(c,{baseOptions:{modelAssetPath:s,delegate:"GPU"},runningMode:"VIDEO",numHands:2,minHandDetectionConfidence:.5,minHandPresenceConfidence:.5,minTrackingConfidence:.5});S.current=u,ve(!0)}catch(e){console.error("Error initializing gesture recognition:",e)}})(),()=>{var t;(t=S.current)==null||t.close()}),[]);const ne=n.useCallback((l,t)=>{var se,ie,ce,ae,oe,le,ue,de,fe;const e=Te.current,r=ye.current;if(!((se=l.gestures)!=null&&se.length))return e.isScrolling=!1,e.lastScrollY=null,x.current&&g.current&&(g.current.style.opacity="0",x.current=!1),e.middleFingerActive&&i.current&&(i.current({gesture:null,progress:0,triggered:!1}),e.middleFingerActive=!1),null;const s=(ie=l.gestures[0])==null?void 0:ie[0],c=l.landmarks[0];if(!s||!c)return null;const u=s.categoryName,d=Pe[u];if(u==="Pointing_Up"){const a=c[8],o={x:1-a.x,y:a.y};(ce=I.current)==null||ce.call(I,o.x,o.y);const E=window.innerWidth,H=window.innerHeight,N=o.x*E,U=o.y*H,F=xe.current;if(x.current?(F.x+=(N-F.x)*pe,F.y+=(U-F.y)*pe):(F.x=N,F.y=U),g.current&&(g.current.style.transform=`translate(${F.x}px, ${F.y}px)`,g.current.style.opacity="1"),x.current=!0,!e.dwellPosition)e.dwellStartTime=t,e.dwellPosition=o;else if(Math.sqrt((o.x-e.dwellPosition.x)**2+(o.y-e.dwellPosition.y)**2)>.05)e.dwellStartTime=t,e.dwellPosition=o;else{const me=t-e.dwellStartTime;if(me>=ge&&Y.current)return Y.current(o.x,o.y),A.current=t,e.dwellStartTime=0,e.dwellPosition=null,(ae=i.current)==null||ae.call(i,{gesture:"DWELL_CLICK",progress:1,triggered:!0}),"DWELL_CLICK";(oe=i.current)==null||oe.call(i,{gesture:"POINTING",progress:Math.min(1,me/ge),triggered:!1})}return"POINTING"}else e.dwellStartTime=0,e.dwellPosition=null,x.current&&g.current&&(g.current.style.opacity="0",x.current=!1);if(u==="Closed_Fist"){const a=c[0].y;if(!e.isScrolling)e.isScrolling=!0,e.lastScrollY=a,e.scrollVelocity=0;else if(e.lastScrollY!==null){const o=a-e.lastScrollY,E=(e.scrollVelocity||0)*.6+o*.4;e.scrollVelocity=E,Math.abs(E)>.006&&V.current?(V.current(E*1800),e.lastScrollY=a):Math.abs(o)>.02&&(e.lastScrollY=a)}return"FIST"}else e.isScrolling=!1,e.lastScrollY=null,e.scrollVelocity=0;if(u==="Open_Palm"){const a=c[0].x;if(!e.waveStartTime||t-e.waveStartTime>2e3)e.waveXPositions=[a],e.waveDirectionChanges=0,e.lastWaveDirection=null,e.waveStartTime=t;else{const o=e.waveXPositions[e.waveXPositions.length-1],E=a-o;if(Math.abs(E)>.03){e.waveXPositions.push(a);const H=E>0?"right":"left";if(e.lastWaveDirection&&H!==e.lastWaveDirection&&e.waveDirectionChanges++,e.lastWaveDirection=H,e.waveDirectionChanges>=3&&t-A.current>he){const N=document.activeElement,U=N instanceof HTMLInputElement||N instanceof HTMLTextAreaElement;if(C.current&&!U&&j(a,c[0].y))return C.current("Hi"),A.current=t,e.waveDirectionChanges=0,e.waveStartTime=0,e.lastWaveDirection=null,e.waveXPositions=[],"WAVE"}}}}const v=c[0],W=c[8],k=c[12],y=c[16],p=c[20],h=c[10],T=(a,o)=>(a.x-o.x)**2+(a.y-o.y)**2,f=T(k,v),R=T(W,v),z=T(y,v),X=T(p,v);if(T(k,v)>T(h,v)&&f>R*2&&f>z*2&&f>X*2){r.candidate==="Middle_Finger"?r.frames++:(r.candidate="Middle_Finger",r.frames=1);const a=Math.min(1,r.frames/8);if(e.middleFingerActive=r.frames>=8,(le=i.current)==null||le.call(i,{gesture:"Middle_Finger",progress:a,triggered:e.middleFingerActive}),e.middleFingerActive)return"Middle_Finger"}else(e.middleFingerActive||r.candidate==="Middle_Finger")&&(e.middleFingerActive=!1,r.candidate="NEUTRAL",r.frames=0,(ue=i.current)==null||ue.call(i,{gesture:null,progress:0,triggered:!1}));if((d==null?void 0:d.action)==="message"&&d.message){if(r.candidate===u?r.frames++:(r.candidate=u,r.frames=1),r.frames>=we&&t-A.current>he){const a=document.activeElement,o=a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement;if(C.current&&!o&&j(c[0].x,c[0].y))return C.current(d.message),A.current=t,r.frames=0,(de=i.current)==null||de.call(i,{gesture:u,progress:1,triggered:!0}),u}(fe=i.current)==null||fe.call(i,{gesture:u,progress:Math.min(1,r.frames/we),triggered:!1})}return u},[j]),M=n.useCallback(()=>{var W,k;const l=w.current,t=_.current;if(!l||!t||!S.current||!l.videoWidth){m.current=requestAnimationFrame(M);return}const e=window.innerWidth,r=window.innerHeight;(t.width!==e||t.height!==r)&&(t.width=e,t.height=r);const s=t.getContext("2d");if(!s){m.current=requestAnimationFrame(M);return}const c=performance.now(),u=S.current.recognizeForVideo(l,c),d=ne(u,c);P.current.frames++;const v=c-P.current.lastTime;if(v>=1e3&&(P.current.fps=Math.round(P.current.frames*1e3/v),P.current.frames=0,P.current.lastTime=c,(W=L.current)==null||W.call(L,{fps:P.current.fps,detectionTime:Math.round(performance.now()-c)})),s.clearRect(0,0,e,r),(k=u.landmarks)!=null&&k.length)for(const y of u.landmarks){let p="#3b82f6",h="#60a5fa";d==="POINTING"?(p="#06b6d4",h="#67e8f9"):d==="Thumb_Up"?(p="#22c55e",h="#86efac"):d==="Thumb_Down"?(p="#f97316",h="#fdba74"):d==="FIST"||d==="Closed_Fist"?(p="#a855f7",h="#d8b4fe"):d==="WAVE"||d==="Open_Palm"?(p="#f59e0b",h="#fcd34d"):d==="Middle_Finger"&&(p="#ef4444",h="#f87171");const T=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];s.shadowColor=p,s.shadowBlur=8;for(const[f,R]of T)s.beginPath(),s.moveTo(y[f].x*e,y[f].y*r),s.lineTo(y[R].x*e,y[R].y*r),s.strokeStyle=p,s.lineWidth=2,s.stroke();for(let f=0;f<y.length;f++){const R=y[f],z=R.x*e,X=R.y*r,D=[4,8,12,16,20].includes(f);s.beginPath(),s.arc(z,X,D?4:2,0,Math.PI*2),s.fillStyle=D?"#fff":"#1e293b",s.shadowColor=h,s.shadowBlur=D?15:5,s.fill(),D||(s.strokeStyle=h,s.lineWidth=1,s.stroke())}s.shadowBlur=0}else x.current&&g.current&&(g.current.style.opacity="0",x.current=!1);m.current=requestAnimationFrame(M)},[ne]);return n.useEffect(()=>{var l;if(!(!te||!w.current))return(l=navigator.mediaDevices)==null||l.getUserMedia({video:!0}).then(t=>{re.current=t,w.current&&(w.current.srcObject=t,w.current.play(),w.current.addEventListener("loadeddata",()=>{_.current&&(_.current.width=window.innerWidth,_.current.height=window.innerHeight),m.current&&cancelAnimationFrame(m.current),m.current=requestAnimationFrame(M)}))}).catch(t=>{var r;let e="Could not access camera";t.name==="NotFoundError"?e="No camera found.":t.name==="NotAllowedError"?e="Camera access denied.":t.name==="NotReadableError"&&(e="Camera in use."),(r=O.current)==null||r.call(O,e)}),()=>{m.current&&cancelAnimationFrame(m.current)}},[te,M]),n.useEffect(()=>()=>{var l,t;m.current&&cancelAnimationFrame(m.current),(l=re.current)==null||l.getTracks().forEach(e=>e.stop()),w.current&&(w.current.srcObject=null),(t=S.current)==null||t.close()},[]),b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"fixed inset-0 z-[1] pointer-events-none overflow-hidden scale-x-[-1]",children:[b.jsx("video",{ref:w,className:"hidden",playsInline:!0,muted:!0,autoPlay:!0}),b.jsx("canvas",{ref:_,className:"absolute inset-0 w-full h-full opacity-50 mix-blend-screen"})]}),b.jsx("div",{ref:g,className:"fixed pointer-events-none z-[9999]",style:{top:0,left:0,width:28,height:28,marginLeft:-14,marginTop:-14,borderRadius:"50%",border:"2px solid rgba(148, 163, 184, 0.7)",opacity:0,boxShadow:"0 0 8px rgba(148, 163, 184, 0.3)",willChange:"transform, opacity"},children:b.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full bg-white/90"})})]})}export{Me as default};
