import{r as o,j as e,Z as ne,u as ye,S as de,V as et,v as tt,X as je,w as Ne,T as Se,U as rt,x as st,y as nt,z as lt,C as Be,D as at,E as ot}from"./react-vendor-VqckXmoY.js";import{F as ce}from"./FormattedContent-CtYzWev5.js";import{g as it,a as ct,S as dt,P as ut,f as ke,s as Re}from"./index-Bx6scwZ6.js";import"./markdown-rIyYVYgH.js";import"./math-render-Q06Bpsm3.js";import"./syntax-highlight-BzG5Erai.js";function Ce(i,h){const T=Math.min(i.x,h.x),b=Math.min(i.y,h.y),k=Math.max(i.x,h.x),f=Math.max(i.y,h.y);return{left:T,top:b,right:k,bottom:f,width:k-T,height:f-b}}function pt(i,h){return!(i.right<h.left||i.left>h.right||i.bottom<h.top||i.top>h.bottom)}function ft({containerRef:i,itemRefs:h,setSelectedIndices:T}){const[b,k]=o.useState(null),f=o.useRef(!1);o.useEffect(()=>{f.current=b!=null},[b]),o.useEffect(()=>{const z=p=>{if(p.button!==0||!i.current)return;const R=p.target;if(!R||R.closest('button, a, input, textarea, select, [role="button"]'))return;const c=i.current.getBoundingClientRect();if(!(p.clientX>=c.left&&p.clientX<=c.right&&p.clientY>=c.top&&p.clientY<=c.bottom))return;const C={x:p.clientX,y:p.clientY};p.preventDefault(),f.current=!0,k({origin:C,current:C,active:!1})};return window.addEventListener("mousedown",z,!0),()=>window.removeEventListener("mousedown",z,!0)},[i]),o.useEffect(()=>{if(!b||!i.current)return;const z=j=>j.preventDefault();document.addEventListener("selectstart",z);const p=j=>{const c={x:j.clientX,y:j.clientY};k(m=>{if(!m)return m;const C=Ce(m.origin,c),$=m.active||C.width>2||C.height>2;return{...m,current:c,active:$}})},R=j=>{f.current=!1;const c={x:j.clientX,y:j.clientY};k(m=>{if(!m)return null;const C=Ce(m.origin,c);if(m.active&&C.width>1&&C.height>1){const $=[];for(const[Q,E]of h.current.entries()){const I=E.getBoundingClientRect();pt({left:C.left,right:C.right,top:C.top,bottom:C.bottom},{left:I.left,right:I.right,top:I.top,bottom:I.bottom})&&$.push(Q)}T(new Set($))}return null})};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",R),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",R),document.removeEventListener("selectstart",z)}},[b,i,h,T]);const x=o.useMemo(()=>{if(!b||!b.active||!i.current)return null;const z=i.current.getBoundingClientRect(),p=Ce(b.origin,b.current);return p.width<=0||p.height<=0?null:{left:p.left-z.left,top:p.top-z.top,width:p.width,height:p.height}},[b,i]),y=o.useCallback(()=>{k(null),f.current=!1},[]);return{selectionRect:x,isSelecting:b!=null,dragSelectionActiveRef:f,clearSelection:y}}const xt=6e4;function mt(){const i=o.useRef(new Map),h=o.useRef(null),T=x=>{const y=i.current.get(x);return y?Date.now()-y<xt:!1};return{sortModels:x=>{const y=x.map(c=>({...c,priority:it(c.id,c.type||"self-hosted",c.priority),isRateLimited:T(c.id),isLastSuccessful:c.id===h.current,isDefault:!!c.default})),z=y.filter(c=>!c.isRateLimited),p=y.filter(c=>c.isRateLimited),R=z.sort((c,m)=>c.isLastSuccessful!==m.isLastSuccessful?c.isLastSuccessful?-1:1:c.isDefault!==m.isDefault?c.isDefault?-1:1:c.priority!==m.priority?c.priority-m.priority:c.type!==m.type?c.type==="self-hosted"?-1:1:c.id.localeCompare(m.id)),j=p.sort((c,m)=>c.priority!==m.priority?c.priority-m.priority:c.id.localeCompare(m.id));return[...R,...j]},recordRateLimit:x=>{i.current.set(x,Date.now())},recordSuccess:x=>{h.current=x,i.current.delete(x)},isRecentlyRateLimited:T,getLastSuccessfulModel:()=>h.current}}function ht(i){const[h,T]=o.useState([]);return o.useEffect(()=>{const b=i.match(/```json\s*([\s\S]*?)\s*```/);if(b)try{let k=b[1];k=k.replace(/[\\']/g,'"').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/}\s*[\\]+\s*$/g,"}").replace(/"\s*"\s*$/g,"").trim();const f=JSON.parse(k);if(f.options&&Array.isArray(f.options)){const x=f.options.filter(y=>y.id&&y.label&&y.value);x.length>0?T(x):T([])}}catch(k){console.error("Failed to parse gesture options:",k),T([])}else T([])},[i]),h}function Ee(i){return i.replace(/```json[\s\S]*?```/g,"").trim()}const bt=1800;function gt({content:i,onSelect:h,isInline:T=!1}){const b=ht(i),[k,f]=o.useState(null),[x,y]=o.useState({}),z=o.useRef(0),p=o.useRef(0);o.useEffect(()=>{const E=I=>{var N;const M=(N=I.detail)==null?void 0:N.target;if(M&&M.hasAttribute("data-gesture-option")){const A=M.getAttribute("data-gesture-option");A&&A!==k&&(f(A),R(A))}else k&&(f(null),j())};return window.addEventListener("gesture-hover",E),()=>{window.removeEventListener("gesture-hover",E),j()}},[k]);const R=E=>{j(),z.current=Date.now();const I=()=>{const M=Date.now()-z.current,N=Math.min(M/bt*100,100);if(y(A=>({...A,[E]:N})),N>=100){const A=b.find(X=>X.id===E);A&&(h(A.value),j())}else p.current=requestAnimationFrame(I)};p.current=requestAnimationFrame(I)},j=()=>{p.current&&cancelAnimationFrame(p.current),y({})},c=E=>{f(E),R(E)},m=()=>{f(null),j()};if(b.length===0)return null;const C=T?"w-full mt-3":"w-full",$=T?"grid grid-cols-2 gap-2":"flex flex-col gap-2.5",Q=E=>T?`relative overflow-hidden rounded-lg font-medium text-xs border transition-all duration-200 text-center min-h-[40px] flex items-center justify-center px-3 py-2 ${E?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`:`relative overflow-hidden rounded-xl font-medium text-sm border transition-all duration-200 w-full text-left min-h-[52px] flex items-center px-4 py-3 ${E?"bg-blue-500/20 border-blue-500/50 text-white shadow-lg shadow-blue-500/10 scale-[1.02]":"bg-slate-800/60 border-slate-700/60 text-slate-200 hover:bg-slate-800/80 hover:border-slate-700/80"}`;return e.jsxs("div",{className:C,children:[!T&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-1",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider text-slate-400",children:"Quick Actions"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-700/50 to-transparent"})]}),e.jsx("div",{className:$,children:b.map(E=>{const I=x[E.id]||0,M=k===E.id;return e.jsxs("button",{onClick:()=>h(E.value),onMouseEnter:()=>c(E.id),onMouseLeave:m,"data-gesture-option":E.id,className:Q(M),children:[M&&I>0&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-blue-400 to-blue-500 transition-all duration-75",style:{width:`${I}%`}}),e.jsx("span",{className:"relative z-10",children:E.label})]},E.id)})})]})}function vt({models:i,selectedModelId:h,onSelectModel:T,autoMode:b,setAutoMode:k,autoModeScope:f,setAutoModeScope:x,isGenerating:y}){const[z,p]=o.useState(null),[R,j]=o.useState(""),c=o.useRef(null),m=o.useRef(null),C=o.useMemo(()=>i.filter(l=>l.type==="self-hosted"),[i]),$=o.useMemo(()=>i.filter(l=>l.type==="github"),[i]),Q=o.useMemo(()=>i.filter(l=>l.type==="external"),[i]),E=o.useMemo(()=>C.filter(l=>!R||l.name.toLowerCase().includes(R.toLowerCase())),[C,R]),I=o.useMemo(()=>$.filter(l=>!R||l.name.toLowerCase().includes(R.toLowerCase())),[$,R]),M=o.useMemo(()=>Q.filter(l=>!R||l.name.toLowerCase().includes(R.toLowerCase())),[Q,R]),N=i.find(l=>l.id===h);o.useEffect(()=>{const l=U=>{c.current&&!c.current.contains(U.target)&&p(null)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),o.useEffect(()=>{const l=U=>{U.key==="Escape"&&p(null)};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[]);const A=l=>{k(!0),x(l),p(null),j("")},X=(l,U)=>{U.stopPropagation(),z===l?(p(null),j("")):(p(l),j(""),setTimeout(()=>{var le;return(le=m.current)==null?void 0:le.focus()},50))},V=l=>{k(!1),T(l),p(null),j("")},B=b&&f==="self-hosted",Z=b&&f==="api",W=b&&f==="external",re=!b&&(N==null?void 0:N.type)==="self-hosted",J=!b&&(N==null?void 0:N.type)==="github",K=!b&&(N==null?void 0:N.type)==="external",se=l=>l==="self-hosted"?B?"Self-Hosted Auto":re&&(N==null?void 0:N.name)||"Self-Hosted":l==="api"?Z?"GitHub Auto":J&&(N==null?void 0:N.name)||"GitHub":W?"External Auto":K&&(N==null?void 0:N.name)||"External";return e.jsxs("div",{className:"relative flex items-center gap-1 bg-slate-800/50 rounded-lg p-1 border border-slate-700/50 backdrop-blur-sm",ref:c,children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>A("self-hosted"),disabled:y,className:`h-7 pl-3 pr-1 flex items-center gap-1.5 rounded-l-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${B||re?"bg-emerald-500/20 text-emerald-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[B?e.jsx(ne,{size:12,className:"text-emerald-400"}):e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"max-w-[120px] truncate",children:se("self-hosted")})]}),e.jsx("button",{onClick:l=>X("self-hosted",l),disabled:y,className:`h-7 px-1 flex items-center rounded-r-md transition-all ${B||re?"bg-emerald-500/20 text-emerald-400":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"}`,children:e.jsx(ye,{size:12,className:`transition-transform ${z==="self-hosted"?"rotate-180":""}`})}),z==="self-hosted"&&C.length>0&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-56 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden animate-in fade-in slide-in-from-top-1 duration-150",children:[C.length>5&&e.jsx("div",{className:"px-2 py-2 border-b border-slate-700/50",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:m,type:"text",placeholder:"Search...",value:R,onChange:l=>j(l.target.value),className:"w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"})]})}),e.jsxs("button",{onClick:()=>A("self-hosted"),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${B?"bg-emerald-500/20 text-emerald-300":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:12,className:"text-emerald-400"}),e.jsx("span",{children:"Auto (Smart Fallback)"})]}),B&&e.jsx("span",{className:"text-emerald-400",children:"âœ“"})]}),e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:E.map(l=>e.jsxs("button",{onClick:()=>V(l.id),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${!b&&h===l.id?"bg-emerald-500/20 text-slate-200":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500/50"}),e.jsx("span",{children:l.name})]}),!b&&h===l.id&&e.jsx("span",{className:"text-emerald-400",children:"âœ“"})]},l.id))})]})]}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50"}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>A("api"),disabled:y,className:`h-7 pl-3 pr-1 flex items-center gap-1.5 rounded-l-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${Z||J?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[Z?e.jsx(ne,{size:12,className:"text-blue-400"}):e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"max-w-[120px] truncate",children:se("api")})]}),e.jsx("button",{onClick:l=>X("api",l),disabled:y,className:`h-7 px-1 flex items-center rounded-r-md transition-all ${Z||J?"bg-blue-500/20 text-blue-400":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"}`,children:e.jsx(ye,{size:12,className:`transition-transform ${z==="api"?"rotate-180":""}`})}),z==="api"&&$.length>0&&e.jsxs("div",{className:"absolute top-full right-0 mt-1 w-64 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden animate-in fade-in slide-in-from-top-1 duration-150",children:[$.length>5&&e.jsx("div",{className:"px-2 py-2 border-b border-slate-700/50",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:m,type:"text",placeholder:"Search models...",value:R,onChange:l=>j(l.target.value),className:"w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:border-blue-500/50"})]})}),e.jsxs("button",{onClick:()=>A("api"),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${Z?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:12,className:"text-blue-400"}),e.jsx("span",{children:"Auto (Smart Fallback)"})]}),Z&&e.jsx("span",{className:"text-blue-400",children:"âœ“"})]}),e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:I.map(l=>e.jsxs("button",{onClick:()=>V(l.id),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${!b&&h===l.id?"bg-blue-500/20 text-slate-200":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500/50"}),e.jsx("span",{children:l.name})]}),!b&&h===l.id&&e.jsx("span",{className:"text-blue-400",children:"âœ“"})]},l.id))})]})]}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50"}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("button",{onClick:()=>A("external"),disabled:y,className:`h-7 pl-3 pr-1 flex items-center gap-1.5 rounded-l-md transition-all active:scale-95 text-xs font-medium whitespace-nowrap ${W||K?"bg-purple-500/20 text-purple-300":"text-slate-400 hover:text-slate-300 hover:bg-slate-700/30"}`,children:[W?e.jsx(ne,{size:12,className:"text-purple-400"}):e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),e.jsx("span",{className:"max-w-[120px] truncate",children:se("external")})]}),e.jsx("button",{onClick:l=>X("external",l),disabled:y,className:`h-7 px-1 flex items-center rounded-r-md transition-all ${W||K?"bg-purple-500/20 text-purple-400":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"}`,children:e.jsx(ye,{size:12,className:`transition-transform ${z==="external"?"rotate-180":""}`})}),z==="external"&&Q.length>0&&e.jsxs("div",{className:"absolute top-full right-0 mt-1 w-64 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden animate-in fade-in slide-in-from-top-1 duration-150",children:[Q.length>5&&e.jsx("div",{className:"px-2 py-2 border-b border-slate-700/50",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:m,type:"text",placeholder:"Search models...",value:R,onChange:l=>j(l.target.value),className:"w-full pl-7 pr-2 py-1 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:border-purple-500/50"})]})}),e.jsxs("button",{onClick:()=>A("external"),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${W?"bg-purple-500/20 text-purple-300":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:12,className:"text-purple-400"}),e.jsx("span",{children:"Auto (Smart Fallback)"})]}),W&&e.jsx("span",{className:"text-purple-400",children:"âœ“"})]}),e.jsx("div",{className:"border-t border-slate-700/50"}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:M.map(l=>e.jsxs("button",{onClick:()=>V(l.id),className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors flex items-center justify-between ${!b&&h===l.id?"bg-purple-500/20 text-slate-200":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500/50"}),e.jsx("span",{children:l.name})]}),!b&&h===l.id&&e.jsx("span",{className:"text-purple-400",children:"âœ“"})]},l.id))})]})]})]})}const Rt=o.forwardRef(({models:i,selectedModelId:h,onSelectModel:T,githubToken:b,openrouterKey:k,messages:f,setMessages:x,autoMode:y,setAutoMode:z,autoModeScope:p,setAutoModeScope:R,currentResponse:j,setCurrentResponse:c,isGenerating:m,setIsGenerating:C,onModelUsed:$,gesturesActive:Q=!1},E)=>{var _e;const[I,M]=o.useState(!1),[N,A]=o.useState(null),[X,V]=o.useState(new Set),[B,Z]=o.useState(null),[W,re]=o.useState(null),[J,K]=o.useState(new Set),[se,l]=o.useState(""),[U,le]=o.useState(null),[Y,Xe]=o.useState(new Set),ae=o.useRef(new Map);o.useRef(new Map);const G=o.useRef(null),Ae=o.useRef(null),F=o.useRef(null),oe=o.useRef(null),ue=o.useRef(new Map),pe=o.useRef(null),Le=o.useRef(null),fe=ct(),We=((_e=fe==null?void 0:fe.gestureState)==null?void 0:_e.gesture)==="Middle_Finger",{sortModels:$e,recordRateLimit:ze,recordSuccess:xe}=mt(),me=o.useRef(!1),Je=t=>{if(!F.current)return t;const r=F.current.scrollHeight-F.current.clientHeight;return Math.max(0,Math.min(r,t))},Ke=()=>{if(!F.current)return!0;const{scrollTop:t,scrollHeight:r,clientHeight:n}=F.current;return r-t-n<100};o.useImperativeHandle(E,()=>({sendMessage:(t,r)=>{be(t,r)},setInput:t=>{oe.current&&(oe.current.value=t,oe.current.focus())},stopGeneration:()=>{Te()},scroll:t=>{if(F.current){me.current=!0;const r=F.current.scrollTop,n=Je(r-t);F.current.scrollTop=n}}}));const{selectionRect:Ye}=ft({containerRef:Ae,itemRefs:ue,setSelectedIndices:V});o.useEffect(()=>{F.current&&!me.current&&(F.current.scrollTop=F.current.scrollHeight)},[f,j,m]),o.useEffect(()=>{const t=F.current;if(!t)return;const r=()=>{Ke()&&(me.current=!1)};return t.addEventListener("scroll",r,{passive:!0}),()=>t.removeEventListener("scroll",r)},[]),o.useEffect(()=>{const t=r=>{var s;if(r.ctrlKey||r.metaKey||r.altKey)return;const n=r.target;n.tagName==="INPUT"||n.tagName==="TEXTAREA"||r.key.length===1&&((s=oe.current)==null||s.focus())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),o.useEffect(()=>{const t=r=>{if((r.metaKey||r.ctrlKey)&&r.key==="a"){const n=r.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA")return;r.preventDefault();const s=new Set(f.map((a,d)=>d));V(s);return}if(r.key==="Delete"||r.key==="Backspace"){if(X.size>0){const n=r.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA")return;r.preventDefault(),Ue()}}else r.key==="Escape"&&V(new Set)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[X,f]);const he=async(t,r)=>{var n,s,a;try{const d=await ke({models:[t],messages:r.map(u=>({role:u.role,content:u.content})),max_tokens:2048,temperature:.7,github_token:b||null,openrouter_key:k||null},(n=G.current)==null?void 0:n.signal);let g="";return await Re(d,u=>{var w;if((w=G.current)!=null&&w.signal.aborted)throw new DOMException("Aborted","AbortError");if(u.event==="error"||u.error){const v=typeof u.error=="string"?u.error:u.content||"Stream failed";throw(v.includes("429")||v.toLowerCase().includes("rate limit")||v.toLowerCase().includes("too many requests"))&&(ze(t),console.log(`[Auto Mode] Rate limit detected for ${t}, trying next model...`)),new Error(v)}else(u.event==="token"||u.content)&&u.content&&(g+=u.content,c(v=>v+u.content))}),xe(t),{success:!0,content:g}}catch(d){if(d.name==="AbortError")throw d;const g=((s=d.message)==null?void 0:s.includes("429"))||((a=d.message)==null?void 0:a.toLowerCase().includes("rate limit"));return g&&ze(t),{success:!1,content:d.message,isRateLimit:g}}},be=async(t,r=!1)=>{var s,a;if(!t.trim()||m||!y&&!h)return;console.log(`[Chat] Sending message. autoMode=${y}, autoModeScope=${p}, selectedModelId=${h}`);const n={role:"user",content:t};x(d=>[...d,n]),C(!0),c(""),G.current=new AbortController;try{const d=r?{role:"system",content:`User is hands-free using gesture control. Build an interactive interface to guide them.

Available gesture inputs:
- ðŸ‘ (yes/approve/like)
- ðŸ‘Ž (no/disapprove/dislike)
- ðŸ‘‹ (hi/hello/greeting)
- "ok" (okay/continue)
- "thanks" (thank you)
- "stop" (stop/wait)
- Pointing finger (select UI buttons)

Choose interaction style:
- Simple binary: "Give ðŸ‘ to continue or ðŸ‘Ž to stop" (no JSON needed)
- Complex choices: Use JSON UI buttons (3+ options, or multi-word responses needed)

For JSON UI (when appropriate):
\`\`\`json
{
  "options": [
    {"id": "opt1", "label": "Option 1", "action": "message", "value": "option 1"},
    {"id": "opt2", "label": "Option 2", "action": "message", "value": "option 2"}
  ]
}
\`\`\`

Guidelines:
- Keep response concise (2-3 sentences)
- Use simple gestures for yes/no/continue (more efficient)
- Use JSON UI for 3+ options or complex choices
- Provide 2-4 options max in JSON
- User can point at buttons with index finger`}:null,g=t==="ðŸ–•"||t.includes("middle finger")?{role:"system",content:"The user is showing you their middle finger (gesture). This is a playful interaction. Respond with humorous, over-the-top anger, indignation, or witty comeback. Don't be actually offended, but play along with the 'angry robot' persona."}:null,u=[...f,n].map(v=>({role:v.role,content:v.content})),w=[...d?[d]:[],...g?[g]:[],...u];if(y){const v=i.filter(S=>p==="self-hosted"?S.type==="self-hosted":p==="api"?S.type==="github"||S.type==="external":!0),P=i.filter(S=>p==="self-hosted"?S.type==="github"||S.type==="external":p==="api"?S.type==="self-hosted":!1),O=$e(v),L=$e(P);let D=null,_=!1,H=0;console.log(`[Auto Mode] Starting with ${O.length} primary (${p}) models, ${L.length} fallback models`);for(const S of O){console.log(`[Auto Mode] Trying primary model: ${S.id}`),A(S.id),c("");const q=await he(S.id,w);if(q.success){console.log(`[Auto Mode] Success with ${S.id}`),x(we=>[...we,{role:"assistant",content:q.content,modelName:S.name,modelId:S.id}]),c(""),A(null),$==null||$(S.id);return}console.log(`[Auto Mode] Failed with ${S.id}: ${(s=q.content)==null?void 0:s.substring(0,100)}`),q.isRateLimit&&H++,D=q.content}if(L.length>0){console.log(`[Auto Mode] All primary models failed, trying ${L.length} fallback models`),_=!0;for(const S of L){console.log(`[Auto Mode] Trying fallback model: ${S.id}`),A(S.id),c("");const q=await he(S.id,w);if(q.success){console.log(`[Auto Mode] Success with fallback ${S.id}`),x(we=>[...we,{role:"assistant",content:q.content,modelName:S.name,modelId:S.id}]),c(""),A(null),$==null||$(S.id);return}console.log(`[Auto Mode] Fallback failed with ${S.id}: ${(a=q.content)==null?void 0:a.substring(0,100)}`),q.isRateLimit&&H++,D=q.content}}else console.log("[Auto Mode] No fallback models available");console.log(`[Auto Mode] All ${O.length+L.length} models failed (${H} rate limited)`);let te;const He=O.length+L.length;H>0&&H>=He?te=`â±ï¸ All ${He} models are currently rate limited. GitHub Models has strict free tier limits. Try again in a minute, or add your own GitHub token in Settings for higher quota.`:H>0?te=`All models failed (${H} rate limited). Last error: ${D}`:_?te=`All models failed to respond. Last error: ${D}`:te=`All ${p} models failed to respond. Last error: ${D}`,x(S=>[...S,{role:"assistant",content:te,error:!0}]),A(null)}else{if(!h)return;const v=i.find(O=>O.id===h),P=await he(h,w);P.success?(x(O=>[...O,{role:"assistant",content:P.content,modelName:v==null?void 0:v.name,modelId:h}]),$==null||$(h)):x(O=>[...O,{role:"assistant",content:P.content,modelName:v==null?void 0:v.name,error:!0}])}c("")}catch(d){d.name!=="AbortError"&&x(g=>[...g,{role:"assistant",content:d.message,error:!0}])}finally{C(!1),A(null),G.current=null}},Te=()=>{G.current&&(G.current.abort(),C(!1),j&&(x(t=>[...t,{role:"assistant",content:j}]),c("")))},Pe=async(t,r)=>{if(m||f[t].role!=="assistant")return;let s=t-1;for(;s>=0&&f[s].role!=="user";)s--;if(s<0)return;const a=i.find(g=>g.id===r);if(!a)return;const d=f.slice(0,t).map(g=>({role:g.role,content:g.content}));C(!0),Z(t),A(r),x(g=>g.map((u,w)=>w===t?{...u,content:"",modelName:a.name,modelId:r,error:void 0}:u)),G.current=new AbortController;try{const g=await ke({models:[r],messages:d,max_tokens:4096,temperature:.7,github_token:b,openrouter_key:k},G.current.signal);let u="";await Re(g,w=>{var v;if((v=G.current)!=null&&v.signal.aborted)throw new DOMException("Aborted","AbortError");if(w.event==="error"||w.error){const P=typeof w.error=="string"?w.error:w.content||"Stream failed";throw new Error(P)}else(w.event==="token"||w.content)&&w.content&&(u+=w.content,x(P=>P.map((O,L)=>L===t?{...O,content:u}:O)))}),xe(r),$==null||$(r)}catch(g){g.name!=="AbortError"&&x(u=>u.map((w,v)=>v===t?{...w,content:g.message,error:!0}:w))}finally{C(!1),Z(null),A(null),G.current=null}},Oe=(t,r)=>{if(!t)return i[0]||null;const n=i.find(g=>g.id===t),s=(n==null?void 0:n.type)||"api",a=i.filter(g=>g.type===s),d=a.findIndex(g=>g.id===t);return d===-1?a[0]||null:r==="prev"?d>0?a[d-1]:a[a.length-1]:d<a.length-1?a[d+1]:a[0]},qe=(t,r)=>{r.stopPropagation(),W===t?(re(null),K(new Set),l("")):(re(t),K(new Set),l(""),setTimeout(()=>{var n;return(n=Le.current)==null?void 0:n.focus()},50))},ge=o.useCallback(()=>{re(null),K(new Set),l("")},[]),Qe=t=>{K(r=>{const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),n})},Ie=o.useCallback((t,r)=>{const n=ae.current.get(r);n&&(n.abort(),ae.current.delete(r)),x(s=>s.map((a,d)=>d===t&&a.alternateResponses?{...a,alternateResponses:a.alternateResponses.filter(g=>g.modelId!==r)}:a))},[x]),Ve=o.useCallback(async(t,r=0)=>{var a;const n=f[t];if(!n)return;let s;r===0||!n.alternateResponses?s=n.content:s=((a=n.alternateResponses[r-1])==null?void 0:a.content)||n.content;try{await navigator.clipboard.writeText(s);const d=`${t}-${r}`;le(d),setTimeout(()=>le(null),2e3)}catch(d){console.error("Failed to copy:",d)}},[f]),Ge=async t=>{if(J.size===0||f[t].role!=="assistant")return;let n=t-1;for(;n>=0&&f[n].role!=="user";)n--;if(n<0)return;const s=f.slice(0,t).map(u=>({role:u.role,content:u.content})),a=Array.from(J),d=a.map(u=>{const w=i.find(v=>v.id===u);return{modelId:u,modelName:(w==null?void 0:w.name)||u,content:"",loading:!0}});x(u=>u.map((w,v)=>v===t?{...w,alternateResponses:[...w.alternateResponses||[],...d]}:w)),re(null),K(new Set);const g=async u=>{if(!i.find(P=>P.id===u))return;const v=new AbortController;ae.current.set(u,v);try{const P=await ke({models:[u],messages:s,max_tokens:4096,temperature:.7,github_token:b,openrouter_key:k},v.signal);let O="";await Re(P,L=>{if(v.signal.aborted)throw new DOMException("Aborted","AbortError");if(L.event==="error"||L.error){const D=typeof L.error=="string"?L.error:L.content||"Stream failed";throw new Error(D)}else(L.event==="token"||L.content)&&L.content&&(O+=L.content,x(D=>D.map((_,H)=>H===t&&_.alternateResponses?{..._,alternateResponses:_.alternateResponses.map(te=>te.modelId===u?{...te,content:O}:te)}:_)))}),x(L=>L.map((D,_)=>_===t&&D.alternateResponses?{...D,alternateResponses:D.alternateResponses.map(H=>H.modelId===u?{...H,loading:!1}:H)}:D)),xe(u)}catch(P){P.name!=="AbortError"&&x(O=>O.map((L,D)=>D===t&&L.alternateResponses?{...L,alternateResponses:L.alternateResponses.map(_=>_.modelId===u?{..._,content:P.message,error:!0,loading:!1}:_)}:L))}finally{ae.current.delete(u)}};a.forEach(u=>g(u))},De=(t,r)=>{x(n=>n.map((s,a)=>a===t?{...s,activeResponseIndex:r}:s))},Me=(t,r)=>{if(ae.current.has(r)){Ie(t,r);return}x(n=>n.map((s,a)=>{var v;if(a!==t||!s.alternateResponses)return s;const d=s.alternateResponses.filter(P=>P.modelId!==r);if(d.length===s.alternateResponses.length)return s;const g=s.activeResponseIndex??0,w=(g===0?s.modelId:(v=s.alternateResponses[g-1])==null?void 0:v.modelId)===r?0:g;return{...s,alternateResponses:d,activeResponseIndex:w}}))},Ze=t=>{Xe(r=>{const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),n})};o.useEffect(()=>{Y.size!==0&&x(t=>t.map(r=>{var d;if(!r.alternateResponses||r.alternateResponses.length===0)return r;const n=r.activeResponseIndex??0,s=n===0?r.modelId:(d=r.alternateResponses[n-1])==null?void 0:d.modelId;if(!s||!Y.has(s))return r;if(r.modelId&&!Y.has(r.modelId))return{...r,activeResponseIndex:0};const a=r.alternateResponses.findIndex(g=>!Y.has(g.modelId));return a===-1?r:{...r,activeResponseIndex:a+1}}))},[Y,x]),o.useEffect(()=>{const t=n=>{pe.current&&!pe.current.contains(n.target)&&ge()},r=n=>{n.key==="Escape"&&ge()};return W!==null&&(document.addEventListener("mousedown",t),document.addEventListener("keydown",r)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",r)}},[W,ge]);const Ue=()=>{X.size!==0&&(x(t=>t.filter((r,n)=>!X.has(n))),V(new Set))},ee=i.find(t=>t.id===h),ve=y&&N?i.find(t=>t.id===N):ee,ie=o.useMemo(()=>{for(let t=f.length-1;t>=0;t-=1){const r=f[t];if(r.role==="assistant"&&r.alternateResponses&&r.alternateResponses.length>0)return{msg:r,index:t}}return null},[f]),Fe=o.useMemo(()=>{var n;if(!ie)return[];const{msg:t}=ie,r=[];return t.modelId&&r.push({modelId:t.modelId,modelName:t.modelName||t.modelId,isPrimary:!0}),(n=t.alternateResponses)==null||n.forEach(s=>{s.modelId&&!r.find(a=>a.modelId===s.modelId)&&r.push({modelId:s.modelId,modelName:s.modelName||s.modelId,isPrimary:!1})}),r},[ie]);return e.jsxs("div",{ref:Ae,className:"flex flex-col h-full relative isolate z-[10]",children:[e.jsx(dt,{rect:Ye}),ie&&Fe.length>1&&e.jsx("div",{className:"mx-auto w-full px-4 pt-2 pb-1",style:{maxWidth:"680px"},children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-slate-700/50 bg-slate-900/60 px-3 py-2 text-[11px] text-slate-300",children:[e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-300 uppercase tracking-wider text-[9px]",children:"Parallel Mode"}),e.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:Fe.map(t=>{const r=Y.has(t.modelId);return e.jsxs("div",{className:`flex items-center gap-1 rounded-full border px-2 py-0.5 ${r?"border-slate-700/60 bg-slate-800/40 text-slate-500":t.isPrimary?"border-emerald-500/30 bg-emerald-500/10 text-emerald-300":"border-slate-700/60 bg-slate-800/60 text-slate-300"}`,children:[e.jsx("span",{className:"text-[10px] font-medium",children:t.modelName}),e.jsx("button",{onClick:()=>Ze(t.modelId),className:"p-0.5 rounded-full hover:bg-slate-700/60 transition-colors",title:r?"Unmute":"Mute",children:r?e.jsx(et,{size:10}):e.jsx(tt,{size:10})}),!t.isPrimary&&e.jsx("button",{onClick:()=>Me(ie.index,t.modelId),className:"p-0.5 rounded-full hover:bg-red-500/20 text-slate-400 hover:text-red-300 transition-colors",title:"Remove",children:e.jsx(je,{size:10})})]},t.modelId)})})]})}),e.jsx("div",{ref:F,className:"flex-1 overflow-y-auto p-4 pb-32 chat-scroll relative z-[10] [mask-image:linear-gradient(to_bottom,transparent_0%,black_2rem,black_calc(100%-4rem),transparent_100%)]","data-no-arena-scroll":!0,onClick:t=>{(t.target===t.currentTarget||!t.target.closest("[data-message]"))&&V(new Set)},children:e.jsxs("div",{className:"mx-auto w-full min-h-full flex flex-col space-y-6",style:{maxWidth:"600px"},children:[f.length===0&&e.jsxs("div",{className:"flex-1 flex flex-col items-center text-slate-500 select-none pb-20 relative pt-[30vh]",children:[We?e.jsxs("div",{className:"mb-4 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500 blur-xl opacity-50 rounded-full"}),e.jsx(Ne,{size:72,className:"relative text-red-500"}),e.jsx("div",{className:"absolute -top-2 -right-2 text-3xl",children:"ðŸ’¢"})]}):e.jsx(Ne,{size:72,className:"mb-4 opacity-50 transition-all duration-300"}),e.jsx("div",{className:"flex flex-col items-center gap-2 mb-4 sticky top-4 z-30",children:e.jsx(vt,{models:i,selectedModelId:h,onSelectModel:T,autoMode:y,setAutoMode:z,autoModeScope:p,setAutoModeScope:R,isGenerating:m})}),!b&&(!y&&(ee==null?void 0:ee.type)==="github"||(ee==null?void 0:ee.type)==="external"||y&&p==="api")&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs",children:[e.jsx(Se,{size:11,className:"shrink-0 text-yellow-500"}),e.jsx("span",{children:"Add GitHub token in Settings for dedicated quota"})]})]}),f.map((t,r)=>{const n=t.role==="assistant"&&Q&&t.content.includes("```json");return e.jsxs("div",{ref:s=>{s?ue.current.set(r,s):ue.current.delete(r)},className:`flex ${t.role==="user"?"justify-end":n?"flex-col sm:flex-row justify-start items-start gap-4":"justify-start"}`,"data-message":r,onClick:s=>{(s.target===s.currentTarget||s.target.closest("[data-message]")===s.currentTarget)&&V(a=>{const d=new Set(a);return d.has(r)?d.delete(r):d.add(r),d})},children:[e.jsxs("div",{className:`group relative ${n?"w-full sm:flex-1 sm:max-w-[45%]":"max-w-[85%]"} rounded-2xl px-4 pt-3 pb-2 select-none transition-all cursor-pointer ${X.has(r)?"ring-2 ring-blue-500 bg-blue-500/10":""} ${t.role==="user"?"bg-blue-600/20 border border-blue-500/30 text-white rounded-tr-sm":B===r?"rounded-tl-sm":t.error?"bg-red-500/10 border border-red-500/30 text-red-200 rounded-tl-sm":"bg-slate-800/60 border border-slate-700/60 text-slate-200 rounded-tl-sm"}`,style:B===r?{background:"rgba(30, 41, 59, 0.8)",border:"1px solid rgba(251, 191, 36, 0.4)",boxShadow:"0 0 20px rgba(251, 191, 36, 0.15), inset 0 0 30px rgba(251, 191, 36, 0.03)"}:void 0,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider ${t.role==="user"?"text-blue-300 flex-row-reverse":B===r?"text-amber-400/80":"text-slate-400"}`,children:[t.role==="user"?e.jsx(rt,{size:12}):B===r?e.jsx("div",{className:"relative flex items-center justify-center",style:{width:"14px",height:"14px"},children:e.jsxs("svg",{width:14,height:14,viewBox:"0 0 24 24",fill:"none",style:{filter:"drop-shadow(0 0 6px rgba(251, 191, 36, 0.55))",animation:"spin 0.6s linear infinite"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"regenSpinnerGradient",gradientUnits:"userSpaceOnUse",x1:"3",y1:"12",x2:"12",y2:"3",children:[e.jsx("stop",{offset:"0%",stopColor:"#fbbf24",stopOpacity:"1"}),e.jsx("stop",{offset:"60%",stopColor:"#fbbf24",stopOpacity:"0.5"}),e.jsx("stop",{offset:"100%",stopColor:"#fbbf24",stopOpacity:"0"})]})}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"url(#regenSpinnerGradient)",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"})]})}):e.jsx(Ne,{size:12}),t.role==="user"?"You":e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:s=>{s.stopPropagation();const a=Oe(t.modelId,"prev");a&&!m&&Pe(r,a.id)},disabled:m,className:"p-0.5 rounded hover:bg-slate-700/50 transition-colors disabled:opacity-30",title:"Try previous model",children:e.jsx(st,{size:10})}),e.jsx("span",{className:"px-1",children:t.modelName||"Assistant"}),e.jsx("button",{onClick:s=>{s.stopPropagation();const a=Oe(t.modelId,"next");a&&!m&&Pe(r,a.id)},disabled:m,className:"p-0.5 rounded hover:bg-slate-700/50 transition-colors disabled:opacity-30",title:"Try next model",children:e.jsx(nt,{size:10})}),e.jsxs("div",{className:"relative ml-1",children:[e.jsx("button",{onClick:s=>qe(r,s),disabled:m,className:"p-0.5 rounded hover:bg-slate-700/50 transition-colors disabled:opacity-30",title:"Add parallel replies",children:e.jsx(lt,{size:10})}),W===r&&e.jsxs("div",{ref:pe,className:"absolute top-full left-0 mt-1 w-64 bg-slate-800/95 backdrop-blur-md border border-slate-700 rounded-lg shadow-2xl z-[100] overflow-hidden animate-in fade-in slide-in-from-top-1 duration-150",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"px-3 py-2 border-b border-slate-700/50",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{ref:Le,type:"text",placeholder:"Search models...",value:se,onChange:s=>l(s.target.value),className:"w-full pl-7 pr-2 py-1.5 text-xs bg-slate-700/50 border border-slate-600/50 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:border-blue-500/50"})]})}),e.jsxs("div",{className:"flex gap-1 p-2 border-b border-slate-700/50",children:[e.jsx("button",{onClick:()=>{const s=i.filter(a=>a.type==="self-hosted"&&a.id!==t.modelId).map(a=>a.id);K(new Set(s))},className:"flex-1 px-2 py-1 text-[10px] rounded bg-emerald-500/20 text-emerald-300 hover:bg-emerald-500/30 transition-colors",children:"All Self-Hosted"}),e.jsx("button",{onClick:()=>{const s=i.filter(a=>a.type==="github"||a.type==="external"&&a.id!==t.modelId).map(a=>a.id);K(new Set(s))},className:"flex-1 px-2 py-1 text-[10px] rounded bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 transition-colors",children:"All GitHub"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:i.filter(s=>s.id!==t.modelId).filter(s=>!se||s.name.toLowerCase().includes(se.toLowerCase())||s.id.toLowerCase().includes(se.toLowerCase())).map(s=>e.jsxs("button",{onClick:()=>Qe(s.id),className:`w-full px-3 py-1.5 text-left text-xs flex items-center justify-between transition-colors ${J.has(s.id)?"bg-slate-700/50 text-white":"text-slate-300 hover:bg-slate-700/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.type==="self-hosted"?"bg-emerald-500":"bg-blue-500"}`}),e.jsx("span",{children:s.name})]}),J.has(s.id)&&e.jsx(Be,{size:12,className:"text-emerald-400"})]},s.id))}),J.size>0&&e.jsx("div",{className:"p-2 border-t border-slate-700/50",children:e.jsxs("button",{onClick:()=>Ge(r),className:"w-full px-3 py-1.5 text-xs font-medium rounded bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 transition-colors",children:["Run parallel with ",J.size," model",J.size>1?"s":""]})})]})]})]}),t.error&&e.jsx(Se,{size:12,className:"text-red-400"})]}),t.alternateResponses&&t.alternateResponses.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-2 pt-2 pb-2 mb-1 border-t border-slate-700/30",children:[e.jsx("span",{className:"text-[9px] text-slate-500 uppercase tracking-wider mr-1",children:"Parallel:"}),e.jsx("div",{className:"flex items-center",children:t.modelId&&e.jsx("button",{onClick:s=>{s.stopPropagation(),De(r,0)},className:`px-2 py-0.5 text-[9px] rounded-full transition-colors flex items-center gap-1 ${Y.has(t.modelId)?"bg-slate-800/60 text-slate-500 ring-1 ring-slate-700/50":(t.activeResponseIndex??0)===0?"bg-emerald-500/25 text-emerald-200 ring-1 ring-emerald-500/50":"bg-slate-700/40 text-slate-400 hover:text-slate-200 hover:bg-slate-700/60"}`,title:Y.has(t.modelId)?"Muted":"Primary response",children:t.modelName||"Assistant"})}),t.alternateResponses.map((s,a)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:d=>{d.stopPropagation(),Y.has(s.modelId)||De(r,a+1)},className:`px-2 py-0.5 text-[9px] rounded-full transition-colors flex items-center gap-1 ${s.loading?"bg-amber-500/20 text-amber-300 ring-1 ring-amber-500/40":s.error?"bg-red-500/20 text-red-300 ring-1 ring-red-500/40":Y.has(s.modelId)?"bg-slate-800/60 text-slate-500 ring-1 ring-slate-700/50":(t.activeResponseIndex??0)===a+1?"bg-blue-500/30 text-blue-200 ring-1 ring-blue-500/50":"bg-slate-700/40 text-slate-400 hover:text-slate-200 hover:bg-slate-700/60"}`,title:Y.has(s.modelId)?"Muted":"Parallel response",children:[s.loading&&e.jsx(at,{size:8,className:"animate-spin text-amber-400"}),s.error&&e.jsx(Se,{size:8,className:"text-red-400"}),s.modelName]}),s.loading&&e.jsx("button",{onClick:d=>{d.stopPropagation(),Ie(r,s.modelId)},className:"ml-0.5 p-0.5 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors",title:"Cancel",children:e.jsx(je,{size:8})}),!s.loading&&e.jsx("button",{onClick:d=>{d.stopPropagation(),Me(r,s.modelId)},className:"ml-0.5 p-0.5 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors",title:"Remove",children:e.jsx(je,{size:8})})]},s.modelId))]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none mt-2",children:(()=>{const s=t.activeResponseIndex??0;if(s===0||!t.alternateResponses)return e.jsx(ce,{text:t.role==="user"?t.content:Ee(t.content)});const a=t.alternateResponses[s-1];return a?e.jsx(ce,{text:Ee(a.content)}):e.jsx(ce,{text:Ee(t.content)})})()}),t.role==="assistant"&&t.content&&e.jsx("button",{onClick:s=>{s.stopPropagation(),Ve(r,t.activeResponseIndex??0)},className:`absolute bottom-2 right-2 p-1.5 rounded-md transition-all z-10 ${U===`${r}-${t.activeResponseIndex??0}`?"bg-emerald-500/20 text-emerald-400":"opacity-0 group-hover:opacity-100 bg-slate-700/70 hover:bg-slate-600/70 text-slate-400"}`,title:U===`${r}-${t.activeResponseIndex??0}`?"Copied!":"Copy response",children:U===`${r}-${t.activeResponseIndex??0}`?e.jsx(Be,{size:12}):e.jsx(ot,{size:12})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full sm:hidden h-px bg-gradient-to-r from-transparent via-blue-500/30 to-transparent my-3"}),e.jsxs("div",{className:"hidden sm:flex items-center self-stretch py-6",children:[e.jsx("div",{className:"h-full w-px bg-gradient-to-b from-transparent via-blue-500/30 to-transparent"}),e.jsx("div",{className:"w-3 h-px bg-blue-500/30"})]}),e.jsx("div",{className:"w-full sm:flex-1 sm:max-w-[40%]",children:e.jsx(gt,{content:t.content,onSelect:s=>be(s,!0),isInline:!1})})]})]},r)}),m&&B===null&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[85%] rounded-2xl rounded-tl-sm px-4 pt-3 pb-0 text-slate-200 relative",style:{background:"rgba(30, 41, 59, 0.8)",border:"1px solid rgba(251, 191, 36, 0.4)",boxShadow:"0 0 20px rgba(251, 191, 36, 0.15), inset 0 0 30px rgba(251, 191, 36, 0.03)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-[10px] font-bold uppercase tracking-wider text-amber-400/80",children:[e.jsx("div",{className:"relative flex items-center justify-center",style:{width:"14px",height:"14px"},children:e.jsxs("svg",{width:14,height:14,viewBox:"0 0 24 24",fill:"none",style:{filter:"drop-shadow(0 0 6px rgba(251, 191, 36, 0.55))",animation:"spin 0.6s linear infinite"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"chatSpinnerGradient",gradientUnits:"userSpaceOnUse",x1:"3",y1:"12",x2:"12",y2:"3",children:[e.jsx("stop",{offset:"0%",stopColor:"#fbbf24",stopOpacity:"1"}),e.jsx("stop",{offset:"60%",stopColor:"#fbbf24",stopOpacity:"0.5"}),e.jsx("stop",{offset:"100%",stopColor:"#fbbf24",stopOpacity:"0"})]})}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"rgba(251, 191, 36, 0.15)",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M 12 3 A 9 9 0 1 1 3 12",stroke:"url(#chatSpinnerGradient)",strokeWidth:"2",strokeLinecap:"round",fill:"none"}),e.jsx("circle",{cx:"3",cy:"12",r:"1.4",fill:"#fbbf24"})]})}),(ve==null?void 0:ve.name)||"Assistant"]}),e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:e.jsx(ce,{text:j})})]})})]})}),e.jsx(ut,{inputRef:oe,inputFocused:I,setInputFocused:M,onSendMessage:be,placeholder:y?"Message (Auto mode - will use auto-selected model)...":ee?`Message ${ee.name}...`:"Select a model from the dock to start chatting...",isGenerating:m,onStop:Te,className:"fixed bottom-0 left-0 right-0 z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300",style:{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"}})]})});export{Rt as default};
