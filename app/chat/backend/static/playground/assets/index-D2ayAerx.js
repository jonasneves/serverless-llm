const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SettingsModal-CWnlkGqh.js","assets/react-vendor-Cr2kZ6Hw.js","assets/markdown-BhL5aFst.js","assets/math-render-BeslBgx1.js","assets/math-render-BqiDbsU2.css","assets/syntax-highlight-xu6YVAlF.js","assets/syntax-highlight-BEHUn5zE.css","assets/DiscussionTranscript-DCCrRM2S.js","assets/FormattedContent-C59IBQBw.js","assets/GestureControl-CA4Xp310.js","assets/HandBackground-bqIFA56D.js","assets/mediapipe-YSlczgt6.js","assets/ChatView-CBcodPgk.js"])))=>i.map(i=>d[i]);
var Bn=Object.defineProperty;var zn=(t,n,s)=>n in t?Bn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var nn=(t,n,s)=>zn(t,typeof n!="symbol"?n+"":n,s);import{j as e,S as Hn,A as Wn,r,a as Yn,Z as Xn,T as Fn,R as Gn,c as Un,b as qn}from"./react-vendor-Cr2kZ6Hw.js";import"./math-render-BeslBgx1.js";import"./syntax-highlight-xu6YVAlF.js";import"./markdown-BhL5aFst.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))f(u);new MutationObserver(u=>{for(const a of u)if(a.type==="childList")for(const w of a.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&f(w)}).observe(document,{childList:!0,subtree:!0});function s(u){const a={};return u.integrity&&(a.integrity=u.integrity),u.referrerPolicy&&(a.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?a.credentials="include":u.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function f(u){if(u.ep)return;u.ep=!0;const a=s(u);fetch(u.href,a)}})();const Kn="modulepreload",Vn=function(t){return"/static/playground/"+t},rn={},rt=function(n,s,f){let u=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),h=(w==null?void 0:w.nonce)||(w==null?void 0:w.getAttribute("nonce"));u=Promise.allSettled(s.map(g=>{if(g=Vn(g),g in rn)return;rn[g]=!0;const x=g.endsWith(".css"),d=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${d}`))return;const b=document.createElement("link");if(b.rel=x?"stylesheet":Kn,x||(b.as="script"),b.crossOrigin="",b.href=g,h&&b.setAttribute("nonce",h),document.head.appendChild(b),x)return new Promise((R,D)=>{b.addEventListener("load",R),b.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${g}`)))})}))}function a(w){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=w,window.dispatchEvent(h),!h.defaultPrevented)throw w}return u.then(w=>{for(const h of w||[])h.status==="rejected"&&a(h.reason);return n().catch(a)})},Qn={local:{color:"#10b981"},api:{color:"#3b82f6"}},Jn={nanbeige:1,qwen:2,r1qwen:3,deepseek:3,gemma:4,mistral:5,phi:6,rnj:7,llama:8,functiongemma:9,nemotron:10,gptoss:11,"gpt-oss":11},Zn={"gpt-4o":1,"gpt-4.1":2,"gpt-5":3,"gpt-5-mini":4,"gpt-5-nano":5,"llama-3.3-70b":6,"llama-4-scout-17b-16e-instruct":7,"deepseek-v3-0324":8,"mistral-large":9,"command-r-plus":10},er=50,tr=100;function os(t,n,s){if(s!==void 0)return s;const f=n==="local"?Jn:Zn,u=n==="local"?er:tr;for(const[a,w]of Object.entries(f))if(t.toLowerCase().includes(a.toLowerCase()))return w;return u}const At=[{id:"eu-ai-act-enforcement",label:"EU AI Act Enforcement Wave",prompt:"The EU AI Act enters enforcement; high-risk systems must prove data provenance, evals, and risk controls. Outline compliance gaps for a frontier model API and tradeoffs between speed and alignment.",category:"Policy",modes:["council","roundtable"],tags:["governance","compliance"]},{id:"export-controls-blackwell",label:"Export Controls Tighten",prompt:"U.S. export rules tighten again on AI accelerators; Blackwell-class parts face new caps and cloud checks. Map the impact on training roadmaps, costs, and on-device strategies.",category:"Infra",modes:["compare","roundtable"],tags:["chips","supply-chain"]},{id:"weights-leak",label:"Major Weights Leak",prompt:"A commercial frontier model checkpoint leaks. Assess risks (misuse, impersonation, jailbreak diffusion), legal exposure, and whether open red-team releases mitigate or worsen safety.",category:"Security",modes:["council","roundtable"],tags:["safety","open-weights"]},{id:"on-device-llm-race",label:"On-Device LLM Race",prompt:"Phone OEMs ship 3nm NPUs and 20B-parameter on-device assistants. What actually moves the needle for UX, privacy, and cost vs. cloud? Where do hybrid (edge + cloud) designs win?",category:"Infra",modes:["compare","roundtable"],tags:["edge","latency"]},{id:"signed-app-prompt-injection",label:"Signed App Prompt Injection",prompt:"A popular signed desktop app shipped with hardcoded system prompts; attackers use supply chain updates to exfiltrate data. How should vendors audit, sandbox, and attest LLM apps?",category:"Security",modes:["compare","council"],tags:["supply-chain","prompt-injection"]},{id:"eval-standardization",label:"Safety Eval Standard",prompt:"NIST-style safety eval suites gain traction (jailbreak, autonomy, bio). How should vendors report scores, and what gaps remain for frontier vs. small models?",category:"Policy",modes:["compare","roundtable"],tags:["evaluation","safety"]},{id:"licensing-standoff",label:"Publisher Licensing Standoff",prompt:"Major news publishers pause AI licensing talks and sue over training. What remedies (revenue share, opt-out registries, model removal) are realistic, and how do they ripple to open models?",category:"Data",modes:["council","roundtable"],tags:["licensing","copyright"]},{id:"sbom-for-llms",label:"SBOM for LLM Pipelines",prompt:"Regulators push SBOMs and signed artifacts for AI stacks. Draft what should appear in an LLM pipeline SBOM (data, weights, evals, guardrails) and how to verify it at runtime.",category:"Security",modes:["compare","council"],tags:["sbom","supply-chain"]},{id:"data-poisoning-campaign",label:"Data Poisoning Campaign",prompt:"Researchers find coordinated data poisoning in popular open corpora. How should model hosts detect and mitigate poisoning post-hoc, and what retraining tradeoffs are acceptable?",category:"Security",modes:["compare","roundtable"],tags:["data","poisoning"]},{id:"copyright-settlement",label:"Copyright Settlement Sets Precedent",prompt:"A major copyright suit settles with dataset disclosure and per-output watermarking. Predict how this precedent affects future training sets and open-weight releases.",category:"Policy",modes:["roundtable"],tags:["copyright","watermarking"]}],as={council:["Tabs or spaces? Give your verdict in under 50 words.","Rock, paper, scissorsâ€”which is objectively the best opening move?","In one sentence: should AI be allowed to write its own code?"],roundtable:["Write a two-sentence horror story where the second sentence recontextualizes the first.","Complete this thought: 'AI will never be able to...'","Pitch a startup in one sentence. No buzzwords allowed."],personality:["Coffee or tea? Defend your choice.","Hot take: pineapple on pizza.","What's the most overrated thing everyone pretends to like?"],compare:[],chat:[]};At.filter(t=>t.category==="Policy"||t.category==="Data"),At.filter(t=>t.category==="Infra"),At.filter(t=>t.category==="Security");const nr=["dots-mesh","dots","dots-fade","grid","mesh","animated-mesh","none"],tt="#0f172a",sn={compare:tt,council:tt,roundtable:tt,chat:tt,personality:tt},nt={maxTokens:1024,temperature:.7},pe={cardWidth:256,cardHeight:200,gapX:24,gapY:24,baseRadius:160,minRadius:120,radiusPerModel:15,scrollClamp:200};function rr({showDock:t,availableModels:n,allSelectedByType:s,totalModelsByType:f,handleDragStart:u,handleModelToggle:a,handleAddGroup:w,dockRef:h}){const g=[{type:"local",title:"Local Models",accentColor:"emerald"},{type:"api",title:"API Models",accentColor:"blue"}];return e.jsxs("div",{ref:h,"data-no-arena-scroll":!0,"data-no-background":!0,className:"dock-scroll model-dock-panel fixed left-3 top-20 bottom-20 w-[min(75vw,320px)] sm:left-6 sm:top-24 sm:bottom-24 sm:w-72 rounded-2xl flex flex-col z-[60] transition-all duration-300 overflow-hidden",style:{transform:t?"translateX(0)":"translateX(-150%)",opacity:t?1:0,pointerEvents:t?"auto":"none"},children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-700/50",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Available Models"}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5",children:"Click to add to arena"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:g.map(x=>{const d=n.filter(O=>O.type===x.type),b=s[x.type],R=f[x.type]>0,D={emerald:{button:"text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/10",dot:"bg-emerald-500",border:"hover:border-emerald-500/40"},blue:{button:"text-blue-400 hover:text-blue-300 hover:bg-blue-500/10",dot:"bg-blue-500",border:"hover:border-blue-500/40"}}[x.accentColor];return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${D.dot} ${x.type==="local"?"glow-dot-emerald":"glow-dot-blue"}`}),e.jsx("h3",{className:"text-[11px] font-semibold text-slate-300 uppercase tracking-wide",children:x.title}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",d.length,")"]})]}),e.jsx("button",{onClick:()=>w(x.type),className:`text-[10px] font-medium px-2 py-1.5 sm:py-0.5 rounded transition-all active:scale-95 ${D.button} ${R?"":"opacity-40 cursor-not-allowed"}`,disabled:!R,children:b?"âˆ’ Remove All":"+ Add All"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[d.map(O=>e.jsxs("div",{draggable:!0,onDragStart:z=>u(z,O.id),onClick:()=>a(O.id),className:`group flex items-center gap-3 px-3 py-3 sm:py-2 rounded-lg cursor-grab active:cursor-grabbing hover:bg-white/5 transition-all border border-transparent active:scale-95 ${D.border}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${D.dot} opacity-60 group-hover:opacity-100 transition-opacity`}),e.jsx("span",{className:"text-xs font-medium text-slate-400 group-hover:text-slate-200 transition-colors",children:O.name})]},O.id)),d.length===0&&e.jsx("div",{className:"text-[10px] text-slate-600 italic px-3 py-2",children:"All models are in the arena"})]})]},x.type)})}),e.jsx("div",{className:"px-5 py-3 border-t border-slate-700/50 bg-slate-900/30",children:e.jsxs("p",{className:"text-[10px] text-slate-500 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-slate-800 text-slate-400 font-mono text-[9px]",children:"M"})," to toggle this panel"]})})]})}function sr({inputRef:t,inputFocused:n,setInputFocused:s,onSendMessage:f,className:u,style:a,placeholder:w,isGenerating:h,onStop:g}){return e.jsx("div",{className:u??"fixed bottom-0 right-0 left-0 z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300",style:a??{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"w-full pointer-events-auto",style:{maxWidth:"600px"},children:e.jsxs("div",{className:`rounded-xl p-2.5 transition-all duration-300 flex items-center gap-2 border border-slate-700/40 header-shell ${n?"prompt-panel-focused":""}`,children:[e.jsx("input",{ref:t,type:"text",placeholder:w||"Ask a question to compare model responses...",className:"w-full bg-transparent text-slate-200 placeholder-slate-500 outline-none text-base sm:text-sm px-2.5 py-2.5",onFocus:()=>s(!0),onBlur:()=>s(!1),onKeyDown:x=>{var d;if(x.key==="Enter"&&!x.shiftKey){if(x.preventDefault(),h)return;(d=t.current)!=null&&d.value&&(f(t.current.value),t.current.value="")}},disabled:h}),e.jsx("button",{onClick:()=>{var x;h?g==null||g():(x=t.current)!=null&&x.value&&(f(t.current.value),t.current.value="")},onMouseDown:x=>x.currentTarget.blur(),className:`min-w-[44px] min-h-[44px] sm:min-w-[36px] sm:min-h-[36px] p-2 rounded-lg transition-colors active:scale-95 flex items-center justify-center focus:outline-none focus-visible:outline-none ${h?"text-red-400 hover:text-red-300 hover:bg-red-500/10":"text-slate-400 hover:text-white hover:bg-white/10"}`,"aria-label":h?"Stop generation":"Send message",children:h?e.jsx(Hn,{className:"w-5 h-5 sm:w-4 sm:h-4 fill-current"}):e.jsx(Wn,{className:"w-5 h-5 sm:w-4 sm:h-4",strokeWidth:2.5})})]})})})}const or={chat:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),compare:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})}),council:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),roundtable:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),personality:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},Ge=[{value:"chat",label:"Chat"},{value:"compare",label:"Compare"},{value:"council",label:"Council"},{value:"roundtable",label:"Roundtable"},{value:"personality",label:"Personalities"}];function ar({mode:t,setMode:n,setHoveredCard:s,clearSelection:f,showDock:u,setShowDock:a,onOpenSettings:w,gestureButtonSlot:h}){const[g,x]=r.useState(!1),d=r.useRef(null),[b,R]=r.useState(!0),D=r.useRef(null),[O,z]=r.useState(null),[K,l]=r.useState(0),X=Ge.findIndex(S=>S.value===t),G=X===-1?0:X,J=Ge[G].label;r.useEffect(()=>{const S=()=>{R(window.innerWidth>=1024)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),r.useEffect(()=>{if(!D.current)return;const S=()=>{const ue=D.current;if(!ue)return;const M=ue.querySelectorAll('button[role="radio"]');if(M.length===0||G>=M.length)return;const H=M[G].getBoundingClientRect(),ge=ue.getBoundingClientRect(),ne=H.width,T=H.left,re=ge.left;z(ne),l(T-re)},te=setTimeout(S,0),ie=new ResizeObserver(()=>{setTimeout(S,0)});return ie.observe(D.current),window.addEventListener("resize",S),()=>{clearTimeout(te),ie.disconnect(),window.removeEventListener("resize",S)}},[t,b,G]),r.useEffect(()=>{function S(te){d.current&&!d.current.contains(te.target)&&x(!1)}return g&&document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[g]);const U=S=>{n(S),s(null),f(),x(!1)};return e.jsxs("div",{className:"fixed top-0 left-0 right-0 flex items-center justify-between mb-2 px-3 sm:px-6 pt-4 sm:pt-6 z-50 pointer-events-none transition-all duration-300",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-auto",style:{height:"100%",zIndex:-1}}),e.jsx("div",{className:"flex items-center gap-2 w-auto pointer-events-auto z-20",children:h}),e.jsx("div",{className:"hidden md:block absolute left-1/2 -translate-x-1/2 pointer-events-auto z-20",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center p-1.5 rounded-xl border border-slate-700/40 header-shell",children:[e.jsx("button",{onClick:()=>a(!u),className:"px-2 sm:px-3 flex items-center justify-center text-slate-400 hover:text-white transition-colors",title:"Toggle Model Dock",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("div",{className:"w-px h-5 bg-slate-700/50 mx-0.5 sm:mx-1"}),e.jsxs("div",{ref:D,className:"relative flex p-1 rounded-lg bg-black/20 mode-track",role:"radiogroup","aria-label":"Mode selection","data-gesture-mode-track":"true",children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-md transition-all duration-300 ease-out mode-slider",style:{width:O!==null?`${O}px`:`calc((100% - 8px) / ${Ge.length})`,left:O!==null?`${K}px`:`calc(4px + (100% - 8px) * ${G} / ${Ge.length})`}}),Ge.map(S=>e.jsx("button",{tabIndex:-1,onClick:()=>U(S.value),role:"radio","aria-checked":t===S.value,"aria-label":S.label,title:S.label,className:`relative z-10 py-2 sm:py-1.5 px-3 text-[11px] sm:text-xs font-medium transition-colors duration-200 min-h-[44px] sm:min-h-0 active:scale-95 focus:outline-none focus-visible:outline-none flex-1 flex items-center justify-center text-center ${t===S.value?"text-white":"text-slate-400 hover:text-slate-200"}`,children:S.label},S.value))]})]})})}),e.jsx("div",{className:"flex md:hidden flex-1 justify-center pointer-events-auto relative z-20",children:e.jsxs("div",{className:"relative",ref:d,children:[e.jsxs("button",{onClick:()=>x(!g),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800/90 border border-slate-700/50 text-slate-200 font-medium text-sm backdrop-blur-md shadow-lg active:scale-95 transition-all",children:[e.jsx("span",{className:"font-bold text-slate-400 hidden xs:inline",children:"Arena"}),e.jsx("span",{className:"font-bold hidden xs:inline text-slate-600",children:"/"}),e.jsx("span",{children:J}),e.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform duration-200 ${g?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 py-1 rounded-xl bg-slate-800 border border-slate-700 shadow-2xl overflow-hidden flex flex-col animate-in fade-in zoom-in-95 duration-100 origin-top",children:Ge.map(S=>e.jsxs("button",{onClick:()=>U(S.value),className:`px-4 py-3 text-sm text-left w-full transition-colors flex items-center gap-3 ${t===S.value?"bg-blue-500/10 text-blue-400":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{className:"flex-shrink-0",children:or[S.value]}),e.jsx("span",{className:"flex-1",children:S.label}),t===S.value&&e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},S.value))})]})}),e.jsx("div",{className:"flex items-center gap-2 w-auto justify-end pointer-events-auto z-20",children:e.jsx("button",{onClick:w,className:"min-w-[42px] min-h-[42px] w-[42px] h-[42px] rounded-full bg-slate-800/50 flex items-center justify-center border border-slate-700/50 hover:border-slate-600 transition-colors active:scale-95 focus:outline-none focus-visible:outline-none",title:"Settings",children:e.jsxs("svg",{className:"w-4 h-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}const ir=t=>{if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return null}},lr=(t,n)=>{if(t===null)return n;try{return JSON.parse(t)}catch{return n}};function Ke(t,n,s={}){const f=s.serialize??ir,u=s.deserialize??lr,[a,w]=r.useState(()=>{if(typeof window>"u")return n;try{const h=window.localStorage.getItem(t);return u(h,n)}catch{return n}});return r.useEffect(()=>{if(!(typeof window>"u"))try{const h=f(a);h===null?window.localStorage.removeItem(t):window.localStorage.setItem(t,h)}catch{}},[t,f,a]),[a,w]}const cr=800,ur=3e3,dr=8;function pr(){const[t,n]=r.useState([]),[s,f]=r.useState(!0),[u,a]=r.useState(null),[w,h]=r.useState(0),[g,x]=Ke("playground_selected_models",null),d=r.useRef(g!==null),[b,R]=Ke("playground_chat_model",null),D=r.useRef(b!==null),O=r.useMemo(()=>g??[],[g]),z=r.useCallback(M=>{x(V=>typeof M=="function"?M(V??[]):M)},[x]),[K,l]=r.useState(""),X=r.useRef(0),G=r.useRef(null),J=r.useCallback(async(M,V,H=!1)=>{G.current&&(clearTimeout(G.current),G.current=null),f(!0),H&&(a("Refreshing..."),h(0));const ge=ne=>{var be,ye;const T=ne.models.map(oe=>{const he=oe.type==="api"?"api":"local",ve=Qn[he];return{id:oe.id,name:ve.name||oe.name||oe.id,color:ve.color,type:he,response:"Ready to generate...",priority:oe.priority,context_length:oe.context_length}});if(n(T),f(!1),a(null),h(0),d.current||(x(T.filter(oe=>oe.type==="local").map(oe=>oe.id)),d.current=!0),!D.current){const oe=T.find(he=>he.type==="api");R((oe==null?void 0:oe.id)||((be=T[0])==null?void 0:be.id)||null),D.current=!0}const re=T.find(oe=>oe.type==="api"),se=((ye=T[0])==null?void 0:ye.id)||"";l((re==null?void 0:re.id)||se)};try{const ne=await fetch("/api/models");if(M!==X.current)return;if(!ne.ok)throw new Error(`HTTP ${ne.status}`);const T=await ne.json();if(M!==X.current)return;if(!T.models||T.models.length===0)throw new Error("No models available yet");ge(T)}catch(ne){if(M!==X.current)return;console.warn("Backend fetch failed:",ne);try{console.log("Trying static models.json...");const re=await fetch("/models.json");if(re.ok){const se=await re.json();if(se.models&&se.models.length>0){console.log(`Loaded ${se.models.length} models from static file`),ge(se);return}}}catch(re){console.warn("Static models.json not available:",re)}const T=V+1;if(h(T),T<dr){const re=Math.min(cr*Math.pow(1.4,V),ur);a("Connecting to backend..."),G.current=setTimeout(()=>{J(M,T)},re)}else f(!1),a("Could not load models")}},[x,R]),U=r.useCallback(()=>{X.current+=1,J(X.current,0,!0)},[J]);r.useEffect(()=>(X.current+=1,J(X.current,0),()=>{X.current+=1,G.current&&clearTimeout(G.current)}),[J]);const S=r.useMemo(()=>t.filter(M=>!O.includes(M.id)),[t,O]),{totalModelsByType:te,allSelectedByType:ie}=r.useMemo(()=>{const M={local:t.filter(H=>H.type==="local").length,api:t.filter(H=>H.type==="api").length},V={local:t.filter(H=>H.type==="local"&&O.includes(H.id)).length,api:t.filter(H=>H.type==="api"&&O.includes(H.id)).length};return{totalModelsByType:M,allSelectedByType:{local:M.local>0&&V.local===M.local,api:M.api>0&&V.api===M.api}}},[t,O]),ue=r.useCallback(M=>{var V;return((V=t.find(H=>H.id===M))==null?void 0:V.name)||M},[t]);return{modelsData:t,setModelsData:n,selected:O,setSelected:z,chatModelId:b,setChatModelId:R,moderator:K,setModerator:l,availableModels:S,totalModelsByType:te,allSelectedByType:ie,modelIdToName:ue,isLoading:s,loadError:u,retryCount:w,retryNow:U}}function fr(){var t;return typeof chrome<"u"&&((t=chrome.storage)!=null&&t.local)?window.__API_BASE__||"https://chat.neevs.io":""}async function*ht(t,n,s){var x;const u=`${fr()}${t}`,a=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:s});if(!a.ok){yield{event:"error",error:`HTTP ${a.status}: ${a.statusText}`};return}const w=(x=a.body)==null?void 0:x.getReader();if(!w){yield{event:"error",error:"No response body"};return}const h=new TextDecoder;let g="";try{for(;;){const{done:d,value:b}=await w.read();if(d)break;g+=h.decode(b,{stream:!0});const R=g.split(`
`);g=R.pop()||"";for(const D of R)if(D.startsWith("data: ")){const O=D.slice(6).trim();if(O)try{yield JSON.parse(O)}catch{}}}}finally{w.releaseLock()}}const hr=async(t,n)=>ht("/api/chat/stream",{models:t.models,messages:t.messages,max_tokens:t.max_tokens,temperature:t.temperature,github_token:t.github_token},n),mr=async(t,n)=>ht("/api/chat/council/stream",t,n),gr=async(t,n)=>ht("/api/chat/discussion/stream",t,n),xr=async(t,n)=>ht("/api/chat/personality/stream",t,n),pt=async(t,n)=>{try{for await(const s of t)n(s)}catch(s){throw console.error("Stream error:",s),s}};function on(t){window.__API_BASE__=t}const br=[{name:"Chat",path:"chat.yml",category:"core"},{name:"Build Images",path:"build-push-images.yml",category:"core"},{name:"Nanbeige4-3B Thinking",path:"nanbeige-inference.yml",category:"reasoning",serviceKey:"nanbeige"},{name:"Qwen3 4B",path:"qwen-inference.yml",category:"small",serviceKey:"qwen"},{name:"DeepSeek R1 1.5B",path:"r1qwen-inference.yml",category:"reasoning",serviceKey:"r1qwen"},{name:"Gemma 3 12B",path:"gemma-inference.yml",category:"medium",serviceKey:"gemma"},{name:"Mistral 7B v0.3",path:"mistral-inference.yml",category:"medium",serviceKey:"mistral"},{name:"Phi-3 Mini",path:"phi-inference.yml",category:"small",serviceKey:"phi"},{name:"RNJ-1 Instruct",path:"rnj-inference.yml",category:"medium",serviceKey:"rnj"},{name:"Llama 3.2-3B",path:"llama-inference.yml",category:"medium",serviceKey:"llama"},{name:"FunctionGemma 270M",path:"functiongemma-inference.yml",category:"small",serviceKey:"functiongemma"},{name:"Nemotron-3 Nano 30B",path:"nemotron-inference.yml",category:"reasoning",serviceKey:"nemotron"},{name:"GPT-OSS 20B",path:"gptoss-inference.yml",category:"reasoning",serviceKey:"gptoss"}],yr={workflows:br},cn=yr.workflows;new Map(cn.map(t=>[t.name,t.path]));new Map(cn.filter(t=>t.serviceKey).map(t=>[t.serviceKey,t.name]));const qe={githubToken:"",profile:"local_all",chatApiBaseUrl:"http://localhost:8080",modelsBaseDomain:"",modelsUseHttps:!1};function an(t){const n={...qe,...t};(!n.chatApiBaseUrl||typeof n.chatApiBaseUrl!="string")&&typeof n.baseDomain=="string"&&(n.chatApiBaseUrl=n.baseDomain?`${n.useHttps===!1?"http":"https"}://chat.${n.baseDomain}`:"http://localhost:8080",n.profile="custom"),(!n.modelsBaseDomain||typeof n.modelsBaseDomain!="string")&&typeof n.baseDomain=="string"&&(n.modelsBaseDomain=n.baseDomain,n.profile="custom"),typeof n.modelsUseHttps!="boolean"&&typeof n.useHttps=="boolean"&&(n.modelsUseHttps=n.useHttps,n.profile="custom");const s=n.profile==="remote_all"||n.profile==="local_chat_remote_models"||n.profile==="local_all"||n.profile==="custom"?n.profile:qe.profile;return{githubToken:typeof n.githubToken=="string"?n.githubToken:qe.githubToken,profile:s,chatApiBaseUrl:Pt(typeof n.chatApiBaseUrl=="string"?n.chatApiBaseUrl:""),modelsBaseDomain:typeof n.modelsBaseDomain=="string"?n.modelsBaseDomain:qe.modelsBaseDomain,modelsUseHttps:typeof n.modelsUseHttps=="boolean"?n.modelsUseHttps:qe.modelsUseHttps}}function vr(){var t;return typeof chrome<"u"&&!!((t=chrome.storage)!=null&&t.local)}function Pt(t){const n=t.trim().replace(/\/+$/,"");return n||"http://localhost:8080"}function wr(){const[t,n]=r.useState(qe),[s,f]=r.useState(!1);return r.useEffect(()=>{if(vr()){chrome.storage.local.get(["envConfig"],a=>{const w=an(a.envConfig);n(w),f(!0);const h=Pt(w.chatApiBaseUrl);on(h),console.log("[Config] Extension mode, API base:",h)});const u=(a,w)=>{var h;if(w==="local"&&((h=a.envConfig)!=null&&h.newValue)){const g=an(a.envConfig.newValue);n(g);const x=Pt(g.chatApiBaseUrl);on(x),console.log("[Config] Updated API base:",x)}};return chrome.storage.onChanged.addListener(u),()=>chrome.storage.onChanged.removeListener(u)}else f(!0),console.log("[Config] Web mode, using relative URLs")},[]),{config:t,isLoaded:s}}function kr(){const[t,n]=r.useState([]),s=r.useRef([]),f=r.useCallback(h=>{if(!h.length)return;const g=[...s.current,...h];s.current=g,n(g)},[]),u=r.useCallback(()=>{s.current=[],n([])},[]),a=r.useCallback(h=>h.map(g=>`${g.role==="user"?"User":"Assistant"}: ${g.content}`).join(`

`),[]),w=r.useCallback((h,g)=>{if(g==="compare")return h;const x=h.filter(b=>b.role==="user"),d=[...h].reverse().find(b=>b.role==="assistant"&&(b.kind==="council_synthesis"||b.kind==="roundtable_synthesis")&&b.content.trim().length>0);return d?[...x,d]:x},[]);return{history:t,historyRef:s,pushHistoryEntries:f,clearHistory:u,historyToText:a,buildCarryoverHistory:w}}function Sr(t){const n=r.useRef({}),s=r.useRef(null),f=r.useCallback(()=>{s.current=null;const g=n.current;n.current={},Object.keys(g).length&&t(d=>d.map(b=>{const R=g[b.id];return R?{...b,response:(b.response||"")+R.answer,thinking:(b.thinking||"")+R.thinking}:b}))},[t]),u=r.useCallback(()=>{s.current==null&&(s.current=requestAnimationFrame(f))},[f]),a=r.useCallback((g,x,d)=>{if(!x&&!d)return;const b=n.current[g]||{answer:"",thinking:""};b.answer+=x,b.thinking+=d,n.current[g]=b,u()},[u]),w=r.useCallback(g=>{n.current[g]&&delete n.current[g]},[]),h=r.useCallback(()=>{n.current={},s.current!=null&&(cancelAnimationFrame(s.current),s.current=null)},[]);return{pendingStreamRef:n,flushStreamRafRef:s,enqueueStreamDelta:a,clearPendingStreamForModel:w,resetPendingStream:h}}function jr(t){const{mode:n,moderator:s,selected:f,selectedCardIds:u,githubToken:a,isGenerating:w,summarizeSessionResponses:h,setLastQuery:g,setHoveredCard:x,setPhaseLabel:d,setModeratorSynthesis:b,setCouncilAggregateRankings:R,setCouncilAnonymousReviews:D,setDiscussionTurnsByModel:O,resetFailedModels:z,markModelFailed:K,failedModelsRef:l,currentDiscussionTurnRef:X,sessionModelIdsRef:G,abortControllerRef:J,thinkingStateRef:U,conversationHistoryRef:S,pushHistoryEntries:te,historyToText:ie,buildCarryoverHistory:ue,setModelsData:M,modelIdToName:V,setExecutionTimes:H,setIsGenerating:ge,setIsSynthesizing:ne,setSpeaking:T,enqueueStreamDelta:re,clearPendingStreamForModel:se,resetPendingStream:be}=t;return{sendMessage:async(oe,he,ve,$e)=>{if(!oe.trim()||f.length===0&&!ve||!ve&&w)return;const ae=($e==null?void 0:$e.skipHistory)??!1,He={role:"user",content:oe},Ne=ae?S.current:[...S.current,He];ae||te([He]);const Re=ue(Ne,n),Le=ie(Re);g(oe);const c=Le?`${Le}

Continue the conversation above and respond to the latest user request.`:oe;let Q;if(ve)Q=ve;else{const N=Array.from(u).filter(L=>f.includes(L)&&(n==="compare"||L!==s));Q=N.length>0?N:f.slice()}G.current=Q;const de={},xe=(N,L,A)=>{if(!L)return;const W=A!=null&&A.label?`${A.label}: ${L}`:L;de[N]=A!=null&&A.replace?W:de[N]?`${de[N]}

${W}`:W},ce=new AbortController;J.current=ce,ge(!0),ne(!1),x(null),d(null),b(""),R(null),D([]),O({}),z(),X.current=null,be(),M(N=>N.map(L=>Q.includes(L.id)||L.id===s?he&&he[L.id]?{...L,response:he[L.id],thinking:void 0,error:void 0}:{...L,response:"",thinking:void 0,error:void 0}:L)),H(N=>{const L={...N},A=performance.now();return Q.forEach(W=>{L[W]={startTime:A}}),s&&!L[s]&&(L[s]={startTime:A}),L});const Ce=new Set(Q);s&&Ce.add(s),Ce.forEach(N=>{U.current[N]={inThink:!1,carry:""}});const fe=new Set,Pe=N=>N?N.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()):"",De=N=>typeof N=="number"&&Number.isFinite(N)?`${Math.round(N*100)}%`:"â€”",We=N=>{if(!N)return"";const L=N.domain_weights||{},A=N.model_expertise_scores||{},W=Object.entries(L).sort((y,_)=>(_[1]??0)-(y[1]??0)).map(([y,_])=>`${Pe(y)} ${De(_)}`).join(", "),P=(Q.length>0?Q:Object.keys(A)).filter(Boolean).map(y=>`${V(y)} ${De(A[y])}`).join(", "),I=N.discussion_lead?V(N.discussion_lead):"â€”",v=N.expected_turns??2,m=(N.reasoning||"").trim(),j=[`ORCHESTRATOR â€¢ ${s?V(s):"Roundtable"}`];return W&&j.push(`Domains: ${W}`),j.push(`Lead: ${I}`),P&&j.push(`Participants: ${P}`),j.push(`Planned rounds: ${v}`),m&&(j.push(""),j.push(m)),j.join(`
`).trim()},je=(N,L)=>{const A=N==null?void 0:N.trim();!A||ae||te([{role:"assistant",content:A,kind:L}])},Me=(N,L)=>{const A=U.current[N]||{inThink:!1,carry:""};let W=A.carry+L;A.carry="";const $=W.lastIndexOf("<");if($!==-1&&W.length-$<8){const m=W.slice($);("<think>".startsWith(m)||"</think>".startsWith(m))&&(A.carry=m,W=W.slice(0,$))}let P="",I="",v=0;for(;v<W.length;)if(A.inThink){const m=W.indexOf("</think>",v);if(m===-1){P+=W.slice(v);break}P+=W.slice(v,m),A.inThink=!1,v=m+8}else{const m=W.indexOf("<think>",v);if(m===-1){I+=W.slice(v);break}I+=W.slice(v,m),A.inThink=!0,v=m+7}U.current[N]=A,I&&xe(N,I),(P||I)&&re(N,I,P)},Ae=N=>{const L=N.toLowerCase();return L.includes("rate limit")||L.includes("waiting")?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="display: inline-block; vertical-align: text-bottom; margin-right: 6px;"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'+N:L.includes("error")||L.includes("failed")?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="display: inline-block; vertical-align: text-bottom; margin-right: 6px;"><path d="M12 2L2 20h20L12 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/><path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'+N:N};try{if(n==="compare"){T(new Set(Q));const $=await hr({models:Q,messages:Ne.map(P=>({role:P.role,content:P.content})),max_tokens:nt.maxTokens,temperature:nt.temperature,github_token:a||null},ce.signal);if(await pt($,P=>{if(P.event==="info"&&P.content){const I=String(P.content),v=Ae(I);d(v),P.model_id&&M(m=>m.map(j=>j.id===P.model_id?{...j,statusMessage:v}:j))}if(P.event==="token"&&P.model_id){const I=P.model_id,v=performance.now();fe.has(I)||(fe.add(I),H(m=>({...m,[I]:{...m[I],firstTokenTime:v}})),M(m=>m.map(j=>j.id===I?{...j,statusMessage:void 0}:j))),Me(I,String(P.content??""))}if(P.event==="done"&&P.model_id){const I=performance.now(),v=P.model_id;H(m=>({...m,[v]:{...m[v],endTime:I}})),T(m=>{const j=new Set(m);return j.delete(v),j})}}),!ae){const P=h(de,Q);P&&te([{role:"assistant",content:P,kind:"compare_summary"}])}return}if(n==="council"){const $=Q;if($.length<2){const y="Select at least 2 participants for Council mode.";b(y),s&&M(_=>_.map(p=>p.id===s?{...p,response:y}:p)),d("Error");return}T(new Set($));const P=ve&&$.length>0?$[0]:s||($.length>0?$[0]:null),I=await mr({query:c,participants:$,chairman_model:P,max_tokens:nt.maxTokens,github_token:a||null,completed_responses:he||null},ce.signal);let v="",m=0,j=0;if(await pt(I,y=>{const _=y.event;if(_==="stage1_start"&&d("Stage 1 Â· Responses"),_==="model_start"&&y.model_id){const p=y.model_id;T(F=>{const Y=new Set(F);return Y.add(p),Y})}if(_==="model_chunk"&&y.model_id){const p=y.model_id,F=performance.now();fe.has(p)||(fe.add(p),H(Y=>({...Y,[p]:{...Y[p],firstTokenTime:F}}))),Me(p,String(y.chunk??""))}if(_==="model_response"&&y.model_id){const p=y.model_id,F=performance.now();H(ee=>({...ee,[p]:{...ee[p],endTime:F}})),T(ee=>{const le=new Set(ee);return le.delete(p),le});const Y=String(y.response??"");xe(p,Y,{replace:!0}),he&&he[p]||(M(ee=>ee.map(le=>le.id===p?{...le,response:Y}:le)),je(`${V(p)}:
${Y}`,"council_turn"))}if(_==="model_error"&&y.model_id){const p=y.model_id,F=performance.now();H(ee=>({...ee,[p]:{...ee[p],endTime:F}})),T(ee=>{const le=new Set(ee);return le.delete(p),le});const Y=String(y.error??"Error generating response.");se(p),M(ee=>ee.map(le=>le.id===p?{...le,response:Y,error:Y}:le)),K(p),xe(p,Y,{replace:!0})}if(_==="stage2_start"){const p=$.filter(F=>!l.current.has(F));m=p.length,j=0,D([]),d(`Stage 2 Â· Anonymous Review (0/${m})`),b(`Anonymous reviews in progress (0/${m})â€¦`),T(new Set(p))}if(_==="ranking_response"&&y.model_id){const p=y.model_id;T(Y=>{const ee=new Set(Y);return ee.delete(p),ee}),j+=1,d(`Stage 2 Â· Anonymous Review (${j}/${m||$.length})`),b(`Anonymous reviews in progress (${j}/${m||$.length})â€¦`);const F=String(y.ranking??"");if(F.trim()){const Y=String(y.model_name??p);D(ee=>[...ee,{reviewer_model_id:p,reviewer_model_name:Y,text:F.trim()}])}}if(_==="ranking_error"&&y.model_id){const p=y.model_id;T(ee=>{const le=new Set(ee);return le.delete(p),le}),K(p),j+=1,d(`Stage 2 Â· Anonymous Review (${j}/${m||$.length})`),b(`Anonymous reviews in progress (${j}/${m||$.length})â€¦`);const F=String(y.error??"Ranking error."),Y=String(y.model_name??p);D(ee=>[...ee,{reviewer_model_id:p,reviewer_model_name:Y,text:F,error:!0}])}if(_==="stage2_complete"){const p=y.aggregate_rankings;if(p){R(p);const F=p.map((Y,ee)=>`${ee+1}. ${Y.model_name} (avg: ${Y.average_rank}, votes: ${Y.votes_count})`).join(`
`);je(`Anonymous Rankings:
${F}`,"council_ranking")}}if(_==="chairman_quip"){const p=String(y.quip??"");b(p),P&&je(`${V(P)}: ${p}`,"council_chairman")}if(_==="stage3_start"&&(d("Stage 3 Â· Synthesis"),ne(!0),b(""),s&&T(new Set([s]))),_==="stage3_complete"||_==="stage3_error"){const p=String(y.response??y.error??"Synthesis error.");b(p),v=p,s&&(se(s),M(F=>F.map(Y=>Y.id===s?{...Y,response:p}:Y)),xe(s,p,{replace:!0})),ne(!1)}if(_==="council_complete"){d(null),ne(!1),T(new Set);const p=y.aggregate_rankings;p&&R(p)}if(_==="error"){const p=String(y.error??y.message??"Council error.");b(p),s&&(se(s),M(F=>F.map(Y=>Y.id===s?{...Y,response:p}:Y))),d("Error")}}),!ae){const y=v.trim();y&&te([{role:"assistant",content:y,kind:"council_synthesis"}])}return}if(n==="personality"){const $=Q;T(new Set($));const P=await xr({query:c,participants:$,max_tokens:512,github_token:a||null},ce.signal);await pt(P,I=>{const v=I.event;if(v==="personality_start"&&d("Generating Personas"),v==="model_start"&&I.model_id){const m=I.model_id;T(j=>{const y=new Set(j);return y.add(m),y})}if(v==="model_chunk"&&I.model_id){const m=I.model_id,j=performance.now();fe.has(m)||(fe.add(m),H(_=>({..._,[m]:{..._[m],firstTokenTime:j}})));const y=I.persona_info;y&&M(_=>_.map(p=>p.id===m?{...p,personaEmoji:y.persona_emoji||p.personaEmoji,personaName:y.persona_name||p.personaName,personaTrait:y.persona_trait||p.personaTrait}:p)),Me(m,String(I.chunk??""))}if(v==="model_response"&&I.model_id){const m=I.model_id,j=performance.now();H(we=>({...we,[m]:{...we[m],endTime:j}})),T(we=>{const _e=new Set(we);return _e.delete(m),_e});const y=String(I.response??""),_=String(I.persona_emoji??"ðŸŽ­"),p=String(I.persona_name??"Persona"),F=String(I.persona_trait??"");xe(m,y,{replace:!0}),M(we=>we.map(_e=>_e.id===m?{..._e,response:y,personaEmoji:_,personaName:p,personaTrait:F}:_e));const Y=y.split(`
`),ee=Y[0]||"",Ye=ee.includes("-")&&(ee.includes("**")||/^[^\w\s]/.test(ee))?Y.slice(1).join(`
`).trim():y,me=`${_} **${p}** (${V(m)})${F?` - ${F}`:""}

${Ye}`;je(me,"personality_response")}if(v==="model_error"&&I.model_id){const m=I.model_id,j=performance.now();H(_=>({..._,[m]:{..._[m],endTime:j}})),T(_=>{const p=new Set(_);return p.delete(m),p});const y=String(I.error??"Error generating persona.");se(m),M(_=>_.map(p=>p.id===m?{...p,response:y,error:y}:p)),K(m)}if(v==="personality_complete"&&(d(null),T(new Set)),v==="error"){const m=String(I.error??"Personality mode error.");d("Error"),b(m)}});return}const N=Q;if(N.length<2){const $="Select at least 2 participants for Roundtable mode.";b($),s&&M(P=>P.map(I=>I.id===s?{...I,response:$}:I)),d("Error");return}s&&T(new Set([s]));const L=await gr({query:c,max_tokens:nt.maxTokens,temperature:nt.temperature,orchestrator_model:s||null,github_token:a||null,participants:N,turns:2},ce.signal);let A=0,W="";if(await pt(L,$=>{var I;const P=$.event;if(P==="analysis_start"&&(d("Analyzing Query"),s&&T(new Set([s]))),P==="analysis_complete"){d("Orchestrating"),T(new Set);let v="Analysis complete.";if($.analysis){const m=$.analysis,j=We(m);j&&(v=j)}b(v),s&&M(m=>m.map(j=>j.id===s?{...j,response:v}:j)),je(v,"roundtable_analysis")}if(P==="turn_start"){const v=$.turn_number;typeof v=="number"&&(A=v),d(`Round ${A+1}`);const m=$.model_id;m&&T(new Set([m]))}if(P==="turn_chunk"&&$.model_id){const v=$.model_id,m=performance.now();fe.has(v)||(fe.add(v),H(j=>({...j,[v]:{...j[v],firstTokenTime:m}}))),((I=X.current)==null?void 0:I.modelId)!==v&&(X.current={modelId:v,turnNumber:A}),Me(v,String($.chunk??""))}if(P==="turn_complete"){const v=$.turn,m=v==null?void 0:v.model_id;if(!m)return;const j=performance.now();H(p=>({...p,[m]:{...p[m],endTime:j}}));const y=String((v==null?void 0:v.response)??"");O(p=>{const F=p[m]||[];return{...p,[m]:[...F,{turn_number:A,response:y}]}}),M(p=>p.map(F=>F.id===m?{...F,response:y}:F)),T(p=>{const F=new Set(p);return F.delete(m),F}),xe(m,y,{label:`Round ${A+1}`});const _=V(m);je(`${_} Â· Round ${A+1}
${y}`,"roundtable_turn")}if(P==="turn_error"&&$.model_id){const v=$.model_id,m=performance.now();H(y=>({...y,[v]:{...y[v],endTime:m}}));const j=String($.error??"Error generating response.");se(v),M(y=>y.map(_=>_.id===v?{..._,response:j,error:j}:_)),T(y=>{const _=new Set(y);return _.delete(v),_}),K(v),xe(v,j,{replace:!0}),je(`${V(v)} Â· Round ${A+1}
${j}`,"roundtable_turn")}if(P==="synthesis_start"&&(d("Synthesis"),ne(!0),s&&T(new Set([s]))),P==="discussion_complete"){const v=String($.final_response??"");b(v),W=v,s&&(se(s),M(m=>m.map(j=>j.id===s?{...j,response:v}:j)),xe(s,v,{replace:!0})),d(null),ne(!1),T(new Set)}if(P==="error"){const v=String($.error??$.message??"Discussion error.");b(v),s&&(se(s),M(m=>m.map(j=>j.id===s?{...j,response:v}:j))),d("Error"),ne(!1),T(new Set)}}),!ae){const $=W.trim();$&&te([{role:"assistant",content:$,kind:"roundtable_synthesis"}])}}catch(N){if(N.name==="AbortError")return;if(console.error("Chat error:",N),J.current===ce){const L=N.message||String(N);b(`Session Error: ${L}`),d("Error"),be(),M(A=>A.map(W=>Q.includes(W.id)&&!W.response?{...W,response:"Error generating response."}:W)),Q.forEach(A=>K(A))}}finally{if(J.current===ce){const N=performance.now();H(L=>{const A={...L};return G.current.forEach(W=>{A[W]&&!A[W].endTime&&(A[W]={...A[W],endTime:N})}),A}),ge(!1),ne(!1),d(L=>L==="Error"?L:null),T(new Set)}}}}}function It(t,n){const s=Math.min(t.x,n.x),f=Math.min(t.y,n.y),u=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return{left:s,top:f,right:u,bottom:a,width:u-s,height:a-f}}function Mr({rootContainerRef:t,visualizationAreaRef:n,arenaOffsetYRef:s,arenaTargetYRef:f,wheelRafRef:u,selectedModels:a,cardRefs:w,selectedCardIds:h,setSelectedCardIds:g,suppressClickRef:x}){const[d,b]=r.useState(null),R=r.useRef(!1);r.useEffect(()=>{R.current=d!=null},[d]),r.useEffect(()=>{const z=K=>{if(K.button!==0||!t.current)return;const l=K.target;if(!l)return;const X=l.closest("[data-card]"),G=l.closest('button, a, input, textarea, select, [role="button"]'),J=l.closest("[draggable]"),U=l.closest("[data-no-arena-scroll]");if(X||G||J||U||!t.current.contains(l))return;f.current=s.current,u.current!=null&&(cancelAnimationFrame(u.current),u.current=null);const S=t.current.getBoundingClientRect(),te={x:K.clientX-S.left,y:K.clientY-S.top};K.preventDefault(),R.current=!0,x.current.card=!1,x.current.background=!1,b({origin:te,current:te,active:!1})};return window.addEventListener("mousedown",z,!0),()=>window.removeEventListener("mousedown",z,!0)},[s,f,u,t,n,x]),r.useEffect(()=>{if(!d||!t.current)return;const z=X=>X.preventDefault();document.addEventListener("selectstart",z);const K=X=>{const G=t.current.getBoundingClientRect(),J={x:X.clientX-G.left,y:X.clientY-G.top};b(U=>{if(!U)return U;const S=It(U.origin,J),te=U.active||S.width>4||S.height>4;return{...U,current:J,active:te}})},l=X=>{R.current=!1;const G=t.current.getBoundingClientRect(),J={x:X.clientX-G.left,y:X.clientY-G.top},U=X.target,S=!!(U&&U.closest("[data-card]"));b(te=>{if(!te)return null;const ie=It(te.origin,J);if(te.active&&ie.width>0&&ie.height>0){const ue=[],M=t.current.getBoundingClientRect(),V={left:M.left+ie.left,right:M.left+ie.right,top:M.top+ie.top,bottom:M.top+ie.bottom};for(const H of a){const ge=w.current.get(H.id);if(!ge)continue;const ne=ge.getBoundingClientRect();!(ne.right<V.left||ne.left>V.right||ne.bottom<V.top||ne.top>V.bottom)&&ue.push(H.id)}g(new Set(ue)),S?x.current.card=!0:ue.length>0&&(x.current.background=!0)}return null})};return window.addEventListener("mousemove",K),window.addEventListener("mouseup",l),()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",l),document.removeEventListener("selectstart",z)}},[d,t,n,a,w,h,g,x]);const D=r.useMemo(()=>{if(!d||!d.active)return null;const z=It(d.origin,d.current);return z.width<=0||z.height<=0?null:{left:z.left,top:z.top,width:z.width,height:z.height}},[d]),O=r.useCallback(()=>{b(null),R.current=!1},[]);return{selectionRect:D,isSelecting:d!=null,dragSelectionActiveRef:R,clearSelection:O}}function Er({visualizationAreaRef:t,cardRefs:n,selected:s,setSelected:f,mode:u,gridCols:a,getCirclePosition:w}){const[h,g]=r.useState(null),x=r.useCallback((d,b)=>{if(d.button!==0||d.target.closest('button, a, input, textarea, select, [role="button"]'))return;d.preventDefault();const D=n.current.get(b);if(!D||!t.current)return;const O=D.getBoundingClientRect(),z=t.current.getBoundingClientRect(),K=O.left+O.width/2,l=O.top+O.height/2;g({activeId:b,currX:d.clientX,currY:d.clientY,offsetX:K-d.clientX,offsetY:l-d.clientY,containerLeft:z.left,containerTop:z.top,containerWidth:z.width,containerHeight:z.height,cardHeight:O.height}),d.target.setPointerCapture(d.pointerId)},[t]);return r.useEffect(()=>{if(!h)return;const d=R=>{if(g(l=>l?{...l,currX:R.clientX,currY:R.clientY}:null),!t.current)return;const D=t.current.getBoundingClientRect(),O=s.indexOf(h.activeId);let z=1/0,K=-1;if(u==="compare"){const l=R.clientX-(D.left+D.width/2),X=R.clientY-D.top,G=(pe.cardWidth+pe.gapX)*a-pe.gapX;s.forEach((J,U)=>{const S=Math.floor(U/a),ie=U%a*(pe.cardWidth+pe.gapX)-G/2+pe.cardWidth/2,ue=S*(pe.cardHeight+pe.gapY),M=ie,V=ue+pe.cardHeight/2,H=(l-M)**2+(X-V)**2;H<z&&(z=H,K=U)})}else{const l=R.clientX-(D.left+D.width/2),X=R.clientY-(D.top+D.height/2),G=Math.max(pe.baseRadius,pe.minRadius+s.length*pe.radiusPerModel);s.forEach((J,U)=>{const S=w(U,s.length,u,G),te=(l-S.x)**2+(X-S.y)**2;te<z&&(z=te,K=U)})}if(K!==-1&&K!==O){const l=[...s],[X]=l.splice(O,1);l.splice(K,0,X),f(l)}},b=()=>g(null);return window.addEventListener("pointermove",d),window.addEventListener("pointerup",b),()=>{window.removeEventListener("pointermove",d),window.removeEventListener("pointerup",b)}},[h,t,n,s,f,u,a,w]),{dragState:h,handlePointerDown:x}}const Cr={autoMode:!0,autoModeScope:"local",selectedModelId:null};function Nr(t,n){switch(n.type){case"SET_AUTO_MODE":return{...t,autoMode:n.payload};case"SET_AUTO_MODE_SCOPE":return{...t,autoMode:!0,autoModeScope:n.payload};case"SELECT_MODEL":return{...t,selectedModelId:n.payload};default:return t}}function Tr(t){const[n,s]=r.useReducer(Nr,{...Cr,...t});return{autoMode:n.autoMode,autoModeScope:n.autoModeScope,selectedModelId:n.selectedModelId,setAutoMode:f=>s({type:"SET_AUTO_MODE",payload:f}),setAutoModeScope:f=>s({type:"SET_AUTO_MODE_SCOPE",payload:f}),selectModel:f=>s({type:"SELECT_MODEL",payload:f})}}const Te=(t,n)=>!t||!t.startsWith("#")?t:t.length===7||t.length===4?`${t}${n}`:t,_r={idle:"Ready",responding:"Responding",done:"Done",waiting:"Waiting",error:"Error"};function $t({state:t,color:n,size:s=16,label:f,className:u=""}){const a={width:`${s}px`,height:`${s}px`},w=f??_r[t],h=Math.max(2,Math.round(s*.14)),g=Math.max(12,s-2),x="#fbbf24",d=Te(n,"cc"),b=()=>{switch(t){case"responding":return e.jsx("div",{className:"relative flex items-center justify-center",style:a,children:e.jsxs("svg",{width:g,height:g,viewBox:"0 0 24 24",fill:"none",className:"",style:{filter:`drop-shadow(0 0 6px ${Te(x,"55")})`,animation:"spin 0.6s linear infinite"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"spinnerGradient",gradientUnits:"userSpaceOnUse",x1:"3",y1:"12",x2:"12",y2:"3",children:[e.jsx("stop",{offset:"0%",stopColor:x,stopOpacity:"1"}),e.jsx("stop",{offset:"60%",stopColor:x,stopOpacity:"0.5"}),e.jsx("stop",{offset:"100%",stopColor:x,stopOpacity:"0"})]})}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:Te(x,"15"),strokeWidth:h,fill:"none"}),e.jsx("path",{d:"M 12 3 A 9 9 0 1 1 3 12",stroke:"url(#spinnerGradient)",strokeWidth:h,strokeLinecap:"round",fill:"none"}),e.jsx("circle",{cx:"3",cy:"12",r:h*.7,fill:x})]})});case"done":return e.jsx("div",{className:"flex items-center justify-center rounded-full",style:{...a,background:Te(n,"14"),border:`1px solid ${Te(n,"99")}`},children:e.jsx("svg",{width:g,height:g,viewBox:"0 0 24 24",fill:"none",children:e.jsx("polyline",{points:"5 13 10 18 19 7",stroke:n,strokeWidth:h,strokeLinecap:"round",strokeLinejoin:"round"})})});case"error":const R="#ef4444";return e.jsx("div",{className:"flex items-center justify-center rounded-full",style:{...a,background:Te(R,"14"),border:`1px solid ${Te(R,"99")}`},children:e.jsx("svg",{width:g,height:g,viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 6L18 18M6 18L18 6",stroke:R,strokeWidth:h,strokeLinecap:"round",strokeLinejoin:"round"})})});case"waiting":return e.jsxs("div",{className:"relative flex items-center justify-center",style:a,children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{border:`1px solid ${Te(d,"99")}`}}),e.jsx("svg",{width:g,height:g,viewBox:"0 0 24 24",fill:"none",style:{animation:"spin 5s linear infinite"},children:e.jsx("circle",{cx:"12",cy:"12",r:"8.5",stroke:Te(d,"44"),strokeWidth:h-1,strokeDasharray:"6 10",strokeLinecap:"round"})}),e.jsx("div",{className:"absolute w-2 h-2 rounded-full",style:{background:Te(d,"aa"),animation:"pulse 1.5s ease-in-out infinite"}})]});default:return e.jsxs("div",{className:"relative flex items-center justify-center",style:a,children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{border:"1px solid rgba(71, 85, 105, 0.5)"}}),e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:"rgba(148, 163, 184, 0.6)",animation:"pulse 2.4s ease-in-out infinite"}})]})}};return e.jsx("div",{className:`inline-flex items-center justify-center ${u}`,title:w,children:b()})}function ln({times:t}){const n=(t==null?void 0:t.startTime)!=null,s=(t==null?void 0:t.endTime)!=null,f=(t==null?void 0:t.firstTokenTime)!=null,u=n&&s?((t.endTime-t.startTime)/1e3).toFixed(2):null,a=n&&f?((t.firstTokenTime-t.startTime)/1e3).toFixed(2):null;return e.jsxs("div",{className:"text-[10px] text-slate-500",children:[e.jsx("span",{className:"text-slate-400",children:"TIME"})," ",u?`${u}s`:n&&!s?"...":"â€”",a&&e.jsxs("span",{className:"ml-2 text-slate-600",children:["TTFT ",a,"s"]})]})}const Dt=({text:t,speed:n=5})=>{const[s,f]=r.useState(""),u=r.useRef(0),a=r.useRef(null);return r.useEffect(()=>{!t.startsWith(s)&&s!==""&&(f(""),u.current=0)},[t]),r.useEffect(()=>{a.current!=null&&(clearTimeout(a.current),a.current=null);const w=t.length;if(u.current>=w)return;const h=()=>{const g=u.current,x=w-g;if(x<=0)return;const d=x>120?12:x>40?4:x>10?2:1,b=Math.min(w,g+d);u.current=b,f(t.slice(0,b));const D=w-b>5?0:n;a.current=window.setTimeout(h,D)};return a.current=window.setTimeout(h,n),()=>{a.current!=null&&(clearTimeout(a.current),a.current=null)}},[t,n]),e.jsx("span",{children:s})},ft=256,un=200,Ue=96;function Rr(t){const{mode:n,selectedModels:s,gridCols:f,speaking:u,selectedCardIds:a,setSelectedCardIds:w,executionTimes:h,failedModels:g,cardRefs:x,handlePointerDown:d,dragState:b,setContextMenu:R,suppressClickRef:D,getTailSnippet:O,hoveredCard:z,setHoveredCard:K,layoutRadius:l,getCirclePosition:X,moderatorModel:G,moderatorId:J,orchestratorTransform:U,orchestratorStatus:S,orchestratorPhaseLabel:te,moderatorSynthesis:ie,isSynthesizing:ue,isGenerating:M,phaseLabel:V,linesTransitioning:H,lastSelectedCardRef:ge,orchestratorAutoMode:ne,orchestratorAutoScope:T,showOrchestratorMenu:re,setShowOrchestratorMenu:se,setOrchestratorAutoMode:be,setOrchestratorAutoScope:ye,orchestratorMenuRef:oe,availableModels:he,setModerator:ve,councilWinnerId:$e}=t,ae=n!=="compare",He=n==="council"?l-64:0,Ne=S==="responding"?"Responding":S==="waiting"?"Waiting":S==="done"?"Done":"Ready",[Re,Le]=r.useState(null);return r.useEffect(()=>{if(!re)return;const c=Q=>{oe.current&&!oe.current.contains(Q.target)&&(se(!1),Le(null))};return document.addEventListener("mousedown",c,!0),()=>document.removeEventListener("mousedown",c,!0)},[re,oe,se]),e.jsxs(e.Fragment,{children:[s.map((c,Q)=>{var Ye;const de=X(Q,s.length,n,l),xe=Lr(Q,f),ce=u.has(c.id),Ce=a.has(c.id),fe=g.has(c.id),Pe=!ce&&!fe&&!!((Ye=h[c.id])!=null&&Ye.endTime)&&c.response.trim().length>0,De=!ce&&!Pe&&!fe&&M&&n==="roundtable",We=fe?"error":ce?"responding":Pe?"done":De?"waiting":"idle",je=fe?"Error":ce?"Responding":Pe?"Done":De?"Waiting":"Ready",Me="#fbbf24",Ae="#ef4444",N=c.type==="local"?"#10b981":"#3b82f6",L=fe?Ae:N,A=ce&&!fe,W="rgba(30, 41, 59, 0.85)",$=fe?`linear-gradient(135deg, ${Ae}14, ${W})`:A?`linear-gradient(135deg, ${Me}14, ${W})`:W,P=fe?`1px solid ${Ae}99`:A?`1px solid ${Me}99`:Ce?`1px solid ${N}d0`:"1px solid rgba(71, 85, 105, 0.5)",I=fe?`0 0 24px ${Ae}33, inset 0 1px 1px rgba(255,255,255,0.1)`:A?`0 0 24px ${Me}33, inset 0 1px 1px rgba(255,255,255,0.1)`:Ce?`0 0 20px ${N}30, inset 0 1px 1px rgba(255,255,255,0.1)`:"0 4px 20px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.05)",v=Ar({mode:n,gridX:xe.gridX,gridY:xe.gridY,circleX:de.x,circleY:de.y,dragState:b,modelId:c.id}),m=z===c.id,j=ae?Ue:ft,y=ae?Ue:un,_=Math.max(800,l*2+600),p=_/2,F=p,Y=p,ee=p+(0-de.x),le=p+(He-de.y);return e.jsxs("div",{ref:me=>{me?x.current.set(c.id,me):x.current.delete(c.id)},onPointerDown:me=>d(me,c.id),className:"absolute",onContextMenu:me=>{me.preventDefault(),me.stopPropagation(),R({x:me.clientX,y:me.clientY,modelId:c.id})},style:{transform:v,zIndex:ae?m?300:Ce?40:ce?15:5:Ce?20:ce?10:1,left:"50%",top:ae?"50%":"0",transition:(b==null?void 0:b.activeId)===c.id?"none":"transform 300ms cubic-bezier(0.2, 0, 0.2, 1)"},children:[ae&&ce&&!fe&&!H&&e.jsxs("svg",{className:"absolute pointer-events-none",style:{width:`${_}px`,height:`${_}px`,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:-1},viewBox:`0 0 ${_} ${_}`,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`grad-${c.id}`,gradientUnits:"userSpaceOnUse",x1:F,y1:Y,x2:ee,y2:le,children:[e.jsx("stop",{offset:"0%",stopColor:Me,stopOpacity:"0.45"}),e.jsx("stop",{offset:"100%",stopColor:Me,stopOpacity:"0.12"})]})}),e.jsx("line",{x1:F,y1:Y,x2:ee,y2:le,stroke:`url(#grad-${c.id})`,strokeWidth:"2",strokeDasharray:"6,4",strokeLinecap:"round",className:"animate-flow arena-link"})]}),e.jsxs("div",{"data-card":!0,onClick:me=>Ir({e:me,modelId:c.id,suppressClickRef:D,setSelectedCardIds:w,selectedModels:s,lastSelectedCardRef:ge}),onMouseEnter:()=>ae&&K(c.id),onMouseLeave:()=>ae&&K(null),className:`relative cursor-grab active:cursor-grabbing card-hover ${ae?"rounded-full":""} ${Ce?"card-selected":""} ${ce?"card-speaking":""}`,style:{background:$,backdropFilter:ae?void 0:"blur(8px)",WebkitBackdropFilter:ae?void 0:"blur(8px)",border:P,boxShadow:I,transform:Ce||A?"scale(1.05)":"scale(1)",width:`${j}px`,height:`${y}px`,borderRadius:ae?"50%":"12px",transition:"transform 180ms ease-out, box-shadow 180ms ease-out, border-color 180ms ease-out, width 0.7s cubic-bezier(0.4, 0, 0.2, 1), height 0.7s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.7s cubic-bezier(0.4, 0, 0.2, 1)"},children:[!ae&&e.jsxs("div",{style:Or,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx($t,{state:We,color:L,size:16,label:je}),e.jsx("span",{className:"text-xs font-semibold text-slate-200 truncate",children:c.name})]}),e.jsx("div",{className:"flex items-center gap-1.5 shrink-0",children:e.jsx("span",{className:`text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded ${c.type==="local"?"bg-emerald-500/10 text-emerald-300 border border-emerald-500/30":"bg-blue-500/10 text-blue-300 border border-blue-500/30"}`,children:c.type==="local"?"Local":"API"})})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed line-clamp-3 flex-1",children:$r({model:c,isSpeaking:ce,thinkingFallback:e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦"}),getTailSnippet:O})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-slate-700/50",children:e.jsx(ln,{times:h[c.id]})})]}),ae&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-center",style:{transition:"opacity 0.3s ease-out"},children:[e.jsx("div",{className:"absolute inset-[3px] rounded-full border border-white/5",style:{boxShadow:`inset 0 0 20px ${L}15`}}),e.jsx("div",{className:"absolute inset-[-6px] rounded-full opacity-60",style:{background:`radial-gradient(circle, ${L}22 0%, transparent 65%)`,filter:"blur(10px)"}}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center gap-1.5 px-3",children:[e.jsx("div",{className:"text-[7px] tracking-[0.32em] text-slate-400 uppercase",children:je}),e.jsx("div",{className:"text-[10px] font-semibold text-slate-100 leading-tight",children:c.name}),e.jsx($t,{state:We,color:L,size:12})]})]})]}),n==="personality"&&ae&&c.personaEmoji&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center justify-center pointer-events-none select-none",style:{bottom:"-12px",fontSize:"20px",zIndex:100,transition:"transform 180ms ease-out",transform:ce?"scale(1.15)":"scale(1)",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5)) drop-shadow(0 0 8px rgba(0,0,0,0.3))"},title:c.personaName?`${c.personaName} - ${c.personaTrait}`:"Persona",children:c.personaEmoji}),n==="council"&&ae&&$e===c.id&&!M&&!ue&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center justify-center pointer-events-none select-none",style:{bottom:"-12px",fontSize:"20px",zIndex:100,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5)) drop-shadow(0 0 12px rgba(251, 191, 36, 0.4))",animation:"pulse 2s ease-in-out infinite"},title:"Top Ranked Response",children:"ðŸ†"}),ae&&z===c.id&&e.jsxs("div",{"data-card":!0,onClick:me=>me.stopPropagation(),className:"absolute w-64 max-w-[calc(100vw-2rem)] p-4 rounded-xl transition-all duration-300 z-[220]",style:{top:de.y>0?"auto":"100%",bottom:de.y>0?"100%":"auto",left:"50%",transform:"translateX(-50%)",marginTop:de.y>0?0:"12px",marginBottom:de.y>0?"12px":0,background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(16px)",border:`1px solid ${L}40`,boxShadow:`0 20px 40px rgba(0,0,0,0.5), 0 0 20px ${L}15`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:L}}),e.jsx("span",{className:"text-xs font-semibold text-slate-300",children:c.name})]}),n==="personality"&&c.personaEmoji&&c.personaName&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-700/50",children:[e.jsx("span",{className:"text-base",children:c.personaEmoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-semibold text-blue-400",children:c.personaName}),c.personaTrait&&e.jsx("div",{className:"text-[10px] text-slate-500",children:c.personaTrait})]})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed whitespace-pre-wrap",children:Pr({model:c,isSpeaking:ce,getTailSnippet:O})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-2 border-t border-slate-700/50",children:e.jsx(ln,{times:h[c.id]})})]})]},c.id)}),n!=="compare"&&G&&e.jsxs("div",{"data-card":!0,className:"absolute z-20 transition-all duration-700 ease-out cursor-pointer",style:{opacity:1,transform:U,left:"50%",top:n==="council"?`calc(50% + ${l}px - 64px)`:"50%"},onClick:c=>{c.stopPropagation(),J&&(w(new Set([J])),ge.current=J)},onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),re?(se(!1),Le(null)):(Le({x:c.clientX,y:c.clientY}),se(!0))},onMouseEnter:()=>K("moderator"),onMouseLeave:()=>K(null),children:[e.jsx("div",{className:"relative flex items-center justify-center",style:{width:`${Ue}px`,height:`${Ue}px`},children:(()=>{const c=S==="responding",Q=c?"#fbbf24":G.color;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-pulse",style:{background:`radial-gradient(circle, ${Q}20 0%, transparent 70%)`,transform:"scale(2.2)",filter:"blur(18px)"}}),e.jsxs("div",{className:"relative rounded-full flex items-center justify-center transition-all duration-300",style:{width:`${Ue}px`,height:`${Ue}px`,background:c?"linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(15, 23, 42, 0.9))":"rgba(15, 23, 42, 0.9)",backdropFilter:"blur(16px)",border:`2px solid ${Q}${c?"99":"60"}`,boxShadow:`0 0 36px ${Q}${c?"40":"28"}, inset 0 1px 1px rgba(255,255,255,0.1)`},children:[e.jsx("div",{className:"absolute inset-[-4px] rounded-full",style:{background:`conic-gradient(from 0deg, transparent, ${Q}60, transparent)`,animation:"spin 4s linear infinite"}}),e.jsx("div",{className:"absolute inset-[2px] rounded-full",style:{background:"rgba(15, 23, 42, 0.96)"}}),e.jsxs("div",{className:"relative text-center z-10 flex flex-col items-center gap-1.5 px-3",children:[e.jsx("div",{className:"text-[7px] tracking-[0.32em] text-slate-400 uppercase",children:Ne}),e.jsx("div",{className:"text-[10px] font-semibold text-slate-100 leading-tight",children:G.name}),e.jsx($t,{state:S,color:Q,size:12})]})]})]})})()}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex flex-col items-center gap-1 w-max max-w-[200px]",style:{top:"calc(100% + 12px)"},children:e.jsx("span",{className:"text-[10px] text-slate-500",children:te})}),z==="moderator"&&!re&&(()=>{const c=S==="responding",Q=c?"#fbbf24":G.color;return e.jsxs("div",{"data-card":!0,onClick:de=>de.stopPropagation(),className:"absolute bottom-full mb-4 left-1/2 -translate-x-1/2 w-80 max-w-[calc(100vw-2rem)] p-4 rounded-xl z-[200] transition-all duration-300",style:{background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(16px)",border:`1px solid ${Q}40`,boxShadow:`0 20px 40px rgba(0,0,0,0.5), 0 0 30px ${Q}20`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Orchestrator"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Â·"}),e.jsx("span",{className:"text-xs font-medium text-slate-300",children:G.name}),c&&e.jsx("span",{className:"text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-300 border border-yellow-500/30",children:"Working"})]}),e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:Dr({moderatorSynthesis:ie,isSynthesizing:ue,moderatorId:J,speaking:u,phaseLabel:V,isGenerating:M,getTailSnippet:O})})]})})(),re&&Re&&Yn.createPortal(e.jsx("div",{ref:oe,className:"w-64 bg-slate-800 border border-slate-700 rounded-lg shadow-xl overflow-hidden",style:{position:"fixed",top:`${Re.y}px`,left:`${Re.x}px`,transform:"translateY(-50%)",zIndex:9999},onClick:c=>c.stopPropagation(),children:ne?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[10px] uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-700/50",children:["Auto Mode: ",T.toUpperCase()]}),["all","local","api"].map(c=>e.jsxs("button",{onClick:()=>{ye(c),se(!1)},className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors ${T===c?"bg-yellow-500/20 text-yellow-300":"text-slate-300 hover:bg-slate-700/50"}`,children:[c==="all"&&"All",c==="local"&&"Local",c==="api"&&"API",e.jsxs("span",{className:"text-[10px] text-slate-500 ml-1",children:[c==="all"&&"(local â†’ API)",c==="local"&&"(no quota)",c==="api"&&"(cloud only)"]})]},c)),e.jsx("div",{className:"border-t border-slate-700",children:e.jsx("button",{onClick:()=>{be(!1),se(!1)},className:"w-full px-3 py-2 text-left text-xs font-medium text-slate-400 hover:bg-slate-700/50 transition-colors",children:"Manual Mode"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 text-[10px] uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-700/50",children:"Select Orchestrator"}),he.filter(c=>c.type==="api").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 text-[9px] uppercase tracking-wider text-slate-600 font-semibold",children:"API Models"}),he.filter(c=>c.type==="api").map(c=>e.jsx("button",{onClick:()=>{ve(c.id),se(!1)},className:`w-full px-4 py-2 text-left text-xs font-medium transition-colors ${J===c.id?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:c.name}),J===c.id&&e.jsx("span",{className:"text-blue-400",children:"âœ“"})]})},c.id))]}),he.filter(c=>c.type==="local").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 text-[9px] uppercase tracking-wider text-slate-600 font-semibold border-t border-slate-700/50 mt-1",children:"Local Models"}),he.filter(c=>c.type==="local").map(c=>e.jsx("button",{onClick:()=>{ve(c.id),se(!1)},className:`w-full px-4 py-2 text-left text-xs font-medium transition-colors ${J===c.id?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:c.name}),J===c.id&&e.jsx("span",{className:"text-blue-400",children:"âœ“"})]})},c.id))]}),e.jsx("div",{className:"border-t border-slate-700",children:e.jsxs("button",{onClick:()=>{be(!0),se(!1)},className:"w-full px-3 py-2 text-left text-xs font-medium text-yellow-400 hover:bg-slate-700/50 transition-colors flex items-center gap-2",children:[e.jsx(Xn,{size:12}),e.jsx("span",{children:"Enable Auto Mode"})]})})]})}),document.body)]}),n!=="compare"&&e.jsxs("svg",{className:"absolute pointer-events-none transition-opacity duration-700",style:{width:"1000px",height:"1000px",opacity:.2},children:[e.jsx("circle",{cx:"500",cy:"500",r:l,fill:"none",stroke:"url(#circleGrad)",strokeWidth:"1",strokeDasharray:"8,4"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"circleGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"50%",stopColor:"#8b5cf6"}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6"})]})})]})]})}function Lr(t,n){const s=Math.floor(t/n),f=t%n,u=(ft+pe.gapX)*n-pe.gapX,a=s*(un+pe.gapY);return{gridX:f*(ft+pe.gapX)-u/2+ft/2,gridY:a}}function Ar({mode:t,gridX:n,gridY:s,circleX:f,circleY:u,dragState:a,modelId:w}){if((a==null?void 0:a.activeId)===w){const h=a.currX+a.offsetX,g=a.currY+a.offsetY;if(t==="compare"){const b=h-(a.containerLeft+a.containerWidth/2),R=g-a.containerTop-a.cardHeight/2;return`translate(calc(-50% + ${b}px), ${R}px)`}const x=h-(a.containerLeft+a.containerWidth/2),d=g-(a.containerTop+a.containerHeight/2);return`translate(calc(-50% + ${x}px), calc(-50% + ${d}px))`}return t==="compare"?`translate(calc(-50% + ${n}px), ${s}px)`:`translate(calc(-50% + ${f}px), calc(-50% + ${u}px))`}function Ir({e:t,modelId:n,suppressClickRef:s,setSelectedCardIds:f,selectedModels:u,lastSelectedCardRef:a}){if(t.stopPropagation(),s.current.card){s.current.card=!1;return}const w=t.shiftKey,h=t.metaKey||t.ctrlKey;if(w&&a.current){const g=u.findIndex(d=>d.id===a.current),x=u.findIndex(d=>d.id===n);if(g!==-1&&x!==-1){const d=Math.min(g,x),b=Math.max(g,x),R=u.slice(d,b+1).map(D=>D.id);f(D=>{const O=new Set(D);return R.forEach(z=>O.add(z)),O})}}else h?(f(g=>{const x=new Set(g);return x.has(n)?x.delete(n):x.add(n),x}),a.current=n):(f(new Set([n])),a.current=n)}function $r({model:t,isSpeaking:n,thinkingFallback:s,getTailSnippet:f}){return t.statusMessage?t.statusMessage.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.statusMessage}}):t.statusMessage:n?t.response.trim().length>0?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):e.jsx(Dt,{text:t.response,speed:20}):t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦ "}),f(t.thinking.trim(),220)]}):s:t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):t.response}function Pr({model:t,isSpeaking:n,getTailSnippet:s,maxChars:f=220}){return t.statusMessage?t.statusMessage.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.statusMessage}}):t.statusMessage:n?t.response.trim().length>0?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):e.jsx(Dt,{text:t.response,speed:20}):t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦ "}),s(t.thinking.trim(),280)]}):e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦"}):t.response?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):s(t.response,f):e.jsx("span",{className:"text-slate-500 italic",children:"No response yet."})}function Dr({moderatorSynthesis:t,isSynthesizing:n,moderatorId:s,speaking:f,phaseLabel:u,isGenerating:a,getTailSnippet:w}){return t?n&&s&&f.has(s)?e.jsx(Dt,{text:t,speed:20}):w(t):n?e.jsx("span",{className:"text-slate-500 italic",children:"Synthesizing responses..."}):a?u&&u.startsWith("<svg")?e.jsx("span",{className:"text-slate-500 italic",dangerouslySetInnerHTML:{__html:u}}):e.jsx("span",{className:"text-slate-500 italic",children:u==="Stage 1 Â· Responses"?"Waiting for model responses...":u||"Orchestrating..."}):e.jsx("span",{className:"text-slate-500 italic",children:"Send a prompt to see the synthesis."})}const Or={padding:"16px",height:"100%",display:"flex",flexDirection:"column",isolation:"isolate",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",opacity:1,transition:"opacity 0.3s ease-out"};function Br({rect:t}){return t?e.jsx("div",{className:"absolute pointer-events-none z-30",style:{left:t.left,top:t.top,width:t.width,height:t.height,border:"2px solid rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)"}}):null}const zr={twoFingerTapWindow:500,twoFingerTapCooldown:400,twoFingerMinFrames:4,minPointingTime:100,dwellTime:1200,cursorSmoothing:.5},Ot=r.createContext(null);function Hr({children:t}){const[n,s]=r.useState(!1),[f,u]=r.useState("navigation"),[a,w]=r.useState("chat"),[h,g]=r.useState(zr),[x,d]=r.useState(!1),b=r.useRef({}),R=r.useCallback(M=>{b.current=M},[]),[D,O]=r.useState({gesture:null,progress:0,triggered:!1}),[z,K]=r.useState(null),[l,X]=r.useState(void 0),[G,J]=r.useState(void 0),[U,S]=r.useState(void 0),[te,ie]=r.useState(null),ue={isActive:n,setIsActive:s,gestureMode:f,setGestureMode:u,appContext:a,setAppContext:w,gestureConfig:h,setGestureConfig:g,mouseSimulation:x,setMouseSimulation:d,callbacks:b,setCallbacks:R,gestureState:D,setGestureState:O,aslResult:z,setASLResult:K,debugInfo:l,setDebugInfo:X,landmarkData:G,setLandmarkData:J,performanceMetrics:U,setPerformanceMetrics:S,cameraError:te,setCameraError:ie};return e.jsx(Ot.Provider,{value:ue,children:t})}function Wr(){const t=r.useContext(Ot);if(!t)throw new Error("useGesture must be used within a GestureProvider");return t}function is(){return r.useContext(Ot)}class Yr extends r.Component{constructor(s){super(s);nn(this,"handleRetry",()=>{var s,f;this.setState({hasError:!1,error:null}),(f=(s=this.props).onRetry)==null||f.call(s)});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,f){console.error("ErrorBoundary caught an error:",s,f)}render(){var s;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/70 gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-400",children:[e.jsx(Fn,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:"Something went wrong"})]}),e.jsx("p",{className:"text-xs text-white/40 text-center max-w-xs",children:((s=this.state.error)==null?void 0:s.message)||"Failed to load component"}),e.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white/80 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg transition-all active:scale-95 border border-slate-600/50",children:[e.jsx(Gn,{size:14}),"Try Again"]})]}):this.props.children}}const Xr=r.lazy(()=>rt(()=>import("./SettingsModal-CWnlkGqh.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Fr=r.lazy(()=>rt(()=>import("./DiscussionTranscript-DCCrRM2S.js"),__vite__mapDeps([7,1,2,3,4,5,6,8]))),Gr=r.lazy(()=>rt(()=>import("./GestureControl-CA4Xp310.js"),__vite__mapDeps([9,1,2,3,4,5,6]))),Ur=r.lazy(()=>rt(()=>import("./HandBackground-bqIFA56D.js"),__vite__mapDeps([10,1,2,3,4,5,6,11]))),qr=r.lazy(()=>rt(()=>import("./ChatView-CBcodPgk.js"),__vite__mapDeps([12,1,2,3,4,5,6,8])).then(t=>({default:t.default}))),Kr='button, input, textarea, select, a, [role="button"], [data-no-background], [data-card]';function Vr(){var en;const t=Wr();wr();const{modelsData:n,setModelsData:s,selected:f,setSelected:u,chatModelId:a,setChatModelId:w,moderator:h,setModerator:g,availableModels:x,totalModelsByType:d,allSelectedByType:b,modelIdToName:R,isLoading:D,loadError:O,retryCount:z,retryNow:K}=pr(),[l,X]=Ke("playground_mode","chat",{serialize:o=>o,deserialize:(o,i)=>["chat","compare","council","roundtable","personality"].includes(o)?o:i}),[G,J]=r.useState(!1),U=r.useRef(null),[S,te]=r.useState(null),[ie,ue]=r.useState(!1),[M,V]=r.useState(!1),[H,ge]=r.useState(2),ne=r.useRef(0),T=r.useRef(0),re=r.useRef(null),[se,be]=r.useState(!1),[ye,oe]=Ke("github_models_token","",{serialize:o=>o||null,deserialize:(o,i)=>o??i}),[he,ve]=Ke("show_council_reviewer_names",!1,{serialize:o=>String(o),deserialize:o=>o==="true"}),[$e,ae]=r.useState({}),He=r.useRef(null),Ne=r.useRef(null),[Re,Le]=r.useState(""),[c,Q]=r.useState(null),de=r.useRef(null),xe=r.useCallback(o=>{de.current&&clearTimeout(de.current),Q(o),de.current=window.setTimeout(()=>{Q(null),de.current=null},5e3)},[]),ce=r.useCallback(o=>{if(l==="chat"||ye)return!0;const i=n.find(k=>k.id===o);return!i||i.type!=="api"},[l,ye,n]),Ce=r.useCallback(()=>!!(l==="chat"||ye),[l,ye]),[fe,Pe]=r.useState([]),{autoMode:De,autoModeScope:We,setAutoMode:je,setAutoModeScope:Me}=Tr({autoMode:!0,autoModeScope:"local"}),[Ae,N]=r.useState(""),[L,A]=r.useState(!1),{history:W,historyRef:$,pushHistoryEntries:P,clearHistory:I,historyToText:v,buildCarryoverHistory:m}=kr(),j=(o,i)=>{const k=new Set,E=i.filter(Boolean).filter((B,q,Z)=>Z.indexOf(B)===q),C=[];return E.forEach(B=>{const q=o[B];q&&q.trim()&&(C.push({id:B,text:q.trim()}),k.add(B))}),Object.entries(o).forEach(([B,q])=>{k.has(B)||!q||!q.trim()||C.push({id:B,text:q.trim()})}),C.length?C.map(({id:B,text:q})=>`${R(B)}:
${q}`).join(`

`):null},y=f.map(o=>n.find(i=>i.id===o)).filter(o=>!!o&&(l==="compare"||o.id!==h)),_=(o,i,k,E)=>{if(k==="council"){const ut=250+o*220/(i-1)-90,dt=ut*Math.PI/180;return{x:Math.cos(dt)*E,y:Math.sin(dt)*E,angle:ut}}const C=o*360/i-90,B=Math.cos(C*Math.PI/180)*E,q=Math.sin(C*Math.PI/180)*E;return{x:B,y:q,angle:C}},p=(o,i)=>{te(i),o.dataTransfer.effectAllowed="move"},F=o=>{o.preventDefault(),ue(!0)},Y=()=>{ue(!1)},ee=o=>{if(o.preventDefault(),ue(!1),S){if(l==="chat")w(S);else if(!f.includes(S)){if(!ce(S)){xe("Add your GitHub token in Settings for API model access with dedicated quota"),te(null);return}u(i=>[...i,S])}te(null)}},le=o=>{if(l==="chat"){w(a===o?null:o);return}if(f.includes(o))if(ze&&gt.current.includes(o)&&Re){Ne.current&&Ne.current.abort();const k=gt.current.filter(C=>C!==o),E={};if(n.forEach(C=>{k.includes(C.id)&&C.response&&!C.error&&(E[C.id]=C.response)}),u(C=>C.filter(B=>B!==o)),Ie.has(o)&&Ve(C=>{const B=new Set(C);return B.delete(o),B}),l==="council"&&k.length<2){Ze(!1),it(!1),vt("Council requires at least 2 participants."),jt("Error");return}Nt(Re,E,k,{skipHistory:!0})}else u(k=>k.filter(E=>E!==o));else{if(!ce(o)){xe("Add your GitHub token in Settings for API model access with dedicated quota");return}u(i=>[...i,o])}},Ye=o=>{const i=n.filter(C=>C.type===o).map(C=>C.id);if(i.length>0&&i.every(C=>f.includes(C))){u(C=>C.filter(B=>!i.includes(B)));return}if(o==="api"&&!Ce()){xe("Add your GitHub token in Settings for API model access with dedicated quota");return}const E=x.filter(C=>C.type===o).map(C=>C.id);E.length>0&&u(C=>[...C,...E])},[me,we]=r.useState(null),[_e,Bt]=r.useState(new Set),[dn,pn]=r.useState(!1),[Ie,Ve]=r.useState(new Set),Xe=()=>Ve(new Set),[st,fn]=r.useState(null),mt=r.useMemo(()=>{if(l==="compare")return 0;const o=Math.max(pe.baseRadius,pe.minRadius+y.length*pe.radiusPerModel);if(!st)return o;const k=Math.min(st.width,st.height)/2-140;return Math.max(o,k)},[l,y.length,st]);r.useEffect(()=>{const o=()=>{if(!ke.current)return;const{clientWidth:k,clientHeight:E}=ke.current;let C=Math.floor(k/(pe.cardWidth+pe.gapX));C=Math.max(1,C),ge(C),fn({width:k,height:E})},i=new ResizeObserver(k=>{for(let E of k)E.target===ke.current&&o()});return ke.current&&(i.observe(ke.current),o()),()=>{ke.current&&i.unobserve(ke.current)}},[l]);const Fe=r.useRef(null),ke=r.useRef(null),Oe=r.useRef(null),zt=r.useRef(null),ot=r.useRef(new Map),hn=r.useRef(null),Qe=r.useRef({card:!1,background:!1}),mn=r.useRef({}),gt=r.useRef([]),{enqueueStreamDelta:gn,clearPendingStreamForModel:xn,resetPendingStream:xt}=Sr(s),{selectionRect:bn,isSelecting:bt,dragSelectionActiveRef:Ht}=Mr({rootContainerRef:zt,visualizationAreaRef:ke,arenaOffsetYRef:ne,arenaTargetYRef:T,wheelRafRef:re,selectedModels:y,cardRefs:ot,selectedCardIds:Ie,setSelectedCardIds:Ve,suppressClickRef:Qe}),{dragState:yn,handlePointerDown:vn}=Er({visualizationAreaRef:ke,cardRefs:ot,selected:f,setSelected:u,mode:l,gridCols:H,getCirclePosition:_});r.useEffect(()=>()=>xt(),[xt]);const[Ee,Be]=r.useState(null);r.useEffect(()=>{const o="arena-selecting",i=document.body;return bt?i.classList.add(o):i.classList.remove(o),()=>{i.classList.remove(o)}},[bt]);const at=r.useCallback(o=>o?!o.closest(Kr):!1,[]),wn=r.useCallback(o=>{if(at(o.target)){if(Qe.current.background){Qe.current.background=!1;return}we(null),Xe(),Qe.current.background=!1}},[at,Xe]),kn=r.useCallback(o=>{at(o.target)&&(o.preventDefault(),Be({x:o.clientX,y:o.clientY,type:"background"}))},[at]),Wt=r.useCallback(()=>{J(!0),U.current&&clearTimeout(U.current),U.current=window.setTimeout(()=>{J(!1),U.current=null},350)},[]),Je=r.useCallback(o=>{o!==l&&(Wt(),Ze(!1),X(o))},[l,Wt]);r.useEffect(()=>()=>{de.current&&clearTimeout(de.current)},[]),r.useEffect(()=>()=>{U.current&&clearTimeout(U.current)},[]),r.useEffect(()=>{const o=()=>Be(null);return window.addEventListener("click",o),()=>window.removeEventListener("click",o)},[]);const[ze,Ze]=r.useState(!1),[et,it]=r.useState(!1),[yt,vt]=r.useState(""),Sn=r.useCallback(()=>{I(),Ze(!1),it(!1),vt(""),jt(null),Xt(null),Ft([]),Gt({}),s(o=>o.map(i=>({...i,response:"Ready to generate...",thinking:void 0,error:void 0}))),ae({}),Bt(new Set)},[I,s]),[jn,Mn]=r.useState(!0),[En,Cn]=r.useState("api"),[wt,kt]=r.useState(!1),St=r.useRef(null);r.useEffect(()=>{const o=k=>{St.current&&!St.current.contains(k.target)&&kt(!1)},i=k=>{k.key==="Escape"&&kt(!1)};return wt&&(document.addEventListener("mousedown",o),document.addEventListener("keydown",i)),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("keydown",i)}},[wt]);const[Yt,jt]=r.useState(null),[Mt,Xt]=r.useState(null),[,Ft]=r.useState([]),[,Gt]=r.useState({}),[Nn,Ut]=r.useState(new Set),Et=r.useRef(new Set),Tn=r.useRef(null),qt=r.useRef({}),Kt=r.useRef(l),[Ct,Vt]=r.useState(null),_n=()=>{const o=new Set;Et.current=o,Ut(o)},Rn=o=>{Ut(i=>{if(i.has(o))return i;const k=new Set(i);return k.add(o),Et.current=k,k})},{sendMessage:Nt}=jr({mode:l,moderator:h,selected:f,selectedCardIds:Ie,githubToken:ye,isGenerating:ze,summarizeSessionResponses:j,setLastQuery:Le,setHoveredCard:we,setPhaseLabel:jt,setModeratorSynthesis:vt,setCouncilAggregateRankings:Xt,setCouncilAnonymousReviews:Ft,setDiscussionTurnsByModel:Gt,resetFailedModels:_n,markModelFailed:Rn,failedModelsRef:Et,currentDiscussionTurnRef:Tn,sessionModelIdsRef:gt,abortControllerRef:Ne,thinkingStateRef:mn,conversationHistoryRef:$,pushHistoryEntries:P,historyToText:v,buildCarryoverHistory:m,setModelsData:s,modelIdToName:R,setExecutionTimes:ae,setIsGenerating:Ze,setIsSynthesizing:it,setSpeaking:Bt,enqueueStreamDelta:gn,clearPendingStreamForModel:xn,resetPendingStream:xt});r.useEffect(()=>{const o=i=>{if(i.key==="Escape"){const E=document.activeElement;if(E&&E!==document.body&&E.blur(),se){be(!1);return}if(Ee){Be(null);return}if(Ie.size>0){Xe(),we(null);return}if(M){V(!1);return}we(null);return}if((i.metaKey||i.ctrlKey)&&(i.key==="a"||i.key==="A")){const E=i.target;if(E.tagName==="INPUT"||E.tagName==="TEXTAREA"||l==="chat")return;i.preventDefault(),f.length>0&&Ve(new Set(f));return}const k=i.target;if(!(k.tagName==="INPUT"||k.tagName==="TEXTAREA")){if(i.key==="ArrowRight"||i.key==="ArrowLeft"){i.preventDefault();const E=["chat","compare","council","roundtable","personality"],C=E.indexOf(l);if(C!==-1){const B=i.key==="ArrowRight"?1:-1,q=(C+B+E.length)%E.length;Je(E[q])}return}if(i.key==="m"||i.key==="M"){i.preventDefault(),V(!M);return}if((i.key==="Delete"||i.key==="Backspace")&&Ie.size>0){i.preventDefault(),u(E=>E.filter(C=>!Ie.has(C))),Xe();return}i.key.length===1&&!i.ctrlKey&&!i.metaKey&&!i.altKey&&Fe.current&&Fe.current.focus()}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[M,se,Ee,Ie,l,Je,Xe]);const lt=r.useRef(!1),Tt=r.useRef(0),Qt=o=>{const i=ke.current;i&&i.style.setProperty("--arena-offset-y",`${o}px`)},_t=o=>Math.max(-200,Math.min(pe.scrollClamp,o)),Jt=()=>{const o=ne.current,i=T.current,k=i-o;if(Math.abs(k)<.5){ne.current=i,Qt(i),re.current=null;return}const E=o+k*.35;ne.current=E,Qt(E),re.current=requestAnimationFrame(Jt)},Rt=()=>{re.current==null&&(re.current=requestAnimationFrame(Jt))};r.useEffect(()=>{const o=B=>{if(Ht.current)return;const q=B.target;if(q&&q.closest("input, textarea, [data-no-arena-scroll]"))return;B.preventDefault();const Z=B.deltaY*.9,Se=T.current-Z;T.current=_t(Se),Rt()},i=B=>B?!!B.closest('input, textarea, [data-no-arena-scroll], [data-card], button, a, select, [role="button"]'):!1,k=B=>{if(B.touches.length!==1)return;const q=B.target;i(q)||(lt.current=!0,Tt.current=B.touches[0].clientY)},E=B=>{if(Ht.current||!lt.current||B.touches.length!==1)return;const q=B.target;if(i(q)){lt.current=!1;return}const Z=B.touches[0].clientY,Se=Z-Tt.current;Tt.current=Z,B.preventDefault(),T.current=_t(T.current+Se),Rt()},C=()=>{lt.current=!1};return window.addEventListener("touchstart",k,{passive:!0}),window.addEventListener("touchmove",E,{passive:!1}),window.addEventListener("touchend",C),window.addEventListener("touchcancel",C),window.addEventListener("wheel",o,{passive:!1}),()=>{window.removeEventListener("touchstart",k),window.removeEventListener("touchmove",E),window.removeEventListener("touchend",C),window.removeEventListener("touchcancel",C),window.removeEventListener("wheel",o),re.current!=null&&cancelAnimationFrame(re.current)}},[]);const[ct,Ln]=Ke("playground-bg-style","dots",{serialize:o=>o,deserialize:(o,i)=>o&&nr.includes(o)?o:i}),An=n.find(o=>o.id===h),In=et?"responding":ze?"waiting":yt?"done":"idle",$n=et?"Synthesizing...":ze?"Observing":yt?"Complete":"Ready",Pn=`${Ct?`translate(-50%, -50%) translate(${Ct.x}px, ${Ct.y}px)`:"translate(-50%, -50%)"} scale(1)`;r.useLayoutEffect(()=>{if(l!=="compare")return;const o={};y.forEach(i=>{const k=ot.current.get(i.id);k&&(o[i.id]=k.getBoundingClientRect())}),qt.current=o},[l,y.length,y.map(o=>o.id).join(",")]),r.useEffect(()=>{if(Kt.current==="compare"&&l!=="compare"&&h&&ke.current){const i=qt.current[h],k=ke.current.getBoundingClientRect();if(i&&k.width>0&&k.height>0){const E=k.left+k.width/2,C=l==="council"?mt-64:0,B=k.top+(k.height*.5+C),q=i.left+i.width/2-E,Z=i.top+i.height/2-B;(Math.abs(q)>1||Math.abs(Z)>1)&&(Vt({x:q,y:Z}),requestAnimationFrame(()=>Vt(null)))}}Kt.current=l},[l,h,mt]);const Dn=ct==="none"?"":`bg-${ct}`,On=(o,i=280)=>o?o.length<=i?o:`â€¦${o.slice(o.length-i)}`:"",Zt=()=>{Ne.current&&(Ne.current.abort(),Ze(!1),it(!1))};return e.jsxs("div",{ref:zt,className:`fixed inset-0 overflow-hidden text-white ${Dn}`,style:{backgroundColor:sn[l],transition:"background-color 1s ease",...ct==="none"?{background:sn[l]}:{},...bt?{userSelect:"none",WebkitUserSelect:"none"}:{}},onClick:wn,onContextMenu:kn,children:[t.isActive&&!t.mouseSimulation&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(Ur,{onStopGeneration:t.callbacks.current.onStopGeneration,onSendMessage:t.callbacks.current.onSendMessage,onScroll:t.callbacks.current.onScroll,onPinch:t.callbacks.current.onPinch,onHover:t.callbacks.current.onHover,onModeChange:t.callbacks.current.onModeChange,config:t.gestureConfig,mode:t.gestureMode,appContext:t.appContext,onGestureModeToggle:()=>t.setGestureMode(t.gestureMode==="navigation"?"asl":"navigation"),gestureActiveArea:{minX:.7,maxX:1,minY:0,maxY:1},onGestureState:t.setGestureState,onASLResult:t.setASLResult,onError:t.setCameraError,onDebugInfo:t.setDebugInfo,onLandmarkData:t.setLandmarkData,onPerformance:t.setPerformanceMetrics})}),D&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/95 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-5 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-slate-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-12 h-12 border-2 border-transparent border-b-emerald-500/50 rounded-full animate-spin",style:{animationDirection:"reverse",animationDuration:"1.5s"}})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:O||"Connecting to models..."}),z>0&&e.jsxs("p",{className:"text-white/40 text-xs tabular-nums",children:["Attempt ",z," of 8"]})]}),e.jsxs("button",{onClick:K,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 rounded-lg transition-all active:scale-95",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh Now"]})]})}),e.jsx(ar,{mode:l,setMode:Je,setHoveredCard:we,clearSelection:Xe,showDock:M,setShowDock:V,onOpenSettings:()=>be(!0),gestureButtonSlot:e.jsx(r.Suspense,{fallback:null,children:e.jsx(Gr,{inHeader:!0,appContext:l,onStopGeneration:()=>{if(l==="chat"&&Oe.current){Oe.current.stopGeneration();return}Zt()},onSendMessage:o=>{if(l==="chat"&&Oe.current){Oe.current.sendMessage(o,!0);return}const i=l==="compare"||l==="council"||l==="roundtable"||l==="personality"?f:[];i.length>0&&Nt(o,{},i)},onScroll:o=>{if(l==="chat"&&Oe.current){Oe.current.scroll(o);return}T.current=_t(T.current+o),Rt()},onHover:(o,i)=>{const k=o*window.innerWidth,E=i*window.innerHeight,C=document.elementFromPoint(k,E);if(C){const B=C.closest("[data-gesture-mode-track]");if(B){const Se=B.getBoundingClientRect(),tn=k-Se.left,ut=Se.width,dt=Math.floor(tn/ut*5),Lt=["chat","compare","council","roundtable","personality"][Math.max(0,Math.min(4,dt))];Lt&&Lt!==l&&Je(Lt);return}const q=document.querySelector('[data-gesture-hovered="true"]'),Z=C.closest('button, a, [role="button"], [data-clickable], .cursor-pointer, [onclick]')||C;Z!==q?(q&&(q.removeAttribute("data-gesture-hovered"),q.dispatchEvent(new PointerEvent("pointerleave",{bubbles:!1,cancelable:!0})),q.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!1,cancelable:!0})),q.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0}))),Z.setAttribute("data-gesture-hovered","true"),Z.dispatchEvent(new PointerEvent("pointerenter",{bubbles:!1,cancelable:!0,clientX:k,clientY:E})),Z.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:k,clientY:E})),Z.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!1,cancelable:!0,clientX:k,clientY:E})),Z.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,clientX:k,clientY:E}))):Z===q&&(Z.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:k,clientY:E})),Z.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:k,clientY:E})))}},onPinch:(o,i)=>{const k=o*window.innerWidth,E=i*window.innerHeight,C=document.elementFromPoint(k,E);if(C){const B=Se=>{Se.dispatchEvent(new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:k,clientY:E,pointerId:1,pointerType:"touch",isPrimary:!0})),Se.dispatchEvent(new PointerEvent("pointerup",{bubbles:!0,cancelable:!0,clientX:k,clientY:E,pointerId:1,pointerType:"touch",isPrimary:!0})),Se.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:k,clientY:E})),Se.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:k,clientY:E})),Se.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:k,clientY:E}))},q=C.closest('button, a, [role="button"], [data-clickable], .cursor-pointer, [onclick]');B(q||C);const Z=document.createElement("div");Z.style.position="fixed",Z.style.left=`${k}px`,Z.style.top=`${E}px`,Z.style.width="20px",Z.style.height="20px",Z.style.background="rgba(236, 72, 153, 0.5)",Z.style.borderRadius="50%",Z.style.transform="translate(-50%, -50%)",Z.style.pointerEvents="none",Z.style.zIndex="9999",document.body.appendChild(Z),Z.animate([{transform:"translate(-50%, -50%) scale(1)",opacity:1},{transform:"translate(-50%, -50%) scale(4)",opacity:0}],{duration:400}).onfinish=()=>Z.remove()}},onModeChange:o=>{const i=["chat","compare","council","roundtable","personality"],k=i.indexOf(l);let E;o==="next"?E=(k+1)%i.length:E=(k-1+i.length)%i.length,Je(i[E])}})})}),e.jsxs("div",{style:{paddingLeft:"1.5rem",paddingRight:"0"},children:[M&&e.jsx("div",{className:"fixed inset-0 z-[55] bg-black/10 backdrop-blur-[1px] transition-opacity duration-300",onClick:()=>V(!1)}),e.jsx(rr,{showDock:M,availableModels:x,allSelectedByType:b,totalModelsByType:d,handleDragStart:p,handleModelToggle:le,handleAddGroup:Ye,dockRef:He}),l==="chat"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex h-screen w-full relative z-[10]",children:e.jsx("div",{className:"flex-1 relative px-2 sm:px-6 pt-20 pb-6",children:e.jsx(Yr,{children:e.jsx(r.Suspense,{fallback:e.jsxs("div",{className:"flex items-center justify-center h-full text-white/50 gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white/60 rounded-full animate-spin"}),"Loading..."]}),children:e.jsx(qr,{ref:Oe,models:n,selectedModelId:a,onSelectModel:w,githubToken:ye,messages:fe,setMessages:Pe,autoMode:De,setAutoMode:je,autoModeScope:We,setAutoModeScope:Me,currentResponse:Ae,setCurrentResponse:N,isGenerating:L,setIsGenerating:A,onModelUsed:w,gesturesActive:t.isActive})})})})})}),l!=="chat"&&e.jsxs("div",{className:"flex h-screen w-full relative",children:[e.jsx("div",{className:"relative flex-1 transition-all duration-300 flex flex-col pt-24",children:e.jsx("div",{ref:ke,onDragOver:F,onDragLeave:Y,onDrop:ee,className:"relative w-full h-full z-10 transition-all duration-300",style:{position:"relative",display:"flex",alignItems:l==="compare"?"flex-start":"center",justifyContent:"center","--arena-offset-y":`${ne.current}px`,transform:l==="council"||l==="roundtable"||l==="personality"?`translateY(calc(var(--arena-offset-y) - 50px)) scale(${ie?1.02:1})`:`translateY(var(--arena-offset-y)) scale(${ie?1.02:1})`,willChange:"transform",border:ie?"2px dashed rgba(59, 130, 246, 0.4)":"2px dashed transparent",borderRadius:ie?"24px":"0px",transition:"transform 0s linear",...l==="compare"?{minHeight:"300px",paddingBottom:"120px"}:l==="council"||l==="roundtable"||l==="personality"?{height:"100%",minHeight:"100%",overflow:"hidden"}:{height:"100%",minHeight:"100%",overflow:"hidden"},...ie?{background:"rgba(59, 130, 246, 0.05)"}:{}},children:e.jsx(Rr,{mode:l,selectedModels:y,gridCols:H,speaking:_e,selectedCardIds:Ie,setSelectedCardIds:Ve,executionTimes:$e,failedModels:Nn,cardRefs:ot,handlePointerDown:vn,dragState:yn,handleModelToggle:le,setContextMenu:Be,suppressClickRef:Qe,getTailSnippet:On,hoveredCard:me,setHoveredCard:we,layoutRadius:mt,getCirclePosition:_,moderatorModel:An,moderatorId:h,orchestratorTransform:Pn,orchestratorStatus:In,orchestratorPhaseLabel:$n,moderatorSynthesis:yt,isSynthesizing:et,isGenerating:ze,phaseLabel:Yt,linesTransitioning:G,lastSelectedCardRef:hn,orchestratorAutoMode:jn,orchestratorAutoScope:En,showOrchestratorMenu:wt,setShowOrchestratorMenu:kt,setOrchestratorAutoMode:Mn,setOrchestratorAutoScope:Cn,orchestratorMenuRef:St,availableModels:x,setModerator:g,councilWinnerId:(en=Mt==null?void 0:Mt[0])==null?void 0:en.model_id})})}),l!=="compare"&&e.jsx("div",{className:"transcript-panel w-[400px] xl:w-[480px] flex flex-col border-l border-white/5 bg-slate-900/20 backdrop-blur-sm z-40 relative h-full",children:e.jsx(r.Suspense,{fallback:null,children:e.jsx(Fr,{history:W,models:n,mode:l,onSelectPrompt:o=>{Fe.current&&(Fe.current.value=o,Fe.current.focus())},onNewSession:Sn,className:"pt-24 pb-6 mask-fade-top",phaseLabel:Yt,isGenerating:ze,isSynthesizing:et,speakingCount:_e.size,totalParticipants:y.length})})})]})]}),e.jsx(Br,{rect:bn}),c&&e.jsx("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-[200] animate-in slide-in-from-bottom-4 fade-in duration-300",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl bg-amber-500/10 border border-amber-500/30 backdrop-blur-md shadow-xl",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-400 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm text-amber-100",children:c}),e.jsx("button",{onClick:()=>{Q(null),be(!0)},className:"ml-2 px-3 py-1 text-xs font-medium text-amber-900 bg-amber-400 hover:bg-amber-300 rounded-md transition-colors",children:"Open Settings"}),e.jsx("button",{onClick:()=>Q(null),className:"ml-1 p-1 text-amber-400/60 hover:text-amber-400 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(Xr,{open:se,onClose:()=>be(!1),token:ye,setToken:oe,showCouncilReviewerNames:he,setShowCouncilReviewerNames:ve,bgStyle:ct,setBgStyle:Ln})}),(l==="compare"||l==="council"||l==="roundtable"||l==="personality")&&e.jsx(sr,{inputRef:Fe,inputFocused:dn,setInputFocused:pn,onSendMessage:Nt,isGenerating:ze||et,onStop:Zt,placeholder:l==="compare"?void 0:l==="personality"?"Ask the personas...":"Steer the discussion...",className:`fixed bottom-0 left-0 z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300 ${l==="compare"?"right-0":"right-[400px] xl:right-[480px]"}`,style:{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"}}),Ee&&e.jsx("div",{className:"fixed bg-slate-800 border border-slate-700 rounded-lg shadow-xl py-1 z-[200] min-w-[160px]",style:{top:Ee.y,left:Ee.x},onClick:o=>o.stopPropagation(),children:Ee.type==="background"?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{V(!0),Be(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Model"]}):Ee.modelId?e.jsxs(e.Fragment,{children:[l!=="compare"&&Ee.modelId!==h&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{g(Ee.modelId),Be(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),"Set as Orchestrator"]}),e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{const o=Ee.modelId===h;if(le(Ee.modelId),o&&l!=="compare"){const i=f.filter(k=>k!==Ee.modelId);i.length>0?g(i[0]):g("")}Be(null)},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})]}):null})]})}function Qr(){return e.jsx(Hr,{children:e.jsx(Vr,{})})}Un.createRoot(document.getElementById("root")).render(e.jsx(qn.StrictMode,{children:e.jsx(Qr,{})}));export{nr as B,as as M,sr as P,Br as S,is as a,hr as f,os as g,pt as s,Wr as u};
