const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResponseInspector-DVfrM-P6.js","assets/react-vendor-B3RF3lZj.js","assets/markdown-IOIbAqJG.js","assets/math-render-DqYgiYKz.js","assets/math-render-BRlVhSdB.css","assets/syntax-highlight-BlOvp5OR.js","assets/syntax-highlight-BEHUn5zE.css","assets/FormattedContent-C1ywt4GL.js","assets/SettingsModal-CuhVH2S7.js","assets/TopicsDrawer-ysED6_Xd.js","assets/DiscussionTranscript-m4zFAV_Z.js","assets/GestureControl-CNJQdpJe.js","assets/HandBackground-DW2tgz8H.js","assets/mediapipe-YSlczgt6.js","assets/ChatView-ixrMFjGH.js","assets/GestureOptions-Bcc-g8nS.js","assets/GesturePanel-7s1FSkiw.js"])))=>i.map(i=>d[i]);
var Zn=Object.defineProperty;var es=(t,n,r)=>n in t?Zn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var un=(t,n,r)=>es(t,typeof n!="symbol"?n+"":n,r);import{j as e,S as ts,A as ns,r as s,a as ss,Z as rs,T as os,R as is,c as as,b as ls}from"./react-vendor-B3RF3lZj.js";import"./math-render-DqYgiYKz.js";import"./syntax-highlight-BlOvp5OR.js";import"./markdown-IOIbAqJG.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))p(d);new MutationObserver(d=>{for(const a of d)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&p(v)}).observe(document,{childList:!0,subtree:!0});function r(d){const a={};return d.integrity&&(a.integrity=d.integrity),d.referrerPolicy&&(a.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?a.credentials="include":d.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function p(d){if(d.ep)return;d.ep=!0;const a=r(d);fetch(d.href,a)}})();const cs="modulepreload",us=function(t){return"/static/playground/"+t},dn={},Be=function(n,r,p){let d=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),g=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));d=Promise.allSettled(r.map(m=>{if(m=us(m),m in dn)return;dn[m]=!0;const b=m.endsWith(".css"),c=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${c}`))return;const h=document.createElement("link");if(h.rel=b?"stylesheet":cs,b||(h.as="script"),h.crossOrigin="",h.href=m,g&&h.setAttribute("nonce",g),document.head.appendChild(h),b)return new Promise((_,$)=>{h.addEventListener("load",_),h.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(v){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=v,window.dispatchEvent(g),!g.defaultPrevented)throw v}return d.then(v=>{for(const g of v||[])g.status==="rejected"&&a(g.reason);return n().catch(a)})},ds={local:{color:"#10b981"},api:{color:"#3b82f6"}},ps={"llama-3.3-70b":1,"llama-4-scout-17b-16e-instruct":2,qwen:3,phi:4,mistral:5,gemma:6},fs={"gpt-4o":1,"gpt-4.1":2,"gpt-5":3,"gpt-5-mini":4,"gpt-5-nano":5,"llama-3.3-70b":6,"llama-4-scout-17b-16e-instruct":7,"deepseek-v3-0324":8,"mistral-large":9,"command-r-plus":10},hs=50,ms=100;function Sr(t,n,r){if(r!==void 0)return r;const p=n==="local"?ps:fs,d=n==="local"?hs:ms;for(const[a,v]of Object.entries(p))if(t.toLowerCase().includes(a.toLowerCase()))return v;return d}const gt=[{id:"eu-ai-act-enforcement",label:"EU AI Act Enforcement Wave",prompt:"The EU AI Act enters enforcement; high-risk systems must prove data provenance, evals, and risk controls. Outline compliance gaps for a frontier model API and tradeoffs between speed and alignment.",category:"Policy",modes:["council","roundtable"],tags:["governance","compliance"]},{id:"export-controls-blackwell",label:"Export Controls Tighten",prompt:"U.S. export rules tighten again on AI accelerators; Blackwell-class parts face new caps and cloud checks. Map the impact on training roadmaps, costs, and on-device strategies.",category:"Infra",modes:["compare","roundtable"],tags:["chips","supply-chain"]},{id:"weights-leak",label:"Major Weights Leak",prompt:"A commercial frontier model checkpoint leaks. Assess risks (misuse, impersonation, jailbreak diffusion), legal exposure, and whether open red-team releases mitigate or worsen safety.",category:"Security",modes:["council","roundtable"],tags:["safety","open-weights"]},{id:"on-device-llm-race",label:"On-Device LLM Race",prompt:"Phone OEMs ship 3nm NPUs and 20B-parameter on-device assistants. What actually moves the needle for UX, privacy, and cost vs. cloud? Where do hybrid (edge + cloud) designs win?",category:"Infra",modes:["compare","roundtable"],tags:["edge","latency"]},{id:"signed-app-prompt-injection",label:"Signed App Prompt Injection",prompt:"A popular signed desktop app shipped with hardcoded system prompts; attackers use supply chain updates to exfiltrate data. How should vendors audit, sandbox, and attest LLM apps?",category:"Security",modes:["compare","council"],tags:["supply-chain","prompt-injection"]},{id:"eval-standardization",label:"Safety Eval Standard",prompt:"NIST-style safety eval suites gain traction (jailbreak, autonomy, bio). How should vendors report scores, and what gaps remain for frontier vs. small models?",category:"Policy",modes:["compare","roundtable"],tags:["evaluation","safety"]},{id:"licensing-standoff",label:"Publisher Licensing Standoff",prompt:"Major news publishers pause AI licensing talks and sue over training. What remedies (revenue share, opt-out registries, model removal) are realistic, and how do they ripple to open models?",category:"Data",modes:["council","roundtable"],tags:["licensing","copyright"]},{id:"sbom-for-llms",label:"SBOM for LLM Pipelines",prompt:"Regulators push SBOMs and signed artifacts for AI stacks. Draft what should appear in an LLM pipeline SBOM (data, weights, evals, guardrails) and how to verify it at runtime.",category:"Security",modes:["compare","council"],tags:["sbom","supply-chain"]},{id:"data-poisoning-campaign",label:"Data Poisoning Campaign",prompt:"Researchers find coordinated data poisoning in popular open corpora. How should model hosts detect and mitigate poisoning post-hoc, and what retraining tradeoffs are acceptable?",category:"Security",modes:["compare","roundtable"],tags:["data","poisoning"]},{id:"copyright-settlement",label:"Copyright Settlement Sets Precedent",prompt:"A major copyright suit settles with dataset disclosure and per-output watermarking. Predict how this precedent affects future training sets and open-weight releases.",category:"Policy",modes:["roundtable"],tags:["copyright","watermarking"]}],jr={council:["Tabs or spaces? Give your verdict in under 50 words.","Rock, paper, scissorsâ€”which is objectively the best opening move?","In one sentence: should AI be allowed to write its own code?"],roundtable:["Write a two-sentence horror story where the second sentence recontextualizes the first.","Complete this thought: 'AI will never be able to...'","Pitch a startup in one sentence. No buzzwords allowed."],personality:["Coffee or tea? Defend your choice.","Hot take: pineapple on pizza.","What's the most overrated thing everyone pretends to like?"],compare:[],chat:[]};gt.filter(t=>t.category==="Policy"||t.category==="Data"),gt.filter(t=>t.category==="Infra"),gt.filter(t=>t.category==="Security");const Bt=gt,Mr="/api/trending-topics",Cr=[{id:"ai-safety-governance",title:"New AI safety governance draft targets frontier model transparency",summary:"Draft policy proposes reporting training data provenance, evals for autonomous behavior, and emergency off-switch requirements.",source:"PolicyWire",tags:["AI","governance"],publishedAt:"2025-01-05"},{id:"chips-3nm",title:"3nm edge devices clear FCC for on-device LLM acceleration",summary:"Vendors claim 2Ã— energy efficiency for 70B-parameter quantized models on consumer hardware.",source:"SemiDaily",tags:["hardware","ai"],publishedAt:"2025-01-04"},{id:"open-weights",title:"Open-weights contest rewards best safety-tuned small models",summary:"Competition encourages transparent training recipes and evals instead of closed checkpoints.",source:"MLHub",tags:["open-source","models"],publishedAt:"2025-01-03"},{id:"security-supply-chain",title:"Software supply chain bill moves forward with SBOM enforcement",summary:"Requires signed artifacts, provenance attestations, and runtime monitoring for critical infra.",source:"CyberBrief",tags:["security","devsecops"],publishedAt:"2025-01-02"},{id:"creator-tools",title:"Creator tooling boom: multimodal editing in the browser",summary:"WebGPU-first editors ship video, audio, and 3D pipelines without native installs.",source:"CreatorBeat",tags:["media","webgpu"],publishedAt:"2025-01-01"}],xs=["dots-mesh","dots","dots-fade","grid","mesh","animated-mesh","none"],rt="#0f172a",pn={compare:rt,council:rt,roundtable:rt,chat:rt,personality:rt},ot={maxTokens:1024,temperature:.7},pe={cardWidth:256,cardHeight:200,gapX:24,gapY:24,baseRadius:160,minRadius:120,radiusPerModel:15,scrollClamp:200};function gs({showDock:t,availableModels:n,allSelectedByType:r,totalModelsByType:p,handleDragStart:d,handleModelToggle:a,handleAddGroup:v,dockRef:g}){const m=[{type:"local",title:"Local Models",accentColor:"emerald"},{type:"api",title:"API Models",accentColor:"blue"}];return e.jsxs("div",{ref:g,"data-no-arena-scroll":!0,"data-no-background":!0,className:"dock-scroll model-dock-panel fixed left-3 top-20 bottom-20 w-[min(75vw,320px)] sm:left-6 sm:top-24 sm:bottom-24 sm:w-72 rounded-2xl flex flex-col z-[60] transition-all duration-300 overflow-hidden",style:{transform:t?"translateX(0)":"translateX(-150%)",opacity:t?1:0,pointerEvents:t?"auto":"none"},children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-700/50",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Available Models"}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5",children:"Click to add to arena"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:m.map(b=>{const c=n.filter(B=>B.type===b.type),h=r[b.type],_=p[b.type]>0,$={emerald:{button:"text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/10",dot:"bg-emerald-500",border:"hover:border-emerald-500/40"},blue:{button:"text-blue-400 hover:text-blue-300 hover:bg-blue-500/10",dot:"bg-blue-500",border:"hover:border-blue-500/40"}}[b.accentColor];return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${$.dot} ${b.type==="local"?"glow-dot-emerald":"glow-dot-blue"}`}),e.jsx("h3",{className:"text-[11px] font-semibold text-slate-300 uppercase tracking-wide",children:b.title}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",c.length,")"]})]}),e.jsx("button",{onClick:()=>v(b.type),className:`text-[10px] font-medium px-2 py-1.5 sm:py-0.5 rounded transition-all active:scale-95 ${$.button} ${_?"":"opacity-40 cursor-not-allowed"}`,disabled:!_,children:h?"âˆ’ Remove All":"+ Add All"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[c.map(B=>e.jsxs("div",{draggable:!0,onDragStart:Q=>d(Q,B.id),onClick:()=>a(B.id),className:`group flex items-center gap-3 px-3 py-3 sm:py-2 rounded-lg cursor-grab active:cursor-grabbing hover:bg-white/5 transition-all border border-transparent active:scale-95 ${$.border}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${$.dot} opacity-60 group-hover:opacity-100 transition-opacity`}),e.jsx("span",{className:"text-xs font-medium text-slate-400 group-hover:text-slate-200 transition-colors",children:B.name})]},B.id)),c.length===0&&e.jsx("div",{className:"text-[10px] text-slate-600 italic px-3 py-2",children:"All models are in the arena"})]})]},b.type)})}),e.jsx("div",{className:"px-5 py-3 border-t border-slate-700/50 bg-slate-900/30",children:e.jsxs("p",{className:"text-[10px] text-slate-500 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-slate-800 text-slate-400 font-mono text-[9px]",children:"M"})," to toggle this panel"]})})]})}function bs({inputRef:t,inputFocused:n,setInputFocused:r,onSendMessage:p,onOpenTopics:d,className:a,style:v,placeholder:g,isGenerating:m,onStop:b}){return e.jsx("div",{className:a??"fixed bottom-0 right-0 left-0 z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300",style:v??{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"w-full pointer-events-auto",style:{maxWidth:"600px"},children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("button",{onClick:d,onMouseDown:c=>c.currentTarget.blur(),className:"shrink-0 w-8 h-8 rounded-lg border border-slate-700/60 bg-slate-900/70 text-slate-400 hover:text-white hover:border-blue-400/60 hover:bg-blue-500/10 transition-colors active:scale-95 flex items-center justify-center focus:outline-none focus-visible:outline-none",title:"Search topics",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("div",{className:"relative overflow-hidden h-6 w-full backdrop-blur-md bg-slate-900/40 rounded-lg border border-white/5 ticker-mask",children:e.jsx("div",{className:"absolute whitespace-nowrap animate-ticker flex gap-2 items-center text-[11px] text-slate-300 font-medium h-full px-4",children:[...Bt,...Bt,...Bt].map((c,h)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{t.current&&(t.current.value=c.prompt,t.current.focus())},onMouseDown:_=>_.currentTarget.blur(),className:"hover:text-blue-400 transition-colors cursor-pointer px-2 py-1 sm:px-1 sm:py-0.5 rounded hover:bg-white/5 active:scale-95 focus:outline-none focus-visible:outline-none",children:c.label}),e.jsx("span",{className:"text-slate-600",children:"â€¢"})]},h))})})]}),e.jsxs("div",{className:`rounded-xl p-2.5 transition-all duration-300 flex items-center gap-2 border border-slate-700/40 header-shell ${n?"prompt-panel-focused":""}`,children:[e.jsx("input",{ref:t,type:"text",placeholder:g||"Ask a question to compare model responses...",className:"w-full bg-transparent text-slate-200 placeholder-slate-500 outline-none text-base sm:text-sm px-2.5 py-2.5",onFocus:()=>r(!0),onBlur:()=>r(!1),onKeyDown:c=>{var h;if(c.key==="Enter"&&!c.shiftKey){if(c.preventDefault(),m)return;(h=t.current)!=null&&h.value&&(p(t.current.value),t.current.value="")}},disabled:m}),e.jsx("button",{onClick:()=>{var c;m?b==null||b():(c=t.current)!=null&&c.value&&(p(t.current.value),t.current.value="")},onMouseDown:c=>c.currentTarget.blur(),className:`min-w-[44px] min-h-[44px] sm:min-w-[36px] sm:min-h-[36px] p-2 rounded-lg transition-colors active:scale-95 flex items-center justify-center focus:outline-none focus-visible:outline-none ${m?"text-red-400 hover:text-red-300 hover:bg-red-500/10":"text-slate-400 hover:text-white hover:bg-white/10"}`,"aria-label":m?"Stop generation":"Send message",children:m?e.jsx(ts,{className:"w-5 h-5 sm:w-4 sm:h-4 fill-current"}):e.jsx(ns,{className:"w-5 h-5 sm:w-4 sm:h-4",strokeWidth:2.5})})]})]})})}const ys={chat:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),compare:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})}),council:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),roundtable:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),personality:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},qe=[{value:"chat",label:"Chat"},{value:"compare",label:"Compare"},{value:"council",label:"Council"},{value:"roundtable",label:"Roundtable"},{value:"personality",label:"Personalities"}];function vs({mode:t,setMode:n,setHoveredCard:r,clearSelection:p,showDock:d,setShowDock:a,onOpenSettings:v,gestureButtonSlot:g,hasRightPanel:m=!0}){const[b,c]=s.useState(!1),h=s.useRef(null),[_,$]=s.useState(!0),B=s.useRef(null),[Q,U]=s.useState(null),[u,Y]=s.useState(0),J=qe.findIndex(S=>S.value===t),q=J===-1?0:J,H=qe[q].label;s.useEffect(()=>{const S=()=>{$(window.innerWidth>=1024)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),s.useEffect(()=>{if(!B.current)return;const S=()=>{const C=B.current;if(!C)return;const X=C.querySelectorAll('button[role="radio"]');if(X.length===0||q>=X.length)return;const be=X[q].getBoundingClientRect(),te=C.getBoundingClientRect(),E=be.width,oe=be.left,ie=te.left;U(E),Y(oe-ie)},re=setTimeout(S,0),ce=new ResizeObserver(()=>{setTimeout(S,0)});return ce.observe(B.current),window.addEventListener("resize",S),()=>{clearTimeout(re),ce.disconnect(),window.removeEventListener("resize",S)}},[t,_,q]),s.useEffect(()=>{function S(re){h.current&&!h.current.contains(re.target)&&c(!1)}return b&&document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[b]);const Z=S=>{n(S),r(null),p(),c(!1)};return e.jsxs("div",{className:`fixed top-0 left-0 flex items-center justify-between mb-2 px-3 sm:px-6 pt-4 sm:pt-6 z-50 pointer-events-none transition-all duration-300 ${m?"right-[400px] xl:right-[480px]":"right-0"}`,children:[e.jsx("div",{className:"absolute inset-0 pointer-events-auto",style:{height:"100%",zIndex:-1}}),e.jsx("div",{className:"flex items-center gap-2 w-auto pointer-events-auto z-20",children:g}),e.jsx("div",{className:"hidden md:block absolute left-1/2 -translate-x-1/2 pointer-events-auto z-20",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center p-1.5 rounded-xl border border-slate-700/40 header-shell",children:[e.jsx("button",{onClick:()=>a(!d),className:"px-2 sm:px-3 flex items-center justify-center text-slate-400 hover:text-white transition-colors",title:"Toggle Model Dock",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("div",{className:"w-px h-5 bg-slate-700/50 mx-0.5 sm:mx-1"}),e.jsxs("div",{ref:B,className:"relative flex p-1 rounded-lg bg-black/20 mode-track",role:"radiogroup","aria-label":"Mode selection","data-gesture-mode-track":"true",children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-md transition-all duration-300 ease-out mode-slider",style:{width:Q!==null?`${Q}px`:`calc((100% - 8px) / ${qe.length})`,left:Q!==null?`${u}px`:`calc(4px + (100% - 8px) * ${q} / ${qe.length})`}}),qe.map(S=>e.jsx("button",{tabIndex:-1,onClick:()=>Z(S.value),role:"radio","aria-checked":t===S.value,"aria-label":S.label,title:S.label,className:`relative z-10 py-2 sm:py-1.5 px-3 text-[11px] sm:text-xs font-medium transition-colors duration-200 min-h-[44px] sm:min-h-0 active:scale-95 focus:outline-none focus-visible:outline-none flex-1 flex items-center justify-center text-center ${t===S.value?"text-white":"text-slate-400 hover:text-slate-200"}`,children:S.label},S.value))]})]})})}),e.jsx("div",{className:"flex md:hidden flex-1 justify-center pointer-events-auto relative z-20",children:e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onClick:()=>c(!b),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800/90 border border-slate-700/50 text-slate-200 font-medium text-sm backdrop-blur-md shadow-lg active:scale-95 transition-all",children:[e.jsx("span",{className:"font-bold text-slate-400 hidden xs:inline",children:"Arena"}),e.jsx("span",{className:"font-bold hidden xs:inline text-slate-600",children:"/"}),e.jsx("span",{children:H}),e.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform duration-200 ${b?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),b&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 py-1 rounded-xl bg-slate-800 border border-slate-700 shadow-2xl overflow-hidden flex flex-col animate-in fade-in zoom-in-95 duration-100 origin-top",children:qe.map(S=>e.jsxs("button",{onClick:()=>Z(S.value),className:`px-4 py-3 text-sm text-left w-full transition-colors flex items-center gap-3 ${t===S.value?"bg-blue-500/10 text-blue-400":"text-slate-300 hover:bg-slate-700/50"}`,children:[e.jsx("span",{className:"flex-shrink-0",children:ys[S.value]}),e.jsx("span",{className:"flex-1",children:S.label}),t===S.value&&e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},S.value))})]})}),e.jsx("div",{className:"flex items-center gap-2 w-auto justify-end pointer-events-auto z-20",children:e.jsx("button",{onClick:v,className:"min-w-[42px] min-h-[42px] w-[42px] h-[42px] rounded-full bg-slate-800/50 flex items-center justify-center border border-slate-700/50 hover:border-slate-600 transition-colors active:scale-95 focus:outline-none focus-visible:outline-none",title:"Settings",children:e.jsxs("svg",{className:"w-4 h-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}const ws=t=>{if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return null}},ks=(t,n)=>{if(t===null)return n;try{return JSON.parse(t)}catch{return n}};function Qe(t,n,r={}){const p=r.serialize??ws,d=r.deserialize??ks,[a,v]=s.useState(()=>{if(typeof window>"u")return n;try{const g=window.localStorage.getItem(t);return d(g,n)}catch{return n}});return s.useEffect(()=>{if(!(typeof window>"u"))try{const g=p(a);g===null?window.localStorage.removeItem(t):window.localStorage.setItem(t,g)}catch{}},[t,p,a]),[a,v]}const Ss=800,js=3e3,Ms=8;function Cs(){const[t,n]=s.useState([]),[r,p]=s.useState(!0),[d,a]=s.useState(null),[v,g]=s.useState(0),[m,b]=Qe("playground_selected_models",null),c=s.useRef(m!==null),[h,_]=Qe("playground_chat_model",null),$=s.useRef(h!==null),B=s.useMemo(()=>m??[],[m]),Q=s.useCallback(C=>{b(X=>typeof C=="function"?C(X??[]):C)},[b]),[U,u]=s.useState(""),Y=s.useRef(0),J=s.useRef(null),q=s.useCallback(async(C,X,z=!1)=>{J.current&&(clearTimeout(J.current),J.current=null),p(!0),z&&(a("Refreshing..."),g(0));const be=te=>{var me,Ne;const E=te.models.map(ne=>{const ae=ne.type==="api"?"api":"local",ye=ds[ae];return{id:ne.id,name:ye.name||ne.name||ne.id,color:ye.color,type:ae,response:"Ready to generate...",priority:ne.priority,context_length:ne.context_length}});if(n(E),p(!1),a(null),g(0),c.current||(b(E.filter(ne=>ne.type==="local").map(ne=>ne.id)),c.current=!0),!$.current){const ne=E.find(ae=>ae.type==="api");_((ne==null?void 0:ne.id)||((me=E[0])==null?void 0:me.id)||null),$.current=!0}const oe=E.find(ne=>ne.type==="api"),ie=((Ne=E[0])==null?void 0:Ne.id)||"";u((oe==null?void 0:oe.id)||ie)};try{const te=await fetch("/api/models");if(C!==Y.current)return;if(!te.ok)throw new Error(`HTTP ${te.status}`);const E=await te.json();if(C!==Y.current)return;if(!E.models||E.models.length===0)throw new Error("No models available yet");be(E)}catch(te){if(C!==Y.current)return;console.warn("Backend fetch failed:",te);try{console.log("Trying static models.json...");const oe=await fetch("/models.json");if(oe.ok){const ie=await oe.json();if(ie.models&&ie.models.length>0){console.log(`Loaded ${ie.models.length} models from static file`),be(ie);return}}}catch(oe){console.warn("Static models.json not available:",oe)}const E=X+1;if(g(E),E<Ms){const oe=Math.min(Ss*Math.pow(1.4,X),js);a("Connecting to backend..."),J.current=setTimeout(()=>{q(C,E)},oe)}else p(!1),a("Could not load models")}},[b,_]),H=s.useCallback(()=>{Y.current+=1,q(Y.current,0,!0)},[q]);s.useEffect(()=>(Y.current+=1,q(Y.current,0),()=>{Y.current+=1,J.current&&clearTimeout(J.current)}),[q]);const Z=s.useMemo(()=>t.filter(C=>!B.includes(C.id)),[t,B]),{totalModelsByType:S,allSelectedByType:re}=s.useMemo(()=>{const C={local:t.filter(z=>z.type==="local").length,api:t.filter(z=>z.type==="api").length},X={local:t.filter(z=>z.type==="local"&&B.includes(z.id)).length,api:t.filter(z=>z.type==="api"&&B.includes(z.id)).length};return{totalModelsByType:C,allSelectedByType:{local:C.local>0&&X.local===C.local,api:C.api>0&&X.api===C.api}}},[t,B]),ce=s.useCallback(C=>{var X;return((X=t.find(z=>z.id===C))==null?void 0:X.name)||C},[t]);return{modelsData:t,setModelsData:n,selected:B,setSelected:Q,chatModelId:h,setChatModelId:_,moderator:U,setModerator:u,availableModels:Z,totalModelsByType:S,allSelectedByType:re,modelIdToName:ce,isLoading:r,loadError:d,retryCount:v,retryNow:H}}function Es(){var t;return typeof chrome<"u"&&((t=chrome.storage)!=null&&t.local)?window.__API_BASE__||"https://chat.neevs.io":""}async function*yt(t,n,r){var b;const d=`${Es()}${t}`,a=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:r});if(!a.ok){yield{event:"error",error:`HTTP ${a.status}: ${a.statusText}`};return}const v=(b=a.body)==null?void 0:b.getReader();if(!v){yield{event:"error",error:"No response body"};return}const g=new TextDecoder;let m="";try{for(;;){const{done:c,value:h}=await v.read();if(c)break;m+=g.decode(h,{stream:!0});const _=m.split(`
`);m=_.pop()||"";for(const $ of _)if($.startsWith("data: ")){const B=$.slice(6).trim();if(B)try{yield JSON.parse(B)}catch{}}}}finally{v.releaseLock()}}const Ns=async(t,n)=>yt("/api/chat/stream",{models:t.models,messages:t.messages,max_tokens:t.max_tokens,temperature:t.temperature,github_token:t.github_token},n),Ts=async(t,n)=>yt("/api/chat/council/stream",t,n),_s=async(t,n)=>yt("/api/chat/discussion/stream",t,n),Is=async(t,n)=>yt("/api/chat/personality/stream",t,n),xt=async(t,n)=>{try{for await(const r of t)try{n(r)}catch(p){console.error("Error handling event:",p)}}catch(r){throw console.error("Stream error:",r),r}};function fn(t){window.__API_BASE__=t}const Ke={githubToken:"",profile:"local_all",chatApiBaseUrl:"http://localhost:8080",modelsBaseDomain:"",modelsUseHttps:!1};function hn(t){const n={...Ke,...t};(!n.chatApiBaseUrl||typeof n.chatApiBaseUrl!="string")&&typeof n.baseDomain=="string"&&(n.chatApiBaseUrl=n.baseDomain?`${n.useHttps===!1?"http":"https"}://chat.${n.baseDomain}`:"http://localhost:8080",n.profile="custom"),(!n.modelsBaseDomain||typeof n.modelsBaseDomain!="string")&&typeof n.baseDomain=="string"&&(n.modelsBaseDomain=n.baseDomain,n.profile="custom"),typeof n.modelsUseHttps!="boolean"&&typeof n.useHttps=="boolean"&&(n.modelsUseHttps=n.useHttps,n.profile="custom");const r=n.profile==="remote_all"||n.profile==="local_chat_remote_models"||n.profile==="local_all"||n.profile==="custom"?n.profile:Ke.profile;return{githubToken:typeof n.githubToken=="string"?n.githubToken:Ke.githubToken,profile:r,chatApiBaseUrl:Wt(typeof n.chatApiBaseUrl=="string"?n.chatApiBaseUrl:""),modelsBaseDomain:typeof n.modelsBaseDomain=="string"?n.modelsBaseDomain:Ke.modelsBaseDomain,modelsUseHttps:typeof n.modelsUseHttps=="boolean"?n.modelsUseHttps:Ke.modelsUseHttps}}function Rs(){var t;return typeof chrome<"u"&&!!((t=chrome.storage)!=null&&t.local)}function Wt(t){const n=t.trim().replace(/\/+$/,"");return n||"http://localhost:8080"}function Ls(){const[t,n]=s.useState(Ke),[r,p]=s.useState(!1);return s.useEffect(()=>{if(Rs()){chrome.storage.local.get(["envConfig"],a=>{const v=hn(a.envConfig);n(v),p(!0);const g=Wt(v.chatApiBaseUrl);fn(g),console.log("[Config] Extension mode, API base:",g)});const d=(a,v)=>{var g;if(v==="local"&&((g=a.envConfig)!=null&&g.newValue)){const m=hn(a.envConfig.newValue);n(m);const b=Wt(m.chatApiBaseUrl);fn(b),console.log("[Config] Updated API base:",b)}};return chrome.storage.onChanged.addListener(d),()=>chrome.storage.onChanged.removeListener(d)}else p(!0),console.log("[Config] Web mode, using relative URLs")},[]),{config:t,isLoaded:r}}function As(){const[t,n]=s.useState([]),r=s.useRef([]),p=s.useCallback(g=>{if(!g.length)return;const m=[...r.current,...g];r.current=m,n(m)},[]),d=s.useCallback(()=>{r.current=[],n([])},[]),a=s.useCallback(g=>g.map(m=>`${m.role==="user"?"User":"Assistant"}: ${m.content}`).join(`

`),[]),v=s.useCallback((g,m)=>{if(m==="compare")return g;const b=g.filter(h=>h.role==="user"),c=[...g].reverse().find(h=>h.role==="assistant"&&(h.kind==="council_synthesis"||h.kind==="roundtable_synthesis")&&h.content.trim().length>0);return c?[...b,c]:b},[]);return{history:t,historyRef:r,pushHistoryEntries:p,clearHistory:d,historyToText:a,buildCarryoverHistory:v}}function $s(t){const n=s.useRef({}),r=s.useRef(null),p=s.useCallback(()=>{r.current=null;const m=n.current;n.current={},Object.keys(m).length&&t(c=>c.map(h=>{const _=m[h.id];return _?{...h,response:(h.response||"")+_.answer,thinking:(h.thinking||"")+_.thinking}:h}))},[t]),d=s.useCallback(()=>{r.current==null&&(r.current=requestAnimationFrame(p))},[p]),a=s.useCallback((m,b,c)=>{if(!b&&!c)return;const h=n.current[m]||{answer:"",thinking:""};h.answer+=b,h.thinking+=c,n.current[m]=h,d()},[d]),v=s.useCallback(m=>{n.current[m]&&delete n.current[m]},[]),g=s.useCallback(()=>{n.current={},r.current!=null&&(cancelAnimationFrame(r.current),r.current=null)},[]);return{pendingStreamRef:n,flushStreamRafRef:r,enqueueStreamDelta:a,clearPendingStreamForModel:v,resetPendingStream:g}}function Ps(t){const{mode:n,moderator:r,selected:p,selectedCardIds:d,githubToken:a,isGenerating:v,summarizeSessionResponses:g,setLastQuery:m,setHoveredCard:b,setPhaseLabel:c,setModeratorSynthesis:h,setCouncilAggregateRankings:_,setCouncilAnonymousReviews:$,setDiscussionTurnsByModel:B,resetFailedModels:Q,markModelFailed:U,failedModelsRef:u,currentDiscussionTurnRef:Y,sessionModelIdsRef:J,abortControllerRef:q,thinkingStateRef:H,conversationHistoryRef:Z,pushHistoryEntries:S,historyToText:re,buildCarryoverHistory:ce,setModelsData:C,modelIdToName:X,setExecutionTimes:z,setIsGenerating:be,setIsSynthesizing:te,setSpeaking:E,enqueueStreamDelta:oe,clearPendingStreamForModel:ie,resetPendingStream:me}=t;return{sendMessage:async(ne,ae,ye,Me)=>{if(!ne.trim()||p.length===0&&!ye||!ye&&v)return;const Te=(Me==null?void 0:Me.skipHistory)??!1,ue={role:"user",content:ne},Xe=Te?Z.current:[...Z.current,ue];Te||S([ue]);const Je=ce(Xe,n),Re=re(Je);m(ne);const Le=Re?`${Re}

Continue the conversation above and respond to the latest user request.`:ne;let i;if(ye)i=ye;else{const T=Array.from(d).filter(D=>p.includes(D)&&(n==="compare"||D!==r));i=T.length>0?T:p.slice()}J.current=i;const fe={},he=(T,D,I)=>{if(!D)return;const W=I!=null&&I.label?`${I.label}: ${D}`:D;fe[T]=I!=null&&I.replace?W:fe[T]?`${fe[T]}

${W}`:W},ve=new AbortController;q.current=ve,be(!0),te(!1),b(null),c(null),h(""),_(null),$([]),B({}),Q(),Y.current=null,me(),C(T=>T.map(D=>i.includes(D.id)||D.id===r?ae&&ae[D.id]?{...D,response:ae[D.id],thinking:void 0,error:void 0}:{...D,response:"",thinking:void 0,error:void 0}:D)),z(T=>{const D={...T},I=performance.now();return i.forEach(W=>{D[W]={startTime:I}}),r&&!D[r]&&(D[r]={startTime:I}),D});const xe=new Set(i);r&&xe.add(r),xe.forEach(T=>{H.current[T]={inThink:!1,carry:""}});const de=new Set,ge=T=>T?T.replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase()):"",Ae=T=>typeof T=="number"&&Number.isFinite(T)?`${Math.round(T*100)}%`:"â€”",Ge=T=>{if(!T)return"";const D=T.domain_weights||{},I=T.model_expertise_scores||{},W=Object.entries(D).sort((w,A)=>(A[1]??0)-(w[1]??0)).map(([w,A])=>`${ge(w)} ${Ae(A)}`).join(", "),P=(i.length>0?i:Object.keys(I)).filter(Boolean).map(w=>`${X(w)} ${Ae(I[w])}`).join(", "),L=T.discussion_lead?X(T.discussion_lead):"â€”",y=T.expected_turns??2,x=(T.reasoning||"").trim(),j=[`ORCHESTRATOR â€¢ ${r?X(r):"Roundtable"}`];return W&&j.push(`Domains: ${W}`),j.push(`Lead: ${L}`),P&&j.push(`Participants: ${P}`),j.push(`Planned rounds: ${y}`),x&&(j.push(""),j.push(x)),j.join(`
`).trim()},je=(T,D)=>{const I=T==null?void 0:T.trim();!I||Te||S([{role:"assistant",content:I,kind:D}])},_e=(T,D)=>{const I=H.current[T]||{inThink:!1,carry:""};let W=I.carry+D;I.carry="";const R=W.lastIndexOf("<");if(R!==-1&&W.length-R<8){const x=W.slice(R);("<think>".startsWith(x)||"</think>".startsWith(x))&&(I.carry=x,W=W.slice(0,R))}let P="",L="",y=0;for(;y<W.length;)if(I.inThink){const x=W.indexOf("</think>",y);if(x===-1){P+=W.slice(y);break}P+=W.slice(y,x),I.inThink=!1,y=x+8}else{const x=W.indexOf("<think>",y);if(x===-1){L+=W.slice(y);break}L+=W.slice(y,x),I.inThink=!0,y=x+7}H.current[T]=I,L&&he(T,L),(P||L)&&oe(T,L,P)},$e=T=>{const D=T.toLowerCase();return D.includes("rate limit")||D.includes("waiting")?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="display: inline-block; vertical-align: text-bottom; margin-right: 6px;"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'+T:D.includes("error")||D.includes("failed")?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="display: inline-block; vertical-align: text-bottom; margin-right: 6px;"><path d="M12 2L2 20h20L12 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/><path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'+T:T};try{if(n==="compare"){E(new Set(i));const R=await Ns({models:i,messages:Xe.map(P=>({role:P.role,content:P.content})),max_tokens:ot.maxTokens,temperature:ot.temperature,github_token:a||null},ve.signal);if(await xt(R,P=>{if(P.event==="info"&&P.content){const L=String(P.content),y=$e(L);c(y),P.model_id&&C(x=>x.map(j=>j.id===P.model_id?{...j,statusMessage:y}:j))}if(P.event==="token"&&P.model_id){const L=P.model_id,y=performance.now();de.has(L)||(de.add(L),z(x=>({...x,[L]:{...x[L],firstTokenTime:y}})),C(x=>x.map(j=>j.id===L?{...j,statusMessage:void 0}:j))),_e(L,String(P.content??""))}if(P.event==="done"&&P.model_id){const L=performance.now(),y=P.model_id;z(x=>({...x,[y]:{...x[y],endTime:L}})),E(x=>{const j=new Set(x);return j.delete(y),j})}}),!Te){const P=g(fe,i);P&&S([{role:"assistant",content:P,kind:"compare_summary"}])}return}if(n==="council"){const R=i;if(R.length<2){const w="Select at least 2 participants for Council mode.";h(w),r&&C(A=>A.map(f=>f.id===r?{...f,response:w}:f)),c("Error");return}E(new Set(R));const P=ye&&R.length>0?R[0]:r||(R.length>0?R[0]:null),L=await Ts({query:Le,participants:R,chairman_model:P,max_tokens:ot.maxTokens,github_token:a||null,completed_responses:ae||null},ve.signal);let y="",x=0,j=0;if(await xt(L,w=>{const A=w.event;if(A==="stage1_start"&&c("Stage 1 Â· Responses"),A==="model_start"&&w.model_id){const f=w.model_id;E(G=>{const F=new Set(G);return F.add(f),F})}if(A==="model_chunk"&&w.model_id){const f=w.model_id,G=performance.now();de.has(f)||(de.add(f),z(F=>({...F,[f]:{...F[f],firstTokenTime:G}}))),_e(f,String(w.chunk??""))}if(A==="model_response"&&w.model_id){const f=w.model_id,G=performance.now();z(ee=>({...ee,[f]:{...ee[f],endTime:G}})),E(ee=>{const se=new Set(ee);return se.delete(f),se});const F=String(w.response??"");he(f,F,{replace:!0}),ae&&ae[f]||(C(ee=>ee.map(se=>se.id===f?{...se,response:F}:se)),je(`${X(f)}:
${F}`,"council_turn"))}if(A==="model_error"&&w.model_id){const f=w.model_id,G=performance.now();z(ee=>({...ee,[f]:{...ee[f],endTime:G}})),E(ee=>{const se=new Set(ee);return se.delete(f),se});const F=String(w.error??"Error generating response.");ie(f),C(ee=>ee.map(se=>se.id===f?{...se,response:F,error:F}:se)),U(f),he(f,F,{replace:!0})}if(A==="stage2_start"){const f=R.filter(G=>!u.current.has(G));x=f.length,j=0,$([]),c(`Stage 2 Â· Anonymous Review (0/${x})`),h(`Anonymous reviews in progress (0/${x})â€¦`),E(new Set(f))}if(A==="ranking_response"&&w.model_id){const f=w.model_id;E(F=>{const ee=new Set(F);return ee.delete(f),ee}),j+=1,c(`Stage 2 Â· Anonymous Review (${j}/${x||R.length})`),h(`Anonymous reviews in progress (${j}/${x||R.length})â€¦`);const G=String(w.ranking??"");if(G.trim()){const F=String(w.model_name??f);$(ee=>[...ee,{reviewer_model_id:f,reviewer_model_name:F,text:G.trim()}])}}if(A==="ranking_error"&&w.model_id){const f=w.model_id;E(ee=>{const se=new Set(ee);return se.delete(f),se}),U(f),j+=1,c(`Stage 2 Â· Anonymous Review (${j}/${x||R.length})`),h(`Anonymous reviews in progress (${j}/${x||R.length})â€¦`);const G=String(w.error??"Ranking error."),F=String(w.model_name??f);$(ee=>[...ee,{reviewer_model_id:f,reviewer_model_name:F,text:G,error:!0}])}if(A==="stage2_complete"){const f=w.aggregate_rankings;if(f){_(f);const G=f.map((F,ee)=>`${ee+1}. ${F.model_name} (avg: ${F.average_rank}, votes: ${F.votes_count})`).join(`
`);je(`Anonymous Rankings:
${G}`,"council_ranking")}}if(A==="chairman_quip"){const f=String(w.quip??"");h(f),P&&je(`${X(P)}: ${f}`,"council_chairman")}if(A==="stage3_start"&&(c("Stage 3 Â· Synthesis"),te(!0),h(""),r&&E(new Set([r]))),A==="stage3_complete"||A==="stage3_error"){const f=String(w.response??w.error??"Synthesis error.");h(f),y=f,r&&(ie(r),C(G=>G.map(F=>F.id===r?{...F,response:f}:F)),he(r,f,{replace:!0})),te(!1)}if(A==="council_complete"){c(null),te(!1),E(new Set);const f=w.aggregate_rankings;f&&_(f)}if(A==="error"){const f=String(w.error??w.message??"Council error.");h(f),r&&(ie(r),C(G=>G.map(F=>F.id===r?{...F,response:f}:F))),c("Error")}}),!Te){const w=y.trim();w&&S([{role:"assistant",content:w,kind:"council_synthesis"}])}return}if(n==="personality"){const R=i;E(new Set(R));const P=await Is({query:Le,participants:R,max_tokens:512,github_token:a||null},ve.signal);await xt(P,L=>{const y=L.event;if(y==="personality_start"&&c("Generating Personas"),y==="model_start"&&L.model_id){const x=L.model_id;E(j=>{const w=new Set(j);return w.add(x),w})}if(y==="model_chunk"&&L.model_id){const x=L.model_id,j=performance.now();de.has(x)||(de.add(x),z(A=>({...A,[x]:{...A[x],firstTokenTime:j}})));const w=L.persona_info;w&&C(A=>A.map(f=>f.id===x?{...f,personaEmoji:w.persona_emoji||f.personaEmoji,personaName:w.persona_name||f.personaName,personaTrait:w.persona_trait||f.personaTrait}:f)),_e(x,String(L.chunk??""))}if(y==="model_response"&&L.model_id){const x=L.model_id,j=performance.now();z(le=>({...le,[x]:{...le[x],endTime:j}})),E(le=>{const De=new Set(le);return De.delete(x),De});const w=String(L.response??""),A=String(L.persona_emoji??"ðŸŽ­"),f=String(L.persona_name??"Persona"),G=String(L.persona_trait??"");he(x,w,{replace:!0}),C(le=>le.map(De=>De.id===x?{...De,response:w,personaEmoji:A,personaName:f,personaTrait:G}:De));const F=w.split(`
`),ee=F[0]||"",ze=ee.includes("-")&&(ee.includes("**")||/^[^\w\s]/.test(ee))?F.slice(1).join(`
`).trim():w,Fe=`${A} **${f}** (${X(x)})${G?` - ${G}`:""}

${ze}`;je(Fe,"personality_response")}if(y==="model_error"&&L.model_id){const x=L.model_id,j=performance.now();z(A=>({...A,[x]:{...A[x],endTime:j}})),E(A=>{const f=new Set(A);return f.delete(x),f});const w=String(L.error??"Error generating persona.");ie(x),C(A=>A.map(f=>f.id===x?{...f,response:w,error:w}:f)),U(x)}if(y==="personality_complete"&&(c(null),E(new Set)),y==="error"){const x=String(L.error??"Personality mode error.");c("Error"),h(x)}});return}const T=i;if(T.length<2){const R="Select at least 2 participants for Roundtable mode.";h(R),r&&C(P=>P.map(L=>L.id===r?{...L,response:R}:L)),c("Error");return}r&&E(new Set([r]));const D=await _s({query:Le,max_tokens:ot.maxTokens,temperature:ot.temperature,orchestrator_model:r||null,github_token:a||null,participants:T,turns:2},ve.signal);let I=0,W="";if(await xt(D,R=>{var L;const P=R.event;if(P==="analysis_start"&&(c("Analyzing Query"),r&&E(new Set([r]))),P==="analysis_complete"){c("Orchestrating"),E(new Set);let y="Analysis complete.";if(R.analysis){const x=R.analysis,j=Ge(x);j&&(y=j)}h(y),r&&C(x=>x.map(j=>j.id===r?{...j,response:y}:j)),je(y,"roundtable_analysis")}if(P==="turn_start"){const y=R.turn_number;typeof y=="number"&&(I=y),c(`Round ${I+1}`);const x=R.model_id;x&&E(new Set([x]))}if(P==="turn_chunk"&&R.model_id){const y=R.model_id,x=performance.now();de.has(y)||(de.add(y),z(j=>({...j,[y]:{...j[y],firstTokenTime:x}}))),((L=Y.current)==null?void 0:L.modelId)!==y&&(Y.current={modelId:y,turnNumber:I}),_e(y,String(R.chunk??""))}if(P==="turn_complete"){const y=R.turn,x=y==null?void 0:y.model_id;if(!x)return;const j=performance.now();z(f=>({...f,[x]:{...f[x],endTime:j}}));const w=String((y==null?void 0:y.response)??"");B(f=>{const G=f[x]||[];return{...f,[x]:[...G,{turn_number:I,response:w}]}}),C(f=>f.map(G=>G.id===x?{...G,response:w}:G)),E(f=>{const G=new Set(f);return G.delete(x),G}),he(x,w,{label:`Round ${I+1}`});const A=X(x);je(`${A} Â· Round ${I+1}
${w}`,"roundtable_turn")}if(P==="turn_error"&&R.model_id){const y=R.model_id,x=performance.now();z(w=>({...w,[y]:{...w[y],endTime:x}}));const j=String(R.error??"Error generating response.");ie(y),C(w=>w.map(A=>A.id===y?{...A,response:j,error:j}:A)),E(w=>{const A=new Set(w);return A.delete(y),A}),U(y),he(y,j,{replace:!0}),je(`${X(y)} Â· Round ${I+1}
${j}`,"roundtable_turn")}if(P==="synthesis_start"&&(c("Synthesis"),te(!0),r&&E(new Set([r]))),P==="discussion_complete"){const y=String(R.final_response??"");h(y),W=y,r&&(ie(r),C(x=>x.map(j=>j.id===r?{...j,response:y}:j)),he(r,y,{replace:!0})),c(null),te(!1),E(new Set)}if(P==="error"){const y=String(R.error??R.message??"Discussion error.");h(y),r&&(ie(r),C(x=>x.map(j=>j.id===r?{...j,response:y}:j))),c("Error"),te(!1),E(new Set)}}),!Te){const R=W.trim();R&&S([{role:"assistant",content:R,kind:"roundtable_synthesis"}])}}catch(T){if(T.name==="AbortError")return;if(console.error("Chat error:",T),q.current===ve){const D=T.message||String(T);h(`Session Error: ${D}`),c("Error"),me(),C(I=>I.map(W=>i.includes(W.id)&&!W.response?{...W,response:"Error generating response."}:W)),i.forEach(I=>U(I))}}finally{if(q.current===ve){const T=performance.now();z(D=>{const I={...D};return J.current.forEach(W=>{I[W]&&!I[W].endTime&&(I[W]={...I[W],endTime:T})}),I}),be(!1),te(!1),c(D=>D==="Error"?D:null),E(new Set)}}}}}function zt(t,n){const r=Math.min(t.x,n.x),p=Math.min(t.y,n.y),d=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return{left:r,top:p,right:d,bottom:a,width:d-r,height:a-p}}function Ds({rootContainerRef:t,visualizationAreaRef:n,arenaOffsetYRef:r,arenaTargetYRef:p,wheelRafRef:d,selectedModels:a,cardRefs:v,selectedCardIds:g,setSelectedCardIds:m,setActiveInspectorId:b,suppressClickRef:c}){const[h,_]=s.useState(null),$=s.useRef(!1);s.useEffect(()=>{$.current=h!=null},[h]),s.useEffect(()=>{const U=u=>{if(u.button!==0||!t.current)return;const Y=u.target;if(!Y)return;const J=Y.closest("[data-card]"),q=Y.closest('button, a, input, textarea, select, [role="button"]'),H=Y.closest("[draggable]"),Z=Y.closest("[data-no-arena-scroll]");if(J||q||H||Z||!t.current.contains(Y))return;p.current=r.current,d.current!=null&&(cancelAnimationFrame(d.current),d.current=null);const S=t.current.getBoundingClientRect(),re={x:u.clientX-S.left,y:u.clientY-S.top};u.preventDefault(),$.current=!0,c.current.card=!1,c.current.background=!1,_({origin:re,current:re,active:!1})};return window.addEventListener("mousedown",U,!0),()=>window.removeEventListener("mousedown",U,!0)},[r,p,d,t,n,c]),s.useEffect(()=>{if(!h||!t.current)return;const U=J=>J.preventDefault();document.addEventListener("selectstart",U);const u=J=>{const q=t.current.getBoundingClientRect(),H={x:J.clientX-q.left,y:J.clientY-q.top};_(Z=>{if(!Z)return Z;const S=zt(Z.origin,H),re=Z.active||S.width>4||S.height>4;return{...Z,current:H,active:re}})},Y=J=>{$.current=!1;const q=t.current.getBoundingClientRect(),H={x:J.clientX-q.left,y:J.clientY-q.top},Z=J.target,S=!!(Z&&Z.closest("[data-card]"));_(re=>{if(!re)return null;const ce=zt(re.origin,H);if(re.active&&ce.width>0&&ce.height>0){const C=[],X=t.current.getBoundingClientRect(),z={left:X.left+ce.left,right:X.left+ce.right,top:X.top+ce.top,bottom:X.top+ce.bottom};for(const be of a){const te=v.current.get(be.id);if(!te)continue;const E=te.getBoundingClientRect();!(E.right<z.left||E.left>z.right||E.bottom<z.top||E.top>z.bottom)&&C.push(be.id)}m(new Set(C)),S?c.current.card=!0:C.length>0&&(c.current.background=!0)}return null})};return window.addEventListener("mousemove",u),window.addEventListener("mouseup",Y),()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",Y),document.removeEventListener("selectstart",U)}},[h,t,n,a,v,g,m,b,c]);const B=s.useMemo(()=>{if(!h||!h.active)return null;const U=zt(h.origin,h.current);return U.width<=0||U.height<=0?null:{left:U.left,top:U.top,width:U.width,height:U.height}},[h]),Q=s.useCallback(()=>{_(null),$.current=!1},[]);return{selectionRect:B,isSelecting:h!=null,dragSelectionActiveRef:$,clearSelection:Q}}function Os({visualizationAreaRef:t,cardRefs:n,selected:r,setSelected:p,mode:d,gridCols:a,getCirclePosition:v}){const[g,m]=s.useState(null),b=s.useCallback((c,h)=>{if(c.button!==0||c.target.closest('button, a, input, textarea, select, [role="button"]'))return;c.preventDefault();const $=n.current.get(h);if(!$||!t.current)return;const B=$.getBoundingClientRect(),Q=t.current.getBoundingClientRect(),U=B.left+B.width/2,u=B.top+B.height/2;m({activeId:h,currX:c.clientX,currY:c.clientY,offsetX:U-c.clientX,offsetY:u-c.clientY,containerLeft:Q.left,containerTop:Q.top,containerWidth:Q.width,containerHeight:Q.height,cardHeight:B.height}),c.target.setPointerCapture(c.pointerId)},[t]);return s.useEffect(()=>{if(!g)return;const c=_=>{if(m(u=>u?{...u,currX:_.clientX,currY:_.clientY}:null),!t.current)return;const $=t.current.getBoundingClientRect(),B=r.indexOf(g.activeId);let Q=1/0,U=-1;if(d==="compare"){const u=_.clientX-($.left+$.width/2),Y=_.clientY-$.top,J=(pe.cardWidth+pe.gapX)*a-pe.gapX;r.forEach((q,H)=>{const Z=Math.floor(H/a),re=H%a*(pe.cardWidth+pe.gapX)-J/2+pe.cardWidth/2,ce=Z*(pe.cardHeight+pe.gapY),C=re,X=ce+pe.cardHeight/2,z=(u-C)**2+(Y-X)**2;z<Q&&(Q=z,U=H)})}else{const u=_.clientX-($.left+$.width/2),Y=_.clientY-($.top+$.height/2),J=Math.max(pe.baseRadius,pe.minRadius+r.length*pe.radiusPerModel);r.forEach((q,H)=>{const Z=v(H,r.length,d,J),S=(u-Z.x)**2+(Y-Z.y)**2;S<Q&&(Q=S,U=H)})}if(U!==-1&&U!==B){const u=[...r],[Y]=u.splice(B,1);u.splice(U,0,Y),p(u)}},h=()=>m(null);return window.addEventListener("pointermove",c),window.addEventListener("pointerup",h),()=>{window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",h)}},[g,t,n,r,p,d,a,v]),{dragState:g,handlePointerDown:b}}const Bs={selectedCardIds:new Set,activeInspectorId:null};function zs(){const[t,n]=s.useReducer(Hs,Bs),r=s.useCallback(a=>{n({type:"setSelected",update:a})},[]),p=s.useCallback(a=>{n({type:"setActive",update:a})},[]),d=s.useCallback(()=>{n({type:"clearSelection"})},[]);return{selectedCardIds:t.selectedCardIds,setSelectedCardIds:r,activeInspectorId:t.activeInspectorId,setActiveInspectorId:p,clearInspectorSelection:d}}function Hs(t,n){switch(n.type){case"setSelected":{const r=Ws(t.selectedCardIds,n.update),p=!Xs(t.selectedCardIds,r),d=mn(t.activeInspectorId,r);return!p&&d===t.activeInspectorId?t:{...t,selectedCardIds:p?r:t.selectedCardIds,activeInspectorId:d}}case"setActive":{const r=Ys(t.activeInspectorId,n.update),p=r&&t.selectedCardIds.has(r)?r:mn(r,t.selectedCardIds);return p===t.activeInspectorId?t:{...t,activeInspectorId:p}}case"clearSelection":return t.selectedCardIds.size===0&&t.activeInspectorId==null?t:{...t,selectedCardIds:new Set,activeInspectorId:null};default:return t}}function Ws(t,n){const r=typeof n=="function"?n(t):n;return new Set(r)}function Ys(t,n){return typeof n=="function"?n(t):n}function mn(t,n){return n.size===0?null:t&&n.has(t)?t:null}function Xs(t,n){if(t===n)return!0;if(t.size!==n.size)return!1;for(const r of t)if(!n.has(r))return!1;return!0}const Ie=(t,n)=>!t||!t.startsWith("#")?t:t.length===7||t.length===4?`${t}${n}`:t,Gs={idle:"Ready",responding:"Responding",done:"Done",waiting:"Waiting",error:"Error"};function Ht({state:t,color:n,size:r=16,label:p,className:d=""}){const a={width:`${r}px`,height:`${r}px`},v=p??Gs[t],g=Math.max(2,Math.round(r*.14)),m=Math.max(12,r-2),b="#fbbf24",c=Ie(n,"cc"),h=()=>{switch(t){case"responding":return e.jsx("div",{className:"relative flex items-center justify-center",style:a,children:e.jsxs("svg",{width:m,height:m,viewBox:"0 0 24 24",fill:"none",className:"",style:{filter:`drop-shadow(0 0 6px ${Ie(b,"55")})`,animation:"spin 0.6s linear infinite"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"spinnerGradient",gradientUnits:"userSpaceOnUse",x1:"3",y1:"12",x2:"12",y2:"3",children:[e.jsx("stop",{offset:"0%",stopColor:b,stopOpacity:"1"}),e.jsx("stop",{offset:"60%",stopColor:b,stopOpacity:"0.5"}),e.jsx("stop",{offset:"100%",stopColor:b,stopOpacity:"0"})]})}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:Ie(b,"15"),strokeWidth:g,fill:"none"}),e.jsx("path",{d:"M 12 3 A 9 9 0 1 1 3 12",stroke:"url(#spinnerGradient)",strokeWidth:g,strokeLinecap:"round",fill:"none"}),e.jsx("circle",{cx:"3",cy:"12",r:g*.7,fill:b})]})});case"done":return e.jsx("div",{className:"flex items-center justify-center rounded-full",style:{...a,background:Ie(n,"14"),border:`1px solid ${Ie(n,"99")}`},children:e.jsx("svg",{width:m,height:m,viewBox:"0 0 24 24",fill:"none",children:e.jsx("polyline",{points:"5 13 10 18 19 7",stroke:n,strokeWidth:g,strokeLinecap:"round",strokeLinejoin:"round"})})});case"error":const _="#ef4444";return e.jsx("div",{className:"flex items-center justify-center rounded-full",style:{...a,background:Ie(_,"14"),border:`1px solid ${Ie(_,"99")}`},children:e.jsx("svg",{width:m,height:m,viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 6L18 18M6 18L18 6",stroke:_,strokeWidth:g,strokeLinecap:"round",strokeLinejoin:"round"})})});case"waiting":return e.jsxs("div",{className:"relative flex items-center justify-center",style:a,children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{border:`1px solid ${Ie(c,"99")}`}}),e.jsx("svg",{width:m,height:m,viewBox:"0 0 24 24",fill:"none",style:{animation:"spin 5s linear infinite"},children:e.jsx("circle",{cx:"12",cy:"12",r:"8.5",stroke:Ie(c,"44"),strokeWidth:g-1,strokeDasharray:"6 10",strokeLinecap:"round"})}),e.jsx("div",{className:"absolute w-2 h-2 rounded-full",style:{background:Ie(c,"aa"),animation:"pulse 1.5s ease-in-out infinite"}})]});default:return e.jsxs("div",{className:"relative flex items-center justify-center",style:a,children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{border:"1px solid rgba(71, 85, 105, 0.5)"}}),e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:"rgba(148, 163, 184, 0.6)",animation:"pulse 2.4s ease-in-out infinite"}})]})}};return e.jsx("div",{className:`inline-flex items-center justify-center ${d}`,title:v,children:h()})}function xn({times:t}){const n=(t==null?void 0:t.startTime)!=null,r=(t==null?void 0:t.endTime)!=null,p=(t==null?void 0:t.firstTokenTime)!=null,d=n&&r?((t.endTime-t.startTime)/1e3).toFixed(2):null,a=n&&p?((t.firstTokenTime-t.startTime)/1e3).toFixed(2):null;return e.jsxs("div",{className:"text-[10px] text-slate-500",children:[e.jsx("span",{className:"text-slate-400",children:"TIME"})," ",d?`${d}s`:n&&!r?"...":"â€”",a&&e.jsxs("span",{className:"ml-2 text-slate-600",children:["TTFT ",a,"s"]})]})}const Yt=({text:t,speed:n=5})=>{const[r,p]=s.useState(""),d=s.useRef(0),a=s.useRef(null);return s.useEffect(()=>{!t.startsWith(r)&&r!==""&&(p(""),d.current=0)},[t]),s.useEffect(()=>{a.current!=null&&(clearTimeout(a.current),a.current=null);const v=t.length;if(d.current>=v)return;const g=()=>{const m=d.current,b=v-m;if(b<=0)return;const c=b>120?12:b>40?4:b>10?2:1,h=Math.min(v,m+c);d.current=h,p(t.slice(0,h));const $=v-h>5?0:n;a.current=window.setTimeout(g,$)};return a.current=window.setTimeout(g,n),()=>{a.current!=null&&(clearTimeout(a.current),a.current=null)}},[t,n]),e.jsx("span",{children:r})},bt=256,bn=200,Ve=96;function Fs(t){const{mode:n,selectedModels:r,gridCols:p,speaking:d,selectedCardIds:a,setSelectedCardIds:v,setActiveInspectorId:g,executionTimes:m,failedModels:b,cardRefs:c,handlePointerDown:h,dragState:_,setContextMenu:$,suppressClickRef:B,getTailSnippet:Q,hoveredCard:U,setHoveredCard:u,layoutRadius:Y,getCirclePosition:J,moderatorModel:q,moderatorId:H,orchestratorTransform:Z,orchestratorStatus:S,orchestratorPhaseLabel:re,moderatorSynthesis:ce,isSynthesizing:C,isGenerating:X,phaseLabel:z,linesTransitioning:be,lastSelectedCardRef:te,orchestratorAutoMode:E,orchestratorAutoScope:oe,showOrchestratorMenu:ie,setShowOrchestratorMenu:me,setOrchestratorAutoMode:Ne,setOrchestratorAutoScope:ne,orchestratorMenuRef:ae,availableModels:ye,setModerator:Me,councilWinnerId:Te}=t,ue=n!=="compare",Xe=n==="council"?Y-64:0,Je=S==="responding"?"Responding":S==="waiting"?"Waiting":S==="done"?"Done":"Ready",[Re,Le]=s.useState(null);return s.useEffect(()=>{if(!ie)return;const i=fe=>{ae.current&&!ae.current.contains(fe.target)&&(me(!1),Le(null))};return document.addEventListener("mousedown",i,!0),()=>document.removeEventListener("mousedown",i,!0)},[ie,ae,me]),e.jsxs(e.Fragment,{children:[r.map((i,fe)=>{var Fe;const he=J(fe,r.length,n,Y),ve=Us(fe,p),xe=d.has(i.id),de=a.has(i.id),ge=b.has(i.id),Ae=!xe&&!ge&&!!((Fe=m[i.id])!=null&&Fe.endTime)&&i.response.trim().length>0,Ge=!xe&&!Ae&&!ge&&X&&n==="roundtable",je=ge?"error":xe?"responding":Ae?"done":Ge?"waiting":"idle",_e=ge?"Error":xe?"Responding":Ae?"Done":Ge?"Waiting":"Ready",$e="#fbbf24",T="#ef4444",D=i.type==="local"?"#10b981":"#3b82f6",I=ge?T:D,W=xe&&!ge,R="rgba(30, 41, 59, 0.85)",P=ge?`linear-gradient(135deg, ${T}14, ${R})`:W?`linear-gradient(135deg, ${$e}14, ${R})`:R,L=ge?`1px solid ${T}99`:W?`1px solid ${$e}99`:de?`1px solid ${D}d0`:"1px solid rgba(71, 85, 105, 0.5)",y=ge?`0 0 24px ${T}33, inset 0 1px 1px rgba(255,255,255,0.1)`:W?`0 0 24px ${$e}33, inset 0 1px 1px rgba(255,255,255,0.1)`:de?`0 0 20px ${D}30, inset 0 1px 1px rgba(255,255,255,0.1)`:"0 4px 20px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.05)",x=qs({mode:n,gridX:ve.gridX,gridY:ve.gridY,circleX:he.x,circleY:he.y,dragState:_,modelId:i.id}),j=U===i.id,w=ue?Ve:bt,A=ue?Ve:bn,f=Math.max(800,Y*2+600),G=f/2,F=G,ee=G,se=G+(0-he.x),ze=G+(Xe-he.y);return e.jsxs("div",{ref:le=>{le?c.current.set(i.id,le):c.current.delete(i.id)},onPointerDown:le=>h(le,i.id),className:"absolute",onContextMenu:le=>{le.preventDefault(),le.stopPropagation(),$({x:le.clientX,y:le.clientY,modelId:i.id})},style:{transform:x,zIndex:ue?j?300:de?40:xe?15:5:de?20:xe?10:1,left:"50%",top:ue?"50%":"0",transition:(_==null?void 0:_.activeId)===i.id?"none":"transform 300ms cubic-bezier(0.2, 0, 0.2, 1)"},children:[ue&&xe&&!ge&&!be&&e.jsxs("svg",{className:"absolute pointer-events-none",style:{width:`${f}px`,height:`${f}px`,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:-1},viewBox:`0 0 ${f} ${f}`,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`grad-${i.id}`,gradientUnits:"userSpaceOnUse",x1:F,y1:ee,x2:se,y2:ze,children:[e.jsx("stop",{offset:"0%",stopColor:$e,stopOpacity:"0.45"}),e.jsx("stop",{offset:"100%",stopColor:$e,stopOpacity:"0.12"})]})}),e.jsx("line",{x1:F,y1:ee,x2:se,y2:ze,stroke:`url(#grad-${i.id})`,strokeWidth:"2",strokeDasharray:"6,4",strokeLinecap:"round",className:"animate-flow arena-link"})]}),e.jsxs("div",{"data-card":!0,onClick:le=>Vs({e:le,modelId:i.id,suppressClickRef:B,setSelectedCardIds:v,selectedModels:r,lastSelectedCardRef:te}),onDoubleClick:le=>Ks({e:le,modelId:i.id,setActiveInspectorId:g}),onMouseEnter:()=>ue&&u(i.id),onMouseLeave:()=>ue&&u(null),className:`relative cursor-grab active:cursor-grabbing card-hover ${ue?"rounded-full":""} ${de?"card-selected":""} ${xe?"card-speaking":""}`,style:{background:P,backdropFilter:ue?void 0:"blur(8px)",WebkitBackdropFilter:ue?void 0:"blur(8px)",border:L,boxShadow:y,transform:de||W?"scale(1.05)":"scale(1)",width:`${w}px`,height:`${A}px`,borderRadius:ue?"50%":"12px",transition:"transform 180ms ease-out, box-shadow 180ms ease-out, border-color 180ms ease-out, width 0.7s cubic-bezier(0.4, 0, 0.2, 1), height 0.7s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.7s cubic-bezier(0.4, 0, 0.2, 1)"},children:[!ue&&e.jsxs("div",{style:er,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(Ht,{state:je,color:I,size:16,label:_e}),e.jsx("span",{className:"text-xs font-semibold text-slate-200 truncate",children:i.name})]}),e.jsx("div",{className:"flex items-center gap-1.5 shrink-0",children:e.jsx("span",{className:`text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded ${i.type==="local"?"bg-emerald-500/10 text-emerald-300 border border-emerald-500/30":"bg-blue-500/10 text-blue-300 border border-blue-500/30"}`,children:i.type==="local"?"Local":"API"})})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed line-clamp-3 flex-1",children:Qs({model:i,isSpeaking:xe,thinkingFallback:e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦"}),getTailSnippet:Q})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-slate-700/50",children:e.jsx(xn,{times:m[i.id]})})]}),ue&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-center",style:{transition:"opacity 0.3s ease-out"},children:[e.jsx("div",{className:"absolute inset-[3px] rounded-full border border-white/5",style:{boxShadow:`inset 0 0 20px ${I}15`}}),e.jsx("div",{className:"absolute inset-[-6px] rounded-full opacity-60",style:{background:`radial-gradient(circle, ${I}22 0%, transparent 65%)`,filter:"blur(10px)"}}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center gap-1.5 px-3",children:[e.jsx("div",{className:"text-[7px] tracking-[0.32em] text-slate-400 uppercase",children:_e}),e.jsx("div",{className:"text-[10px] font-semibold text-slate-100 leading-tight",children:i.name}),e.jsx(Ht,{state:je,color:I,size:12})]})]})]}),n==="personality"&&ue&&i.personaEmoji&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center justify-center pointer-events-none select-none",style:{bottom:"-12px",fontSize:"20px",zIndex:100,transition:"transform 180ms ease-out",transform:xe?"scale(1.15)":"scale(1)",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5)) drop-shadow(0 0 8px rgba(0,0,0,0.3))"},title:i.personaName?`${i.personaName} - ${i.personaTrait}`:"Persona",children:i.personaEmoji}),n==="council"&&ue&&Te===i.id&&!X&&!C&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center justify-center pointer-events-none select-none",style:{bottom:"-12px",fontSize:"20px",zIndex:100,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5)) drop-shadow(0 0 12px rgba(251, 191, 36, 0.4))",animation:"pulse 2s ease-in-out infinite"},title:"Top Ranked Response",children:"ðŸ†"}),ue&&U===i.id&&e.jsxs("div",{"data-card":!0,onClick:le=>le.stopPropagation(),className:"absolute w-64 max-w-[calc(100vw-2rem)] p-4 rounded-xl transition-all duration-300 z-[220]",style:{top:he.y>0?"auto":"100%",bottom:he.y>0?"100%":"auto",left:"50%",transform:"translateX(-50%)",marginTop:he.y>0?0:"12px",marginBottom:he.y>0?"12px":0,background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(16px)",border:`1px solid ${I}40`,boxShadow:`0 20px 40px rgba(0,0,0,0.5), 0 0 20px ${I}15`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:I}}),e.jsx("span",{className:"text-xs font-semibold text-slate-300",children:i.name})]}),n==="personality"&&i.personaEmoji&&i.personaName&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-700/50",children:[e.jsx("span",{className:"text-base",children:i.personaEmoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-semibold text-blue-400",children:i.personaName}),i.personaTrait&&e.jsx("div",{className:"text-[10px] text-slate-500",children:i.personaTrait})]})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed whitespace-pre-wrap",children:Js({model:i,isSpeaking:xe,getTailSnippet:Q})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-2 border-t border-slate-700/50",children:e.jsx(xn,{times:m[i.id]})})]})]},i.id)}),n!=="compare"&&q&&e.jsxs("div",{"data-card":!0,className:"absolute z-20 transition-all duration-700 ease-out cursor-pointer",style:{opacity:1,transform:Z,left:"50%",top:n==="council"?`calc(50% + ${Y}px - 64px)`:"50%"},onClick:i=>{i.stopPropagation(),H&&(v(new Set([H])),te.current=H)},onDoubleClick:i=>{i.stopPropagation(),H&&g(H)},onContextMenu:i=>{i.preventDefault(),i.stopPropagation(),ie?(me(!1),Le(null)):(Le({x:i.clientX,y:i.clientY}),me(!0))},onMouseEnter:()=>u("moderator"),onMouseLeave:()=>u(null),children:[e.jsx("div",{className:"relative flex items-center justify-center",style:{width:`${Ve}px`,height:`${Ve}px`},children:(()=>{const i=S==="responding",fe=i?"#fbbf24":q.color;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-pulse",style:{background:`radial-gradient(circle, ${fe}20 0%, transparent 70%)`,transform:"scale(2.2)",filter:"blur(18px)"}}),e.jsxs("div",{className:"relative rounded-full flex items-center justify-center transition-all duration-300",style:{width:`${Ve}px`,height:`${Ve}px`,background:i?"linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(15, 23, 42, 0.9))":"rgba(15, 23, 42, 0.9)",backdropFilter:"blur(16px)",border:`2px solid ${fe}${i?"99":"60"}`,boxShadow:`0 0 36px ${fe}${i?"40":"28"}, inset 0 1px 1px rgba(255,255,255,0.1)`},children:[e.jsx("div",{className:"absolute inset-[-4px] rounded-full",style:{background:`conic-gradient(from 0deg, transparent, ${fe}60, transparent)`,animation:"spin 4s linear infinite"}}),e.jsx("div",{className:"absolute inset-[2px] rounded-full",style:{background:"rgba(15, 23, 42, 0.96)"}}),e.jsxs("div",{className:"relative text-center z-10 flex flex-col items-center gap-1.5 px-3",children:[e.jsx("div",{className:"text-[7px] tracking-[0.32em] text-slate-400 uppercase",children:Je}),e.jsx("div",{className:"text-[10px] font-semibold text-slate-100 leading-tight",children:q.name}),e.jsx(Ht,{state:S,color:fe,size:12})]})]})]})})()}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex flex-col items-center gap-1 w-max max-w-[200px]",style:{top:"calc(100% + 12px)"},children:e.jsx("span",{className:"text-[10px] text-slate-500",children:re})}),U==="moderator"&&!ie&&(()=>{const i=S==="responding",fe=i?"#fbbf24":q.color;return e.jsxs("div",{"data-card":!0,onClick:he=>he.stopPropagation(),className:"absolute bottom-full mb-4 left-1/2 -translate-x-1/2 w-80 max-w-[calc(100vw-2rem)] p-4 rounded-xl z-[200] transition-all duration-300",style:{background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(16px)",border:`1px solid ${fe}40`,boxShadow:`0 20px 40px rgba(0,0,0,0.5), 0 0 30px ${fe}20`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Orchestrator"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Â·"}),e.jsx("span",{className:"text-xs font-medium text-slate-300",children:q.name}),i&&e.jsx("span",{className:"text-[9px] uppercase tracking-wider px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-300 border border-yellow-500/30",children:"Working"})]}),e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:Zs({moderatorSynthesis:ce,isSynthesizing:C,moderatorId:H,speaking:d,phaseLabel:z,isGenerating:X,getTailSnippet:Q})})]})})(),ie&&Re&&ss.createPortal(e.jsx("div",{ref:ae,className:"w-64 bg-slate-800 border border-slate-700 rounded-lg shadow-xl overflow-hidden",style:{position:"fixed",top:`${Re.y}px`,left:`${Re.x}px`,transform:"translateY(-50%)",zIndex:9999},onClick:i=>i.stopPropagation(),children:E?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-2 text-[10px] uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-700/50",children:["Auto Mode: ",oe.toUpperCase()]}),["all","local","api"].map(i=>e.jsxs("button",{onClick:()=>{ne(i),me(!1)},className:`w-full px-3 py-2 text-left text-xs font-medium transition-colors ${oe===i?"bg-yellow-500/20 text-yellow-300":"text-slate-300 hover:bg-slate-700/50"}`,children:[i==="all"&&"All",i==="local"&&"Local",i==="api"&&"API",e.jsxs("span",{className:"text-[10px] text-slate-500 ml-1",children:[i==="all"&&"(local â†’ API)",i==="local"&&"(no quota)",i==="api"&&"(cloud only)"]})]},i)),e.jsx("div",{className:"border-t border-slate-700",children:e.jsx("button",{onClick:()=>{Ne(!1),me(!1)},className:"w-full px-3 py-2 text-left text-xs font-medium text-slate-400 hover:bg-slate-700/50 transition-colors",children:"Manual Mode"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 text-[10px] uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-700/50",children:"Select Orchestrator"}),ye.filter(i=>i.type==="api").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 text-[9px] uppercase tracking-wider text-slate-600 font-semibold",children:"API Models"}),ye.filter(i=>i.type==="api").map(i=>e.jsx("button",{onClick:()=>{Me(i.id),me(!1)},className:`w-full px-4 py-2 text-left text-xs font-medium transition-colors ${H===i.id?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),H===i.id&&e.jsx("span",{className:"text-blue-400",children:"âœ“"})]})},i.id))]}),ye.filter(i=>i.type==="local").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 text-[9px] uppercase tracking-wider text-slate-600 font-semibold border-t border-slate-700/50 mt-1",children:"Local Models"}),ye.filter(i=>i.type==="local").map(i=>e.jsx("button",{onClick:()=>{Me(i.id),me(!1)},className:`w-full px-4 py-2 text-left text-xs font-medium transition-colors ${H===i.id?"bg-blue-500/20 text-blue-300":"text-slate-300 hover:bg-slate-700/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),H===i.id&&e.jsx("span",{className:"text-blue-400",children:"âœ“"})]})},i.id))]}),e.jsx("div",{className:"border-t border-slate-700",children:e.jsxs("button",{onClick:()=>{Ne(!0),me(!1)},className:"w-full px-3 py-2 text-left text-xs font-medium text-yellow-400 hover:bg-slate-700/50 transition-colors flex items-center gap-2",children:[e.jsx(rs,{size:12}),e.jsx("span",{children:"Enable Auto Mode"})]})})]})}),document.body)]}),n!=="compare"&&e.jsxs("svg",{className:"absolute pointer-events-none transition-opacity duration-700",style:{width:"1000px",height:"1000px",opacity:.2},children:[e.jsx("circle",{cx:"500",cy:"500",r:Y,fill:"none",stroke:"url(#circleGrad)",strokeWidth:"1",strokeDasharray:"8,4"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"circleGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6"}),e.jsx("stop",{offset:"50%",stopColor:"#8b5cf6"}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6"})]})})]})]})}function Us(t,n){const r=Math.floor(t/n),p=t%n,d=(bt+pe.gapX)*n-pe.gapX,a=r*(bn+pe.gapY);return{gridX:p*(bt+pe.gapX)-d/2+bt/2,gridY:a}}function qs({mode:t,gridX:n,gridY:r,circleX:p,circleY:d,dragState:a,modelId:v}){if((a==null?void 0:a.activeId)===v){const g=a.currX+a.offsetX,m=a.currY+a.offsetY;if(t==="compare"){const h=g-(a.containerLeft+a.containerWidth/2),_=m-a.containerTop-a.cardHeight/2;return`translate(calc(-50% + ${h}px), ${_}px)`}const b=g-(a.containerLeft+a.containerWidth/2),c=m-(a.containerTop+a.containerHeight/2);return`translate(calc(-50% + ${b}px), calc(-50% + ${c}px))`}return t==="compare"?`translate(calc(-50% + ${n}px), ${r}px)`:`translate(calc(-50% + ${p}px), calc(-50% + ${d}px))`}function Vs({e:t,modelId:n,suppressClickRef:r,setSelectedCardIds:p,selectedModels:d,lastSelectedCardRef:a}){if(t.stopPropagation(),r.current.card){r.current.card=!1;return}const v=t.shiftKey,g=t.metaKey||t.ctrlKey;if(v&&a.current){const m=d.findIndex(c=>c.id===a.current),b=d.findIndex(c=>c.id===n);if(m!==-1&&b!==-1){const c=Math.min(m,b),h=Math.max(m,b),_=d.slice(c,h+1).map($=>$.id);p($=>{const B=new Set($);return _.forEach(Q=>B.add(Q)),B})}}else g?(p(m=>{const b=new Set(m);return b.has(n)?b.delete(n):b.add(n),b}),a.current=n):(p(new Set([n])),a.current=n)}function Ks({e:t,modelId:n,setActiveInspectorId:r}){t.stopPropagation(),r(n)}function Qs({model:t,isSpeaking:n,thinkingFallback:r,getTailSnippet:p}){return t.statusMessage?t.statusMessage.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.statusMessage}}):t.statusMessage:n?t.response.trim().length>0?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):e.jsx(Yt,{text:t.response,speed:20}):t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦ "}),p(t.thinking.trim(),220)]}):r:t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):t.response}function Js({model:t,isSpeaking:n,getTailSnippet:r,maxChars:p=220}){return t.statusMessage?t.statusMessage.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.statusMessage}}):t.statusMessage:n?t.response.trim().length>0?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):e.jsx(Yt,{text:t.response,speed:20}):t.thinking&&t.thinking.trim().length>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦ "}),r(t.thinking.trim(),280)]}):e.jsx("span",{className:"text-slate-500 italic",children:"Thinkingâ€¦"}):t.response?t.response.startsWith("<svg")?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.response}}):r(t.response,p):e.jsx("span",{className:"text-slate-500 italic",children:"No response yet."})}function Zs({moderatorSynthesis:t,isSynthesizing:n,moderatorId:r,speaking:p,phaseLabel:d,isGenerating:a,getTailSnippet:v}){return t?n&&r&&p.has(r)?e.jsx(Yt,{text:t,speed:20}):v(t):n?e.jsx("span",{className:"text-slate-500 italic",children:"Synthesizing responses..."}):a?d&&d.startsWith("<svg")?e.jsx("span",{className:"text-slate-500 italic",dangerouslySetInnerHTML:{__html:d}}):e.jsx("span",{className:"text-slate-500 italic",children:d==="Stage 1 Â· Responses"?"Waiting for model responses...":d||"Orchestrating..."}):e.jsx("span",{className:"text-slate-500 italic",children:"Send a prompt to see the synthesis."})}const er={padding:"16px",height:"100%",display:"flex",flexDirection:"column",isolation:"isolate",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",opacity:1,transition:"opacity 0.3s ease-out"};function tr({rect:t}){return t?e.jsx("div",{className:"absolute pointer-events-none z-40",style:{left:t.left,top:t.top,width:t.width,height:t.height,border:"2px solid rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)"}}):null}const nr={twoFingerTapWindow:500,twoFingerTapCooldown:400,twoFingerMinFrames:4,minPointingTime:100,dwellTime:1200,cursorSmoothing:.5},yn=s.createContext(null);function sr({children:t}){const[n,r]=s.useState(!1),[p,d]=s.useState("navigation"),[a,v]=s.useState("chat"),[g,m]=s.useState(nr),[b,c]=s.useState(!1),h=s.useRef({}),_=s.useCallback(C=>{h.current=C},[]),[$,B]=s.useState({gesture:null,progress:0,triggered:!1}),[Q,U]=s.useState(null),[u,Y]=s.useState(void 0),[J,q]=s.useState(void 0),[H,Z]=s.useState(void 0),[S,re]=s.useState(null),ce={isActive:n,setIsActive:r,gestureMode:p,setGestureMode:d,appContext:a,setAppContext:v,gestureConfig:g,setGestureConfig:m,mouseSimulation:b,setMouseSimulation:c,callbacks:h,setCallbacks:_,gestureState:$,setGestureState:B,aslResult:Q,setASLResult:U,debugInfo:u,setDebugInfo:Y,landmarkData:J,setLandmarkData:q,performanceMetrics:H,setPerformanceMetrics:Z,cameraError:S,setCameraError:re};return e.jsx(yn.Provider,{value:ce,children:t})}function rr(){const t=s.useContext(yn);if(!t)throw new Error("useGesture must be used within a GestureProvider");return t}class or extends s.Component{constructor(r){super(r);un(this,"handleRetry",()=>{var r,p;this.setState({hasError:!1,error:null}),(p=(r=this.props).onRetry)==null||p.call(r)});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,p){console.error("ErrorBoundary caught an error:",r,p)}render(){var r;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/70 gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-400",children:[e.jsx(os,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:"Something went wrong"})]}),e.jsx("p",{className:"text-xs text-white/40 text-center max-w-xs",children:((r=this.state.error)==null?void 0:r.message)||"Failed to load component"}),e.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white/80 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg transition-all active:scale-95 border border-slate-600/50",children:[e.jsx(is,{size:14}),"Try Again"]})]}):this.props.children}}const ir=s.lazy(()=>Be(()=>import("./ResponseInspector-DVfrM-P6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),ar=s.lazy(()=>Be(()=>import("./SettingsModal-CuhVH2S7.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),lr=s.lazy(()=>Be(()=>import("./TopicsDrawer-ysED6_Xd.js"),__vite__mapDeps([9,1,2,3,4,5,6]))),gn=s.lazy(()=>Be(()=>import("./DiscussionTranscript-m4zFAV_Z.js"),__vite__mapDeps([10,1,2,3,4,5,6,7]))),cr=s.lazy(()=>Be(()=>import("./GestureControl-CNJQdpJe.js"),__vite__mapDeps([11,1,2,3,4,5,6]))),ur=s.lazy(()=>Be(()=>import("./HandBackground-DW2tgz8H.js"),__vite__mapDeps([12,1,2,3,4,5,6,13]))),dr=s.lazy(()=>Be(()=>import("./ChatView-ixrMFjGH.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,15])).then(t=>({default:t.default}))),pr=s.lazy(()=>Be(()=>import("./GesturePanel-7s1FSkiw.js"),__vite__mapDeps([16,1,2,3,4,5,6,15]))),fr='button, input, textarea, select, a, [role="button"], [data-no-background], [data-card]';function hr(){var ln;const t=rr();Ls();const{modelsData:n,setModelsData:r,selected:p,setSelected:d,chatModelId:a,setChatModelId:v,moderator:g,setModerator:m,availableModels:b,totalModelsByType:c,allSelectedByType:h,modelIdToName:_,isLoading:$,loadError:B,retryCount:Q,retryNow:U}=Cs(),[u,Y]=Qe("playground_mode","chat",{serialize:o=>o,deserialize:(o,l)=>["chat","compare","council","roundtable","personality"].includes(o)?o:l}),[J,q]=s.useState(!1),H=s.useRef(null),[Z,S]=s.useState(null),[re,ce]=s.useState(!1),[C,X]=s.useState(!1),[z,be]=s.useState(2),te=s.useRef(0),E=s.useRef(0),oe=s.useRef(null),[ie,me]=s.useState(!1),[Ne,ne]=s.useState(!1),[ae,ye]=Qe("github_models_token","",{serialize:o=>o||null,deserialize:(o,l)=>o??l}),[Me,Te]=s.useState("right"),[ue,Xe]=Qe("show_council_reviewer_names",!1,{serialize:o=>String(o),deserialize:o=>o==="true"}),[Je,Re]=s.useState({}),Le=s.useRef(null),i=s.useRef(null),[fe,he]=s.useState(""),[ve,xe]=s.useState(null),de=s.useRef(null),ge=s.useCallback(o=>{de.current&&clearTimeout(de.current),xe(o),de.current=window.setTimeout(()=>{xe(null),de.current=null},5e3)},[]),Ae=s.useCallback(o=>{if(u==="chat"||ae)return!0;const l=n.find(k=>k.id===o);return!l||l.type!=="api"},[u,ae,n]),Ge=s.useCallback(()=>!!(u==="chat"||ae),[u,ae]),[je,_e]=s.useState([]),[$e,T]=s.useState(!0),[D,I]=s.useState("api"),[W,R]=s.useState(""),[P,L]=s.useState(!1),[y,x]=s.useState(null),{history:j,historyRef:w,pushHistoryEntries:A,clearHistory:f,historyToText:G,buildCarryoverHistory:F}=As(),ee=(o,l)=>{const k=new Set,M=l.filter(Boolean).filter((O,V,K)=>K.indexOf(O)===V),N=[];return M.forEach(O=>{const V=o[O];V&&V.trim()&&(N.push({id:O,text:V.trim()}),k.add(O))}),Object.entries(o).forEach(([O,V])=>{k.has(O)||!V||!V.trim()||N.push({id:O,text:V.trim()})}),N.length?N.map(({id:O,text:V})=>`${_(O)}:
${V}`).join(`

`):null},se=p.map(o=>n.find(l=>l.id===o)).filter(o=>!!o&&(u==="compare"||o.id!==g)),ze=(o,l,k,M)=>{if(k==="council"){const ht=250+o*220/(l-1)-90,mt=ht*Math.PI/180;return{x:Math.cos(mt)*M,y:Math.sin(mt)*M,angle:ht}}const N=o*360/l-90,O=Math.cos(N*Math.PI/180)*M,V=Math.sin(N*Math.PI/180)*M;return{x:O,y:V,angle:N}},Fe=(o,l)=>{S(l),o.dataTransfer.effectAllowed="move"},le=o=>{o.preventDefault(),ce(!0)},De=()=>{ce(!1)},vn=o=>{if(o.preventDefault(),ce(!1),Z){if(u==="chat")v(Z);else if(!p.includes(Z)){if(!Ae(Z)){ge("Add your GitHub token in Settings for API model access with dedicated quota"),S(null);return}d(l=>[...l,Z])}S(null)}},vt=o=>{if(u==="chat"){v(a===o?null:o);return}if(p.includes(o))if(Ye&&St.current.includes(o)&&fe){i.current&&i.current.abort();const k=St.current.filter(N=>N!==o),M={};if(n.forEach(N=>{k.includes(N.id)&&N.response&&!N.error&&(M[N.id]=N.response)}),d(N=>N.filter(O=>O!==o)),Ce.has(o)&&it(N=>{const O=new Set(N);return O.delete(o),O}),u==="council"&&k.length<2){nt(!1),ut(!1),Et("Council requires at least 2 participants."),It("Error");return}At(fe,M,k,{skipHistory:!0})}else d(k=>k.filter(M=>M!==o));else{if(!Ae(o)){ge("Add your GitHub token in Settings for API model access with dedicated quota");return}d(l=>[...l,o])}},wn=o=>{const l=n.filter(N=>N.type===o).map(N=>N.id);if(l.length>0&&l.every(N=>p.includes(N))){d(N=>N.filter(O=>!l.includes(O)));return}if(o==="api"&&!Ge()){ge("Add your GitHub token in Settings for API model access with dedicated quota");return}const M=b.filter(N=>N.type===o).map(N=>N.id);M.length>0&&d(N=>[...N,...M])},[kn,Ue]=s.useState(null),[wt,Xt]=s.useState(new Set),[Sn,Gt]=s.useState(!1),{selectedCardIds:Ce,setSelectedCardIds:it,activeInspectorId:He,setActiveInspectorId:Ze,clearInspectorSelection:We}=zs(),[at,jn]=s.useState(null),kt=s.useMemo(()=>{if(u==="compare")return 0;const o=Math.max(pe.baseRadius,pe.minRadius+se.length*pe.radiusPerModel);if(!at)return o;const k=Math.min(at.width,at.height)/2-140;return Math.max(o,k)},[u,se.length,at]);s.useEffect(()=>{const o=()=>{if(!we.current)return;const{clientWidth:k,clientHeight:M}=we.current;let N=Math.floor(k/(pe.cardWidth+pe.gapX));N=Math.max(1,N),be(N),jn({width:k,height:M})},l=new ResizeObserver(k=>{for(let M of k)M.target===we.current&&o()});return we.current&&(l.observe(we.current),o()),()=>{we.current&&l.unobserve(we.current)}},[u,He,Me]);const Pe=s.useRef(null),we=s.useRef(null),Ee=s.useRef(null),Ft=s.useRef(null),lt=s.useRef(new Map),Mn=s.useRef(null),et=s.useRef({card:!1,background:!1}),Cn=s.useRef({}),St=s.useRef([]),{enqueueStreamDelta:En,clearPendingStreamForModel:Nn,resetPendingStream:jt}=$s(r),{selectionRect:Tn,isSelecting:Mt,dragSelectionActiveRef:Ut}=Ds({rootContainerRef:Ft,visualizationAreaRef:we,arenaOffsetYRef:te,arenaTargetYRef:E,wheelRafRef:oe,selectedModels:se,cardRefs:lt,selectedCardIds:Ce,setSelectedCardIds:it,setActiveInspectorId:Ze,suppressClickRef:et}),_n=o=>{u==="chat"&&Ee.current?Ee.current.setInput(o):Pe.current&&(Pe.current.value=o,Pe.current.focus(),Gt(!0)),ne(!1)},{dragState:In,handlePointerDown:Rn}=Os({visualizationAreaRef:we,cardRefs:lt,selected:p,setSelected:d,mode:u,gridCols:z,getCirclePosition:ze});s.useEffect(()=>()=>jt(),[jt]);const[ke,Oe]=s.useState(null);s.useEffect(()=>{const o="arena-selecting",l=document.body;return Mt?l.classList.add(o):l.classList.remove(o),()=>{l.classList.remove(o)}},[Mt]);const ct=s.useCallback(o=>o?!o.closest(fr):!1,[]),Ln=s.useCallback(o=>{if(ct(o.target)){if(et.current.background){et.current.background=!1;return}Ue(null),We(),et.current.background=!1}},[ct,We]),An=s.useCallback(o=>{ct(o.target)&&(o.preventDefault(),Oe({x:o.clientX,y:o.clientY,type:"background"}))},[ct]),qt=s.useCallback(()=>{q(!0),H.current&&clearTimeout(H.current),H.current=window.setTimeout(()=>{q(!1),H.current=null},350)},[]),tt=s.useCallback(o=>{o!==u&&(qt(),nt(!1),Y(o))},[u,qt]);s.useEffect(()=>()=>{de.current&&clearTimeout(de.current)},[]),s.useEffect(()=>()=>{H.current&&clearTimeout(H.current)},[]),s.useEffect(()=>{const o=()=>Oe(null);return window.addEventListener("click",o),()=>window.removeEventListener("click",o)},[]);const[Ye,nt]=s.useState(!1),[st,ut]=s.useState(!1),[Ct,Et]=s.useState(""),$n=s.useCallback(()=>{f(),nt(!1),ut(!1),Et(""),It(null),Kt(null),Qt([]),Jt({}),r(o=>o.map(l=>({...l,response:"Ready to generate...",thinking:void 0,error:void 0}))),Re({}),Xt(new Set)},[f,r]),[Pn,Dn]=s.useState(!0),[On,Bn]=s.useState("api"),[Nt,Tt]=s.useState(!1),_t=s.useRef(null);s.useEffect(()=>{const o=k=>{_t.current&&!_t.current.contains(k.target)&&Tt(!1)},l=k=>{k.key==="Escape"&&Tt(!1)};return Nt&&(document.addEventListener("mousedown",o),document.addEventListener("keydown",l)),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("keydown",l)}},[Nt]);const[Vt,It]=s.useState(null),[dt,Kt]=s.useState(null),[zn,Qt]=s.useState([]),[Hn,Jt]=s.useState({}),[Wn,Zt]=s.useState(new Set),Rt=s.useRef(new Set),Yn=s.useRef(null),en=s.useRef({}),tn=s.useRef(u),[Lt,nn]=s.useState(null),Xn=()=>{const o=new Set;Rt.current=o,Zt(o)},Gn=o=>{Zt(l=>{if(l.has(o))return l;const k=new Set(l);return k.add(o),Rt.current=k,k})},{sendMessage:At}=Ps({mode:u,moderator:g,selected:p,selectedCardIds:Ce,githubToken:ae,isGenerating:Ye,summarizeSessionResponses:ee,setLastQuery:he,setHoveredCard:Ue,setPhaseLabel:It,setModeratorSynthesis:Et,setCouncilAggregateRankings:Kt,setCouncilAnonymousReviews:Qt,setDiscussionTurnsByModel:Jt,resetFailedModels:Xn,markModelFailed:Gn,failedModelsRef:Rt,currentDiscussionTurnRef:Yn,sessionModelIdsRef:St,abortControllerRef:i,thinkingStateRef:Cn,conversationHistoryRef:w,pushHistoryEntries:A,historyToText:G,buildCarryoverHistory:F,setModelsData:r,modelIdToName:_,setExecutionTimes:Re,setIsGenerating:nt,setIsSynthesizing:ut,setSpeaking:Xt,enqueueStreamDelta:En,clearPendingStreamForModel:Nn,resetPendingStream:jt});s.useEffect(()=>{const o=l=>{if(l.key==="Escape"){const M=document.activeElement;if(M&&M!==document.body&&M.blur(),ie){me(!1);return}if(Ne){ne(!1);return}if(ke){Oe(null);return}if(He||Ce.size>0){We(),Ue(null);return}if(C){X(!1);return}Ue(null);return}if((l.metaKey||l.ctrlKey)&&(l.key==="a"||l.key==="A")){const M=l.target;if(M.tagName==="INPUT"||M.tagName==="TEXTAREA"||u==="chat")return;l.preventDefault(),p.length>0&&it(new Set(p));return}const k=l.target;if(!(k.tagName==="INPUT"||k.tagName==="TEXTAREA")){if(l.key==="ArrowRight"||l.key==="ArrowLeft"){l.preventDefault();const M=["chat","compare","council","roundtable","personality"],N=M.indexOf(u);if(N!==-1){const O=l.key==="ArrowRight"?1:-1,V=(N+O+M.length)%M.length;tt(M[V])}return}if(l.key==="m"||l.key==="M"){l.preventDefault(),X(!C);return}if((l.key==="Delete"||l.key==="Backspace")&&Ce.size>0){l.preventDefault(),d(M=>M.filter(N=>!Ce.has(N))),We();return}if(l.key==="Enter"&&Ce.size>=1){l.preventDefault();const M=Array.from(Ce)[0];Ze(M);return}l.key.length===1&&!l.ctrlKey&&!l.metaKey&&!l.altKey&&Pe.current&&Pe.current.focus()}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[C,ie,Ne,ke,He,Ce,u,tt,We]);const pt=s.useRef(!1),$t=s.useRef(0),sn=o=>{const l=we.current;l&&l.style.setProperty("--arena-offset-y",`${o}px`)},Pt=o=>Math.max(-200,Math.min(pe.scrollClamp,o)),rn=()=>{const o=te.current,l=E.current,k=l-o;if(Math.abs(k)<.5){te.current=l,sn(l),oe.current=null;return}const M=o+k*.35;te.current=M,sn(M),oe.current=requestAnimationFrame(rn)},Dt=()=>{oe.current==null&&(oe.current=requestAnimationFrame(rn))};s.useEffect(()=>{const o=O=>{if(Ut.current)return;const V=O.target;if(V&&V.closest("input, textarea, [data-no-arena-scroll]"))return;O.preventDefault();const K=O.deltaY*.9,Se=E.current-K;E.current=Pt(Se),Dt()},l=O=>O?!!O.closest('input, textarea, [data-no-arena-scroll], [data-card], button, a, select, [role="button"]'):!1,k=O=>{if(O.touches.length!==1)return;const V=O.target;l(V)||(pt.current=!0,$t.current=O.touches[0].clientY)},M=O=>{if(Ut.current||!pt.current||O.touches.length!==1)return;const V=O.target;if(l(V)){pt.current=!1;return}const K=O.touches[0].clientY,Se=K-$t.current;$t.current=K,O.preventDefault(),E.current=Pt(E.current+Se),Dt()},N=()=>{pt.current=!1};return window.addEventListener("touchstart",k,{passive:!0}),window.addEventListener("touchmove",M,{passive:!1}),window.addEventListener("touchend",N),window.addEventListener("touchcancel",N),window.addEventListener("wheel",o,{passive:!1}),()=>{window.removeEventListener("touchstart",k),window.removeEventListener("touchmove",M),window.removeEventListener("touchend",N),window.removeEventListener("touchcancel",N),window.removeEventListener("wheel",o),oe.current!=null&&cancelAnimationFrame(oe.current)}},[]);const[ft,Fn]=Qe("playground-bg-style","dots",{serialize:o=>o,deserialize:(o,l)=>o&&xs.includes(o)?o:l}),Un=n.find(o=>o.id===g),on=n.filter(o=>Ce.has(o.id)),qn=st?"responding":Ye?"waiting":Ct?"done":"idle",Vn=st?"Synthesizing...":Ye?"Observing":Ct?"Complete":"Ready",Kn=`${Lt?`translate(-50%, -50%) translate(${Lt.x}px, ${Lt.y}px)`:"translate(-50%, -50%)"} scale(1)`;s.useLayoutEffect(()=>{if(u!=="compare")return;const o={};se.forEach(l=>{const k=lt.current.get(l.id);k&&(o[l.id]=k.getBoundingClientRect())}),en.current=o},[u,se.length,se.map(o=>o.id).join(",")]),s.useEffect(()=>{if(tn.current==="compare"&&u!=="compare"&&g&&we.current){const l=en.current[g],k=we.current.getBoundingClientRect();if(l&&k.width>0&&k.height>0){const M=k.left+k.width/2,N=u==="council"?kt-64:0,O=k.top+(k.height*.5+N),V=l.left+l.width/2-M,K=l.top+l.height/2-O;(Math.abs(V)>1||Math.abs(K)>1)&&(nn({x:V,y:K}),requestAnimationFrame(()=>nn(null)))}}tn.current=u},[u,g,kt]);const Qn=ft==="none"?"":`bg-${ft}`,Jn=(o,l=280)=>o?o.length<=l?o:`â€¦${o.slice(o.length-l)}`:"",an=()=>{i.current&&(i.current.abort(),nt(!1),ut(!1))};return e.jsxs("div",{ref:Ft,className:`fixed inset-0 overflow-hidden text-white ${Qn}`,style:{backgroundColor:pn[u],transition:"background-color 1s ease",...ft==="none"?{background:pn[u]}:{},...Mt?{userSelect:"none",WebkitUserSelect:"none"}:{}},onClick:Ln,onContextMenu:An,children:[t.isActive&&!t.mouseSimulation&&e.jsx(s.Suspense,{fallback:null,children:e.jsx(ur,{onStopGeneration:t.callbacks.current.onStopGeneration,onSendMessage:t.callbacks.current.onSendMessage,onScroll:t.callbacks.current.onScroll,onPinch:t.callbacks.current.onPinch,onHover:t.callbacks.current.onHover,onModeChange:t.callbacks.current.onModeChange,config:t.gestureConfig,mode:t.gestureMode,appContext:t.appContext,onGestureModeToggle:()=>t.setGestureMode(t.gestureMode==="navigation"?"asl":"navigation"),gestureActiveArea:{minX:.7,maxX:1,minY:0,maxY:1},onGestureState:t.setGestureState,onASLResult:t.setASLResult,onError:t.setCameraError,onDebugInfo:t.setDebugInfo,onLandmarkData:t.setLandmarkData,onPerformance:t.setPerformanceMetrics})}),$&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/95 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-5 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-slate-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-12 h-12 border-2 border-transparent border-b-emerald-500/50 rounded-full animate-spin",style:{animationDirection:"reverse",animationDuration:"1.5s"}})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:B||"Connecting to models..."}),Q>0&&e.jsxs("p",{className:"text-white/40 text-xs tabular-nums",children:["Attempt ",Q," of 8"]})]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 rounded-lg transition-all active:scale-95",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh Now"]})]})}),e.jsx(vs,{mode:u,setMode:tt,setHoveredCard:Ue,clearSelection:We,showDock:C,setShowDock:X,onOpenSettings:()=>me(!0),hasRightPanel:!0,gestureButtonSlot:e.jsx(s.Suspense,{fallback:null,children:e.jsx(cr,{inHeader:!0,appContext:u,onStopGeneration:()=>{if(u==="chat"&&Ee.current){Ee.current.stopGeneration();return}an()},onSendMessage:o=>{if(u==="chat"&&Ee.current){Ee.current.sendMessage(o,!0);return}const l=u==="compare"||u==="council"||u==="roundtable"||u==="personality"?p:[];l.length>0&&At(o,{},l)},onScroll:o=>{if(u==="chat"&&Ee.current){Ee.current.scroll(o);return}E.current=Pt(E.current+o),Dt()},onHover:(o,l)=>{const k=o*window.innerWidth,M=l*window.innerHeight,N=document.elementFromPoint(k,M);if(N){const O=N.closest("[data-gesture-mode-track]");if(O){const Se=O.getBoundingClientRect(),cn=k-Se.left,ht=Se.width,mt=Math.floor(cn/ht*5),Ot=["chat","compare","council","roundtable","personality"][Math.max(0,Math.min(4,mt))];Ot&&Ot!==u&&tt(Ot);return}const V=document.querySelector('[data-gesture-hovered="true"]'),K=N.closest('button, a, [role="button"], [data-clickable], .cursor-pointer, [onclick]')||N;K!==V?(V&&(V.removeAttribute("data-gesture-hovered"),V.dispatchEvent(new PointerEvent("pointerleave",{bubbles:!1,cancelable:!0})),V.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!1,cancelable:!0})),V.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0}))),K.setAttribute("data-gesture-hovered","true"),K.dispatchEvent(new PointerEvent("pointerenter",{bubbles:!1,cancelable:!0,clientX:k,clientY:M})),K.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:k,clientY:M})),K.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!1,cancelable:!0,clientX:k,clientY:M})),K.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,clientX:k,clientY:M}))):K===V&&(K.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:k,clientY:M})),K.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:k,clientY:M})))}},onPinch:(o,l)=>{const k=o*window.innerWidth,M=l*window.innerHeight,N=document.elementFromPoint(k,M);if(N){const O=Se=>{Se.dispatchEvent(new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:k,clientY:M,pointerId:1,pointerType:"touch",isPrimary:!0})),Se.dispatchEvent(new PointerEvent("pointerup",{bubbles:!0,cancelable:!0,clientX:k,clientY:M,pointerId:1,pointerType:"touch",isPrimary:!0})),Se.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:k,clientY:M})),Se.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:k,clientY:M})),Se.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:k,clientY:M}))},V=N.closest('button, a, [role="button"], [data-clickable], .cursor-pointer, [onclick]');O(V||N);const K=document.createElement("div");K.style.position="fixed",K.style.left=`${k}px`,K.style.top=`${M}px`,K.style.width="20px",K.style.height="20px",K.style.background="rgba(236, 72, 153, 0.5)",K.style.borderRadius="50%",K.style.transform="translate(-50%, -50%)",K.style.pointerEvents="none",K.style.zIndex="9999",document.body.appendChild(K),K.animate([{transform:"translate(-50%, -50%) scale(1)",opacity:1},{transform:"translate(-50%, -50%) scale(4)",opacity:0}],{duration:400}).onfinish=()=>K.remove()}},onModeChange:o=>{const l=["chat","compare","council","roundtable","personality"],k=l.indexOf(u);let M;o==="next"?M=(k+1)%l.length:M=(k-1+l.length)%l.length,tt(l[M])}})})}),e.jsxs("div",{style:{paddingLeft:He&&u==="compare"&&Me==="left"?"28rem":"1.5rem",paddingRight:He&&u==="compare"&&Me==="right"?"28rem":"0"},children:[C&&e.jsx("div",{className:"fixed inset-0 z-[55] bg-black/10 backdrop-blur-[1px] transition-opacity duration-300",onClick:()=>X(!1)}),e.jsx(gs,{showDock:C,availableModels:b,allSelectedByType:h,totalModelsByType:c,handleDragStart:Fe,handleModelToggle:vt,handleAddGroup:wn,dockRef:Le}),u==="chat"&&e.jsxs("div",{className:"flex h-screen w-full relative z-[10]",children:[e.jsx("div",{className:`flex-1 relative ${t.isActive?"":"px-2 sm:px-6"} pt-20 pb-6`,children:e.jsx(or,{children:e.jsx(s.Suspense,{fallback:e.jsxs("div",{className:"flex items-center justify-center h-full text-white/50 gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white/60 rounded-full animate-spin"}),"Loading..."]}),children:e.jsx(dr,{ref:Ee,models:n,selectedModelId:a,onSelectModel:v,githubToken:ae,onOpenTopics:()=>ne(!0),messages:je,setMessages:_e,autoMode:$e,setAutoMode:T,autoModeScope:D,setAutoModeScope:I,currentResponse:W,setCurrentResponse:R,isGenerating:P,setIsGenerating:L,onModelUsed:v,onGestureOptionsChange:x})})})}),t.isActive?e.jsx(s.Suspense,{fallback:null,children:e.jsx(pr,{content:y,onSelect:o=>{var l;(l=Ee.current)==null||l.sendMessage(o,!0)}})}):e.jsx("div",{className:"transcript-panel w-[400px] xl:w-[480px] flex flex-col border-l border-white/5 bg-slate-900/20 backdrop-blur-sm z-40 relative h-full",children:e.jsx(s.Suspense,{fallback:null,children:e.jsx(gn,{history:[],models:n,mode:u,onSelectPrompt:o=>{var l;(l=Ee.current)==null||l.setInput(o)},onNewSession:()=>_e([]),className:"pt-24 pb-6 mask-fade-top"})})})]}),u!=="chat"&&e.jsxs("div",{className:"flex h-screen w-full relative",children:[e.jsx("div",{className:"relative flex-1 transition-all duration-300 flex flex-col pt-24",children:e.jsx("div",{ref:we,onDragOver:le,onDragLeave:De,onDrop:vn,className:"relative w-full h-full z-10 transition-all duration-300",style:{position:"relative",display:"flex",alignItems:u==="compare"?"flex-start":"center",justifyContent:"center","--arena-offset-y":`${te.current}px`,transform:u==="council"||u==="roundtable"||u==="personality"?`translateY(calc(var(--arena-offset-y) - 50px)) scale(${re?1.02:1})`:`translateY(var(--arena-offset-y)) scale(${re?1.02:1})`,willChange:"transform",border:re?"2px dashed rgba(59, 130, 246, 0.4)":"2px dashed transparent",borderRadius:re?"24px":"0px",transition:"transform 0s linear",...u==="compare"?{minHeight:"300px",paddingBottom:"120px"}:u==="council"||u==="roundtable"||u==="personality"?{height:"100%",minHeight:"100%",overflow:"hidden"}:{height:"100%",minHeight:"100%",overflow:"hidden"},...re?{background:"rgba(59, 130, 246, 0.05)"}:{}},children:e.jsx(Fs,{mode:u,selectedModels:se,gridCols:z,speaking:wt,selectedCardIds:Ce,setSelectedCardIds:it,setActiveInspectorId:Ze,executionTimes:Je,failedModels:Wn,cardRefs:lt,handlePointerDown:Rn,dragState:In,handleModelToggle:vt,setContextMenu:Oe,suppressClickRef:et,getTailSnippet:Jn,hoveredCard:kn,setHoveredCard:Ue,layoutRadius:kt,getCirclePosition:ze,moderatorModel:Un,moderatorId:g,orchestratorTransform:Kn,orchestratorStatus:qn,orchestratorPhaseLabel:Vn,moderatorSynthesis:Ct,isSynthesizing:st,isGenerating:Ye,phaseLabel:Vt,linesTransitioning:J,lastSelectedCardRef:Mn,orchestratorAutoMode:Pn,orchestratorAutoScope:On,showOrchestratorMenu:Nt,setShowOrchestratorMenu:Tt,setOrchestratorAutoMode:Dn,setOrchestratorAutoScope:Bn,orchestratorMenuRef:_t,availableModels:b,setModerator:m,councilWinnerId:(ln=dt==null?void 0:dt[0])==null?void 0:ln.model_id})})}),e.jsx("div",{className:"transcript-panel w-[400px] xl:w-[480px] flex flex-col border-l border-white/5 bg-slate-900/20 backdrop-blur-sm z-40 relative h-full",children:e.jsx(s.Suspense,{fallback:null,children:e.jsx(gn,{history:j,models:n,mode:u,onSelectPrompt:o=>{Pe.current&&(Pe.current.value=o,Pe.current.focus())},onNewSession:$n,className:"pt-24 pb-6 mask-fade-top",phaseLabel:Vt,isGenerating:Ye,isSynthesizing:st,speakingCount:wt.size,totalParticipants:se.length})})})]})]}),e.jsx(tr,{rect:Tn}),He&&on.length>0&&e.jsx(s.Suspense,{fallback:null,children:e.jsx(ir,{models:on,activeId:He,onSelect:Ze,onClose:We,speaking:wt,mode:u,moderatorId:g,councilAggregateRankings:dt,councilAnonymousReviews:zn,showCouncilReviewerNames:ue,discussionTurnsByModel:Hn,position:Me,onTogglePosition:()=>Te(o=>o==="left"?"right":"left")})}),ve&&e.jsx("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-[200] animate-in slide-in-from-bottom-4 fade-in duration-300",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl bg-amber-500/10 border border-amber-500/30 backdrop-blur-md shadow-xl",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-400 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"text-sm text-amber-100",children:ve}),e.jsx("button",{onClick:()=>{xe(null),me(!0)},className:"ml-2 px-3 py-1 text-xs font-medium text-amber-900 bg-amber-400 hover:bg-amber-300 rounded-md transition-colors",children:"Open Settings"}),e.jsx("button",{onClick:()=>xe(null),className:"ml-1 p-1 text-amber-400/60 hover:text-amber-400 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx(s.Suspense,{fallback:null,children:e.jsx(ar,{open:ie,onClose:()=>me(!1),token:ae,setToken:ye,showCouncilReviewerNames:ue,setShowCouncilReviewerNames:Xe,bgStyle:ft,setBgStyle:Fn})}),e.jsx(s.Suspense,{fallback:null,children:e.jsx(lr,{open:Ne,onClose:()=>ne(!1),onSelectPrompt:_n})}),(u==="compare"||u==="council"||u==="roundtable"||u==="personality")&&e.jsx(bs,{inputRef:Pe,inputFocused:Sn,setInputFocused:Gt,onSendMessage:At,onOpenTopics:()=>ne(!0),isGenerating:Ye||st,onStop:an,placeholder:u==="compare"?void 0:u==="personality"?"Ask the personas...":"Steer the discussion...",className:"fixed bottom-0 left-0 right-[400px] xl:right-[480px] z-[100] pb-6 px-3 sm:px-4 flex justify-center items-end pointer-events-none transition-all duration-300",style:{paddingBottom:"calc(1.5rem + env(safe-area-inset-bottom))"}}),ke&&e.jsx("div",{className:"fixed bg-slate-800 border border-slate-700 rounded-lg shadow-xl py-1 z-[200] min-w-[160px]",style:{top:ke.y,left:ke.x},onClick:o=>o.stopPropagation(),children:ke.type==="background"?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{X(!0),Oe(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Model"]}):ke.modelId?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{Ze(ke.modelId),Oe(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Open"]}),u!=="compare"&&ke.modelId!==g&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{m(ke.modelId),Oe(null)},children:[e.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),"Set as Orchestrator"]}),e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-slate-700 transition-colors flex items-center gap-2",onClick:()=>{const o=ke.modelId===g;if(vt(ke.modelId),o&&u!=="compare"){const l=p.filter(k=>k!==ke.modelId);l.length>0?m(l[0]):m("")}Oe(null)},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})]}):null})]})}function mr(){return e.jsx(sr,{children:e.jsx(hr,{})})}as.createRoot(document.getElementById("root")).render(e.jsx(ls.StrictMode,{children:e.jsx(mr,{})}));export{xs as B,gt as C,jr as M,bs as P,tr as S,Yt as T,Cr as a,Mr as b,Ns as f,Sr as g,xt as s,rr as u};
